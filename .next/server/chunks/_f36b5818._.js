module.exports=[36741,e=>e.a(async(t,a)=>{try{var r=e.i(89171),o=e.i(30056),n=e.i(81504),i=e.i(28286),s=t([o]);[o]=s.then?(await s)():s;let d=new o.Pool({connectionString:process.env.DATABASE_URL});async function l(e,{params:t}){try{let{id:e}=await t,a=await d.query(`
      SELECT 
        po.*,
        b.name as branch_name,
        vp.name as supplier_name,
        vp.tin as supplier_tin,
        vp.physical_address as supplier_address,
        vp.phone as supplier_phone,
        tp.name as transporter_name,
        u.username as created_by_name,
        au.username as approved_by_name
      FROM purchase_orders po
      LEFT JOIN branches b ON po.branch_id = b.id
      LEFT JOIN vendor_partners vp ON po.supplier_id = vp.id
      LEFT JOIN vendor_partners tp ON po.transporter_id = tp.id
      LEFT JOIN users u ON po.created_by = u.id
      LEFT JOIN users au ON po.approved_by = au.id
      WHERE po.id = $1
    `,[e]);if(0===a.rows.length)return r.NextResponse.json({error:"Purchase order not found"},{status:404});let o=a.rows[0],s=(await d.query(`
      SELECT 
        poi.*,
        i.item_name
      FROM purchase_order_items poi
      LEFT JOIN items i ON poi.item_id = i.id
      WHERE poi.purchase_order_id = $1
      ORDER BY poi.created_at
    `,[e])).rows,l=(await d.query(`
      SELECT 
        poa.*,
        u.username as accepted_by_name
      FROM purchase_order_acceptances poa
      LEFT JOIN users u ON poa.accepted_by = u.id
      WHERE poa.purchase_order_id = $1
      ORDER BY poa.acceptance_timestamp DESC
      LIMIT 1
    `,[e])).rows[0]||null,p=[],c=[];l&&(p=(await d.query(`
        SELECT 
          ptr.*,
          t.tank_name
        FROM po_acceptance_tank_readings ptr
        LEFT JOIN tanks t ON ptr.tank_id = t.id
        WHERE ptr.acceptance_id = $1
      `,[l.id])).rows,c=(await d.query(`
        SELECT 
          pdr.*,
          d.dispenser_number
        FROM po_acceptance_dispenser_readings pdr
        LEFT JOIN dispensers d ON pdr.dispenser_id = d.id
        WHERE pdr.acceptance_id = $1
      `,[l.id])).rows);let u=new n.default,h=u.internal.pageSize.getWidth();u.setFontSize(20),u.setFont("helvetica","bold"),u.text("PURCHASE ORDER",h/2,20,{align:"center"}),u.setFontSize(14),u.text(o.po_number,h/2,28,{align:"center"}),u.setFontSize(10),u.setFont("helvetica","normal");let m=40,_=h/2+5;u.setFont("helvetica","bold"),u.text("Order Details",14,m),(o.transporter_name||o.vehicle_registration||o.driver_name)&&u.text("Transport Details",_,m),m+=6,u.setFont("helvetica","normal");let f=[["Branch:",o.branch_name||"N/A"],["Supplier:",o.supplier_name||"N/A"],["Supplier TIN:",o.supplier_tin||"N/A"],["Status:",`${o.status} / ${o.approval_status}`],["Issued:",o.issued_at?new Date(o.issued_at).toLocaleDateString():"N/A"],["Expected:",o.expected_delivery?new Date(o.expected_delivery).toLocaleDateString():"N/A"],["Created By:",o.created_by_name||"N/A"]];o.approved_by_name&&f.push(["Approved By:",o.approved_by_name]);let v=[];o.transporter_name&&v.push(["Transporter:",o.transporter_name]),o.vehicle_registration&&v.push(["Vehicle:",o.vehicle_registration]),o.driver_name&&v.push(["Driver:",o.driver_name]),o.driver_phone&&v.push(["Driver Phone:",o.driver_phone]),o.transport_cost&&v.push(["Transport Cost:",`KES ${parseFloat(o.transport_cost).toLocaleString()}`]);let g=Math.max(f.length,v.length);for(let e=0;e<g;e++)f[e]&&u.text(`${f[e][0]} ${f[e][1]}`,14,m),v[e]&&u.text(`${v[e][0]} ${v[e][1]}`,_,m),m+=5;m+=5,u.setFont("helvetica","bold"),u.text("Order Items",14,m),m+=4;let E=s.reduce((e,t)=>e+(parseFloat(t.quantity)||0),0),R=s.reduce((e,t)=>e+(parseFloat(t.total_amount)||0),0);if((0,i.default)(u,{startY:m,head:[["Item","Quantity (L)","Unit Price","Total"]],body:s.map(e=>[e.item_name||"Unknown Item",parseFloat(e.quantity).toLocaleString(),`KES ${parseFloat(e.unit_price).toLocaleString()}`,`KES ${parseFloat(e.total_amount).toLocaleString()}`]),foot:[["TOTAL",`${E.toLocaleString()} L`,"",`KES ${R.toLocaleString()}`]],theme:"striped",headStyles:{fillColor:[41,128,185]},footStyles:{fillColor:[236,240,241],textColor:[0,0,0],fontStyle:"bold"}}),m=u.lastAutoTable.finalY+10,l){m>240&&(u.addPage(),m=20),u.setFont("helvetica","bold"),u.setFontSize(12),u.text("DELIVERY ACCEPTANCE",14,m),m+=8,u.setFont("helvetica","normal"),u.setFontSize(10);let e=[["Accepted By:",l.accepted_by_name||"N/A"],["Acceptance Date:",l.acceptance_timestamp?new Date(l.acceptance_timestamp).toLocaleString():"N/A"],["Bowser Volume:",`${parseFloat(l.bowser_volume).toLocaleString()} L`],["Total Variance:",`${parseFloat(l.total_variance).toLocaleString()} L`]];l.dips_mm&&e.push(["Dips (mm):",l.dips_mm.toString()]),l.remarks&&e.push(["Remarks:",l.remarks]),e.forEach(([e,t])=>{u.text(`${e} ${t}`,14,m),m+=5}),p.length>0&&(m+=5,u.setFont("helvetica","bold"),u.text("Tank Readings",14,m),m+=4,(0,i.default)(u,{startY:m,head:[["Tank","Volume Before (L)","Volume After (L)","Received (L)"]],body:p.map(e=>[e.tank_name||"Unknown Tank",parseFloat(e.volume_before).toLocaleString(),parseFloat(e.volume_after).toLocaleString(),(parseFloat(e.volume_after)-parseFloat(e.volume_before)).toLocaleString()]),theme:"striped",headStyles:{fillColor:[39,174,96]}}),m=u.lastAutoTable.finalY+8),c.length>0&&(m>250&&(u.addPage(),m=20),u.setFont("helvetica","bold"),u.text("Dispenser Readings",14,m),m+=4,(0,i.default)(u,{startY:m,head:[["Dispenser","Meter Before","Meter After","Difference"]],body:c.map(e=>[`Dispenser ${e.dispenser_number}`,parseFloat(e.meter_reading_before).toLocaleString(),parseFloat(e.meter_reading_after).toLocaleString(),(parseFloat(e.meter_reading_after)-parseFloat(e.meter_reading_before)).toLocaleString()]),theme:"striped",headStyles:{fillColor:[155,89,182]}}),m=u.lastAutoTable.finalY+8),m>240&&(u.addPage(),m=20);let t=p.reduce((e,t)=>e+(parseFloat(t.volume_after)-parseFloat(t.volume_before)),0),a=c.reduce((e,t)=>e+(parseFloat(t.meter_reading_after)-parseFloat(t.meter_reading_before)),0),r=parseFloat(l.bowser_volume)||0,o=t+a-r;m+=5,u.setFont("helvetica","bold"),u.setFontSize(11),u.text("Variance Calculation",14,m),m+=6,u.setFont("helvetica","normal"),u.setFontSize(10),(0,i.default)(u,{startY:m,head:[["Description","Volume (L)"]],body:[["Tank Volume Increase (After - Before)",t.toLocaleString()],["Dispenser Difference (After - Before)",a.toLocaleString()],["Total Received (Tank + Dispenser)",(t+a).toLocaleString()],["Bowser Volume (Delivered)",r.toLocaleString()]],foot:[["VARIANCE (Received - Delivered)",`${o>=0?"+":""}${o.toLocaleString()} L`]],theme:"striped",headStyles:{fillColor:[231,76,60]},footStyles:{fillColor:o<0?[231,76,60]:[39,174,96],textColor:[255,255,255],fontStyle:"bold"}})}o.notes&&((m=u.lastAutoTable?.finalY+10||m+10)>270&&(u.addPage(),m=20),u.setFont("helvetica","bold"),u.text("Notes:",14,m),m+=5,u.setFont("helvetica","normal"),u.text(o.notes,14,m,{maxWidth:h-28}));let S=u.getNumberOfPages();for(let e=1;e<=S;e++)u.setPage(e),u.setFontSize(8),u.setFont("helvetica","normal"),u.text(`Generated on ${new Date().toLocaleString()} | Page ${e} of ${S}`,h/2,u.internal.pageSize.getHeight()-10,{align:"center"});let b=u.output("arraybuffer");return new r.NextResponse(b,{status:200,headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${o.po_number}.pdf"`}})}catch(e){return console.error("Error generating PDF:",e),r.NextResponse.json({error:"Failed to generate PDF"},{status:500})}}e.s(["GET",()=>l]),a()}catch(e){a(e)}},!1),43129,e=>e.a(async(t,a)=>{try{var r=e.i(47909),o=e.i(74017),n=e.i(96250),i=e.i(59756),s=e.i(61916),l=e.i(14444),d=e.i(37092),p=e.i(69741),c=e.i(16795),u=e.i(87718),h=e.i(95169),m=e.i(47587),_=e.i(66012),f=e.i(70101),v=e.i(26937),g=e.i(10372),E=e.i(93695);e.i(52474);var R=e.i(220),S=e.i(36741),b=t([S]);[S]=b.then?(await b)():b;let w=new r.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/headquarters/purchase-orders/[id]/pdf/route",pathname:"/api/headquarters/purchase-orders/[id]/pdf",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/headquarters/purchase-orders/[id]/pdf/route.ts",nextConfigOutput:"standalone",userland:S}),{workAsyncStorage:T,workUnitAsyncStorage:C,serverHooks:A}=w;function y(){return(0,n.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:C})}async function F(e,t,a){w.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/headquarters/purchase-orders/[id]/pdf/route";r=r.replace(/\/index$/,"")||"/";let n=await w.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:S,params:b,nextConfig:y,parsedUrl:F,isDraftMode:T,prerenderManifest:C,routerServerContext:A,isOnDemandRevalidate:N,revalidateOnlyGenerated:x,resolvedPathname:L,clientReferenceManifest:O,serverActionsManifest:D}=n,P=(0,p.normalizeAppPath)(r),$=!!(C.dynamicRoutes[P]||C.routes[L]),I=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,F,!1):t.end("This page could not be found"),null);if($&&!T){let e=!!C.routes[L],t=C.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await I();throw new E.NoFallbackError}}let k=null;!$||w.isDev||T||(k=L,k="/index"===k?"/":k);let q=!0===w.isDev||!$,M=$&&!q;D&&O&&(0,l.setReferenceManifestsSingleton)({page:r,clientReferenceManifest:O,serverActionsManifest:D,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:D})});let H=e.method||"GET",U=(0,s.getTracer)(),B=U.getActiveScopeSpan(),V={params:b,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>w.onRequestError(e,t,r,A)},sharedContext:{buildId:S}},K=new c.NodeNextRequest(e),z=new c.NodeNextResponse(t),Y=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let n=async e=>w.handle(Y,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=U.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=a.get("next.route");if(o){let t=`${H} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${r}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let p=async({previousCacheEntry:o})=>{try{if(!l&&N&&x&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await n(i);e.fetchMetrics=V.renderOpts.fetchMetrics;let s=V.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let d=V.renderOpts.collectedTags;if(!$)return await (0,_.sendResponse)(K,z,r,V.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(r.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,o=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:o}}}}catch(t){throw(null==o?void 0:o.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:N})},A),t}},c=await w.handleResponse({req:e,nextConfig:y,cacheKey:k,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:x,responseGenerator:p,waitUntil:a.waitUntil,isMinimalMode:l});if(!$)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",N?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&$||u.delete(g.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,_.sendResponse)(K,z,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};B?await d(B):await U.withPropagatedContext(e.headers,()=>U.trace(h.BaseServerSpan.handleRequest,{spanName:`${H} ${r}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof E.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:N})}),$)throw t;return await (0,_.sendResponse)(K,z,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>y,"routeModule",()=>w,"serverHooks",()=>A,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>C]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=_f36b5818._.js.map