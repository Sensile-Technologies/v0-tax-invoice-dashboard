{"version":3,"sources":["../../../lib/db/client.ts","../../../lib/db/index.ts","../../../lib/kra-url-helper.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n","export * from './client';\n","export function buildKraBaseUrl(\n  serverAddress: string | null | undefined,\n  serverPort: string | null | undefined\n): string {\n  const DEFAULT_SERVER = '5.189.171.160'\n  const DEFAULT_PORT = '8088'\n  \n  if (!serverAddress) {\n    return `http://${DEFAULT_SERVER}:${serverPort || DEFAULT_PORT}`\n  }\n  \n  let address = serverAddress.trim()\n  \n  const hasScheme = /^https?:\\/\\//i.test(address)\n  if (hasScheme) {\n    address = address.replace(/^https?:\\/\\//i, '')\n  }\n  \n  address = address.replace(/\\/+$/, '')\n  \n  const hasPort = /:\\d+$/.test(address)\n  \n  if (hasPort) {\n    return `http://${address}`\n  }\n  \n  return `http://${address}:${serverPort || DEFAULT_PORT}`\n}\n"],"names":[],"mappings":"6kCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,yCAEA,IAAM,EAAO,IAAI,EAAA,IAAI,CAAC,CACpB,iBAAkB,QAAQ,GAAG,CAAC,YAAY,CAC1C,IAA6C,CAAE,AAA1C,mBAA8D,EAAM,CAC3E,GAD+E,AAGxE,eAAe,EAAe,CAAY,CAAE,CAAc,EAC/D,IAAM,EAAS,MAAM,EAAK,OAAO,GACjC,GAAI,CAEF,MAAO,CADQ,MAAM,EAAO,KAAK,CAAC,EAAM,EAAA,EAC1B,IAAI,AACpB,QAAU,CACR,EAAO,OAAO,EAChB,CACF,CAiBO,eAAe,IACpB,OAAO,MAAM,EAAK,OAAO,EAC3B,2GClCA,IAAA,EAAA,EAAA,CAAA,CAAA,gGCAO,SAAS,EACd,CAAwC,CACxC,CAAqC,EAGrC,IAAM,EAAe,OAErB,GAAI,CAAC,EACH,MAAO,CAAC,MADU,CACH,EAAE,cAAkB,CAAH,CAAC,CAAgB,GAAc,CAGjE,IAAI,EAAU,EAAc,IAAI,SAWhC,CATkB,AACd,GAQA,QARW,CAQF,IATqB,IAAI,CAAC,KAErC,EAAU,EAAQ,OAAO,CAAC,gBAAiB,GAAA,EAG7C,EAAU,EAAQ,OAAO,CAAC,OAAQ,IAElB,QAAQ,IAAI,CAAC,IAGpB,CAAC,OAAO,EAAE,EAAA,CAAS,CAGrB,CAAC,OAAO,EAAE,EAAQ,CAAC,EAAE,GAAc,EAAA,CAAc,AAC1D"}