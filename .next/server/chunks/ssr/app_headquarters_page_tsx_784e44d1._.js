module.exports=[79537,a=>{"use strict";var b=a.i(87924),c=a.i(69265),d=a.i(40695),e=a.i(54161),f=a.i(24569),g=a.i(3314),h=a.i(67453),i=a.i(67900),j=a.i(24669),k=a.i(60246),l=a.i(38784),m=a.i(15618),n=a.i(5784),o=a.i(83497),p=a.i(73320),q=a.i(90166),r=a.i(99385),s=a.i(4720),t=a.i(72131),u=a.i(3130),v=a.i(65733),w=a.i(5522),x=a.i(17171),y=a.i(76504),z=a.i(87682),A=a.i(50944),B=a.i(84505),C=a.i(96221),D=a.i(95117),E=a.i(23292);function F({open:a,onOpenChange:c}){let[e,f]=(0,t.useState)(!1),[g,h]=(0,t.useState)(null),[i,j]=(0,t.useState)([]);(0,t.useEffect)(()=>{a&&k()},[a]);let k=async()=>{try{let a=await fetch("/api/branches?status=active"),b=await a.json();b.success?j(b.data||[]):(console.error("Error fetching branches:",b.error),E.toast.error("Failed to fetch branches"))}catch(a){console.error("Error fetching branches:",a),E.toast.error("Failed to fetch branches")}},l=async()=>{if(!g)return void E.toast.error("Please select a file to upload");f(!0);try{let a=new FormData;a.append("file",g),a.append("branchId","global");let b=await fetch("/api/shifts/close-excel",{method:"POST",body:a}),d=await b.json();if(!b.ok)throw Error(d.error||"Upload failed");E.toast.success(`Successfully closed shifts for ${d.results?.length||0} branches`),d.errors&&d.errors.length>0&&E.toast.warning(`Some errors occurred: ${d.errors.join(", ")}`),h(null),c(!1)}catch(a){console.error("Upload error:",a),E.toast.error(a instanceof Error?a.message:"Failed to close shifts")}finally{f(!1)}};return(0,b.jsx)(v.Dialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(v.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsx)(v.DialogHeader,{children:(0,b.jsx)(v.DialogTitle,{children:"Global Shift Management - Close All Branch Shifts"})}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{children:"Step 1: Download Global Template"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Download the Excel template with separate sheets for each branch. Each sheet contains the branch name in the first row."}),(0,b.jsxs)(d.Button,{onClick:()=>{0===i.length?E.toast.error("No active branches found"):((0,D.generateGlobalShiftCloseTemplate)(i),E.toast.success("Global template downloaded successfully"))},variant:"outline",className:"w-full bg-transparent",disabled:0===i.length,children:[(0,b.jsx)(B.Download,{className:"mr-2 h-4 w-4"}),"Download Global Shift Close Template (",i.length," branches)"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{children:"Step 2: Fill Template & Upload"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fill in the meter readings and tank volumes for each branch, then upload to close all shifts at once."}),(0,b.jsx)(w.Input,{type:"file",accept:".xlsx,.xls",onChange:a=>{let b=a.target.files?.[0];b&&h(b)},className:"cursor-pointer"}),g&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Selected: ",g.name]})]}),(0,b.jsx)(d.Button,{onClick:l,disabled:!g||e,className:"w-full",children:e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Closing All Shifts..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Upload,{className:"mr-2 h-4 w-4"}),"Upload & Close All Shifts"]})})]})]})})}var G=a.i(74575),H=a.i(90023);function I(){let a=(0,A.useRouter)(),[B,C]=(0,t.useState)(!1),[D,E]=(0,t.useState)(!1),[I,J]=(0,t.useState)(!1),[K,L]=(0,t.useState)(null),[M,N]=(0,t.useState)(!1),[O,P]=(0,t.useState)(!1),[Q,R]=(0,t.useState)(null),[S,T]=(0,t.useState)([]),[U,V]=(0,t.useState)(!0),[W,X]=(0,t.useState)(!1),{formatCurrency:Y}=(0,G.useCurrency)();(0,t.useEffect)(()=>{Z()},[]);let Z=async()=>{try{V(!0);let a=(0,H.getCurrentUser)(),b=a?.id,c=b?`/api/branches/list?user_id=${b}`:"/api/branches/list",d=await fetch(c);if(d.ok){let a=(await d.json()).map(a=>({id:a.id,name:a.name,location:a.location,status:a.status.charAt(0).toUpperCase()+a.status.slice(1),revenue:a.monthly_revenue||425e4,monthToDateRevenue:a.mtd_revenue||245e4,currentShiftRevenue:a.current_shift_revenue||145e3,transactions:a.transactions||1245,inventory:a.inventory||342,performance:a.performance||"+12.5%",gradient:"from-blue-600 via-blue-500 to-cyan-400",manager:a.manager,phone:a.phone,email:a.email,bhfId:a.bhf_id,tankConfig:a.tank_config||{},storageIndices:a.storage_indices||[],device_token:a.device_token}));T(a)}else console.error("Failed to fetch branches:",d.status)}catch(a){console.error("Error fetching branches:",a)}finally{V(!1)}},$=async()=>{if(Q)try{let a=new FormData;a.append("file",Q),(await fetch("/api/global-uploads",{method:"POST",body:a})).ok?(alert("File uploaded successfully!"),P(!1),R(null)):alert("Failed to upload file")}catch(a){console.error("Upload error:",a),alert("Error uploading file")}},[_,aa]=(0,t.useState)({name:"",location:"",manager:"",phone:"",email:"",address:"",county:"",localTaxOffice:"",hardwareType:"",serialNumber:"",storageIndices:[],newStorageIndex:"",tankConfig:{}}),ab=S.reduce((a,b)=>a+b.revenue,0),ac=S.reduce((a,b)=>a+b.transactions,0),ad=S.reduce((a,b)=>a+b.inventory,0),ae=async()=>{if(!_.name||!_.location||!_.county||!_.localTaxOffice)return void alert("Please fill in all required fields (Branch Name, Location, County, Local Tax Office)");N(!0);try{let a=await fetch("/api/branches",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:_.name,location:_.location,manager:_.manager,email:_.email,phone:_.phone,status:"active",storage_indices:_.storageIndices,county:_.county,address:_.address,local_tax_office:_.localTaxOffice})}),b=await a.json();if(!b.success){console.error("[v0] Branch creation error:",b.error),alert(`Branch creation failed: ${b.error}`),N(!1);return}console.log("[v0] Branch created:",b.data);let c=b.data,d=new Map,e=[];Object.entries(_.tankConfig).forEach(([a,b])=>{let f=b.fuelType||"Petrol";e.push({branch_id:c.id,tank_name:a,fuel_type:f,capacity:Number.parseFloat(b.tankCapacity||"0"),current_stock:Number.parseFloat(b.initialStock||"0"),status:"active"}),b.dispensers.forEach(a=>{let b=Number.parseInt(a.replace(/\D/g,""))||d.size+1;d.has(b)||d.set(b,new Set),d.get(b).add(f)})});let f=Array.from(d.entries()).map(([a,b])=>({branch_id:c.id,dispenser_number:a,fuel_type:Array.from(b)[0],status:"active"}));if(e.length>0){for(let a of e)await fetch("/api/tanks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});console.log("[v0] Tanks created:",e)}let g=0;if(f.length>0){console.log("[v0] Creating dispensers:",{dispensersToCreate:f});let a=[];for(let b of f){let c=await fetch("/api/dispensers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),d=await c.json();d.success&&a.push(d.data)}console.log("[v0] Dispensers created:",a);let b=[];if(a.forEach(a=>{let e=d.get(a.dispenser_number);if(e){let d=1;e.forEach(e=>{b.push({branch_id:c.id,dispenser_id:a.id,nozzle_number:d++,fuel_type:e,initial_meter_reading:0,status:"active"})})}}),b.length>0){for(let a of(console.log("[v0] Creating nozzles:",{nozzlesToCreate:b}),b))await fetch("/api/nozzles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});g=b.length}}try{let a=await fetch("/api/branches/register-backend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchId:c.id,name:_.name,location:_.location,county:_.county,address:_.address,organization:process.env.NEXT_PUBLIC_ORGANIZATION_ID})}),b=await a.json();a.ok&&b.success?alert(`Branch "${_.name}" created successfully!
Local database entry created
${e.length} tank(s) created
${f.length} dispenser(s) created
${g} nozzle(s) created
Backend registration completed`):alert(`Branch "${_.name}" created successfully!
Local database entry created
${e.length} tank(s) created
${f.length} dispenser(s) created
${g} nozzle(s) created
Backend registration failed (can be retried later)`)}catch(a){console.log("[v0] Backend registration failed:",a),alert(`Branch "${_.name}" created successfully!
Local database entry created
${e.length} tank(s) created
${f.length} dispenser(s) created
${g} nozzle(s) created
Backend registration unavailable (can be retried later)`)}C(!1),aa({name:"",location:"",manager:"",email:"",phone:"",address:"",county:"",localTaxOffice:"",hardwareType:"",serialNumber:"",storageIndices:[],newStorageIndex:"",tankConfig:{}}),await Z()}catch(a){console.error("Error creating branch:",a),alert(`Branch creation failed: ${a.message||"Unknown error"}`)}finally{N(!1)}},af=a=>{console.log("[v0] Opening edit dialog for branch:",a),L(S.find(b=>b.id===a.id)||a),aa({name:a.name||"",location:a.location||"",manager:a.manager||"",email:a.email||"",phone:a.phone||"",address:a.address||"",county:a.county||"",localTaxOffice:a.local_tax_office||"",hardwareType:"",serialNumber:"",storageIndices:a.storage_indices||[],newStorageIndex:"",tankConfig:a.tank_config||{}}),E(!0)},ag=async()=>{if(K){if(console.log("[v0] Updating branch:",K.id,_),!_.name||!_.location||!_.county||!_.localTaxOffice)return void alert("Please fill in all required fields (Branch Name, Location, County, Local Tax Office)");try{let a=await fetch(`/api/branches/${K.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:_.name,location:_.location,manager:_.manager,email:_.email,phone:_.phone,address:_.address,county:_.county,localTaxOffice:_.localTaxOffice,storageIndices:_.storageIndices,tankConfig:_.tankConfig})});if(a.ok)alert("Branch updated successfully!"),E(!1),L(null),await Z();else{let b=await a.json();console.error("Update error:",b),alert(`Failed to update branch: ${b.error||"Unknown error"}`)}}catch(a){console.error("Error updating branch:",a),alert("Error updating branch. Please try again.")}}},ah=async(a,b)=>{if(confirm(`Are you sure you want to delete the branch "${b}"? This action cannot be undone.`))try{let c=await fetch(`/api/branches/${a}`,{method:"DELETE"});if(c.ok)alert(`Branch "${b}" deleted successfully!`),await Z();else{let a=await c.json();console.error("Delete error:",a),alert(`Failed to delete branch: ${a.error||"Unknown error"}`)}}catch(a){console.error("Error deleting branch:",a),alert("Error deleting branch. Please try again.")}};return(0,b.jsxs)("div",{className:"flex h-screen flex-col overflow-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,b.jsx)(c.DashboardHeader,{currentBranch:"hq"}),(0,b.jsxs)("main",{className:"flex-1 overflow-y-auto p-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-balance text-white",children:"Headquarters Overview"}),(0,b.jsx)("p",{className:"mt-1 text-white/80 text-pretty",children:"Monitor all branches and organization performance"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(y.DropdownMenu,{children:[(0,b.jsx)(y.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"outline",className:"rounded-xl bg-white hover:bg-gray-50",children:[(0,b.jsx)(i.Building2,{className:"mr-2 h-4 w-4"}),"Branches",(0,b.jsx)(n.ChevronDown,{className:"ml-2 h-4 w-4"})]})}),(0,b.jsxs)(y.DropdownMenuContent,{align:"end",className:"w-56 rounded-xl",children:[(0,b.jsxs)(y.DropdownMenuItem,{onSelect:()=>C(!0),className:"cursor-pointer rounded-lg",children:[(0,b.jsx)(m.Plus,{className:"mr-2 h-4 w-4"}),"Create Branch"]}),(0,b.jsxs)(y.DropdownMenuSub,{children:[(0,b.jsxs)(y.DropdownMenuSubTrigger,{className:"cursor-pointer rounded-lg",children:[(0,b.jsx)(f.Edit,{className:"mr-2 h-4 w-4"}),"Edit Branch Details"]}),(0,b.jsx)(y.DropdownMenuSubContent,{className:"rounded-xl",children:S.map(a=>(0,b.jsx)(y.DropdownMenuItem,{onSelect:()=>af(a),className:"cursor-pointer rounded-lg",children:a.name},a.id))})]}),(0,b.jsxs)(y.DropdownMenuItem,{onSelect:()=>a.push("/headquarters/inventory"),className:"cursor-pointer rounded-lg",children:[(0,b.jsx)(o.Package,{className:"mr-2 h-4 w-4"}),"Inventory"]}),(0,b.jsxs)(y.DropdownMenuItem,{onSelect:()=>P(!0),className:"cursor-pointer rounded-lg",children:[(0,b.jsx)(p.Upload,{className:"mr-2 h-4 w-4"}),"Global Uploads"]})]})]}),(0,b.jsxs)(y.DropdownMenu,{children:[(0,b.jsx)(y.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"outline",className:"gap-2 rounded-xl bg-white hover:bg-gray-50",children:[(0,b.jsx)(k.Users,{className:"h-4 w-4"}),"Users",(0,b.jsx)(n.ChevronDown,{className:"h-4 w-4"})]})}),(0,b.jsxs)(y.DropdownMenuContent,{align:"end",className:"w-56 rounded-xl",children:[(0,b.jsx)(y.DropdownMenuItem,{asChild:!0,className:"cursor-pointer rounded-lg",children:(0,b.jsxs)("a",{href:"/headquarters/staff-management",className:"flex items-center gap-2",children:[(0,b.jsx)(k.Users,{className:"h-4 w-4"}),"Staff Management"]})}),(0,b.jsx)(y.DropdownMenuItem,{asChild:!0,className:"cursor-pointer rounded-lg",children:(0,b.jsxs)("a",{href:"/headquarters/roles",className:"flex items-center gap-2",children:[(0,b.jsx)(g.Shield,{className:"h-4 w-4"}),"Roles & Permissions"]})}),(0,b.jsx)(y.DropdownMenuItem,{asChild:!0,className:"cursor-pointer rounded-lg",children:(0,b.jsxs)("a",{href:"/headquarters/approvals",className:"flex items-center gap-2",children:[(0,b.jsx)(h.CheckCircle2,{className:"h-4 w-4"}),"Approval Workflows"]})})]})]}),(0,b.jsxs)(y.DropdownMenu,{children:[(0,b.jsx)(y.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"outline",className:"rounded-xl bg-white hover:bg-gray-50",children:[(0,b.jsx)(r.Clock,{className:"mr-2 h-4 w-4"}),"Shift Management",(0,b.jsx)(n.ChevronDown,{className:"ml-2 h-4 w-4"})]})}),(0,b.jsxs)(y.DropdownMenuContent,{align:"end",className:"w-56 rounded-xl",children:[(0,b.jsxs)(y.DropdownMenuItem,{onSelect:()=>X(!0),className:"cursor-pointer rounded-lg",children:[(0,b.jsx)(p.Upload,{className:"mr-2 h-4 w-4"}),"Global Shift Upload"]}),(0,b.jsx)(y.DropdownMenuItem,{asChild:!0,className:"cursor-pointer rounded-lg",children:(0,b.jsxs)("a",{href:"/reports/shifts",children:[(0,b.jsx)(s.FileText,{className:"mr-2 h-4 w-4"}),"View Shift Reports"]})})]})]})]})]}),(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4 text-white",children:"Organization Summary"}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)(u.Card,{className:"rounded-2xl",children:[(0,b.jsx)(u.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(u.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-blue-100",children:(0,b.jsx)(o.Package,{className:"h-5 w-5 text-blue-600"})})]})}),(0,b.jsxs)(u.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:Y(ab)}),(0,b.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"+10.8% from last month"})]})]}),(0,b.jsxs)(u.Card,{className:"rounded-2xl",children:[(0,b.jsx)(u.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(u.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Transactions"}),(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-purple-100",children:(0,b.jsx)(l.ShoppingCart,{className:"h-5 w-5 text-purple-600"})})]})}),(0,b.jsxs)(u.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:ac.toLocaleString()}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Across all branches"})]})]}),(0,b.jsxs)(u.Card,{className:"rounded-2xl",children:[(0,b.jsx)(u.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(u.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Total Employees"}),(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-orange-100",children:(0,b.jsx)(k.Users,{className:"h-5 w-5 text-orange-600"})})]})}),(0,b.jsxs)(u.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:S.length}),(0,b.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["In ",S.length," branches"]})]})]}),(0,b.jsxs)(u.Card,{className:"rounded-2xl",children:[(0,b.jsx)(u.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(u.CardTitle,{className:"text-sm font-medium text-gray-600",children:"Inventory Items"}),(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-green-100",children:(0,b.jsx)(o.Package,{className:"h-5 w-5 text-green-600"})})]})}),(0,b.jsxs)(u.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:ad}),(0,b.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"+7.3% stock increase"})]})]})]})]}),(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4 text-white",children:"Performance Analytics"}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,b.jsxs)(u.Card,{className:"rounded-2xl",children:[(0,b.jsxs)(u.CardHeader,{children:[(0,b.jsx)(u.CardTitle,{children:"Organization Revenue Trend"}),(0,b.jsx)(u.CardDescription,{children:"Monthly revenue across all branches"})]}),(0,b.jsx)(u.CardContent,{className:"px-2",children:(0,b.jsx)("div",{className:"h-[300px] w-full",children:(0,b.jsx)("div",{className:"h-full w-full"})})})]}),(0,b.jsxs)(u.Card,{className:"rounded-2xl",children:[(0,b.jsxs)(u.CardHeader,{children:[(0,b.jsx)(u.CardTitle,{children:"Branch Performance Comparison"}),(0,b.jsx)(u.CardDescription,{children:"Sales vs Purchases by branch"})]}),(0,b.jsx)(u.CardContent,{className:"px-2",children:(0,b.jsx)("div",{className:"h-[300px] w-full",children:(0,b.jsx)("div",{className:"h-full w-full"})})})]})]})]}),U?(0,b.jsx)("div",{className:"text-center py-12 text-white",children:(0,b.jsx)("p",{children:"Loading branches..."})}):0===S.length?(0,b.jsx)("div",{className:"text-center py-12 text-white",children:(0,b.jsx)("p",{children:"No branches found. Create your first branch to get started."})}):(0,b.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:S.map(c=>(0,b.jsxs)(u.Card,{onClick:()=>{var b;"hq"===(b=c.id)?a.push("/headquarters"):a.push(`/sales?branch=${b}`)},className:"rounded-2xl hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden group hover:scale-105",children:[(0,b.jsx)("div",{className:`h-3 bg-gradient-to-r ${c.gradient}`}),(0,b.jsx)(u.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)("div",{className:`flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br ${c.gradient} shadow-lg`,children:(0,b.jsx)(i.Building2,{className:"h-6 w-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(u.CardTitle,{className:"group-hover:text-blue-600 transition-colors text-base",children:c.name}),(0,b.jsx)(u.CardDescription,{className:"text-xs",children:c.location})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`rounded-full text-xs px-2 py-1 ${"active"===c.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c.status}),(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:a=>{a.stopPropagation(),af(c)},children:(0,b.jsx)(f.Edit,{className:"h-4 w-4"})})]})]})}),(0,b.jsx)(u.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-gray-600 text-xs",children:[(0,b.jsx)(o.Package,{className:"h-3 w-3"}),"MTD Revenue"]}),(0,b.jsx)("div",{className:"font-semibold text-sm",children:Y(c.monthToDateRevenue)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-gray-600 text-xs",children:[(0,b.jsx)(q.DollarSign,{className:"h-3 w-3"})," ","Current Shift"]}),(0,b.jsx)("div",{className:"font-semibold text-sm",children:Y(c.currentShiftRevenue)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-gray-600 text-xs",children:[(0,b.jsx)(j.TrendingUp,{className:"h-3 w-3"}),"Growth"]}),(0,b.jsx)("div",{className:"font-semibold text-sm text-green-600",children:c.performance})]})]})})]},c.id))})]}),(0,b.jsxs)(v.Dialog,{open:B,onOpenChange:C,children:[(0,b.jsx)(v.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{onClick:()=>{aa({name:"",location:"",manager:"",email:"",phone:"",address:"",county:"",localTaxOffice:"",hardwareType:"",serialNumber:"",storageIndices:[],newStorageIndex:"",tankConfig:{}}),C(!0)},size:"lg",className:"rounded-xl shadow-lg",children:[(0,b.jsx)(m.Plus,{className:"h-5 w-5 mr-2"}),"Create New Branch"]})}),(0,b.jsxs)(v.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto rounded-2xl",children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{className:"text-2xl",children:"Create New Branch"}),(0,b.jsx)(v.DialogDescription,{children:"Fill in the details to create a new branch location with device initialization"})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Branch Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"branch-name",children:"Branch Name *"}),(0,b.jsx)(w.Input,{id:"branch-name",placeholder:"e.g., Mombasa Branch",value:_.name,onChange:a=>aa({..._,name:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"location",children:"Location *"}),(0,b.jsx)(w.Input,{id:"location",placeholder:"e.g., Mombasa, Kenya",value:_.location,onChange:a=>aa({..._,location:a.target.value}),className:"rounded-xl"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"address",children:"Physical Address"}),(0,b.jsx)(w.Input,{id:"address",placeholder:"Street address, building, floor",value:_.address,onChange:a=>aa({..._,address:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"county",children:"County *"}),(0,b.jsx)(w.Input,{id:"county",placeholder:"e.g., Mombasa",value:_.county,onChange:a=>aa({..._,county:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"tax-office",children:"Local Tax Office *"}),(0,b.jsx)(w.Input,{id:"tax-office",placeholder:"e.g., Mombasa Tax Office",value:_.localTaxOffice,onChange:a=>aa({..._,localTaxOffice:a.target.value}),className:"rounded-xl"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Staff Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"manager",children:"Branch Manager"}),(0,b.jsx)(w.Input,{id:"manager",placeholder:"Manager name",value:_.manager,onChange:a=>aa({..._,manager:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(w.Input,{id:"email",type:"email",placeholder:"branch@flow360.com",value:_.email,onChange:a=>aa({..._,email:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"phone",children:"Phone Number"}),(0,b.jsx)(w.Input,{id:"phone",type:"tel",placeholder:"+254...",value:_.phone,onChange:a=>aa({..._,phone:a.target.value}),className:"rounded-xl"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Hardware Assignment"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"hardware-type",children:"Hardware Type"}),(0,b.jsxs)(z.Select,{value:_.hardwareType,onValueChange:a=>aa({..._,hardwareType:a}),children:[(0,b.jsx)(z.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select hardware type"})}),(0,b.jsxs)(z.SelectContent,{className:"rounded-xl",children:[(0,b.jsx)(z.SelectItem,{value:"Controller",children:"Controller"}),(0,b.jsx)(z.SelectItem,{value:"MiniPC",children:"Mini PC"}),(0,b.jsx)(z.SelectItem,{value:"POS",children:"POS"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"serial-number",children:"Serial Number"}),(0,b.jsx)(w.Input,{id:"serial-number",placeholder:"e.g., SN-12345",value:_.serialNumber,onChange:a=>aa({..._,serialNumber:a.target.value}),className:"rounded-xl"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Storage Indices"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Configure unique storage locations for this branch (e.g., Tank, Warehouse, Cold Storage)"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(z.Select,{value:_.newStorageIndex,onValueChange:a=>aa({..._,newStorageIndex:a}),children:[(0,b.jsx)(z.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select storage type"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"Tank",children:"Tank"}),(0,b.jsx)(z.SelectItem,{value:"Warehouse",children:"Warehouse"}),(0,b.jsx)(z.SelectItem,{value:"Cold Storage",children:"Cold Storage"}),(0,b.jsx)(z.SelectItem,{value:"Dry Storage",children:"Dry Storage"})]})]}),(0,b.jsx)(w.Input,{placeholder:"e.g., Tank 1",value:_.newStorageIndex&&_.newStorageIndex.split(" ")[1]||"",onChange:a=>{let b=_.newStorageIndex&&_.newStorageIndex.split(" ")[0]||"";aa({..._,newStorageIndex:`${b} ${a.target.value}`})},className:"rounded-xl"}),(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>{if(_.newStorageIndex.trim()){let a=_.newStorageIndex.trim();a.toLowerCase().includes("tank")?aa({..._,storageIndices:[..._.storageIndices,a],tankConfig:{..._.tankConfig,[a]:{dispensers:[],initialStock:"",fuelType:"Petrol",tankCapacity:""}},newStorageIndex:""}):aa({..._,storageIndices:[..._.storageIndices,a],newStorageIndex:""})}},className:"rounded-xl",children:"Add"})]}),_.storageIndices.length>0&&(0,b.jsx)("div",{className:"space-y-4 mt-4",children:_.storageIndices.map((a,c)=>(0,b.jsxs)("div",{className:"border rounded-xl p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(e.Badge,{variant:"secondary",className:"rounded-lg",children:a}),(0,b.jsx)("button",{type:"button",onClick:()=>{let b={..._.tankConfig};delete b[a],aa({..._,storageIndices:_.storageIndices.filter((a,b)=>b!==c),tankConfig:b})},className:"text-sm text-destructive hover:underline",children:"Remove"})]}),a.toLowerCase().includes("tank")&&(0,b.jsxs)("div",{className:"space-y-4 bg-muted/50 p-3 rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{children:"Fuel Type"}),(0,b.jsxs)(z.Select,{value:_.tankConfig[a]?.fuelType||"Petrol",onValueChange:b=>{let c=_.tankConfig[a]||{dispensers:[],initialStock:"",fuelType:"Petrol",tankCapacity:""};aa({..._,tankConfig:{..._.tankConfig,[a]:{...c,fuelType:b}}})},children:[(0,b.jsx)(z.SelectTrigger,{children:(0,b.jsx)(z.SelectValue,{placeholder:"Select fuel type"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"Petrol",children:"Petrol"}),(0,b.jsx)(z.SelectItem,{value:"Diesel",children:"Diesel"}),(0,b.jsx)(z.SelectItem,{value:"Kerosene",children:"Kerosene"}),(0,b.jsx)(z.SelectItem,{value:"Super",children:"Super"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:`tank-capacity-${c}`,children:"Tank Capacity (Litres) *"}),(0,b.jsx)(w.Input,{id:`tank-capacity-${c}`,type:"number",placeholder:"e.g., 10000",value:_.tankConfig[a]?.tankCapacity||"",onChange:b=>{let c=_.tankConfig[a]||{dispensers:[],initialStock:"",fuelType:"Petrol",tankCapacity:""};aa({..._,tankConfig:{..._.tankConfig,[a]:{...c,tankCapacity:b.target.value}}})},className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{children:"Dispensers Served by This Tank *"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(w.Input,{placeholder:"e.g., Dispenser 01",id:`new-dispenser-${a}`,className:"rounded-xl"}),(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>{let b=document.getElementById(`new-dispenser-${a}`),c=b?.value?.trim();if(c){let d=_.tankConfig[a]||{dispensers:[],initialStock:"",fuelType:"Petrol",tankCapacity:""};aa({..._,tankConfig:{..._.tankConfig,[a]:{...d,dispensers:[...d.dispensers||[],c]}}}),b.value=""}},className:"rounded-xl",children:"Add Dispenser"})]}),_.tankConfig[a]?.dispensers?.length>0&&(0,b.jsx)("div",{className:"space-y-2 mt-2",children:_.tankConfig[a].dispensers.map((d,e)=>(0,b.jsxs)("div",{className:"flex items-center justify-between bg-background p-2 rounded-lg",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:d}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Input,{type:"number",placeholder:"Initial meter reading",className:"w-48 rounded-lg",id:`meter-${c}-${e}`}),(0,b.jsx)("button",{type:"button",onClick:()=>{let b=_.tankConfig[a]||{dispensers:[],initialStock:"",fuelType:"Petrol",tankCapacity:""},c=b.dispensers.filter((a,b)=>b!==e);aa({..._,tankConfig:{..._.tankConfig,[a]:{...b,dispensers:c}}})},className:"text-xs text-destructive hover:underline",children:"Remove"})]})]},e))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:`tank-stock-${a}`,children:"Initial Stock Position (Litres) *"}),(0,b.jsx)(w.Input,{id:`tank-stock-${a}`,type:"number",placeholder:"e.g., 5000",value:_.tankConfig[a]?.initialStock||"",onChange:b=>{let c=_.tankConfig[a]||{dispensers:[],initialStock:"",fuelType:"Petrol",tankCapacity:""};aa({..._,tankConfig:{..._.tankConfig,[a]:{...c,initialStock:b.target.value}}})},className:"rounded-xl",required:!0})]})]})]},c))})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>C(!1),className:"rounded-xl",disabled:M,children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:ae,className:"rounded-xl bg-blue-600 hover:bg-blue-700",disabled:!_.name||!_.location||!_.county||!_.localTaxOffice||M,children:M?"Creating...":"Create Branch"})]})]})]}),(0,b.jsx)(v.Dialog,{open:D,onOpenChange:E,children:(0,b.jsxs)(v.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl",children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{className:"text-2xl",children:"Edit Branch Details"}),(0,b.jsxs)(v.DialogDescription,{children:["Update the information for ",K?.name]})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"edit-branch-name",children:"Branch Name *"}),(0,b.jsx)(w.Input,{id:"edit-branch-name",placeholder:"e.g., Nairobi Branch",value:_.name,onChange:a=>aa({..._,name:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"edit-location",children:"Location *"}),(0,b.jsx)(w.Input,{id:"edit-location",placeholder:"e.g., Nairobi, Kenya",value:_.location,onChange:a=>aa({..._,location:a.target.value}),className:"rounded-xl"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"edit-address",children:"Physical Address"}),(0,b.jsx)(w.Input,{id:"edit-address",placeholder:"Street address, building, floor",value:_.address,onChange:a=>aa({..._,address:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"edit-manager",children:"Branch Manager"}),(0,b.jsx)(w.Input,{id:"edit-manager",placeholder:"Manager name",value:_.manager,onChange:a=>aa({..._,manager:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"edit-email",children:"Email"}),(0,b.jsx)(w.Input,{id:"edit-email",type:"email",placeholder:"branch@flow360.com",value:_.email,onChange:a=>aa({..._,email:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"edit-phone",children:"Phone Number"}),(0,b.jsx)(w.Input,{id:"edit-phone",type:"tel",placeholder:"+254...",value:_.phone,onChange:a=>aa({..._,phone:a.target.value}),className:"rounded-xl"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-medium",children:"Staff Password Reset"}),(0,b.jsx)(d.Button,{variant:"outline",size:"sm",onClick:async()=>{if(!K)return;let a=prompt("Enter the email or username of the staff member:");if(a)try{let b=await fetch(`/api/users?email=${encodeURIComponent(a)}&branch_id=${K.id}`),c=await b.json();if(!c.success||!c.data||0===c.data.length)return void alert("User not found in this branch");let d=c.data[0],e=(0,H.getCurrentUser)(),f=await fetch("/api/auth/reset/issue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:d.id,admin_id:e?.id})}),g=await f.json();g.success?alert(`Reset code for ${g.user.username}: ${g.code}

This code expires in ${g.expires_in_minutes} minutes.

Give this code to the user to reset their password.`):alert(g.error||"Failed to generate reset code")}catch(a){console.error("Error generating reset code:",a),alert("Error generating reset code")}},className:"rounded-xl",children:"Generate Reset Code"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Generate a password reset code for a staff member in this branch"})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,b.jsx)(d.Button,{variant:"destructive",onClick:()=>{K&&(ah(K.id,K.name),E(!1))},className:"rounded-xl",children:"Delete Branch"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>E(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:ag,className:"rounded-xl bg-blue-600 hover:bg-blue-700",disabled:!_.name||!_.location||!_.county||!_.localTaxOffice,children:"Update Branch"})]})]})]})}),(0,b.jsx)(v.Dialog,{open:I,onOpenChange:J,children:(0,b.jsxs)(v.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl",children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{className:"text-2xl",children:"Hardware Inventory"}),(0,b.jsx)(v.DialogDescription,{children:"View all hardware assigned to branches"})]}),(0,b.jsx)("div",{className:"py-4",children:(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"Hardware inventory data will be displayed here. Navigate to the Inventory page for full details."})})]})}),(0,b.jsx)(v.Dialog,{open:O,onOpenChange:P,children:(0,b.jsxs)(v.DialogContent,{className:"max-w-2xl rounded-2xl",children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{className:"text-2xl",children:"Global Uploads"}),(0,b.jsx)(v.DialogDescription,{children:"Upload meter readings and stock positions for all branches"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold",children:"File Requirements"}),(0,b.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[(0,b.jsx)("li",{children:"Excel or CSV file format"}),(0,b.jsx)("li",{children:"Must include: Branch Name, Dispenser ID, Opening Meter Reading, Closing Meter Reading"}),(0,b.jsx)("li",{children:"Must include: Tank ID, Opening Stock, Closing Stock"}),(0,b.jsx)("li",{children:"One row per dispenser/tank reading"})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(x.Label,{htmlFor:"upload-file",children:"Select File *"}),(0,b.jsx)(w.Input,{id:"upload-file",type:"file",accept:".xlsx,.xls,.csv",onChange:a=>R(a.target.files?.[0]||null),className:"rounded-xl"}),Q&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Selected: ",Q.name]})]}),(0,b.jsxs)("div",{className:"bg-muted/50 p-4 rounded-xl",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Sample Format"}),(0,b.jsxs)("div",{className:"text-xs font-mono bg-background p-3 rounded-lg overflow-x-auto",children:[(0,b.jsx)("div",{children:"Branch,Dispenser,Opening,Closing,Tank,Opening Stock,Closing Stock"}),(0,b.jsx)("div",{children:"Nairobi,Dispenser 01,1000,1500,Tank 1,5000,4200"}),(0,b.jsx)("div",{children:"Mombasa,Dispenser 02,2000,2300,Tank 2,6000,5800"})]})]})]}),(0,b.jsxs)(v.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>P(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsxs)(d.Button,{onClick:$,disabled:!Q,className:"rounded-xl",children:[(0,b.jsx)(p.Upload,{className:"mr-2 h-4 w-4"}),"Upload"]})]})]})}),(0,b.jsx)(F,{open:W,onOpenChange:X})]})}a.s(["default",()=>I],79537)}];

//# sourceMappingURL=app_headquarters_page_tsx_784e44d1._.js.map