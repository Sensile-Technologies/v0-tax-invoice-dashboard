module.exports=[15021,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69265),e=a.i(3130),f=a.i(5522),g=a.i(88237),h=a.i(76504),i=a.i(40695),j=a.i(54161),k=a.i(65733),l=a.i(17171),m=a.i(87682),n=a.i(87532),o=a.i(79360),p=a.i(24569),q=a.i(70106);let r=(0,q.default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),s=(0,q.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var t=a.i(15618),u=a.i(81402),v=a.i(5151),w=a.i(33441),x=a.i(96221);let y={Director:"Full system access, financial approvals, user management, strategic reporting",Manager:"Branch operations, staff supervision, inventory management, sales reporting",Supervisor:"Daily operations, stock monitoring, customer management, basic reporting",Cashier:"Sales transactions, customer invoicing, basic inventory view, receipt generation"};var z=a.i(90023),A=a.i(41792);function B(){let{isChecking:a,hasAccess:q}=(0,A.useHQAccess)(),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)({name:"",username:"",email:"",phone:"",role:"Cashier",password:"",branchId:""}),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(!0);if((0,c.useEffect)(()=>{q&&(Z(),$())},[q]),a)return(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsx)(x.Loader2,{className:"h-8 w-8 animate-spin text-primary"})});if(!q)return null;let Z=async()=>{try{let a=(0,z.getCurrentUser)(),b=a?.id,c=b?`/api/branches/list?user_id=${b}`:"/api/branches/list",d=await fetch(c);if(d.ok){let a=await d.json();M(a.branches||a||[])}}catch(a){console.error("Error fetching branches:",a)}},$=async()=>{Y(!0);try{let a=(0,z.getCurrentUser)(),b=a?.id,c=b?`/api/staff/list?user_id=${b}`:"/api/staff/list",d=await fetch(c);if(d.ok){let a=await d.json(),b=(a.staff||a||[]).map((a,b)=>({id:a.id,staffId:a.staff_id||`STF-${String(b+1).padStart(3,"0")}`,name:a.full_name||a.name||"",username:a.username||a.email?.split("@")[0]||"",email:a.email||"",phone:a.phone_number||a.phone||"",role:a.role||"Cashier",status:a.status||"active",branchId:a.branch_id||"",branchName:a.branch_name||"All Branches",attendantCode:a.attendant_code||""}));C(b)}}catch(a){console.error("Error fetching staff:",a)}finally{Y(!1)}},_=async()=>{if(J)C(B.map(a=>a.id===J.id?{...a,...N}:a)),E(!1),K(null);else{if(!N.password)return void alert("Password is required for new staff members");if("Director"!==N.role&&!N.branchId)return void alert("Please select a branch for this staff member");U(!0);try{let a=await fetch("/api/staff/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:N.email,username:N.username,password:N.password,fullName:N.name,phoneNumber:N.phone,role:N.role,branchId:"Director"===N.role?null:N.branchId})}),b=await a.json();U(!1),a.ok&&b.success?(await $(),alert("Staff account created successfully! They can now log in with their credentials."),E(!1),K(null)):alert(`Error creating staff: ${b.error}`)}catch(a){U(!1),alert("Failed to create staff member. Please try again.")}}},aa=async()=>{U(!0);try{let a=await fetch("/api/staff/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:J.id,email:J.email})});if(U(!1),a.ok)alert("Password has been reset to 'flow360'. User should change it on next login."),G(!1);else{let b=await a.json();alert(`Error resetting password: ${b.error||"Please try again."}`)}}catch(a){U(!1),alert("Failed to reset password. Please try again.")}},ab=async()=>{P!==R?alert("Passwords do not match!"):(U(!0),U(!1),alert("Password changed successfully!"),I(!1),Q(""),S(""),K(null))},ac=async a=>{let b="active"===a.status?"inactive":"active";try{(await fetch("/api/staff/update-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:a.id,status:b})})).ok?C(B.map(c=>c.id===a.id?{...c,status:b}:c)):alert("Failed to update staff status. Please try again.")}catch(a){console.error("Error updating staff status:",a),alert("Failed to update staff status. Please try again.")}},ad=async a=>{try{let b=await fetch("/api/staff/generate-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staff_id:a.id})}),c=await b.json();b.ok&&c.success?(C(B.map(b=>b.id===a.id?{...b,attendantCode:c.attendant_code}:b)),alert(`Attendant code generated: ${c.attendant_code}

This is the 4-digit code ${a.name} will use to log in to the mobile app.`)):alert(`Error generating code: ${c.error||"Please try again."}`)}catch(a){console.error("Error generating attendant code:",a),alert("Failed to generate attendant code. Please try again.")}};return(0,b.jsxs)("div",{className:"flex h-screen flex-col overflow-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,b.jsx)(d.DashboardHeader,{currentBranch:"hq"}),(0,b.jsxs)("main",{className:"flex-1 overflow-y-auto p-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-balance text-white",children:"Staff List"}),(0,b.jsx)("p",{className:"mt-1 text-white/80 text-pretty",children:"Manage your staff members"})]}),(0,b.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,b.jsxs)("div",{className:"relative w-96",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"Search staff...",className:"pl-10 rounded-xl"})]}),(0,b.jsxs)(i.Button,{onClick:()=>{K(null),O({name:"",username:"",email:"",phone:"",role:"Cashier",password:"",branchId:""}),E(!0)},className:"rounded-xl gap-2",children:[(0,b.jsx)(t.Plus,{className:"h-4 w-4"}),"Add Staff"]})]})]}),(0,b.jsx)(e.Card,{className:"rounded-2xl",children:(0,b.jsx)(e.CardContent,{className:"p-6",children:(0,b.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHeader,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHead,{children:"Staff ID"}),(0,b.jsx)(g.TableHead,{children:"Name"}),(0,b.jsx)(g.TableHead,{children:"Username"}),(0,b.jsx)(g.TableHead,{children:"Phone"}),(0,b.jsx)(g.TableHead,{children:"Role"}),(0,b.jsx)(g.TableHead,{children:"Branch"}),(0,b.jsx)(g.TableHead,{children:"APK Code"}),(0,b.jsx)(g.TableHead,{children:"Status"}),(0,b.jsx)(g.TableHead,{className:"w-12"})]})}),(0,b.jsx)(g.TableBody,{children:X?(0,b.jsx)(g.TableRow,{children:(0,b.jsx)(g.TableCell,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"Loading staff members..."})}):0===B.length?(0,b.jsx)(g.TableRow,{children:(0,b.jsx)(g.TableCell,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:'No staff members found. Click "Add Staff" to create one.'})}):B.map(a=>(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableCell,{className:"font-medium",children:a.staffId}),(0,b.jsx)(g.TableCell,{children:a.name}),(0,b.jsx)(g.TableCell,{children:a.username}),(0,b.jsx)(g.TableCell,{children:a.phone}),(0,b.jsx)(g.TableCell,{children:a.role}),(0,b.jsx)(g.TableCell,{children:a.branchName||"All Branches"}),(0,b.jsx)(g.TableCell,{children:["Cashier","Supervisor","Manager","cashier","supervisor","manager"].includes(a.role)?a.attendantCode?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("code",{className:"bg-slate-100 px-2 py-1 rounded font-mono text-sm font-bold",children:a.attendantCode}),(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{navigator.clipboard.writeText(a.attendantCode||""),W(a.id),setTimeout(()=>W(null),2e3)},children:V===a.id?(0,b.jsx)(w.Check,{className:"h-3 w-3 text-green-600"}):(0,b.jsx)(v.Copy,{className:"h-3 w-3"})})]}):(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>ad(a),children:[(0,b.jsx)(u.Key,{className:"h-3 w-3 mr-1"}),"Generate"]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"N/A"})}),(0,b.jsx)(g.TableCell,{children:(0,b.jsx)(j.Badge,{variant:"active"===a.status?"default":"secondary",className:"rounded-lg",children:a.status})}),(0,b.jsx)(g.TableCell,{children:(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",className:"rounded-lg",children:(0,b.jsx)(o.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsxs)(h.DropdownMenuContent,{align:"end",className:"rounded-xl",children:[(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>{K(a),O({name:a.name,username:a.username,email:a.email,phone:a.phone,role:a.role,password:"",branchId:a.branchId||""}),E(!0)},className:"gap-2 cursor-pointer rounded-lg",children:[(0,b.jsx)(p.Edit,{className:"h-4 w-4"}),"Edit"]}),["Cashier","Supervisor","Manager","cashier","supervisor","manager"].includes(a.role)&&(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>ad(a),className:"gap-2 cursor-pointer rounded-lg",children:[(0,b.jsx)(u.Key,{className:"h-4 w-4"}),a.attendantCode?"Regenerate Code":"Generate Code"]}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>{K(a),G(!0)},className:"gap-2 cursor-pointer rounded-lg",children:[(0,b.jsx)(r,{className:"h-4 w-4"}),"Reset Account"]}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>ac(a),className:"gap-2 cursor-pointer rounded-lg text-red-600",children:[(0,b.jsx)(s,{className:"h-4 w-4"}),"active"===a.status?"Deactivate":"Activate"]})]})]})})]},a.id))})]})})})})]}),(0,b.jsx)("footer",{className:"border-t px-8 py-4 text-center text-sm text-navy-900",children:"Powered by Sensile Technologies East Africa Ltd"}),(0,b.jsx)(k.Dialog,{open:D,onOpenChange:E,children:(0,b.jsxs)(k.DialogContent,{className:"max-w-2xl rounded-2xl",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:J?"Edit Staff Member":"Add New Staff Member"}),(0,b.jsx)(k.DialogDescription,{children:J?"Update staff information and role assignment":"Create a new staff account with authentication credentials and role permissions"})]}),(0,b.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"Full Name"}),(0,b.jsx)(f.Input,{id:"name",value:N.name,onChange:a=>O({...N,name:a.target.value}),className:"rounded-xl",placeholder:"Enter full name"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"username",children:"Username"}),(0,b.jsx)(f.Input,{id:"username",value:N.username,onChange:a=>O({...N,username:a.target.value}),className:"rounded-xl",placeholder:"Enter username"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"phone",children:"Phone Number"}),(0,b.jsx)(f.Input,{id:"phone",value:N.phone,onChange:a=>O({...N,phone:a.target.value}),className:"rounded-xl",placeholder:"+254 7XX XXXXXX"})]})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(f.Input,{id:"email",type:"email",value:N.email,onChange:a=>O({...N,email:a.target.value}),className:"rounded-xl",placeholder:"email@flow360.co.ke"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"role",children:"Role & Permissions"}),(0,b.jsxs)(m.Select,{value:N.role,onValueChange:a=>O({...N,role:a}),children:[(0,b.jsx)(m.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(m.SelectValue,{})}),(0,b.jsxs)(m.SelectContent,{className:"rounded-xl",children:[(0,b.jsx)(m.SelectItem,{value:"Director",className:"rounded-lg",children:"Director"}),(0,b.jsx)(m.SelectItem,{value:"Manager",className:"rounded-lg",children:"Manager"}),(0,b.jsx)(m.SelectItem,{value:"Supervisor",className:"rounded-lg",children:"Supervisor"}),(0,b.jsx)(m.SelectItem,{value:"Cashier",className:"rounded-lg",children:"Cashier"})]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:y[N.role]})]}),"Director"!==N.role&&(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"branch",children:"Assigned Branch *"}),(0,b.jsxs)(m.Select,{value:N.branchId,onValueChange:a=>O({...N,branchId:a}),children:[(0,b.jsx)(m.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(m.SelectValue,{placeholder:"Select branch"})}),(0,b.jsx)(m.SelectContent,{className:"rounded-xl",children:L.map(a=>(0,b.jsx)(m.SelectItem,{value:a.id,className:"rounded-lg",children:a.name},a.id))})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"This user will only be able to access and manage this specific branch."})]}),!J&&(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"password",children:"Initial Password"}),(0,b.jsx)(f.Input,{id:"password",type:"password",value:N.password,onChange:a=>O({...N,password:a.target.value}),className:"rounded-xl",placeholder:"Enter initial password"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"This password will be used to create their login account. They can change it later."})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>E(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:_,disabled:T,className:"rounded-xl",children:T?"Creating...":J?"Save Changes":"Create Account"})]})]})}),(0,b.jsx)(k.Dialog,{open:F,onOpenChange:G,children:(0,b.jsxs)(k.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Reset Account Password"}),(0,b.jsxs)(k.DialogDescription,{children:["This will reset ",J?.name,'\'s password to the default password "flow360". They will be prompted to change it immediately.']})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>G(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:aa,disabled:T,className:"rounded-xl",children:T?"Resetting...":"Confirm Reset"})]})]})}),(0,b.jsx)(k.Dialog,{open:H,onOpenChange:I,children:(0,b.jsxs)(k.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Change Password"}),(0,b.jsx)(k.DialogDescription,{children:"Your password has been reset. Please create a new secure password."})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"new-password",children:"New Password"}),(0,b.jsx)(f.Input,{id:"new-password",type:"password",value:P,onChange:a=>Q(a.target.value),className:"rounded-xl",placeholder:"Enter new password"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"confirm-password",children:"Confirm Password"}),(0,b.jsx)(f.Input,{id:"confirm-password",type:"password",value:R,onChange:a=>S(a.target.value),className:"rounded-xl",placeholder:"Confirm new password"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>I(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:ab,className:"rounded-xl",children:"Change Password"})]})]})})]})}a.s(["default",()=>B],15021)}];

//# sourceMappingURL=app_headquarters_staff-management_page_tsx_c150a828._.js.map