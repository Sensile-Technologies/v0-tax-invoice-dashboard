module.exports=[25455,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(87682),i=a.i(21958),j=a.i(80281),k=a.i(23292),l=a.i(13655);let m=(0,a.i(70106).default)("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);var n=a.i(15618),o=a.i(210),p=a.i(50944);function q(){let a=(0,p.useRouter)(),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)({fuel_type:"",price:""}),[G,H]=(0,c.useState)({dispenser_id:"",nozzle_number:"",fuel_type:"",initial_meter_reading:""});(0,c.useEffect)(()=>{I()},[]);let I=async()=>{try{let a=localStorage.getItem("selectedBranch");if(!a)return void k.toast.error("Please select a branch first");let b=JSON.parse(a).id,[c,d,e,f]=await Promise.all([fetch(`/api/tanks?branch_id=${b}`),fetch(`/api/fuel-prices?branch_id=${b}`),fetch(`/api/dispensers?branch_id=${b}`),fetch(`/api/nozzles?branch_id=${b}`)]),[g,h,i,j]=await Promise.all([c.json(),d.json(),e.json(),f.json()]);if(g.success){let a=[...new Set(g.data?.map(a=>a.fuel_type)||[])];x(a)}h.success&&r(h.data||[]),i.success&&t(i.data||[]),j.success&&v(j.data||[])}catch(a){console.error("Error fetching configuration:",a),k.toast.error("Failed to load configuration")}},J=async()=>{if(!E.fuel_type||!E.price)return void k.toast.error("Please fill in all fields");z(!0);try{let a=localStorage.getItem("selectedBranch");if(!a)return void k.toast.error("Please select a branch first");let b=JSON.parse(a).id,c=await fetch("/api/fuel-prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:b,fuel_type:E.fuel_type,price:Number.parseFloat(E.price),effective_date:new Date().toISOString()})}),d=await c.json();d.success?(k.toast.success("Fuel price added successfully"),F({fuel_type:"",price:""}),await I()):(console.error("Error adding fuel price:",d.error),k.toast.error("Failed to add fuel price"))}catch(a){console.error("Error adding fuel price:",a),k.toast.error("Failed to add fuel price")}finally{z(!1)}},K=async(a,b)=>{if(!C)return void k.toast.error("Please enter a price");z(!0);try{let c=await fetch("/api/fuel-prices",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,price:Number.parseFloat(C),effective_date:new Date().toISOString()})}),d=await c.json();d.success?(k.toast.success(`${b} price updated successfully`),B(null),D(""),await I()):(console.error("Error updating fuel price:",d.error),k.toast.error("Failed to update fuel price"))}catch(a){console.error("Error updating fuel price:",a),k.toast.error("Failed to update fuel price")}finally{z(!1)}},L=async()=>{if(!G.dispenser_id||!G.fuel_type)return void k.toast.error("Please fill in all required fields");z(!0);try{let a=localStorage.getItem("selectedBranch");if(!a)return void k.toast.error("Please select a branch first");let b=JSON.parse(a).id,c=await fetch(`/api/tanks?branch_id=${b}`),d=await c.json(),e=d.success?d.data.filter(a=>a.fuel_type===G.fuel_type):[];if(0===e.length){k.toast.error(`No tank configured for ${G.fuel_type}. Please add a ${G.fuel_type} tank in Tank Management first.`),z(!1);return}if(!q.some(a=>a.fuel_type===G.fuel_type)){k.toast.error(`No price configured for ${G.fuel_type}. Please add a fuel price for ${G.fuel_type} first.`),z(!1);return}let f=await fetch(`/api/nozzles?dispenser_id=${G.dispenser_id}`),g=await f.json(),h=(g.success?g.data:[]).map(a=>a.nozzle_number||0),i=h.length>0?Math.max(...h)+1:1,j=await fetch("/api/nozzles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:b,dispenser_id:G.dispenser_id,nozzle_number:i,fuel_type:G.fuel_type,initial_meter_reading:G.initial_meter_reading?Number.parseFloat(G.initial_meter_reading):0,status:"active"})}),l=await j.json();if(l.success){let a=s.find(a=>a.id===G.dispenser_id),b=a?.dispenser_number||"?";k.toast.success(`Nozzle D${b}N${i} added successfully`),H({dispenser_id:"",nozzle_number:"",fuel_type:"",initial_meter_reading:""}),await I()}else console.error("Error adding nozzle:",l.error),k.toast.error("Failed to add nozzle")}catch(a){console.error("Error adding nozzle:",a),k.toast.error("Failed to add nozzle")}finally{z(!1)}},M=async(a,b)=>{let c="active"===b?"inactive":"active";try{let b=await fetch("/api/nozzles",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,status:c})}),d=await b.json();d.success?(k.toast.success(`Nozzle ${"active"===c?"activated":"deactivated"}`),await I()):(console.error("Error updating nozzle status:",d.error),k.toast.error("Failed to update nozzle status"))}catch(a){console.error("Error updating nozzle status:",a),k.toast.error("Failed to update nozzle status")}};return(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>a.back(),className:"gap-2",children:[(0,b.jsx)(o.ArrowLeft,{className:"h-4 w-4"}),"Back"]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Branch Configuration"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Configure fuel prices and nozzle mappings for this branch"})]})]}),(0,b.jsxs)(i.Tabs,{defaultValue:"fuel-prices",className:"space-y-6",children:[(0,b.jsxs)(i.TabsList,{children:[(0,b.jsxs)(i.TabsTrigger,{value:"fuel-prices",children:[(0,b.jsx)(l.Fuel,{className:"h-4 w-4 mr-2"}),"Fuel Prices"]}),(0,b.jsxs)(i.TabsTrigger,{value:"nozzles",children:[(0,b.jsx)(m,{className:"h-4 w-4 mr-2"}),"Nozzles & Dispensers"]})]}),(0,b.jsxs)(i.TabsContent,{value:"fuel-prices",className:"space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Add Fuel Price"}),(0,b.jsx)(d.CardDescription,{children:"Set selling prices for different fuel types"})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"fuel_type",children:"Fuel Type"}),(0,b.jsxs)(h.Select,{value:E.fuel_type,onValueChange:a=>F({...E,fuel_type:a}),children:[(0,b.jsx)(h.SelectTrigger,{id:"fuel_type",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select fuel type"})}),(0,b.jsx)(h.SelectContent,{children:0===w.length?(0,b.jsx)("div",{className:"px-2 py-1.5 text-sm text-slate-500",children:"No fuel types available. Add tanks in Tank Management first."}):w.filter(a=>!q.some(b=>b.fuel_type===a)).map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"price",children:"Price (KES)"}),(0,b.jsx)(f.Input,{id:"price",type:"number",step:"0.01",placeholder:"0.00",value:E.price,onChange:a=>F({...E,price:a.target.value})})]})]}),(0,b.jsxs)(e.Button,{onClick:J,disabled:y||0===w.filter(a=>!q.some(b=>b.fuel_type===a)).length,children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),"Add Fuel Price"]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Current Fuel Prices"}),(0,b.jsx)(d.CardDescription,{children:"Active fuel prices for this branch"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:0===q.length?(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"No fuel prices configured"}):q.map(a=>(0,b.jsx)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:A===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium mb-2",children:a.fuel_type}),(0,b.jsx)(f.Input,{type:"number",step:"0.01",placeholder:"Enter new price",value:C,onChange:a=>D(a.target.value),className:"max-w-[200px]"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",onClick:()=>K(a.id,a.fuel_type),disabled:y,children:"Save"}),(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>{B(null),D("")},disabled:y,children:"Cancel"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.fuel_type}),(0,b.jsxs)("p",{className:"text-sm text-slate-500",children:["Effective: ",new Date(a.effective_date).toLocaleDateString()]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("p",{className:"text-lg font-bold",children:["KES ",Number.parseFloat(a.price).toFixed(2)]}),(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>{B(a.id),D(a.price.toString())},children:"Edit"})]})]})},a.id))})})]})]}),(0,b.jsxs)(i.TabsContent,{value:"nozzles",className:"space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Add Nozzle"}),(0,b.jsx)(d.CardDescription,{children:"Map nozzles to dispensers and fuel types"})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"dispenser",children:"Dispenser"}),(0,b.jsxs)(h.Select,{value:G.dispenser_id,onValueChange:a=>H({...G,dispenser_id:a}),children:[(0,b.jsx)(h.SelectTrigger,{id:"dispenser",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select dispenser"})}),(0,b.jsx)(h.SelectContent,{children:s.map(a=>(0,b.jsxs)(h.SelectItem,{value:a.id,children:["Dispenser ",a.dispenser_number]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"nozzle_fuel_type",children:"Fuel Type"}),(0,b.jsxs)(h.Select,{value:G.fuel_type,onValueChange:a=>H({...G,fuel_type:a}),children:[(0,b.jsx)(h.SelectTrigger,{id:"nozzle_fuel_type",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select fuel type"})}),(0,b.jsx)(h.SelectContent,{children:0===w.length?(0,b.jsx)("div",{className:"px-2 py-1.5 text-sm text-slate-500",children:"No fuel types available. Add tanks in Tank Management first."}):w.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"initial_meter_reading",children:"Initial Meter Reading"}),(0,b.jsx)(f.Input,{id:"initial_meter_reading",type:"number",step:"0.001",placeholder:"0.000",value:G.initial_meter_reading,onChange:a=>H({...G,initial_meter_reading:a.target.value})})]})]}),(0,b.jsx)("div",{className:"text-sm text-slate-500",children:"Nozzle number will be automatically assigned"}),(0,b.jsxs)(e.Button,{onClick:L,disabled:y||0===w.length,children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),"Add Nozzle"]})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Dispensers"}),(0,b.jsx)(d.CardDescription,{children:"Fuel dispensers at this branch (multi-product capable)"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:0===s.length?(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"No dispensers found. Dispensers are created when you create a branch."}):s.map(a=>(0,b.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,b.jsxs)("p",{className:"font-medium",children:["Dispenser ",a.dispenser_number]}),(0,b.jsxs)("p",{className:"text-sm text-slate-500 capitalize",children:["Multi-Product - ",a.status]})]},a.id))})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Nozzles"}),(0,b.jsx)(d.CardDescription,{children:"Nozzles mapped to dispensers"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:0===u.length?(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"No nozzles configured"}):u.map(a=>{let c=s.find(b=>b.id===a.dispenser_id);return(0,b.jsx)("div",{className:"p-3 border rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:c?`D${c.dispenser_number}N${a.nozzle_number}`:`Nozzle ${a.nozzle_number}`}),(0,b.jsxs)("p",{className:"text-sm text-slate-500",children:[c?`Dispenser ${c.dispenser_number}`:"Unknown"," - ",a.fuel_type]}),(0,b.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["Initial Reading: ",Number(a.initial_meter_reading||0).toFixed(3)," L"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Label,{htmlFor:`nozzle-${a.id}`,className:"text-xs text-slate-500",children:"active"===a.status?"Active":"Inactive"}),(0,b.jsx)(j.Switch,{id:`nozzle-${a.id}`,checked:"active"===a.status,onCheckedChange:()=>M(a.id,a.status)})]})]})},a.id)})})})]})]})]})]})]})}a.s(["default",()=>q],25455)}];

//# sourceMappingURL=app_configuration_page_tsx_dd13e961._.js.map