module.exports=[50584,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69265),e=a.i(40695),f=a.i(3130),g=a.i(5522),h=a.i(17171),i=a.i(46893),j=a.i(87682),k=a.i(210),l=a.i(15618),m=a.i(81560),n=a.i(96221),o=a.i(83497),p=a.i(10227);let q=(0,a.i(70106).default)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);var r=a.i(50944),s=a.i(23292),t=a.i(90023),u=a.i(41792);function v(){let{isChecking:a,hasAccess:v}=(0,u.useHQAccess)(),w=(0,r.useRouter)(),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!0),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)([]),ab=(0,c.useCallback)(async()=>{try{let a=(0,t.getCurrentUser)(),b=a?.id,c=b?`/api/branches/list?user_id=${b}`:"/api/branches/list",d=await fetch(c);if(d.ok){let a=await d.json();y(a||[])}}catch(a){console.error("Error fetching branches:",a)}},[]),ac=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/vendors/partners?partner_type=supplier"),b=await a.json();b.success&&A(b.data||[])}catch(a){console.error("Error fetching suppliers:",a)}},[]),ad=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/vendors/partners?partner_type=transporter"),b=await a.json();b.success&&C(b.data||[])}catch(a){console.error("Error fetching transporters:",a)}},[]),ae=(0,c.useCallback)(async()=>{try{let a=(0,t.getCurrentUser)(),b=a?.vendor_id;if(!b)return void console.error("No vendor ID found");let c=await fetch(`/api/items?vendorId=${b}&catalog=true`),d=await c.json();d.success&&E(d.items||[])}catch(a){console.error("Error fetching items:",a)}},[]);if((0,c.useEffect)(()=>{v&&Promise.all([ab(),ac(),ad(),ae()]).finally(()=>{I(!1)})},[ab,ac,ad,ae,v]),a)return(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-primary"})});if(!v)return null;let af=(a,b,c)=>{let d=[..._];if(d[a]={...d[a],[b]:c},"item_id"===b){let b=D.find(a=>a.id===c);b&&(d[a].item_name=b.item_name)}("quantity"===b||"unit_price"===b)&&(d[a].total_amount=d[a].quantity*d[a].unit_price),aa(d)},ag=async()=>{if(!J)return void s.toast.error("Please select a branch");if(!L)return void s.toast.error("Please select a supplier");if(0===_.length)return void s.toast.error("Please add at least one item");if(_.filter(a=>!a.item_name||a.quantity<=0||a.unit_price<=0).length>0)return void s.toast.error("Please fill in all item details with valid quantities and unit prices");try{G(!0);let a=await fetch("/api/headquarters/purchase-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:J,supplier_id:L,transporter_id:N||null,expected_delivery:P||null,notes:R||null,transport_cost:parseFloat(T)||0,vehicle_registration:V||null,driver_name:X||null,driver_phone:Z||null,items:_})}),b=await a.json();b.success?(s.toast.success(b.message||"Purchase order created successfully"),w.push("/headquarters/purchase-orders")):s.toast.error(b.error||"Failed to create purchase order")}catch(a){console.error("Error creating purchase order:",a),s.toast.error("Failed to create purchase order")}finally{G(!1)}},ah=a=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:2}).format(a),ai=_.reduce((a,b)=>a+b.total_amount,0),aj=ai+(parseFloat(T)||0);return H?(0,b.jsxs)("div",{className:"flex h-screen flex-col overflow-hidden bg-gradient-to-b from-slate-50 to-white",children:[(0,b.jsx)(d.DashboardHeader,{currentBranch:"hq"}),(0,b.jsx)("main",{className:"flex-1 flex items-center justify-center",children:(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):(0,b.jsxs)("div",{className:"flex h-screen flex-col overflow-hidden bg-gradient-to-b from-slate-50 to-white",children:[(0,b.jsx)(d.DashboardHeader,{currentBranch:"hq"}),(0,b.jsx)("main",{className:"flex-1 overflow-y-auto p-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>w.push("/headquarters/purchase-orders"),className:"rounded-xl mb-6",children:[(0,b.jsx)(k.ArrowLeft,{className:"mr-2 h-4 w-4"}),"Back to Purchase Orders"]}),(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:"Create Purchase Order"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-8",children:"Fill in the details to create a new purchase order for a branch."}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(f.Card,{className:"rounded-2xl",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(q,{className:"h-5 w-5"}),"Order Details"]}),(0,b.jsx)(f.CardDescription,{children:"Select the branch, supplier, and delivery information"})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Branch *"}),(0,b.jsxs)(j.Select,{value:J,onValueChange:K,children:[(0,b.jsx)(j.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(j.SelectValue,{placeholder:"Select branch"})}),(0,b.jsx)(j.SelectContent,{children:x.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Supplier *"}),(0,b.jsxs)(j.Select,{value:L,onValueChange:M,children:[(0,b.jsx)(j.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(j.SelectValue,{placeholder:"Select supplier"})}),(0,b.jsx)(j.SelectContent,{children:z.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:a.name},a.id))})]})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Expected Delivery Date"}),(0,b.jsx)(g.Input,{type:"date",value:P,onChange:a=>Q(a.target.value),className:"rounded-xl"})]})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Notes"}),(0,b.jsx)(i.Textarea,{value:R,onChange:a=>S(a.target.value),placeholder:"Additional notes or instructions...",className:"rounded-xl",rows:3})]})]})]}),(0,b.jsxs)(f.Card,{className:"rounded-2xl",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Truck,{className:"h-5 w-5"}),"Transport Details"]}),(0,b.jsx)(f.CardDescription,{children:"Transporter, vehicle, and driver information"})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Transporter"}),(0,b.jsxs)(j.Select,{value:N,onValueChange:O,children:[(0,b.jsx)(j.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(j.SelectValue,{placeholder:"Select transporter (optional)"})}),(0,b.jsx)(j.SelectContent,{children:B.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Transport Cost (KES)"}),(0,b.jsx)(g.Input,{type:"number",value:T,onChange:a=>U(a.target.value),placeholder:"0.00",className:"rounded-xl",min:"0",step:"0.01"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Vehicle Registration"}),(0,b.jsx)(g.Input,{value:V,onChange:a=>W(a.target.value),placeholder:"e.g., KBZ 123A",className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Driver Name"}),(0,b.jsx)(g.Input,{value:X,onChange:a=>Y(a.target.value),placeholder:"Driver's full name",className:"rounded-xl"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Driver Phone"}),(0,b.jsx)(g.Input,{value:Z,onChange:a=>$(a.target.value),placeholder:"e.g., 0712345678",className:"rounded-xl"})]})]})]})]}),(0,b.jsxs)(f.Card,{className:"rounded-2xl",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Package,{className:"h-5 w-5"}),"Order Items"]}),(0,b.jsx)(f.CardDescription,{children:"Add items with quantities and unit purchase prices"})]}),(0,b.jsxs)(e.Button,{type:"button",variant:"outline",onClick:()=>{aa([..._,{item_id:"",item_name:"",quantity:0,unit_price:0,total_amount:0}])},className:"rounded-xl",disabled:!J,children:[(0,b.jsx)(l.Plus,{className:"mr-2 h-4 w-4"}),"Add Item"]})]})}),(0,b.jsx)(f.CardContent,{children:J?0===_.length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground border rounded-xl bg-slate-50",children:[(0,b.jsx)(o.Package,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No items added yet"}),(0,b.jsx)("p",{className:"text-sm",children:'Click "Add Item" to add items to this order'})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 text-sm font-medium text-muted-foreground px-3",children:[(0,b.jsx)("div",{className:"col-span-4",children:"Item"}),(0,b.jsx)("div",{className:"col-span-2",children:"Quantity (L)"}),(0,b.jsx)("div",{className:"col-span-2",children:"Unit Price *"}),(0,b.jsx)("div",{className:"col-span-3 text-right",children:"Total"}),(0,b.jsx)("div",{className:"col-span-1"})]}),_.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center p-3 border rounded-xl bg-white",children:[(0,b.jsx)("div",{className:"col-span-4",children:(0,b.jsxs)(j.Select,{value:a.item_id,onValueChange:a=>af(c,"item_id",a),children:[(0,b.jsx)(j.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(j.SelectValue,{placeholder:"Select item"})}),(0,b.jsx)(j.SelectContent,{children:D.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:a.item_name},a.id))})]})}),(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsx)(g.Input,{type:"number",placeholder:"Qty",value:a.quantity||"",onChange:a=>af(c,"quantity",parseFloat(a.target.value)||0),className:"rounded-xl",min:"0"})}),(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsx)(g.Input,{type:"number",placeholder:"Price *",value:a.unit_price||"",onChange:a=>af(c,"unit_price",parseFloat(a.target.value)||0),className:"rounded-xl",min:"0",step:"0.01"})}),(0,b.jsx)("div",{className:"col-span-3 text-right font-medium",children:ah(a.total_amount)}),(0,b.jsx)("div",{className:"col-span-1 text-right",children:(0,b.jsx)(e.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{aa(_.filter((a,b)=>b!==c))},className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})})]},c)),(0,b.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Items Subtotal:"}),(0,b.jsx)("span",{children:ah(ai)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Transport Cost:"}),(0,b.jsx)("span",{children:ah(parseFloat(T)||0)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,b.jsx)("span",{children:"Grand Total:"}),(0,b.jsx)("span",{children:ah(aj)})]})]})]}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground border rounded-xl bg-slate-50",children:[(0,b.jsx)(o.Package,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"Please select a branch first to load available items"})]})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>w.push("/headquarters/purchase-orders"),className:"rounded-xl",children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:ag,disabled:F,className:"rounded-xl px-8",children:[F&&(0,b.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Purchase Order"]})]})]})]})})]})}a.s(["default",()=>v],50584)}];

//# sourceMappingURL=app_headquarters_purchase-orders_create_page_tsx_bffd3ddc._.js.map