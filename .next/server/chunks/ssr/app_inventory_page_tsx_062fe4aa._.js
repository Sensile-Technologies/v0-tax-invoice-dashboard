module.exports=[1194,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(344),e=a.i(69265),f=a.i(40695),g=a.i(3130),h=a.i(5522),i=a.i(17171),j=a.i(88237),k=a.i(24669),l=a.i(70106);let m=(0,l.default)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);var n=a.i(87532);a.i(9941),(0,l.default)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),(0,l.default)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var o=a.i(13655),p=a.i(4720),q=a.i(69520),r=a.i(90166),s=a.i(74575),t=a.i(87682),u=a.i(65733);let v=(0,l.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var w=a.i(15618),x=a.i(83497),y=a.i(81560),z=a.i(54161),A=a.i(20094);function B({branchId:a}){let[d,e]=(0,c.useState)([]),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!0),[s,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)({quantity:"",reason:"",requestedBy:""}),[Q,R]=(0,c.useState)({toTankId:"",toBranchId:a,quantity:"",notes:"",requestedBy:""}),[S,T]=(0,c.useState)({tankName:"",fuelType:"Petrol",capacity:"",initialStock:""});(0,c.useEffect)(()=>{a&&(V(),W(),X(),Y())},[a]),(0,c.useEffect)(()=>{Q.toBranchId&&Q.toBranchId!==a?U(Q.toBranchId):Q.toBranchId===a&&L(d)},[Q.toBranchId,a,d]);let U=async a=>{N(!0);try{let b=await fetch(`/api/tanks?branch_id=${a}`),c=await b.json();c.success?L(c.data||[]):L([])}catch(a){console.error("Error fetching destination tanks:",a),L([])}finally{N(!1)}},V=async()=>{r(!0);try{let b=await fetch(`/api/tanks?branch_id=${a}`),c=await b.json();if(!c.success){console.error("Error fetching tanks:",c.error),r(!1);return}let[d,f]=await Promise.all([fetch(`/api/dispensers?branch_id=${a}`),fetch(`/api/nozzles?branch_id=${a}`)]),g=await d.json(),h=await f.json(),i=g.success?g.data:[],j=h.success?h.data:[],k=(c.data||[]).map(a=>({...a,dispensers:i.filter(b=>{let c=b.tank_ids||[];return c.includes(a.id)||b.tank_id===a.id||!b.tank_id&&!c.length&&b.fuel_type===a.fuel_type}),nozzles:j.filter(b=>b.fuel_type===a.fuel_type)}));e(k)}catch(a){console.error("Error fetching tanks:",a)}finally{r(!1)}},W=async()=>{try{let a=await fetch("/api/branches"),b=await a.json();b.success&&k(b.data||[])}catch(a){console.error("Error fetching branches:",a)}},X=async()=>{try{let b=await fetch(`/api/branch-items?branchId=${a}`),c=await b.json();if(c.success){let a=(c.items||[]).filter(a=>a.is_assigned||a.branch_item_id).map(a=>({id:a.item_id,item_name:a.item_name,item_code:a.item_code,item_type:a.item_type}));m(a)}}catch(a){console.error("Error fetching items:",a)}},Y=async()=>{try{let b=await fetch(`/api/stock-transfers?branch_id=${a}`),c=await b.json();if(c.success){let b=(c.data||[]).filter(b=>b.to_branch_id===a&&("pending"===b.status||!b.status&&"pending"===b.approval_status)),d=await Promise.all(b.map(async a=>{let b="Unknown Branch",c="Unknown Tank",d=await fetch(`/api/branches?id=${a.from_branch_id}`),e=await d.json();e.success&&e.data?.length>0&&(b=e.data[0].name);let f=await fetch(`/api/tanks?branch_id=${a.from_branch_id}`),g=await f.json();if(g.success){let b=g.data.find(b=>b.id===a.from_tank_id);b&&(c=b.tank_name)}return{...a,from_branch_name:b,from_tank_name:c}}));p(d)}}catch(a){console.error("Error fetching pending transfers:",a)}},Z=async a=>{J(a);try{let b=await fetch("/api/stock-transfers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({transfer_id:a,action:"accept",approved_by:"Branch User"})}),c=await b.json();b.ok&&c.success?(A.toast.success(`Transfer accepted. New stock: ${c.data.newStock} litres`),V(),Y(),B(!1)):A.toast.error(c.error||"Error accepting transfer")}catch(a){console.error("Error accepting transfer:",a),A.toast.error("Error accepting transfer")}finally{J(null)}},$=async a=>{try{let b=await fetch("/api/stock-transfers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({transfer_id:a,action:"reject",approved_by:"Branch User"})}),c=await b.json();b.ok&&c.success?(A.toast.info("Transfer rejected"),Y()):A.toast.error(c.error||"Error rejecting transfer")}catch(a){console.error("Error rejecting transfer:",a),A.toast.error("Error rejecting transfer")}},_=async(a,b)=>{try{(await fetch("/api/tanks",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,item_id:b})})).ok?(A.toast.success("Item mapped to tank successfully"),V()):A.toast.error("Failed to map item to tank")}catch(a){console.error("Error updating tank item:",a),A.toast.error("Failed to map item to tank")}},aa=async()=>{if(!G)return;let b=Number.parseFloat(Q.quantity);try{if(!(await fetch("/api/stock-transfers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from_tank_id:G.id,to_tank_id:Q.toTankId,from_branch_id:a,to_branch_id:Q.toBranchId,quantity:b,requested_by:Q.requestedBy,notes:Q.notes,approval_status:"pending"})})).ok)return void console.error("Error creating transfer");A.toast.success("Transfer request submitted. Awaiting approval at destination branch."),D(!1),R({toTankId:"",toBranchId:a,quantity:"",notes:"",requestedBy:""}),V()}catch(a){console.error("Error creating transfer:",a)}},ab=async()=>{if(a)try{(await fetch("/api/tanks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:a,tank_name:S.tankName,fuel_type:S.fuelType,capacity:Number.parseFloat(S.capacity),current_stock:Number.parseFloat(S.initialStock||"0"),status:"active"})})).ok?(A.toast.success(`Tank ${S.tankName} added successfully`),F(!1),T({tankName:"",fuelType:"Petrol",capacity:"",initialStock:""}),V()):(console.error("Error adding tank"),A.toast.error("Failed to add tank"))}catch(a){console.error("Error adding tank:",a),A.toast.error("Failed to add tank")}},ac=async a=>{if(confirm(`Are you sure you want to delete "${a.tank_name}"? This action cannot be undone.`))try{let b=await fetch(`/api/tanks?id=${a.id}`,{method:"DELETE"});if(b.ok)A.toast.success(`Tank "${a.tank_name}" deleted successfully`),V();else{let a=await b.json();A.toast.error(a.error||"Failed to delete tank")}}catch(a){console.error("Error deleting tank:",a),A.toast.error("Failed to delete tank")}};return a?q?(0,b.jsx)("div",{className:"p-6",children:"Loading tank management..."}):(0,b.jsxs)("div",{className:"space-y-6 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Tank Management"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage fuel tanks, stock levels, and transfers"})]}),(0,b.jsxs)(f.Button,{onClick:()=>F(!0),className:"rounded-xl",children:[(0,b.jsx)(w.Plus,{className:"h-4 w-4 mr-2"}),"Add New Tank"]})]}),(0,b.jsx)("div",{className:"grid gap-4",children:d.map(a=>{let c,d=Number.parseFloat((a.current_stock/a.capacity*100).toFixed(1)),e=d<20?"critical":d<50?"low":"normal";return(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(o.Fuel,{className:"h-5 w-5 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.CardTitle,{className:"text-lg",children:a.tank_name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.fuel_type})]})]}),(0,b.jsxs)(z.Badge,{variant:"critical"===e?"destructive":"low"===e?"secondary":"default",children:[d,"% Full"]})]})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Capacity"}),(0,b.jsxs)("p",{className:"text-lg font-semibold",children:[a.capacity.toLocaleString()," L"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Current Stock"}),(0,b.jsxs)("p",{className:"text-lg font-semibold",children:[a.current_stock.toLocaleString()," L"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Available Space"}),(0,b.jsxs)("p",{className:"text-lg font-semibold",children:[(a.capacity-a.current_stock).toLocaleString()," L"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Linked Item"}),(0,b.jsxs)(t.Select,{value:a.item_id||"none",onValueChange:b=>_(a.id,"none"===b?null:b),children:[(0,b.jsx)(t.SelectTrigger,{className:"h-8 rounded-lg text-sm",children:(0,b.jsx)(t.SelectValue,{placeholder:"Select item"})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"none",children:"No item linked"}),l.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:a.item_name},a.id))]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Serving Dispensers/Nozzles"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.dispensers?.map(a=>(0,b.jsxs)(z.Badge,{variant:"outline",children:["D",a.dispenser_number]},a.id)),a.nozzles?.map(a=>(0,b.jsxs)(z.Badge,{variant:"outline",children:["N",a.nozzle_number]},a.id)),!a.dispensers?.length&&!a.nozzles?.length&&(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"No dispensers/nozzles assigned"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(c=n.filter(b=>b.to_tank_id===a.id),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{H(a),B(!0)},className:"rounded-xl relative",disabled:0===c.length,title:0===c.length?"No pending transfers to accept":`${c.length} pending transfer(s)`,children:[(0,b.jsx)(x.Package,{className:"h-4 w-4 mr-2"}),"Accept Transfer",c.length>0&&(0,b.jsx)(z.Badge,{className:"ml-2 h-5 min-w-5 bg-orange-500 text-white text-xs",children:c.length})]})),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{H(a),D(!0)},className:"rounded-xl",children:[(0,b.jsx)(v,{className:"h-4 w-4 mr-2"}),"Transfer Stock"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>ac(a),className:"rounded-xl text-red-600 hover:text-red-700 hover:bg-red-50",children:[(0,b.jsx)(y.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]},a.id)})}),(0,b.jsx)(u.Dialog,{open:s,onOpenChange:B,children:(0,b.jsxs)(u.DialogContent,{className:"rounded-2xl max-w-lg",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Accept Stock Transfer"}),(0,b.jsxs)(u.DialogDescription,{children:["Accept incoming stock transfers for ",G?.tank_name,". Stock can only be received via approved transfers from other branches."]})]}),(0,b.jsx)("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:G&&0===n.filter(a=>a.to_tank_id===G.id).length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(x.Package,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"No pending transfers for this tank"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:"Transfers must be initiated from another branch"})]}):G&&n.filter(a=>a.to_tank_id===G.id).map(a=>(0,b.jsx)(g.Card,{className:"rounded-xl",children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("p",{className:"font-medium",children:[Number(a.quantity).toLocaleString()," litres"]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["From: ",a.from_branch_name," - ",a.from_tank_name]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Requested by: ",a.requested_by||"Unknown"]}),a.notes&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Notes: ",a.notes]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[new Date(a.created_at).toLocaleDateString()," ",new Date(a.created_at).toLocaleTimeString()]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>$(a.id),className:"rounded-lg text-red-600 hover:bg-red-50",children:"Reject"}),(0,b.jsx)(f.Button,{size:"sm",onClick:()=>Z(a.id),disabled:I===a.id,className:"rounded-lg",children:I===a.id?"Accepting...":"Accept"})]})]})})},a.id))}),(0,b.jsx)(u.DialogFooter,{children:(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>B(!1),className:"rounded-xl",children:"Close"})})]})}),(0,b.jsx)(u.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(u.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Transfer Stock"}),(0,b.jsxs)(u.DialogDescription,{children:["Transfer stock from ",G?.tank_name," to another tank"]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Destination Branch"}),(0,b.jsxs)(t.Select,{value:Q.toBranchId||void 0,onValueChange:a=>R({...Q,toBranchId:a,toTankId:""}),children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{placeholder:"Select branch"})}),(0,b.jsx)(t.SelectContent,{children:j.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Destination Tank"}),(0,b.jsxs)(t.Select,{value:Q.toTankId,onValueChange:a=>R({...Q,toTankId:a}),disabled:M,children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{placeholder:M?"Loading tanks...":"Select tank"})}),(0,b.jsxs)(t.SelectContent,{children:[K.filter(a=>a.id!==G?.id&&a.fuel_type===G?.fuel_type).map(a=>(0,b.jsxs)(t.SelectItem,{value:a.id,children:[a.tank_name," (",a.fuel_type,")"]},a.id)),0===K.filter(a=>a.id!==G?.id&&a.fuel_type===G?.fuel_type).length&&!M&&(0,b.jsx)("div",{className:"px-2 py-1 text-sm text-muted-foreground",children:"No matching tanks found"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Quantity to Transfer (Litres)"}),(0,b.jsx)(h.Input,{type:"number",placeholder:"e.g., 1000",value:Q.quantity,onChange:a=>R({...Q,quantity:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Transfer Notes"}),(0,b.jsx)(h.Input,{placeholder:"Reason for transfer",value:Q.notes,onChange:a=>R({...Q,notes:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Requested By"}),(0,b.jsx)(h.Input,{placeholder:"Your name",value:Q.requestedBy,onChange:a=>R({...Q,requestedBy:a.target.value}),className:"rounded-xl"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"This transfer requires approval before taking effect."})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>D(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:aa,className:"rounded-xl",children:"Submit Transfer Request"})]})]})}),(0,b.jsx)(u.Dialog,{open:E,onOpenChange:F,children:(0,b.jsxs)(u.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Add New Tank"}),(0,b.jsx)(u.DialogDescription,{children:"Add a new fuel tank to this branch"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Tank Name"}),(0,b.jsx)(h.Input,{placeholder:"e.g., Tank 03",value:S.tankName,onChange:a=>T({...S,tankName:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Fuel Type"}),(0,b.jsxs)(t.Select,{value:S.fuelType,onValueChange:a=>T({...S,fuelType:a}),children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"Petrol",children:"Petrol"}),(0,b.jsx)(t.SelectItem,{value:"Diesel",children:"Diesel"}),(0,b.jsx)(t.SelectItem,{value:"Kerosene",children:"Kerosene"}),(0,b.jsx)(t.SelectItem,{value:"Super",children:"Super"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Tank Capacity (Litres)"}),(0,b.jsx)(h.Input,{type:"number",placeholder:"e.g., 10000",value:S.capacity,onChange:a=>T({...S,capacity:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Initial Stock (Litres)"}),(0,b.jsx)(h.Input,{type:"number",placeholder:"e.g., 5000",value:S.initialStock,onChange:a=>T({...S,initialStock:a.target.value}),className:"rounded-xl"})]})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>F(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:ab,className:"rounded-xl",children:"Add Tank"})]})]})})]}):(0,b.jsx)("div",{className:"p-6 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Please select a branch to view tank management."})})}var C=a.i(24569);function D({branchId:a}){let[d,e]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[v,x]=(0,c.useState)(null),[B,D]=(0,c.useState)({dispenser_id:"",nozzle_number:"1",fuel_type:"Diesel",initial_meter_reading:"0"});(0,c.useEffect)(()=>{a&&E()},[a]);let E=async()=>{n(!0);try{let[b,c]=await Promise.all([fetch(`/api/nozzles?branch_id=${a}`),fetch(`/api/dispensers?branch_id=${a}`)]),d=await b.json(),f=await c.json();d.success&&e(d.data||[]),f.success&&l(f.data||[])}catch(a){console.error("Error fetching data:",a),A.toast.error("Failed to load nozzles")}finally{n(!1)}},F=async()=>{if(!B.dispenser_id)return void A.toast.error("Please select a dispenser");try{let b=await fetch("/api/nozzles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:a,dispenser_id:B.dispenser_id,nozzle_number:parseInt(B.nozzle_number),fuel_type:B.fuel_type,initial_meter_reading:parseFloat(B.initial_meter_reading)||0,status:"active"})}),c=await b.json();c.success?(A.toast.success("Nozzle added successfully"),q(!1),I(),E()):A.toast.error(c.error||"Failed to add nozzle")}catch(a){console.error("Error adding nozzle:",a),A.toast.error("Failed to add nozzle")}},G=async()=>{if(v)try{let a=await fetch("/api/nozzles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:v.id,dispenser_id:B.dispenser_id,nozzle_number:parseInt(B.nozzle_number),fuel_type:B.fuel_type,status:v.status,initial_meter_reading:parseFloat(B.initial_meter_reading)||0})}),b=await a.json();b.success?(A.toast.success("Nozzle updated successfully"),s(!1),x(null),I(),E()):A.toast.error(b.error||"Failed to update nozzle")}catch(a){console.error("Error updating nozzle:",a),A.toast.error("Failed to update nozzle")}},H=async a=>{if(confirm(`Are you sure you want to delete nozzle D${a.dispenser_number}N${a.nozzle_number}?`))try{let b=await fetch("/api/nozzles",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id})}),c=await b.json();c.success?(A.toast.success("Nozzle deleted successfully"),E()):A.toast.error(c.error||"Failed to delete nozzle")}catch(a){console.error("Error deleting nozzle:",a),A.toast.error("Failed to delete nozzle")}},I=()=>{D({dispenser_id:"",nozzle_number:"1",fuel_type:"Diesel",initial_meter_reading:"0"})},J=a=>`D${a.dispenser_number} - ${a.fuel_type||"Unknown"} (${a.tank_name||"No tank"})`;return a?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Fuel,{className:"h-5 w-5"}),"Nozzle Management"]}),(0,b.jsxs)(f.Button,{onClick:()=>{I(),q(!0)},children:[(0,b.jsx)(w.Plus,{className:"h-4 w-4 mr-2"}),"Add Nozzle"]})]}),(0,b.jsx)(g.CardContent,{children:m?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading nozzles..."}):0===d.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No nozzles found. Click "Add Nozzle" to create one.'}):(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Nozzle"}),(0,b.jsx)(j.TableHead,{children:"Dispenser"}),(0,b.jsx)(j.TableHead,{children:"Fuel Type"}),(0,b.jsx)(j.TableHead,{children:"Status"}),(0,b.jsx)(j.TableHead,{children:"Current Meter Reading"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(j.TableBody,{children:d.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsxs)(j.TableCell,{className:"font-medium",children:["D",a.dispenser_number,"N",a.nozzle_number]}),(0,b.jsxs)(j.TableCell,{children:["Dispenser ",a.dispenser_number]}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(z.Badge,{variant:"Diesel"===a.fuel_type?"default":"secondary",children:a.fuel_type})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(z.Badge,{variant:"active"===a.status?"default":"destructive",children:a.status})}),(0,b.jsx)(j.TableCell,{children:a.initial_meter_reading?.toLocaleString()||0}),(0,b.jsxs)(j.TableCell,{className:"text-right",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{x(a),D({dispenser_id:a.dispenser_id,nozzle_number:a.nozzle_number.toString(),fuel_type:a.fuel_type,initial_meter_reading:(a.initial_meter_reading||0).toString()}),s(!0)},children:(0,b.jsx)(C.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>H(a),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4 text-red-500"})})]})]},a.id))})]})})]}),(0,b.jsx)(u.Dialog,{open:p,onOpenChange:q,children:(0,b.jsxs)(u.DialogContent,{children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Add New Nozzle"}),(0,b.jsx)(u.DialogDescription,{children:"Add a nozzle to a dispenser. The nozzle will be used for recording sales."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Dispenser"}),(0,b.jsxs)(t.Select,{value:B.dispenser_id,onValueChange:a=>D({...B,dispenser_id:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{placeholder:"Select dispenser"})}),(0,b.jsx)(t.SelectContent,{children:k.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:J(a)},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Nozzle Number"}),(0,b.jsx)(h.Input,{type:"number",min:"1",value:B.nozzle_number,onChange:a=>D({...B,nozzle_number:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Fuel Type"}),(0,b.jsxs)(t.Select,{value:B.fuel_type,onValueChange:a=>D({...B,fuel_type:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"Diesel",children:"Diesel"}),(0,b.jsx)(t.SelectItem,{value:"Petrol",children:"Petrol"}),(0,b.jsx)(t.SelectItem,{value:"Kerosene",children:"Kerosene"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Current Meter Reading"}),(0,b.jsx)(h.Input,{type:"number",min:"0",value:B.initial_meter_reading,onChange:a=>D({...B,initial_meter_reading:a.target.value})})]})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:F,children:"Add Nozzle"})]})]})}),(0,b.jsx)(u.Dialog,{open:r,onOpenChange:s,children:(0,b.jsxs)(u.DialogContent,{children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Edit Nozzle"}),(0,b.jsx)(u.DialogDescription,{children:"Update nozzle details."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Dispenser"}),(0,b.jsxs)(t.Select,{value:B.dispenser_id,onValueChange:a=>D({...B,dispenser_id:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{placeholder:"Select dispenser"})}),(0,b.jsx)(t.SelectContent,{children:k.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:J(a)},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Nozzle Number"}),(0,b.jsx)(h.Input,{type:"number",min:"1",value:B.nozzle_number,onChange:a=>D({...B,nozzle_number:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Fuel Type"}),(0,b.jsxs)(t.Select,{value:B.fuel_type,onValueChange:a=>D({...B,fuel_type:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"Diesel",children:"Diesel"}),(0,b.jsx)(t.SelectItem,{value:"Petrol",children:"Petrol"}),(0,b.jsx)(t.SelectItem,{value:"Kerosene",children:"Kerosene"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Current Meter Reading"}),(0,b.jsx)(h.Input,{type:"number",min:"0",value:B.initial_meter_reading,onChange:a=>D({...B,initial_meter_reading:a.target.value})})]})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:G,children:"Save Changes"})]})]})})]}):(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-6 text-center text-muted-foreground",children:"Please select a branch to manage nozzles"})})}var E=a.i(69922),F=a.i(46143);function G({branchId:a}){let[d,e]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[v,x]=(0,c.useState)(!1),[B,D]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)({dispenser_number:"",status:"active"}),[M,N]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&O()},[a]);let O=async()=>{n(!0);try{let[b,c]=await Promise.all([fetch(`/api/dispensers?branch_id=${a}`),fetch(`/api/tanks?branch_id=${a}`)]),d=await b.json(),f=await c.json();d.success&&e(d.data||[]),f.success&&l(f.data||[])}catch(a){console.error("Error fetching data:",a),A.toast.error("Failed to load dispensers")}finally{n(!1)}},P=async()=>{if(!K.dispenser_number)return void A.toast.error("Please enter a dispenser number");try{let b=await fetch("/api/dispensers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:a,dispenser_number:parseInt(K.dispenser_number),fuel_type:"Pending",status:K.status,tank_ids:[]})}),c=await b.json();c.success?(A.toast.success("Dispenser added successfully. Now assign tanks to it."),q(!1),U(),O()):A.toast.error(c.error||"Failed to add dispenser")}catch(a){console.error("Error adding dispenser:",a),A.toast.error("Failed to add dispenser")}},Q=async()=>{if(G)try{let b=await fetch("/api/dispensers/assign-tanks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dispenser_id:G.id,tank_ids:M,branch_id:a})}),c=await b.json();c.success?(x(!1),c.createdNozzles&&c.createdNozzles.length>0?(J(c.createdNozzles.map(a=>({...a,meter_reading:"0"}))),D(!0),A.toast.success(`Tanks assigned. Please enter meter readings for ${c.createdNozzles.length} new nozzle(s).`)):(A.toast.success("Tanks assigned successfully"),H(null),N([]),O())):A.toast.error(c.error||"Failed to assign tanks")}catch(a){console.error("Error assigning tanks:",a),A.toast.error("Failed to assign tanks")}},R=async()=>{for(let a of I){let b=parseFloat(a.meter_reading);if(isNaN(b)||b<0)return void A.toast.error(`Invalid meter reading for D${a.dispenser_number}N${a.nozzle_number}`)}try{let a=!1;for(let b of I){let c=await fetch("/api/nozzles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:b.id,initial_meter_reading:parseFloat(b.meter_reading)||0})});(await c.json()).success||(a=!0,A.toast.error(`Failed to save reading for D${b.dispenser_number}N${b.nozzle_number}`))}a||A.toast.success("Meter readings saved successfully"),D(!1),J([]),H(null),N([]),O()}catch(a){console.error("Error saving meter readings:",a),A.toast.error("Failed to save meter readings")}},S=async()=>{if(G)try{let a=await fetch("/api/dispensers",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:G.id,dispenser_number:parseInt(K.dispenser_number),status:K.status})}),b=await a.json();b.success?(A.toast.success("Dispenser updated successfully"),s(!1),H(null),U(),O()):A.toast.error(b.error||"Failed to update dispenser")}catch(a){console.error("Error updating dispenser:",a),A.toast.error("Failed to update dispenser")}},T=async a=>{if(confirm(`Are you sure you want to delete Dispenser ${a.dispenser_number}? This will also delete all associated nozzles.`))try{let b=await fetch("/api/dispensers",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id})}),c=await b.json();c.success?(A.toast.success("Dispenser deleted successfully"),O()):A.toast.error(c.error||"Failed to delete dispenser")}catch(a){console.error("Error deleting dispenser:",a),A.toast.error("Failed to delete dispenser")}},U=()=>{L({dispenser_number:"",status:"active"})},V=k.filter(a=>"active"===a.status);return m?(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Fuel,{className:"h-5 w-5"}),"Manage Dispensers"]})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading dispensers..."})})]}):(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Fuel,{className:"h-5 w-5"}),"Manage Dispensers"]}),(0,b.jsxs)(f.Button,{onClick:()=>q(!0),className:"rounded-xl",children:[(0,b.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Add Dispenser"]})]}),(0,b.jsx)(g.CardContent,{children:0===d.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:'No dispensers found. Click "Add Dispenser" to create one.'}):(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Dispenser #"}),(0,b.jsx)(j.TableHead,{children:"Assigned Tanks"}),(0,b.jsx)(j.TableHead,{children:"Fuel Types"}),(0,b.jsx)(j.TableHead,{children:"Item"}),(0,b.jsx)(j.TableHead,{children:"Status"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(j.TableBody,{children:d.map(a=>{let c;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsxs)(j.TableCell,{className:"font-medium",children:["D",a.dispenser_number]}),(0,b.jsx)(j.TableCell,{children:0===(c=a.tank_ids||(a.tank_id?[a.tank_id]:[])).length?"None":k.filter(a=>c.includes(a.id)).map(a=>a.tank_name).join(", ")||"None"}),(0,b.jsx)(j.TableCell,{children:a.fuel_type||"Pending"}),(0,b.jsx)(j.TableCell,{children:a.item_name||"-"}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(z.Badge,{variant:"active"===a.status?"default":"secondary",children:a.status})}),(0,b.jsxs)(j.TableCell,{className:"text-right space-x-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{H(a),N(a.tank_ids||(a.tank_id?[a.tank_id]:[])),x(!0)},className:"rounded-xl",children:[(0,b.jsx)(E.Link2,{className:"h-4 w-4 mr-1"}),"Assign Tanks"]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>{H(a),L({dispenser_number:a.dispenser_number.toString(),status:a.status}),s(!0)},className:"rounded-xl",children:(0,b.jsx)(C.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>T(a),className:"rounded-xl text-red-500 hover:text-red-700",children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]})]},a.id)})})]})}),(0,b.jsx)(u.Dialog,{open:p,onOpenChange:q,children:(0,b.jsxs)(u.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Add New Dispenser"}),(0,b.jsx)(u.DialogDescription,{children:"Create a new dispenser. After adding, assign tanks to it."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Dispenser Number"}),(0,b.jsx)(h.Input,{type:"number",placeholder:"e.g., 1",value:K.dispenser_number,onChange:a=>L({...K,dispenser_number:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Status"}),(0,b.jsxs)(t.Select,{value:K.status,onValueChange:a=>L({...K,status:a}),children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"active",children:"Active"}),(0,b.jsx)(t.SelectItem,{value:"inactive",children:"Inactive"}),(0,b.jsx)(t.SelectItem,{value:"maintenance",children:"Maintenance"})]})]})]})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>q(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:P,className:"rounded-xl",children:"Add Dispenser"})]})]})}),(0,b.jsx)(u.Dialog,{open:r,onOpenChange:s,children:(0,b.jsxs)(u.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Edit Dispenser"}),(0,b.jsx)(u.DialogDescription,{children:"Update dispenser details."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Dispenser Number"}),(0,b.jsx)(h.Input,{type:"number",value:K.dispenser_number,onChange:a=>L({...K,dispenser_number:a.target.value}),className:"rounded-xl"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Status"}),(0,b.jsxs)(t.Select,{value:K.status,onValueChange:a=>L({...K,status:a}),children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"active",children:"Active"}),(0,b.jsx)(t.SelectItem,{value:"inactive",children:"Inactive"}),(0,b.jsx)(t.SelectItem,{value:"maintenance",children:"Maintenance"})]})]})]})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>s(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:S,className:"rounded-xl",children:"Save Changes"})]})]})}),(0,b.jsx)(u.Dialog,{open:v,onOpenChange:x,children:(0,b.jsxs)(u.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsxs)(u.DialogTitle,{children:["Assign Tanks to Dispenser ",G?.dispenser_number]}),(0,b.jsx)(u.DialogDescription,{children:"Select tanks this dispenser will serve. Nozzles will be automatically created for each tank."})]}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{className:"mb-2 block",children:"Select Active Tanks"}),(0,b.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-3",children:0===V.length?(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No active tanks available"}):V.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(F.Checkbox,{id:`assign-tank-${a.id}`,checked:M.includes(a.id),onCheckedChange:b=>{b?N([...M,a.id]):N(M.filter(b=>b!==a.id))}}),(0,b.jsxs)("label",{htmlFor:`assign-tank-${a.id}`,className:"text-sm cursor-pointer flex-1",children:[(0,b.jsx)("span",{className:"font-medium",children:a.tank_name}),(0,b.jsxs)("span",{className:"text-muted-foreground ml-2",children:["- ",a.fuel_type]}),a.item_id&&(0,b.jsx)("span",{className:"text-green-600 ml-2",children:"(Item linked)"})]})]},a.id))}),M.length>0&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:[M.length," tank(s) selected - ",M.length," nozzle(s) will be created"]})]})}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{x(!1),N([])},className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:Q,className:"rounded-xl",children:"Assign Tanks & Create Nozzles"})]})]})}),(0,b.jsx)(u.Dialog,{open:B,onOpenChange:D,children:(0,b.jsxs)(u.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:"Enter Nozzle Meter Readings"}),(0,b.jsx)(u.DialogDescription,{children:"Enter the current meter readings for the newly created nozzles."})]}),(0,b.jsx)("div",{className:"space-y-4 max-h-[400px] overflow-y-auto",children:I.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-medium",children:["D",a.dispenser_number,"N",a.nozzle_number]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.tank_name," - ",a.fuel_type]})]}),(0,b.jsxs)("div",{className:"w-40",children:[(0,b.jsx)(i.Label,{className:"text-xs",children:"Meter Reading"}),(0,b.jsx)(h.Input,{type:"number",min:"0",step:"0.01",value:a.meter_reading,onChange:b=>{var c,d;return c=a.id,d=b.target.value,void J(a=>a.map(a=>a.id===c?{...a,meter_reading:d}:a))},placeholder:"0"})]})]},a.id))}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{D(!1),J([]),H(null),N([]),O()},className:"rounded-xl",children:"Skip"}),(0,b.jsx)(f.Button,{onClick:R,className:"rounded-xl",children:"Save Meter Readings"})]})]})})]})}var H=a.i(80281),I=a.i(76504),J=a.i(79360);function K(){let[a,d]=(0,c.useState)([]),[e,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),[t,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[B,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(""),{formatCurrency:G}=(0,s.useCurrency)(),[K,L]=(0,c.useState)({salePrice:"",purchasePrice:"",isAvailable:!0});(0,c.useEffect)(()=>{M()},[]),(0,c.useEffect)(()=>{B&&N()},[B]);let M=async()=>{try{let a=localStorage.getItem("selectedBranch");if(a){let b=JSON.parse(a);if(b.id){D(b.id),F(b.name||"");return}}let b=await fetch("/api/auth/session"),c=await b.json();if(c.success&&c.session?.branch_id){D(c.session.branch_id);let a=await fetch(`/api/branches/${c.session.branch_id}`),b=await a.json();b.success&&F(b.branch?.name||"")}else{let a=await fetch("/api/branches"),b=await a.json();if(b.success&&b.data?.length>0){let a=b.data[0];D(a.id),F(a.name)}}}catch(a){console.error("Error fetching branch:",a)}},N=async()=>{if(B){k(!0);try{let a=await fetch(`/api/branch-items?branchId=${B}`),b=await a.json();b.success?d(b.items||[]):A.toast.error(b.error||"Failed to fetch items")}catch(a){console.error("Error fetching branch items:",a),A.toast.error("Failed to fetch items")}finally{k(!1)}}},O=async()=>{if(t&&B){if(!K.salePrice)return void A.toast.error("Sale price is required");x(!0);try{if(t.is_assigned&&t.branch_item_id){let a=await fetch("/api/branch-items",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchItemId:t.branch_item_id,salePrice:parseFloat(K.salePrice),purchasePrice:K.purchasePrice?parseFloat(K.purchasePrice):null,isAvailable:K.isAvailable})}),b=await a.json();b.success?(A.toast.success("Item price updated"),p(!1),N()):A.toast.error(b.error||"Failed to update price")}else{let a=await fetch("/api/branch-items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchId:B,itemId:t.item_id,salePrice:parseFloat(K.salePrice),purchasePrice:K.purchasePrice?parseFloat(K.purchasePrice):null})}),b=await a.json();b.success?(A.toast.success("Item assigned to branch with custom pricing"),p(!1),N()):A.toast.error(b.error||"Failed to assign item")}}catch(a){console.error("Error saving price:",a),A.toast.error("Failed to save price")}finally{x(!1)}}},P=async a=>{if(a.branch_item_id&&confirm("Remove this item from the branch? This will make it unavailable for sales at this location."))try{let b=await fetch(`/api/branch-items?id=${a.branch_item_id}`,{method:"DELETE"}),c=await b.json();c.success?(A.toast.success("Item removed from branch"),N()):A.toast.error(c.error||"Failed to remove item")}catch(a){console.error("Error removing item:",a),A.toast.error("Failed to remove item")}},Q=a.filter(a=>a.item_name.toLowerCase().includes(l.toLowerCase())||a.item_code.toLowerCase().includes(l.toLowerCase()));return B?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(g.Card,{className:"rounded-2xl shadow-lg border-2",children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(r.DollarSign,{className:"h-5 w-5"}),"Set Prices"]}),(0,b.jsxs)(g.CardDescription,{children:["Manage selling prices for items at ",E||"your branch"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[E&&(0,b.jsx)(z.Badge,{variant:"outline",className:"text-sm",children:E}),(0,b.jsxs)(f.Button,{variant:"outline",onClick:N,className:"rounded-xl",children:[(0,b.jsx)(q.RefreshCw,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(h.Input,{placeholder:"Search items...",value:l,onChange:a=>m(a.target.value),className:"pl-9 rounded-xl"})]})}),e?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading items..."}):0===Q.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No items found. Add items in Item Management first."}):(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Item Code"}),(0,b.jsx)(j.TableHead,{children:"Name"}),(0,b.jsx)(j.TableHead,{children:"Type"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Selling Price"}),(0,b.jsx)(j.TableHead,{children:"Status"}),(0,b.jsx)(j.TableHead,{className:"text-right w-[50px]"})]})}),(0,b.jsx)(j.TableBody,{children:Q.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-mono text-sm",children:a.item_code}),(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.item_name}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(z.Badge,{variant:"outline",className:"capitalize",children:a.item_type})}),(0,b.jsx)(j.TableCell,{className:"text-right font-medium",children:a.is_assigned&&null!==a.branch_sale_price?G(a.branch_sale_price):(0,b.jsx)("span",{className:"text-muted-foreground",children:"Not set"})}),(0,b.jsx)(j.TableCell,{children:a.is_assigned?!1!==a.is_available?(0,b.jsx)(z.Badge,{className:"bg-green-100 text-green-800",children:"Active"}):(0,b.jsx)(z.Badge,{className:"bg-gray-100 text-gray-800",children:"Disabled"}):(0,b.jsx)(z.Badge,{className:"bg-yellow-100 text-yellow-800",children:"Not Assigned"})}),(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)(I.DropdownMenu,{children:[(0,b.jsx)(I.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,b.jsx)(J.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsxs)(I.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(I.DropdownMenuItem,{onClick:()=>{v(a),L({salePrice:a.branch_sale_price?.toString()||"",purchasePrice:a.branch_purchase_price?.toString()||"",isAvailable:!1!==a.is_available}),p(!0)},children:[(0,b.jsx)(C.Edit,{className:"h-4 w-4 mr-2"}),a.is_assigned?"Edit Price":"Set Price"]}),a.is_assigned&&a.branch_item_id&&(0,b.jsxs)(I.DropdownMenuItem,{onClick:()=>P(a),className:"text-red-600",children:[(0,b.jsx)(y.Trash2,{className:"h-4 w-4 mr-2"}),"Remove from Branch"]})]})]})})]},a.item_id))})]})]})]}),(0,b.jsx)(u.Dialog,{open:o,onOpenChange:p,children:(0,b.jsxs)(u.DialogContent,{children:[(0,b.jsxs)(u.DialogHeader,{children:[(0,b.jsx)(u.DialogTitle,{children:t?.is_assigned?"Edit Selling Price":"Set Selling Price"}),(0,b.jsx)(u.DialogDescription,{children:t?.is_assigned?"Update the selling price for this item":"Set the selling price for this item at your branch"})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{className:"text-muted-foreground",children:"Item"}),(0,b.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,b.jsx)("p",{className:"font-medium",children:t?.item_name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:t?.item_code})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"salePrice",children:"Selling Price *"}),(0,b.jsx)(h.Input,{id:"salePrice",type:"number",step:"0.01",value:K.salePrice,onChange:a=>L({...K,salePrice:a.target.value}),placeholder:"Enter selling price",className:"rounded-xl"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"This price is required for sales at this branch"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"purchasePrice",children:"Purchase Price (Optional)"}),(0,b.jsx)(h.Input,{id:"purchasePrice",type:"number",step:"0.01",value:K.purchasePrice,onChange:a=>L({...K,purchasePrice:a.target.value}),placeholder:"Enter purchase price",className:"rounded-xl"})]}),t?.is_assigned&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(i.Label,{htmlFor:"isAvailable",children:"Item Available for Sale"}),(0,b.jsx)(H.Switch,{id:"isAvailable",checked:K.isAvailable,onCheckedChange:a=>L({...K,isAvailable:a})})]})]}),(0,b.jsxs)(u.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>p(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:O,disabled:w,className:"rounded-xl",children:w?"Saving...":"Save Price"})]})]})})]}):(0,b.jsx)(g.Card,{className:"rounded-2xl",children:(0,b.jsx)(g.CardContent,{className:"py-8 text-center text-muted-foreground",children:"Loading branch information..."})})}function L(){let[a,d]=(0,c.useState)("cards"),[e,l]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,A]=(0,c.useState)(""),[C,E]=(0,c.useState)(null),{formatCurrency:F}=(0,s.useCurrency)(),[H,I]=(0,c.useState)([]),[J,L]=(0,c.useState)(""),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(!1);(0,c.useEffect)(()=>{U();try{let a=localStorage.getItem("selectedBranch");if(a){let b=JSON.parse(a);b.id&&L(b.id)}}catch{}},[]);let U=async()=>{try{let a=await fetch("/api/branches"),b=await a.json();b.success&&I(b.data||[])}catch(a){console.error("Error fetching branches:",a)}},V=(0,c.useCallback)(async()=>{if(J){T(!0);try{let a=`/api/stock-report?branch_id=${J}`;u&&(a+=`&start_date=${u}`),w&&(a+=`&end_date=${w}`);let b=await fetch(a),c=await b.json();c.success&&(N(c.data.summary||[]),P(c.data.movements||[]),R(c.data.totals||null))}catch(a){console.error("Error fetching stock report:",a)}finally{T(!1)}}},[J,u,w]);(0,c.useEffect)(()=>{("stockReport"===a||"stockIn"===a||"stockOut"===a)&&V()},[a,V]);let W=O.filter(a=>"receive"===a.adjustment_type||"stock_receive"===a.adjustment_type||"addition"===a.adjustment_type||"increase"===a.adjustment_type||"purchase_receive"===a.adjustment_type||"manual_adjustment"===a.adjustment_type&&a.quantity>0||"transfer_in"===a.adjustment_type),X=O.filter(a=>"sale"===a.adjustment_type||"deduction"===a.adjustment_type||"decrease"===a.adjustment_type||"manual_adjustment"===a.adjustment_type&&a.quantity<0||"transfer_out"===a.adjustment_type||"transfer"===a.adjustment_type),Y=a=>new Date(a).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),Z=a=>({receive:"bg-green-100 text-green-800",stock_receive:"bg-green-100 text-green-800",addition:"bg-green-100 text-green-800",increase:"bg-green-100 text-green-800",purchase_receive:"bg-green-100 text-green-800",sale:"bg-blue-100 text-blue-800",deduction:"bg-red-100 text-red-800",decrease:"bg-red-100 text-red-800",manual_adjustment:"bg-yellow-100 text-yellow-800",transfer_in:"bg-purple-100 text-purple-800",transfer_out:"bg-orange-100 text-orange-800",transfer:"bg-orange-100 text-orange-800"})[a]||"bg-gray-100 text-gray-800";return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-balance",children:"Inventory Management"}),(0,b.jsx)("p",{className:"mt-1 text-muted-foreground text-pretty",children:"Monitor and manage your stock levels"})]})}),"cards"===a&&(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("stockReport"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Stock Report"}),(0,b.jsx)(p.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:"View Report"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Per tank stock summary"})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("stockIn"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Stock In History"}),(0,b.jsx)(k.TrendingUp,{className:"h-4 w-4 text-green-600"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[W.length," Entries"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Stock received & adjusted in"})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("stockOut"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Stock Out History"}),(0,b.jsx)(m,{className:"h-4 w-4 text-red-600"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[X.length," Entries"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Sales & deductions"})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("tankManagement"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Tank Management"}),(0,b.jsx)(o.Fuel,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:"Manage Tanks"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Stock levels & transfers"})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("dispenserManagement"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Dispenser Management"}),(0,b.jsx)(o.Fuel,{className:"h-4 w-4 text-purple-600"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:"Manage Dispensers"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Add dispensers & assign tanks"})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("nozzleManagement"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Nozzle Management"}),(0,b.jsx)(o.Fuel,{className:"h-4 w-4 text-blue-600"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:"Manage Nozzles"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Add & configure nozzles"})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>d("itemPricing"),children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium",children:"Item Pricing"}),(0,b.jsx)(r.DollarSign,{className:"h-4 w-4 text-green-600"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:"Set Prices"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Branch-specific item prices"})]})]})]}),"cards"===a&&Q&&(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Stock Summary"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-green-50 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-green-700",children:"Total Received"}),(0,b.jsxs)("p",{className:"text-xl font-bold text-green-800",children:[Q.total_received.toLocaleString()," L"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-blue-50 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-blue-700",children:"Total Sold"}),(0,b.jsxs)("p",{className:"text-xl font-bold text-blue-800",children:[Q.total_sold.toLocaleString()," L"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-yellow-50 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-yellow-700",children:"Adjusted In/Out"}),(0,b.jsxs)("p",{className:"text-xl font-bold text-yellow-800",children:["+",Q.total_adjusted_in.toLocaleString()," / -",Q.total_adjusted_out.toLocaleString()," L"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-purple-50 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-purple-700",children:"Current Stock"}),(0,b.jsxs)("p",{className:"text-xl font-bold text-purple-800",children:[Q.current_stock.toLocaleString()," L"]})]})]})})]}),"stockReport"===a&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(f.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>d("cards"),children:" Back to Overview"}),(0,b.jsxs)(f.Button,{variant:"outline",className:"rounded-xl",onClick:V,disabled:S,children:[(0,b.jsx)(q.RefreshCw,{className:`h-4 w-4 mr-2 ${S?"animate-spin":""}`}),"Refresh"]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Stock Report by Tank"})}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"w-64",children:[(0,b.jsx)(i.Label,{children:"Branch"}),(0,b.jsxs)(t.Select,{value:J,onValueChange:L,children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{placeholder:"Select branch"})}),(0,b.jsx)(t.SelectContent,{children:H.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Start Date"}),(0,b.jsx)(h.Input,{type:"date",value:u,onChange:a=>v(a.target.value),className:"rounded-xl w-48"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"End Date"}),(0,b.jsx)(h.Input,{type:"date",value:w,onChange:a=>x(a.target.value),className:"rounded-xl w-48"})]})]}),S?(0,b.jsx)("div",{className:"text-center py-8",children:"Loading..."}):0===M.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:J?"No stock data found":"Select a branch to view report"}):(0,b.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Tank"}),(0,b.jsx)(j.TableHead,{children:"Fuel Type"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Capacity"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Current Stock"}),(0,b.jsx)(j.TableHead,{className:"text-right text-green-700",children:"Received"}),(0,b.jsx)(j.TableHead,{className:"text-right text-yellow-700",children:"Adjusted +/-"}),(0,b.jsx)(j.TableHead,{className:"text-right text-blue-700",children:"Sold"}),(0,b.jsx)(j.TableHead,{className:"text-right text-purple-700",children:"Transferred In/Out"})]})}),(0,b.jsx)(j.TableBody,{children:M.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.tank_name}),(0,b.jsx)(j.TableCell,{children:a.fuel_type}),(0,b.jsxs)(j.TableCell,{className:"text-right",children:[Number(a.capacity).toLocaleString()," L"]}),(0,b.jsxs)(j.TableCell,{className:"text-right font-medium",children:[Number(a.current_stock).toLocaleString()," L"]}),(0,b.jsxs)(j.TableCell,{className:"text-right text-green-600",children:["+",Number(a.total_received).toLocaleString()]}),(0,b.jsxs)(j.TableCell,{className:"text-right text-yellow-600",children:["+",Number(a.total_adjusted_in).toLocaleString()," / -",Number(a.total_adjusted_out).toLocaleString()]}),(0,b.jsx)(j.TableCell,{className:"text-right text-blue-600",children:Number(a.total_sold).toLocaleString()}),(0,b.jsxs)(j.TableCell,{className:"text-right text-purple-600",children:["+",Number(a.total_transferred_in).toLocaleString()," / -",Number(a.total_transferred_out).toLocaleString()]})]},a.tank_id))})]})})]})]}),O.length>0&&(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Recent Stock Movements"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Date"}),(0,b.jsx)(j.TableHead,{children:"Tank"}),(0,b.jsx)(j.TableHead,{children:"Type"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Quantity"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Before"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"After"}),(0,b.jsx)(j.TableHead,{children:"Reason"}),(0,b.jsx)(j.TableHead,{children:"KRA Status"})]})}),(0,b.jsx)(j.TableBody,{children:O.slice(0,20).map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"text-sm",children:Y(a.created_at)}),(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.tank_name}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(z.Badge,{className:Z(a.adjustment_type),children:a.adjustment_type.replace(/_/g," ")})}),(0,b.jsxs)(j.TableCell,{className:`text-right font-medium ${a.quantity>=0?"text-green-600":"text-red-600"}`,children:[a.quantity>=0?"+":"",Number(a.quantity).toLocaleString()]}),(0,b.jsx)(j.TableCell,{className:"text-right",children:Number(a.previous_stock).toLocaleString()}),(0,b.jsx)(j.TableCell,{className:"text-right",children:Number(a.new_stock).toLocaleString()}),(0,b.jsx)(j.TableCell,{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:a.reason||"-"}),(0,b.jsx)(j.TableCell,{children:"synced"===a.kra_sync_status?(0,b.jsx)(z.Badge,{className:"bg-green-100 text-green-800",children:"Synced"}):"failed"===a.kra_sync_status?(0,b.jsx)(z.Badge,{className:"bg-red-100 text-red-800",children:"Failed"}):(0,b.jsx)(z.Badge,{className:"bg-gray-100 text-gray-600",children:"Pending"})})]},a.id))})]})})})]})]}),("stockIn"===a||"stockOut"===a)&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(f.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>d("cards"),children:" Back to Overview"}),(0,b.jsxs)(f.Button,{variant:"outline",className:"rounded-xl",onClick:V,disabled:S,children:[(0,b.jsx)(q.RefreshCw,{className:`h-4 w-4 mr-2 ${S?"animate-spin":""}`}),"Refresh"]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"stockIn"===a?"Stock In History":"Stock Out History"})}),(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"w-64",children:[(0,b.jsx)(i.Label,{children:"Branch"}),(0,b.jsxs)(t.Select,{value:J,onValueChange:L,children:[(0,b.jsx)(t.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(t.SelectValue,{placeholder:"Select branch"})}),(0,b.jsx)(t.SelectContent,{children:H.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(i.Label,{children:"Search"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(h.Input,{placeholder:"Search by tank or reason...",value:e,onChange:a=>l(a.target.value),className:"pl-9 rounded-xl"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Start Date"}),(0,b.jsx)(h.Input,{type:"date",value:u,onChange:a=>v(a.target.value),className:"rounded-xl w-48"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"End Date"}),(0,b.jsx)(h.Input,{type:"date",value:w,onChange:a=>x(a.target.value),className:"rounded-xl w-48"})]})]}),S?(0,b.jsx)("div",{className:"text-center py-8",children:"Loading..."}):(0,b.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Date"}),(0,b.jsx)(j.TableHead,{children:"Tank"}),(0,b.jsx)(j.TableHead,{children:"Fuel Type"}),(0,b.jsx)(j.TableHead,{children:"Type"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Quantity"}),(0,b.jsx)(j.TableHead,{children:"Reason"}),(0,b.jsx)(j.TableHead,{children:"KRA Status"})]})}),(0,b.jsxs)(j.TableBody,{children:[("stockIn"===a?W:X).filter(a=>""===e||a.tank_name?.toLowerCase().includes(e.toLowerCase())||a.reason?.toLowerCase().includes(e.toLowerCase())).map(c=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"text-sm",children:Y(c.created_at)}),(0,b.jsx)(j.TableCell,{className:"font-medium",children:c.tank_name}),(0,b.jsx)(j.TableCell,{children:c.fuel_type}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(z.Badge,{className:Z(c.adjustment_type),children:c.adjustment_type.replace(/_/g," ")})}),(0,b.jsxs)(j.TableCell,{className:`text-right font-medium ${"stockIn"===a?"text-green-600":"text-red-600"}`,children:["stockIn"===a?"+":"-",Math.abs(Number(c.quantity)).toLocaleString()," L"]}),(0,b.jsx)(j.TableCell,{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:c.reason||"-"}),(0,b.jsx)(j.TableCell,{children:"synced"===c.kra_sync_status?(0,b.jsx)(z.Badge,{className:"bg-green-100 text-green-800",children:"Synced"}):"failed"===c.kra_sync_status?(0,b.jsx)(z.Badge,{className:"bg-red-100 text-red-800",children:"Failed"}):(0,b.jsx)(z.Badge,{className:"bg-gray-100 text-gray-600",children:"Pending"})})]},c.id)),0===("stockIn"===a?W:X).length&&(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:J?"No stock movements found":"Select a branch to view history"})})]})]})})]})]})]}),"tankManagement"===a&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(f.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>d("cards"),children:" Back to Overview"})}),(0,b.jsx)(B,{branchId:J})]}),"dispenserManagement"===a&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(f.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>d("cards"),children:" Back to Overview"})}),(0,b.jsx)(G,{branchId:J})]}),"nozzleManagement"===a&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(f.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>d("cards"),children:" Back to Overview"})}),(0,b.jsx)(D,{branchId:J})]}),"itemPricing"===a&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(f.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>d("cards"),children:" Back to Overview"})}),(0,b.jsx)(K,{})]})]})}function M(){let[a,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(!1);return(0,b.jsxs)("div",{className:"flex min-h-screen w-full overflow-x-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,b.jsx)(d.DashboardSidebar,{collapsed:a,onToggle:()=>f(!a),mobileOpen:g,onMobileClose:()=>h(!1)}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-w-0 lg:ml-8 my-2 lg:my-6 mx-2 lg:mr-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl lg:rounded-tl-3xl shadow-2xl flex-1 flex flex-col overflow-hidden",children:[(0,b.jsx)(e.DashboardHeader,{onMobileMenuToggle:()=>h(!g)}),(0,b.jsx)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden bg-slate-50 p-3 md:p-6",children:(0,b.jsxs)("div",{className:"w-full max-w-7xl mx-auto space-y-4 md:space-y-6",children:[(0,b.jsx)(L,{}),(0,b.jsxs)("footer",{className:"mt-12 border-t pt-6 pb-4 text-center text-sm text-muted-foreground",children:["Powered by ",(0,b.jsx)("span",{className:"font-semibold text-foreground",children:"Sensile Technologies East Africa Ltd"})]})]})})]})})]})}a.s(["default",()=>M],1194)}];

//# sourceMappingURL=app_inventory_page_tsx_062fe4aa._.js.map