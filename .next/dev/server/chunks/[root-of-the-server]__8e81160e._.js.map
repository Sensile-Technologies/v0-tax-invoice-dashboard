{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/customers/list/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get(\"branch_id\")\n    const vendorId = searchParams.get(\"vendor_id\")\n    const userId = searchParams.get(\"user_id\")\n    \n    let vendorFilter = vendorId\n    \n    if (userId && !vendorFilter) {\n      const userResult = await query(\n        `SELECT v.id as vendor_id FROM users u \n         JOIN vendors v ON v.email = u.email \n         WHERE u.id = $1`,\n        [userId]\n      )\n      if (userResult && userResult.length > 0) {\n        vendorFilter = userResult[0].vendor_id\n      }\n    }\n    \n    let result\n    \n    if (branchId) {\n      result = await query(`\n        SELECT \n          c.id,\n          c.cust_nm as name,\n          c.cust_no as customer_number,\n          c.tel_no as phone,\n          c.email,\n          c.adrs as address,\n          c.use_yn as status,\n          c.branch_id,\n          b.name as branch_name,\n          COALESCE(\n            (SELECT SUM(lt.points_earned) FROM loyalty_transactions lt WHERE lt.customer_phone = c.tel_no AND lt.branch_id = c.branch_id),\n            0\n          ) as total_points,\n          COALESCE(\n            (SELECT COUNT(*) FROM sales s WHERE s.customer_name = c.cust_nm AND s.branch_id = c.branch_id),\n            0\n          ) as total_purchases,\n          (SELECT MAX(lt.transaction_date) FROM loyalty_transactions lt WHERE lt.customer_phone = c.tel_no AND lt.branch_id = c.branch_id) as last_activity\n        FROM customers c\n        LEFT JOIN branches b ON c.branch_id = b.id\n        WHERE c.branch_id = $1 AND c.use_yn = 'Y'\n        ORDER BY c.cust_nm\n      `, [branchId])\n    } else if (vendorFilter) {\n      result = await query(`\n        SELECT \n          c.id,\n          c.cust_nm as name,\n          c.cust_no as customer_number,\n          c.tel_no as phone,\n          c.email,\n          c.adrs as address,\n          c.use_yn as status,\n          c.branch_id,\n          b.name as branch_name,\n          COALESCE(\n            (SELECT SUM(lt.points_earned) FROM loyalty_transactions lt WHERE lt.customer_phone = c.tel_no AND lt.branch_id = c.branch_id),\n            0\n          ) as total_points,\n          COALESCE(\n            (SELECT COUNT(*) FROM sales s WHERE s.customer_name = c.cust_nm AND s.branch_id = c.branch_id),\n            0\n          ) as total_purchases,\n          (SELECT MAX(lt.transaction_date) FROM loyalty_transactions lt WHERE lt.customer_phone = c.tel_no AND lt.branch_id = c.branch_id) as last_activity\n        FROM customers c\n        LEFT JOIN branches b ON c.branch_id = b.id\n        WHERE b.vendor_id = $1 AND c.use_yn = 'Y'\n        ORDER BY c.cust_nm\n      `, [vendorFilter])\n    } else {\n      result = await query(`\n        SELECT \n          c.id,\n          c.cust_nm as name,\n          c.cust_no as customer_number,\n          c.tel_no as phone,\n          c.email,\n          c.adrs as address,\n          c.use_yn as status,\n          c.branch_id,\n          b.name as branch_name,\n          COALESCE(\n            (SELECT SUM(lt.points_earned) FROM loyalty_transactions lt WHERE lt.customer_phone = c.tel_no AND lt.branch_id = c.branch_id),\n            0\n          ) as total_points,\n          COALESCE(\n            (SELECT COUNT(*) FROM sales s WHERE s.customer_name = c.cust_nm AND s.branch_id = c.branch_id),\n            0\n          ) as total_purchases,\n          (SELECT MAX(lt.transaction_date) FROM loyalty_transactions lt WHERE lt.customer_phone = c.tel_no AND lt.branch_id = c.branch_id) as last_activity\n        FROM customers c\n        LEFT JOIN branches b ON c.branch_id = b.id\n        WHERE c.use_yn = 'Y'\n        ORDER BY c.cust_nm\n      `)\n    }\n\n    return NextResponse.json({ customers: result })\n  } catch (error: any) {\n    console.error(\"Error fetching customers:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch customers\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,eAAe;QAEnB,IAAI,UAAU,CAAC,cAAc;YAC3B,MAAM,aAAa,MAAM,IAAA,8HAAK,EAC5B,CAAC;;wBAEe,CAAC,EACjB;gBAAC;aAAO;YAEV,IAAI,cAAc,WAAW,MAAM,GAAG,GAAG;gBACvC,eAAe,UAAU,CAAC,EAAE,CAAC,SAAS;YACxC;QACF;QAEA,IAAI;QAEJ,IAAI,UAAU;YACZ,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;MAwBtB,CAAC,EAAE;gBAAC;aAAS;QACf,OAAO,IAAI,cAAc;YACvB,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;MAwBtB,CAAC,EAAE;gBAAC;aAAa;QACnB,OAAO;YACL,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;MAwBtB,CAAC;QACH;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,WAAW;QAAO;IAC/C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA6B,SAAS,MAAM,OAAO;QAAC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}