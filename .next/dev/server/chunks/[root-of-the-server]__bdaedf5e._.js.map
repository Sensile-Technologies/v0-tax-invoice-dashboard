{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/dashboard/route.ts"],"sourcesContent":["import { query } from \"@/lib/db/client\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const [\n      vendorStats,\n      ticketStats,\n      invoiceStats,\n      recentTickets,\n      recentVendors\n    ] = await Promise.all([\n      query(`\n        SELECT \n          COUNT(*) as total_vendors,\n          COUNT(*) FILTER (WHERE status = 'active') as active_vendors,\n          COUNT(*) FILTER (WHERE created_at > NOW() - INTERVAL '30 days') as new_vendors_30d\n        FROM vendors\n      `),\n      query(`\n        SELECT \n          COUNT(*) as total_tickets,\n          COUNT(*) FILTER (WHERE status = 'open') as open_tickets,\n          COUNT(*) FILTER (WHERE status = 'in_progress') as in_progress_tickets,\n          COUNT(*) FILTER (WHERE status = 'resolved') as resolved_tickets,\n          COUNT(*) FILTER (WHERE priority = 'high' AND status = 'open') as high_priority_open\n        FROM support_tickets\n      `),\n      query(`\n        SELECT \n          COUNT(*) as total_invoices,\n          COUNT(*) FILTER (WHERE status = 'pending') as pending_invoices,\n          COUNT(*) FILTER (WHERE status = 'paid') as paid_invoices,\n          COALESCE(SUM(total_amount) FILTER (WHERE status = 'pending'), 0) as pending_amount,\n          COALESCE(SUM(paid_amount) FILTER (WHERE status = 'paid'), 0) as received_amount\n        FROM invoices\n      `),\n      query(`\n        SELECT t.*, v.name as vendor_name, c.name as category_name, c.color as category_color\n        FROM support_tickets t\n        LEFT JOIN vendors v ON v.id = t.vendor_id\n        LEFT JOIN ticket_categories c ON c.id = t.category_id\n        WHERE t.status IN ('open', 'in_progress')\n        ORDER BY \n          CASE t.priority WHEN 'high' THEN 1 WHEN 'medium' THEN 2 ELSE 3 END,\n          t.created_at DESC\n        LIMIT 5\n      `),\n      query(`\n        SELECT v.*, COUNT(b.id) as branch_count\n        FROM vendors v\n        LEFT JOIN branches b ON b.vendor_id = v.id\n        GROUP BY v.id\n        ORDER BY v.created_at DESC\n        LIMIT 5\n      `)\n    ])\n\n    return NextResponse.json({\n      vendors: vendorStats[0] || { total_vendors: 0, active_vendors: 0, new_vendors_30d: 0 },\n      tickets: ticketStats[0] || { total_tickets: 0, open_tickets: 0, in_progress_tickets: 0, resolved_tickets: 0, high_priority_open: 0 },\n      invoices: invoiceStats[0] || { total_invoices: 0, pending_invoices: 0, paid_invoices: 0, pending_amount: 0, received_amount: 0 },\n      recentTickets,\n      recentVendors\n    })\n  } catch (error: any) {\n    console.error(\"[Admin] Error fetching dashboard:\", error)\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,CACJ,aACA,aACA,cACA,eACA,cACD,GAAG,MAAM,QAAQ,GAAG,CAAC;YACpB,IAAA,8HAAK,EAAC,CAAC;;;;;;MAMP,CAAC;YACD,IAAA,8HAAK,EAAC,CAAC;;;;;;;;MAQP,CAAC;YACD,IAAA,8HAAK,EAAC,CAAC;;;;;;;;MAQP,CAAC;YACD,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;MAUP,CAAC;YACD,IAAA,8HAAK,EAAC,CAAC;;;;;;;MAOP,CAAC;SACF;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS,WAAW,CAAC,EAAE,IAAI;gBAAE,eAAe;gBAAG,gBAAgB;gBAAG,iBAAiB;YAAE;YACrF,SAAS,WAAW,CAAC,EAAE,IAAI;gBAAE,eAAe;gBAAG,cAAc;gBAAG,qBAAqB;gBAAG,kBAAkB;gBAAG,oBAAoB;YAAE;YACnI,UAAU,YAAY,CAAC,EAAE,IAAI;gBAAE,gBAAgB;gBAAG,kBAAkB;gBAAG,eAAe;gBAAG,gBAAgB;gBAAG,iBAAiB;YAAE;YAC/H;YACA;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}