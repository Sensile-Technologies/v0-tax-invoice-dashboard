{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/stock-adjustments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get(\"branch_id\")\n    const tankId = searchParams.get(\"tank_id\")\n\n    let query = \"SELECT * FROM stock_adjustments WHERE 1=1\"\n    const params: any[] = []\n    let paramIndex = 1\n\n    if (branchId) {\n      query += ` AND branch_id = $${paramIndex}`\n      params.push(branchId)\n      paramIndex++\n    }\n\n    if (tankId) {\n      query += ` AND tank_id = $${paramIndex}`\n      params.push(tankId)\n      paramIndex++\n    }\n\n    query += \" ORDER BY created_at DESC\"\n\n    const result = await pool.query(query, params)\n\n    return NextResponse.json({ success: true, data: result.rows })\n  } catch (error) {\n    console.error(\"Error fetching stock adjustments:\", error)\n    return NextResponse.json({ success: false, error: \"Failed to fetch stock adjustments\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { \n      tank_id, \n      branch_id, \n      adjustment_type, \n      quantity, \n      previous_stock, \n      new_stock, \n      reason, \n      requested_by, \n      approval_status \n    } = body\n\n    if (!tank_id || !branch_id || !adjustment_type) {\n      return NextResponse.json({ success: false, error: \"tank_id, branch_id, and adjustment_type are required\" }, { status: 400 })\n    }\n\n    const result = await pool.query(\n      `INSERT INTO stock_adjustments (tank_id, branch_id, adjustment_type, quantity, previous_stock, new_stock, reason, requested_by, approval_status)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)\n       RETURNING *`,\n      [tank_id, branch_id, adjustment_type, quantity || 0, previous_stock || 0, new_stock || 0, reason, requested_by, approval_status || \"pending\"]\n    )\n\n    return NextResponse.json({ success: true, data: result.rows[0] })\n  } catch (error) {\n    console.error(\"Error creating stock adjustment:\", error)\n    return NextResponse.json({ success: false, error: \"Failed to create stock adjustment\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,QAAQ;QACZ,MAAM,SAAgB,EAAE;QACxB,IAAI,aAAa;QAEjB,IAAI,UAAU;YACZ,SAAS,CAAC,kBAAkB,EAAE,YAAY;YAC1C,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,QAAQ;YACV,SAAS,CAAC,gBAAgB,EAAE,YAAY;YACxC,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,SAAS;QAET,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QAEvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM,OAAO,IAAI;QAAC;IAC9D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzG;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,OAAO,EACP,SAAS,EACT,eAAe,EACf,QAAQ,EACR,cAAc,EACd,SAAS,EACT,MAAM,EACN,YAAY,EACZ,eAAe,EAChB,GAAG;QAEJ,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,iBAAiB;YAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAuD,GAAG;gBAAE,QAAQ;YAAI;QAC5H;QAEA,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,CAAC;;kBAEW,CAAC,EACb;YAAC;YAAS;YAAW;YAAiB,YAAY;YAAG,kBAAkB;YAAG,aAAa;YAAG;YAAQ;YAAc,mBAAmB;SAAU;QAG/I,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM,OAAO,IAAI,CAAC,EAAE;QAAC;IACjE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzG;AACF"}}]
}