{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,OAAO,MAAM,KAAK,OAAO;AAC3B"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/reports/expenses/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { pool } from \"@/lib/db\"\nimport { cookies } from \"next/headers\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const cookieStore = await cookies()\n    const sessionCookie = cookieStore.get(\"user_session\")\n    if (!sessionCookie) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const session = JSON.parse(sessionCookie.value)\n    const { vendor_id, branch_id, role } = session\n\n    if (!vendor_id) {\n      return NextResponse.json({ error: \"Vendor ID required\" }, { status: 400 })\n    }\n\n    const searchParams = request.nextUrl.searchParams\n    const dateFrom = searchParams.get(\"dateFrom\")\n    const dateTo = searchParams.get(\"dateTo\")\n    const filterBranchId = searchParams.get(\"branchId\")\n\n    const effectiveBranchId = [\"cashier\", \"supervisor\", \"manager\"].includes(role)\n      ? branch_id\n      : filterBranchId || null\n\n    let query = `\n      SELECT \n        se.id,\n        se.shift_id,\n        se.branch_id,\n        se.expense_account_id,\n        se.amount,\n        se.description,\n        se.created_at,\n        ea.account_name as category,\n        b.name as branch_name,\n        s.start_time as shift_start,\n        s.end_time as shift_end,\n        st.name as recorded_by\n      FROM shift_expenses se\n      JOIN expense_accounts ea ON se.expense_account_id = ea.id\n      JOIN branches b ON se.branch_id = b.id\n      JOIN shifts s ON se.shift_id = s.id\n      LEFT JOIN staff st ON se.created_by = st.id\n      WHERE b.vendor_id = $1\n    `\n    const params: any[] = [vendor_id]\n    let paramIndex = 2\n\n    if (effectiveBranchId) {\n      query += ` AND se.branch_id = $${paramIndex}`\n      params.push(effectiveBranchId)\n      paramIndex++\n    }\n\n    if (dateFrom) {\n      query += ` AND DATE(se.created_at) >= $${paramIndex}`\n      params.push(dateFrom)\n      paramIndex++\n    }\n\n    if (dateTo) {\n      query += ` AND DATE(se.created_at) <= $${paramIndex}`\n      params.push(dateTo)\n      paramIndex++\n    }\n\n    query += ` ORDER BY se.created_at DESC`\n\n    const result = await pool.query(query, params)\n\n    const totalExpense = result.rows.reduce((sum, row) => sum + parseFloat(row.amount || 0), 0)\n\n    const categoryTotals: Record<string, number> = {}\n    result.rows.forEach(row => {\n      const category = row.category || \"Uncategorized\"\n      categoryTotals[category] = (categoryTotals[category] || 0) + parseFloat(row.amount || 0)\n    })\n\n    return NextResponse.json({\n      expenses: result.rows,\n      summary: {\n        totalExpense,\n        transactionCount: result.rows.length,\n        averageExpense: result.rows.length > 0 ? totalExpense / result.rows.length : 0,\n        categoryCount: Object.keys(categoryTotals).length,\n        categoryTotals\n      }\n    })\n  } catch (error) {\n    console.error(\"Error fetching expense report:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch expense report\" },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;;;;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,MAAM,gBAAgB,YAAY,GAAG,CAAC;QACtC,IAAI,CAAC,eAAe;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,UAAU,KAAK,KAAK,CAAC,cAAc,KAAK;QAC9C,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG;QAEvC,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,iBAAiB,aAAa,GAAG,CAAC;QAExC,MAAM,oBAAoB;YAAC;YAAW;YAAc;SAAU,CAAC,QAAQ,CAAC,QACpE,YACA,kBAAkB;QAEtB,IAAI,QAAQ,CAAC;;;;;;;;;;;;;;;;;;;;IAoBb,CAAC;QACD,MAAM,SAAgB;YAAC;SAAU;QACjC,IAAI,aAAa;QAEjB,IAAI,mBAAmB;YACrB,SAAS,CAAC,qBAAqB,EAAE,YAAY;YAC7C,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,UAAU;YACZ,SAAS,CAAC,6BAA6B,EAAE,YAAY;YACrD,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,QAAQ;YACV,SAAS,CAAC,6BAA6B,EAAE,YAAY;YACrD,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,SAAS,CAAC,4BAA4B,CAAC;QAEvC,MAAM,SAAS,MAAM,6HAAI,CAAC,KAAK,CAAC,OAAO;QAEvC,MAAM,eAAe,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,MAAQ,MAAM,WAAW,IAAI,MAAM,IAAI,IAAI;QAEzF,MAAM,iBAAyC,CAAC;QAChD,OAAO,IAAI,CAAC,OAAO,CAAC,CAAA;YAClB,MAAM,WAAW,IAAI,QAAQ,IAAI;YACjC,cAAc,CAAC,SAAS,GAAG,CAAC,cAAc,CAAC,SAAS,IAAI,CAAC,IAAI,WAAW,IAAI,MAAM,IAAI;QACxF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,UAAU,OAAO,IAAI;YACrB,SAAS;gBACP;gBACA,kBAAkB,OAAO,IAAI,CAAC,MAAM;gBACpC,gBAAgB,OAAO,IAAI,CAAC,MAAM,GAAG,IAAI,eAAe,OAAO,IAAI,CAAC,MAAM,GAAG;gBAC7E,eAAe,OAAO,IAAI,CAAC,gBAAgB,MAAM;gBACjD;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiC,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}