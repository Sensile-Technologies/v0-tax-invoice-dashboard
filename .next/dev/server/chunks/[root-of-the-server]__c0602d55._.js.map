{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/notifications/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const userId = searchParams.get(\"user_id\")\n\n    // Check for recurring invoices that are due and create notifications if needed\n    const overdueRecurring = await query(`\n      SELECT i.id, i.invoice_number, v.name as merchant_name, i.next_invoice_date, i.total_amount\n      FROM invoices i\n      LEFT JOIN merchants v ON i.vendor_id = v.id\n      WHERE i.is_recurring = true \n        AND i.next_invoice_date <= CURRENT_DATE\n        AND i.status != 'cancelled'\n    `)\n\n    // Create notifications for overdue recurring invoices if they don't exist\n    for (const invoice of overdueRecurring) {\n      const existingNotification = await query(`\n        SELECT id FROM notifications \n        WHERE reference_id = $1 \n          AND type = 'recurring_invoice_due'\n          AND DATE(created_at) = CURRENT_DATE\n      `, [invoice.id])\n\n      if (existingNotification.length === 0) {\n        await query(`\n          INSERT INTO notifications (user_id, type, title, message, reference_id)\n          VALUES (NULL, 'recurring_invoice_due', $1, $2, $3)\n        `, [\n          `Recurring Invoice Due: ${invoice.invoice_number}`,\n          `Recurring invoice for ${invoice.merchant_name || 'Unknown'} is due. Amount: KES ${Number(invoice.total_amount || 0).toLocaleString()}`,\n          invoice.id\n        ])\n      }\n    }\n\n    const result = await query(`\n      SELECT * FROM notifications \n      WHERE user_id = $1 OR user_id IS NULL\n      ORDER BY created_at DESC \n      LIMIT 20\n    `, [userId])\n    \n    return NextResponse.json(result)\n  } catch (error) {\n    console.error(\"Error fetching notifications:\", error)\n    return NextResponse.json([])\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { user_id, type, title, message, reference_id } = body\n\n    const result = await query(`\n      INSERT INTO notifications (user_id, type, title, message, reference_id)\n      VALUES ($1, $2, $3, $4, $5)\n      RETURNING *\n    `, [user_id, type, title, message, reference_id])\n\n    return NextResponse.json(result[0])\n  } catch (error) {\n    console.error(\"Error creating notification:\", error)\n    return NextResponse.json({ error: \"Failed to create notification\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { id, is_read } = body\n\n    const result = await query(`\n      UPDATE notifications \n      SET is_read = $1, updated_at = NOW()\n      WHERE id = $2\n      RETURNING *\n    `, [is_read, id])\n\n    return NextResponse.json(result[0])\n  } catch (error) {\n    console.error(\"Error updating notification:\", error)\n    return NextResponse.json({ error: \"Failed to update notification\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,+EAA+E;QAC/E,MAAM,mBAAmB,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;IAOtC,CAAC;QAED,0EAA0E;QAC1E,KAAK,MAAM,WAAW,iBAAkB;YACtC,MAAM,uBAAuB,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;MAK1C,CAAC,EAAE;gBAAC,QAAQ,EAAE;aAAC;YAEf,IAAI,qBAAqB,MAAM,KAAK,GAAG;gBACrC,MAAM,IAAA,8HAAK,EAAC,CAAC;;;QAGb,CAAC,EAAE;oBACD,CAAC,uBAAuB,EAAE,QAAQ,cAAc,EAAE;oBAClD,CAAC,sBAAsB,EAAE,QAAQ,aAAa,IAAI,UAAU,qBAAqB,EAAE,OAAO,QAAQ,YAAY,IAAI,GAAG,cAAc,IAAI;oBACvI,QAAQ,EAAE;iBACX;YACH;QACF;QAEA,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;IAK5B,CAAC,EAAE;YAAC;SAAO;QAEX,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC,EAAE;IAC7B;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG;QAExD,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;IAI5B,CAAC,EAAE;YAAC;YAAS;YAAM;YAAO;YAAS;SAAa;QAEhD,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,GAAG;QAExB,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;IAK5B,CAAC,EAAE;YAAC;YAAS;SAAG;QAEhB,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF"}}]
}