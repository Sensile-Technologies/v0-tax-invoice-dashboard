{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/whatsapp-service.ts"],"sourcesContent":["import Twilio from 'twilio'\n\nconst accountSid = process.env.TWILIO_ACCOUNT_SID\nconst authToken = process.env.TWILIO_AUTH_TOKEN\nconst whatsappNumber = process.env.TWILIO_WHATSAPP_NUMBER\n\nlet twilioClient: Twilio.Twilio | null = null\n\nfunction getClient(): Twilio.Twilio {\n  if (!twilioClient) {\n    if (!accountSid || !authToken) {\n      throw new Error('Twilio credentials not configured')\n    }\n    twilioClient = Twilio(accountSid, authToken)\n  }\n  return twilioClient\n}\n\nexport interface DSSRSummary {\n  branchName: string\n  date: string\n  shiftType: string\n  attendantName: string\n  totalSales: number\n  totalVolume: number\n  cashCollected: number\n  mpesaCollected: number\n  creditSales: number\n  variance: number\n  productBreakdown: Array<{\n    product: string\n    volume: number\n    amount: number\n  }>\n}\n\nexport function formatDSSRMessage(summary: DSSRSummary): string {\n  const formatCurrency = (amount: number) => `KES ${amount.toLocaleString('en-KE', { minimumFractionDigits: 2 })}`\n  const formatVolume = (vol: number) => `${vol.toLocaleString('en-KE', { minimumFractionDigits: 2 })} L`\n  \n  let message = `*DSSR - ${summary.branchName}*\\n`\n  message += `Date: ${summary.date}\\n`\n  message += `Shift: ${summary.shiftType}\\n`\n  message += `Attendant: ${summary.attendantName}\\n`\n  message += `─────────────────\\n`\n  message += `*Sales Summary*\\n`\n  message += `Total Sales: ${formatCurrency(summary.totalSales)}\\n`\n  message += `Total Volume: ${formatVolume(summary.totalVolume)}\\n`\n  message += `─────────────────\\n`\n  message += `*Collections*\\n`\n  message += `Cash: ${formatCurrency(summary.cashCollected)}\\n`\n  message += `M-Pesa: ${formatCurrency(summary.mpesaCollected)}\\n`\n  message += `Credit: ${formatCurrency(summary.creditSales)}\\n`\n  message += `─────────────────\\n`\n  \n  if (summary.productBreakdown.length > 0) {\n    message += `*Product Breakdown*\\n`\n    for (const product of summary.productBreakdown) {\n      message += `${product.product}: ${formatVolume(product.volume)} (${formatCurrency(product.amount)})\\n`\n    }\n    message += `─────────────────\\n`\n  }\n  \n  const varianceStatus = summary.variance >= 0 ? '✅' : '⚠️'\n  message += `*Variance: ${varianceStatus} ${formatCurrency(summary.variance)}*\\n`\n  message += `─────────────────\\n`\n  message += `_Sent automatically by Flow360_`\n  \n  return message\n}\n\nexport async function sendWhatsAppMessage(\n  to: string,\n  message: string\n): Promise<{ success: boolean; messageId?: string; error?: string }> {\n  try {\n    if (!whatsappNumber) {\n      throw new Error('Twilio WhatsApp number not configured')\n    }\n    \n    const client = getClient()\n    \n    const toNumber = to.startsWith('+') ? to : `+${to}`\n    const fromNumber = whatsappNumber.startsWith('+') ? whatsappNumber : `+${whatsappNumber}`\n    \n    const result = await client.messages.create({\n      from: `whatsapp:${fromNumber}`,\n      to: `whatsapp:${toNumber}`,\n      body: message\n    })\n    \n    console.log(`[WhatsApp] Message sent successfully. SID: ${result.sid}`)\n    \n    return {\n      success: true,\n      messageId: result.sid\n    }\n  } catch (error: any) {\n    console.error('[WhatsApp] Error sending message:', error.message)\n    return {\n      success: false,\n      error: error.message || 'Failed to send WhatsApp message'\n    }\n  }\n}\n\nexport async function sendDSSRToDirectors(\n  summary: DSSRSummary,\n  directorNumbers: string[]\n): Promise<{ success: boolean; results: Array<{ number: string; success: boolean; error?: string }> }> {\n  const message = formatDSSRMessage(summary)\n  const results: Array<{ number: string; success: boolean; error?: string }> = []\n  \n  for (const number of directorNumbers) {\n    const result = await sendWhatsAppMessage(number, message)\n    results.push({\n      number,\n      success: result.success,\n      error: result.error\n    })\n  }\n  \n  const allSuccess = results.every(r => r.success)\n  \n  return {\n    success: allSuccess,\n    results\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/shifts/reconcile/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\nimport { sendDSSRToDirectors, DSSRSummary } from \"@/lib/whatsapp-service\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function POST(request: NextRequest) {\n  const client = await pool.connect()\n  try {\n    const body = await request.json()\n    const { shift_id, attendant_collections, expenses, banking, notes } = body\n\n    if (!shift_id) {\n      return NextResponse.json(\n        { error: \"shift_id is required\" },\n        { status: 400 }\n      )\n    }\n\n    await client.query('BEGIN')\n\n    const shiftCheck = await client.query(\n      `SELECT s.*, b.vendor_id FROM shifts s\n       JOIN branches b ON s.branch_id = b.id\n       WHERE s.id = $1`,\n      [shift_id]\n    )\n\n    if (shiftCheck.rows.length === 0) {\n      await client.query('ROLLBACK')\n      client.release()\n      return NextResponse.json(\n        { error: \"Shift not found\" },\n        { status: 404 }\n      )\n    }\n\n    const shift = shiftCheck.rows[0]\n    const branchId = shift.branch_id\n    const vendorId = shift.vendor_id\n\n    if (shift.reconciliation_status === 'reconciled') {\n      await client.query('ROLLBACK')\n      client.release()\n      return NextResponse.json(\n        { error: \"Shift has already been reconciled\" },\n        { status: 400 }\n      )\n    }\n\n    // Collections, expenses, and banking are now optional for reconciliation\n\n    await client.query(\n      `DELETE FROM attendant_collections WHERE shift_id = $1`,\n      [shift_id]\n    )\n    \n    if (attendant_collections && attendant_collections.length > 0) {\n      for (const collection of attendant_collections) {\n        if (collection.attendant_id && collection.payments && Array.isArray(collection.payments)) {\n          for (const payment of collection.payments) {\n            if (payment.payment_method && payment.amount > 0) {\n              await client.query(\n                `INSERT INTO attendant_collections (shift_id, branch_id, staff_id, payment_method, amount, is_app_payment)\n                 VALUES ($1, $2, $3, $4, $5, false)`,\n                [shift_id, branchId, collection.attendant_id, payment.payment_method, payment.amount]\n              )\n            }\n          }\n        }\n      }\n    }\n\n    await client.query(\n      `DELETE FROM shift_expenses WHERE shift_id = $1`,\n      [shift_id]\n    )\n\n    if (expenses && expenses.length > 0) {\n      for (const expense of expenses) {\n        if (expense.expense_account_id && expense.amount > 0) {\n          const accountCheck = await client.query(\n            'SELECT id FROM expense_accounts WHERE id = $1 AND vendor_id = $2',\n            [expense.expense_account_id, vendorId]\n          )\n          if (accountCheck.rows.length === 0) {\n            console.warn(`[Reconcile] Skipping invalid expense account ${expense.expense_account_id}`)\n            continue\n          }\n          \n          await client.query(\n            `INSERT INTO shift_expenses (shift_id, branch_id, expense_account_id, amount, description)\n             VALUES ($1, $2, $3, $4, $5)`,\n            [shift_id, branchId, expense.expense_account_id, expense.amount, expense.description || null]\n          )\n        }\n      }\n    }\n\n    await client.query(\n      `DELETE FROM shift_banking WHERE shift_id = $1`,\n      [shift_id]\n    )\n\n    if (banking && banking.length > 0) {\n      for (const entry of banking) {\n        if (entry.banking_account_id && entry.amount > 0) {\n          const accountCheck = await client.query(\n            'SELECT id FROM banking_accounts WHERE id = $1 AND vendor_id = $2',\n            [entry.banking_account_id, vendorId]\n          )\n          if (accountCheck.rows.length === 0) {\n            console.warn(`[Reconcile] Skipping invalid banking account ${entry.banking_account_id}`)\n            continue\n          }\n          \n          await client.query(\n            `INSERT INTO shift_banking (shift_id, banking_account_id, amount, notes)\n             VALUES ($1, $2, $3, $4)`,\n            [shift_id, entry.banking_account_id, entry.amount, entry.notes || null]\n          )\n        }\n      }\n    }\n\n    if (notes) {\n      await client.query(\n        `UPDATE shifts SET notes = $1 WHERE id = $2`,\n        [notes, shift_id]\n      )\n    }\n\n    await client.query(\n      `UPDATE shifts SET reconciliation_status = 'reconciled', updated_at = NOW() WHERE id = $1`,\n      [shift_id]\n    )\n\n    await client.query('COMMIT')\n\n    // Send DSSR via WhatsApp to directors (async, don't block response)\n    try {\n      // Get whatsapp_directors from branch level (not vendor level)\n      const branchConfigResult = await client.query(\n        `SELECT whatsapp_directors FROM branches WHERE id = $1`,\n        [branchId]\n      )\n      \n      if (branchConfigResult.rows.length > 0 && branchConfigResult.rows[0].whatsapp_directors) {\n        let directorNumbers: string[] = []\n        try {\n          const directors = branchConfigResult.rows[0].whatsapp_directors\n          directorNumbers = typeof directors === 'string' ? JSON.parse(directors) : directors\n        } catch {\n          directorNumbers = []\n        }\n        \n        if (directorNumbers.length > 0) {\n          // Fetch sales data for DSSR\n          const salesResult = await client.query(\n            `SELECT \n               COALESCE(i.item_name, s.fuel_type, 'Unknown') as product,\n               SUM(s.quantity) as volume,\n               SUM(s.total_amount) as amount,\n               SUM(CASE WHEN LOWER(s.payment_method) = 'cash' THEN s.total_amount ELSE 0 END) as cash_amount,\n               SUM(CASE WHEN LOWER(s.payment_method) IN ('mpesa', 'm-pesa', 'mobile_money') THEN s.total_amount ELSE 0 END) as mpesa_amount,\n               SUM(CASE WHEN LOWER(s.payment_method) = 'credit' THEN s.total_amount ELSE 0 END) as credit_amount\n             FROM sales s\n             LEFT JOIN items i ON s.item_id = i.id\n             WHERE s.shift_id = $1\n             GROUP BY COALESCE(i.item_name, s.fuel_type, 'Unknown')`,\n            [shift_id]\n          )\n          \n          const branchResult = await client.query(\n            `SELECT name FROM branches WHERE id = $1`,\n            [branchId]\n          )\n          \n          const attendantResult = await client.query(\n            `SELECT s.name FROM staff s\n             WHERE s.id = (SELECT staff_id FROM shifts WHERE id = $1)`,\n            [shift_id]\n          )\n          \n          let totalSales = 0, totalVolume = 0, cashCollected = 0, mpesaCollected = 0, creditSales = 0\n          const productBreakdown: Array<{ product: string; volume: number; amount: number }> = []\n          \n          for (const row of salesResult.rows) {\n            const volume = parseFloat(row.volume) || 0\n            const amount = parseFloat(row.amount) || 0\n            totalVolume += volume\n            totalSales += amount\n            cashCollected += parseFloat(row.cash_amount) || 0\n            mpesaCollected += parseFloat(row.mpesa_amount) || 0\n            creditSales += parseFloat(row.credit_amount) || 0\n            productBreakdown.push({ product: row.product, volume, amount })\n          }\n          \n          const summary: DSSRSummary = {\n            branchName: branchResult.rows[0]?.name || 'Unknown Branch',\n            date: new Date().toISOString().split('T')[0],\n            shiftType: shift.shift_type || 'Day',\n            attendantName: attendantResult.rows[0]?.name || 'N/A',\n            totalSales,\n            totalVolume,\n            cashCollected,\n            mpesaCollected,\n            creditSales,\n            variance: (cashCollected + mpesaCollected) - (totalSales - creditSales),\n            productBreakdown\n          }\n          \n          // Fire and forget - don't wait for WhatsApp response\n          sendDSSRToDirectors(summary, directorNumbers).catch(err => {\n            console.error('[Reconcile] WhatsApp notification failed:', err)\n          })\n        }\n      }\n    } catch (whatsappError) {\n      // Don't fail reconciliation if WhatsApp notification fails\n      console.error('[Reconcile] WhatsApp notification error:', whatsappError)\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: \"Shift reconciled successfully\"\n    })\n\n  } catch (error: any) {\n    await client.query('ROLLBACK')\n    console.error(\"Error reconciling shift:\", error)\n    return NextResponse.json(\n      { error: \"Failed to reconcile shift\", details: error.message },\n      { status: 500 }\n    )\n  } finally {\n    client.release()\n  }\n}\n"],"names":[],"mappings":"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"}}]
}