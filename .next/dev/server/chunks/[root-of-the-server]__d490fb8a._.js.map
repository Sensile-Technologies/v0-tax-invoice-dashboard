{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,OAAO,MAAM,KAAK,OAAO;AAC3B"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/auth/change-password/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\nimport { cookies } from \"next/headers\"\nimport bcrypt from \"bcryptjs\"\n\nasync function getSession() {\n  const cookieStore = await cookies()\n  const sessionCookie = cookieStore.get(\"user_session\")\n  if (!sessionCookie) return null\n  try {\n    return JSON.parse(sessionCookie.value)\n  } catch {\n    return null\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getSession()\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const { currentPassword, newPassword, userId } = await request.json()\n\n    // Use userId from request if provided (for forced password change), otherwise use session\n    const targetUserId = userId || session.id\n\n    if (!newPassword || newPassword.length < 6) {\n      return NextResponse.json(\n        { error: \"New password must be at least 6 characters\" },\n        { status: 400 }\n      )\n    }\n\n    // Get user's current password hash\n    const userResult = await query(\n      `SELECT id, password_hash, must_change_password FROM users WHERE id = $1`,\n      [targetUserId]\n    )\n\n    if (userResult.length === 0) {\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 })\n    }\n\n    const user = userResult[0]\n\n    // If not a forced password change, verify current password\n    if (!user.must_change_password && currentPassword) {\n      const isValid = await bcrypt.compare(currentPassword, user.password_hash)\n      if (!isValid) {\n        return NextResponse.json(\n          { error: \"Current password is incorrect\" },\n          { status: 400 }\n        )\n      }\n    }\n\n    // Hash new password and update\n    const hashedPassword = await bcrypt.hash(newPassword, 10)\n    \n    await query(\n      `UPDATE users SET password_hash = $1, must_change_password = false, updated_at = NOW() WHERE id = $2`,\n      [hashedPassword, targetUserId]\n    )\n\n    return NextResponse.json({ \n      success: true, \n      message: \"Password changed successfully\" \n    })\n  } catch (error: any) {\n    console.error(\"Error changing password:\", error)\n    return NextResponse.json(\n      { error: \"Failed to change password\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;;;;;;;;;;AAEA,eAAe;IACb,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,gBAAgB,YAAY,GAAG,CAAC;IACtC,IAAI,CAAC,eAAe,OAAO;IAC3B,IAAI;QACF,OAAO,KAAK,KAAK,CAAC,cAAc,KAAK;IACvC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM;QACtB,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,eAAe,EAAE,WAAW,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEnE,0FAA0F;QAC1F,MAAM,eAAe,UAAU,QAAQ,EAAE;QAEzC,IAAI,CAAC,eAAe,YAAY,MAAM,GAAG,GAAG;YAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,MAAM,aAAa,MAAM,IAAA,8HAAK,EAC5B,CAAC,uEAAuE,CAAC,EACzE;YAAC;SAAa;QAGhB,IAAI,WAAW,MAAM,KAAK,GAAG;YAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,OAAO,UAAU,CAAC,EAAE;QAE1B,2DAA2D;QAC3D,IAAI,CAAC,KAAK,oBAAoB,IAAI,iBAAiB;YACjD,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,iBAAiB,KAAK,aAAa;YACxE,IAAI,CAAC,SAAS;gBACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAgC,GACzC;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,+BAA+B;QAC/B,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,aAAa;QAEtD,MAAM,IAAA,8HAAK,EACT,CAAC,mGAAmG,CAAC,EACrG;YAAC;YAAgB;SAAa;QAGhC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA6B,SAAS,MAAM,OAAO;QAAC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}