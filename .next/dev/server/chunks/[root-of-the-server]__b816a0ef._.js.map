{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/db/%5Btable%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { query } from \"@/lib/db/client\";\n\nconst ALLOWED_TABLES = [\n  'users', 'branches', 'staff', 'tanks', 'dispensers', 'nozzles',\n  'fuel_prices', 'shifts', 'sales', 'customers', 'loyalty_transactions',\n  'items', 'item_compositions', 'stock_adjustments', 'stock_transfers',\n  'credit_notes', 'hardware', 'device_initialization', 'code_lists',\n  'item_classifications', 'notices', 'branch_insurances', 'branch_users',\n  'imported_items', 'stock_master', 'sales_transactions', 'sales_transaction_items',\n  'sales_receipts', 'purchase_transactions', 'purchase_transaction_items',\n  'stock_movements', 'stock_movement_items', 'api_logs'\n];\n\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  try {\n    const { table } = await params;\n    \n    if (!ALLOWED_TABLES.includes(table)) {\n      return NextResponse.json({ error: 'Table not allowed' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const single = searchParams.get('single') === 'true';\n    \n    const filters: { column: string; operator: string; value: string }[] = [];\n    searchParams.forEach((value, key) => {\n      if (key.startsWith('filter_')) {\n        const [column, operator, val] = value.split(':');\n        filters.push({ column, operator, value: val });\n      }\n    });\n\n    let sql = `SELECT * FROM ${table}`;\n    const sqlParams: any[] = [];\n\n    if (filters.length > 0) {\n      const whereClauses = filters.map((f, i) => {\n        sqlParams.push(f.value);\n        return `${f.column} ${f.operator} $${i + 1}`;\n      });\n      sql += ` WHERE ${whereClauses.join(' AND ')}`;\n    }\n\n    if (single) {\n      sql += ' LIMIT 1';\n    }\n\n    const result = await query(sql, sqlParams);\n    return NextResponse.json(result);\n  } catch (error: any) {\n    console.error(\"Database query error:\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  try {\n    const { table } = await params;\n    \n    if (!ALLOWED_TABLES.includes(table)) {\n      return NextResponse.json({ error: 'Table not allowed' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { data } = body;\n    \n    const rows = Array.isArray(data) ? data : [data];\n    if (rows.length === 0) {\n      return NextResponse.json([]);\n    }\n\n    const columns = Object.keys(rows[0]);\n    const values = rows.map((row, i) =>\n      `(${columns.map((_, j) => `$${i * columns.length + j + 1}`).join(', ')})`\n    ).join(', ');\n    const sqlParams = rows.flatMap(row => columns.map(col => {\n      const value = row[col];\n      if (value !== null && typeof value === 'object') {\n        return JSON.stringify(value);\n      }\n      return value;\n    }));\n\n    const sql = `INSERT INTO ${table} (${columns.join(', ')}) VALUES ${values} RETURNING *`;\n    const result = await query(sql, sqlParams);\n\n    return NextResponse.json(result);\n  } catch (error: any) {\n    console.error(\"Database insert error:\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  try {\n    const { table } = await params;\n    \n    if (!ALLOWED_TABLES.includes(table)) {\n      return NextResponse.json({ error: 'Table not allowed' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { data, where } = body;\n\n    const columns = Object.keys(data);\n    const setClause = columns.map((col, i) => `${col} = $${i + 1}`).join(', ');\n    const sqlParams = columns.map(col => {\n      const value = data[col];\n      if (value !== null && typeof value === 'object') {\n        return JSON.stringify(value);\n      }\n      return value;\n    });\n\n    let sql = `UPDATE ${table} SET ${setClause}`;\n    let paramIndex = sqlParams.length;\n\n    if (where && where.length > 0) {\n      const whereClauses = where.map((cond: any) => {\n        paramIndex++;\n        sqlParams.push(cond.value);\n        return `${cond.column} ${cond.operator} $${paramIndex}`;\n      });\n      sql += ` WHERE ${whereClauses.join(' AND ')}`;\n    }\n\n    sql += ' RETURNING *';\n    const result = await query(sql, sqlParams);\n\n    return NextResponse.json(result);\n  } catch (error: any) {\n    console.error(\"Database update error:\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ table: string }> }\n) {\n  try {\n    const { table } = await params;\n    \n    if (!ALLOWED_TABLES.includes(table)) {\n      return NextResponse.json({ error: 'Table not allowed' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { where } = body;\n\n    let sql = `DELETE FROM ${table}`;\n    const sqlParams: any[] = [];\n\n    if (where && where.length > 0) {\n      const whereClauses = where.map((cond: any, i: number) => {\n        sqlParams.push(cond.value);\n        return `${cond.column} ${cond.operator} $${i + 1}`;\n      });\n      sql += ` WHERE ${whereClauses.join(' AND ')}`;\n    }\n\n    sql += ' RETURNING *';\n    const result = await query(sql, sqlParams);\n\n    return NextResponse.json(result);\n  } catch (error: any) {\n    console.error(\"Database delete error:\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}