{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/leads/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const stage = searchParams.get(\"stage\")\n\n    const includeArchived = searchParams.get(\"include_archived\") === \"true\"\n    \n    let sql = `\n      SELECT \n        l.*,\n        sp.name as assigned_to_name\n      FROM leads l\n      LEFT JOIN sales_people sp ON l.assigned_to = sp.id\n      WHERE (l.is_archived = false OR l.is_archived IS NULL)\n    `\n    const params: any[] = []\n    let paramIndex = 1\n\n    if (includeArchived) {\n      sql = `\n        SELECT \n          l.*,\n          sp.name as assigned_to_name\n        FROM leads l\n        LEFT JOIN sales_people sp ON l.assigned_to = sp.id\n        WHERE 1=1\n      `\n    }\n\n    if (stage && stage !== \"all\") {\n      sql += ` AND l.stage = $${paramIndex}`\n      params.push(stage)\n      paramIndex++\n    }\n\n    sql += ` ORDER BY l.created_at DESC`\n\n    const result = await query(sql, params)\n    return NextResponse.json(result)\n  } catch (error) {\n    console.error(\"Error fetching leads:\", error)\n    return NextResponse.json({ error: \"Failed to fetch leads\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { \n      company_name,\n      trading_name,\n      kra_pin,\n      contact_name, \n      contact_email, \n      contact_phone, \n      stage, \n      assigned_to, \n      notes, \n      expected_value, \n      expected_close_date,\n      source \n    } = body\n\n    const result = await query(`\n      INSERT INTO leads (\n        company_name, trading_name, kra_pin, contact_name, contact_email, contact_phone, \n        stage, assigned_to, notes, expected_value, expected_close_date, source\n      )\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)\n      RETURNING *\n    `, [\n      company_name, trading_name, kra_pin, contact_name, contact_email, contact_phone,\n      stage || 'contact', assigned_to || null, notes, expected_value, expected_close_date, source\n    ])\n\n    return NextResponse.json(result[0])\n  } catch (error) {\n    console.error(\"Error creating lead:\", error)\n    return NextResponse.json({ error: \"Failed to create lead\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { \n      id,\n      company_name,\n      trading_name,\n      kra_pin,\n      contact_name, \n      contact_email, \n      contact_phone, \n      stage, \n      assigned_to, \n      notes, \n      expected_value, \n      expected_close_date,\n      source \n    } = body\n\n    const result = await query(`\n      UPDATE leads \n      SET company_name = $1, trading_name = $2, kra_pin = $3, contact_name = $4, \n          contact_email = $5, contact_phone = $6, stage = $7, assigned_to = $8, \n          notes = $9, expected_value = $10, expected_close_date = $11, source = $12, updated_at = NOW()\n      WHERE id = $13\n      RETURNING *\n    `, [\n      company_name, trading_name, kra_pin, contact_name, contact_email, contact_phone,\n      stage, assigned_to || null, notes, expected_value, expected_close_date, source, id\n    ])\n\n    return NextResponse.json(result[0])\n  } catch (error) {\n    console.error(\"Error updating lead:\", error)\n    return NextResponse.json({ error: \"Failed to update lead\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const id = searchParams.get(\"id\")\n    const action = searchParams.get(\"action\")\n\n    if (action === \"archive\") {\n      // Archive the lead instead of deleting\n      const result = await query(`\n        UPDATE leads SET is_archived = true, updated_at = NOW() WHERE id = $1 RETURNING *\n      `, [id])\n      return NextResponse.json({ success: true, archived: true, lead: result[0] })\n    }\n\n    // Hard delete (kept for backward compatibility but not used in UI)\n    await query(`DELETE FROM leads WHERE id = $1`, [id])\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Error deleting/archiving lead:\", error)\n    return NextResponse.json({ error: \"Failed to process lead\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}