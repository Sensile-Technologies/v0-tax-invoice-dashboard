{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/shifts/unreconciled/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get(\"branch_id\")\n\n    if (!branchId) {\n      return NextResponse.json(\n        { error: \"branch_id is required\" },\n        { status: 400 }\n      )\n    }\n\n    const result = await pool.query(\n      `SELECT s.*, \n        st.full_name as cashier_name,\n        st.username as cashier_username\n       FROM shifts s\n       LEFT JOIN staff st ON s.staff_id = st.id\n       WHERE s.branch_id = $1 \n         AND s.status = 'completed' \n         AND s.reconciliation_status = 'pending'\n       ORDER BY s.end_time DESC\n       LIMIT 1`,\n      [branchId]\n    )\n\n    if (result.rows.length > 0) {\n      return NextResponse.json({\n        has_unreconciled: true,\n        shift: result.rows[0]\n      })\n    }\n\n    return NextResponse.json({\n      has_unreconciled: false,\n      shift: null\n    })\n\n  } catch (error: any) {\n    console.error(\"Error checking unreconciled shifts:\", error)\n    return NextResponse.json(\n      { error: \"Failed to check unreconciled shifts\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,CAAC;;;;;;;;;cASO,CAAC,EACT;YAAC;SAAS;QAGZ,IAAI,OAAO,IAAI,CAAC,MAAM,GAAG,GAAG;YAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,kBAAkB;gBAClB,OAAO,OAAO,IAAI,CAAC,EAAE;YACvB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,kBAAkB;YAClB,OAAO;QACT;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAuC,SAAS,MAAM,OAAO;QAAC,GACvE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}