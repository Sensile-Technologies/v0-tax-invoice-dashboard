{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/operations/onboarding/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET() {\n  try {\n    // Get branches that need onboarding (no device_token configured yet)\n    // These are new branches from signups that need device configuration\n    const result = await query(`\n      SELECT \n        b.id,\n        'branch' as type,\n        b.vendor_id as merchant_id,\n        b.id as branch_id,\n        b.name as merchant_name,\n        b.trading_name,\n        b.kra_pin,\n        b.name as branch_name,\n        'pending_onboarding' as status,\n        b.manager as contact_name,\n        b.email as contact_email,\n        b.phone as contact_phone,\n        b.location,\n        b.county,\n        b.address,\n        b.created_at\n      FROM branches b\n      WHERE (b.device_token IS NULL OR b.device_token = '')\n        AND b.status = 'active'\n      ORDER BY b.created_at DESC\n    `)\n    \n    return NextResponse.json(result)\n  } catch (error) {\n    console.error(\"Error fetching onboarding requests:\", error)\n    return NextResponse.json([])\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const { id, device_token, bhf_id, server_address, server_port } = await request.json()\n\n    // Update the branch with onboarding configuration (device token, bhf_id, server address/port)\n    const result = await query(`\n      UPDATE branches \n      SET device_token = $2, bhf_id = $3, server_address = $4, server_port = $5, updated_at = NOW()\n      WHERE id = $1\n      RETURNING *\n    `, [id, device_token, bhf_id, server_address || null, server_port || null])\n\n    if (result.length === 0) {\n      return NextResponse.json({ error: \"Branch not found\" }, { status: 404 })\n    }\n\n    return NextResponse.json(result[0])\n  } catch (error) {\n    console.error(\"Error updating onboarding request:\", error)\n    return NextResponse.json({ error: \"Failed to update request\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,qEAAqE;QACrE,qEAAqE;QACrE,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;IAsB5B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,gJAAY,CAAC,IAAI,CAAC,EAAE;IAC7B;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,YAAY,EAAE,MAAM,EAAE,cAAc,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpF,8FAA8F;QAC9F,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;IAK5B,CAAC,EAAE;YAAC;YAAI;YAAc;YAAQ,kBAAkB;YAAM,eAAe;SAAK;QAE1E,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF"}}]
}