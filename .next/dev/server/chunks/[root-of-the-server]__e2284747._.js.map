{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/supabase/server.ts"],"sourcesContent":["import { query, queryOne, execute } from '../db/client';\n\ninterface QueryResult<T = any> {\n  data: T | null;\n  error: { message: string } | null;\n}\n\ninterface QueryBuilder extends PromiseLike<QueryResult> {\n  select: (columns?: string) => QueryBuilder;\n  insert: (data: any | any[]) => Promise<QueryResult>;\n  update: (data: any) => Promise<QueryResult>;\n  delete: () => Promise<QueryResult>;\n  upsert: (data: any | any[], options?: { onConflict?: string }) => Promise<QueryResult>;\n  eq: (column: string, value: any) => QueryBuilder;\n  neq: (column: string, value: any) => QueryBuilder;\n  gt: (column: string, value: any) => QueryBuilder;\n  gte: (column: string, value: any) => QueryBuilder;\n  lt: (column: string, value: any) => QueryBuilder;\n  lte: (column: string, value: any) => QueryBuilder;\n  like: (column: string, value: any) => QueryBuilder;\n  ilike: (column: string, value: any) => QueryBuilder;\n  is: (column: string, value: any) => QueryBuilder;\n  in: (column: string, values: any[]) => QueryBuilder;\n  order: (column: string, options?: { ascending?: boolean }) => QueryBuilder;\n  limit: (count: number) => QueryBuilder;\n  single: () => QueryBuilder;\n  maybeSingle: () => QueryBuilder;\n}\n\nexport async function createClient() {\n  return {\n    from: (table: string): QueryBuilder => createQueryBuilder(table),\n    auth: createAuthClient(),\n  };\n}\n\nfunction createQueryBuilder(table: string): QueryBuilder {\n  let selectColumns = '*';\n  let whereConditions: { column: string; operator: string; value: any }[] = [];\n  let orderByColumn: string | null = null;\n  let orderDirection: 'asc' | 'desc' = 'asc';\n  let limitCount: number | null = null;\n  let singleResult = false;\n\n  const builder = {\n    select: (columns = '*') => {\n      selectColumns = columns;\n      return builder;\n    },\n    insert: async (data: any | any[]) => {\n      const rows = Array.isArray(data) ? data : [data];\n      if (rows.length === 0) return { data: [], error: null };\n      \n      const columns = Object.keys(rows[0]);\n      const values = rows.map((row, i) => \n        `(${columns.map((_, j) => `$${i * columns.length + j + 1}`).join(', ')})`\n      ).join(', ');\n      const params = rows.flatMap(row => columns.map(col => row[col]));\n      \n      try {\n        const sql = `INSERT INTO ${table} (${columns.join(', ')}) VALUES ${values} RETURNING *`;\n        const result = await query(sql, params);\n        return { data: result, error: null };\n      } catch (error: any) {\n        return { data: null, error: { message: error.message } };\n      }\n    },\n    update: async (data: any) => {\n      const columns = Object.keys(data);\n      const setClause = columns.map((col, i) => `${col} = $${i + 1}`).join(', ');\n      const params = columns.map(col => data[col]);\n      \n      let sql = `UPDATE ${table} SET ${setClause}`;\n      let paramIndex = params.length;\n      \n      if (whereConditions.length > 0) {\n        const whereClauses = whereConditions.map((cond, i) => {\n          paramIndex++;\n          return `${cond.column} ${cond.operator} $${paramIndex}`;\n        });\n        sql += ` WHERE ${whereClauses.join(' AND ')}`;\n        params.push(...whereConditions.map(c => c.value));\n      }\n      \n      sql += ' RETURNING *';\n      \n      try {\n        const result = await query(sql, params);\n        return { data: result, error: null };\n      } catch (error: any) {\n        return { data: null, error: { message: error.message } };\n      }\n    },\n    delete: async () => {\n      let sql = `DELETE FROM ${table}`;\n      const params: any[] = [];\n      \n      if (whereConditions.length > 0) {\n        const whereClauses = whereConditions.map((cond, i) => {\n          return `${cond.column} ${cond.operator} $${i + 1}`;\n        });\n        sql += ` WHERE ${whereClauses.join(' AND ')}`;\n        params.push(...whereConditions.map(c => c.value));\n      }\n      \n      sql += ' RETURNING *';\n      \n      try {\n        const result = await query(sql, params);\n        return { data: result, error: null };\n      } catch (error: any) {\n        return { data: null, error: { message: error.message } };\n      }\n    },\n    upsert: async (data: any | any[], options?: { onConflict?: string }) => {\n      const rows = Array.isArray(data) ? data : [data];\n      if (rows.length === 0) return { data: [], error: null };\n      \n      const columns = Object.keys(rows[0]);\n      const values = rows.map((row, i) => \n        `(${columns.map((_, j) => `$${i * columns.length + j + 1}`).join(', ')})`\n      ).join(', ');\n      const params = rows.flatMap(row => columns.map(col => row[col]));\n      \n      const conflictColumns = options?.onConflict || 'id';\n      const updateColumns = columns.filter(c => !conflictColumns.split(',').includes(c));\n      const updateClause = updateColumns.map(c => `${c} = EXCLUDED.${c}`).join(', ');\n      \n      try {\n        let sql = `INSERT INTO ${table} (${columns.join(', ')}) VALUES ${values}`;\n        if (updateClause) {\n          sql += ` ON CONFLICT (${conflictColumns}) DO UPDATE SET ${updateClause}`;\n        } else {\n          sql += ` ON CONFLICT (${conflictColumns}) DO NOTHING`;\n        }\n        sql += ' RETURNING *';\n        const result = await query(sql, params);\n        return { data: result, error: null };\n      } catch (error: any) {\n        return { data: null, error: { message: error.message } };\n      }\n    },\n    eq: (column: string, value: any) => {\n      whereConditions.push({ column, operator: '=', value });\n      return builder;\n    },\n    neq: (column: string, value: any) => {\n      whereConditions.push({ column, operator: '!=', value });\n      return builder;\n    },\n    gt: (column: string, value: any) => {\n      whereConditions.push({ column, operator: '>', value });\n      return builder;\n    },\n    gte: (column: string, value: any) => {\n      whereConditions.push({ column, operator: '>=', value });\n      return builder;\n    },\n    lt: (column: string, value: any) => {\n      whereConditions.push({ column, operator: '<', value });\n      return builder;\n    },\n    lte: (column: string, value: any) => {\n      whereConditions.push({ column, operator: '<=', value });\n      return builder;\n    },\n    like: (column: string, value: any) => {\n      whereConditions.push({ column, operator: 'LIKE', value });\n      return builder;\n    },\n    ilike: (column: string, value: any) => {\n      whereConditions.push({ column, operator: 'ILIKE', value });\n      return builder;\n    },\n    is: (column: string, value: any) => {\n      whereConditions.push({ column, operator: 'IS', value });\n      return builder;\n    },\n    in: (column: string, values: any[]) => {\n      whereConditions.push({ column, operator: 'IN', value: values });\n      return builder;\n    },\n    order: (column: string, options?: { ascending?: boolean }) => {\n      orderByColumn = column;\n      orderDirection = options?.ascending === false ? 'desc' : 'asc';\n      return builder;\n    },\n    limit: (count: number) => {\n      limitCount = count;\n      return builder;\n    },\n    single: () => {\n      singleResult = true;\n      limitCount = 1;\n      return builder;\n    },\n    maybeSingle: () => {\n      singleResult = true;\n      limitCount = 1;\n      return builder;\n    },\n    then: async (resolve: any, reject?: any) => {\n      try {\n        let sql = `SELECT ${selectColumns} FROM ${table}`;\n        const params: any[] = [];\n        let paramIndex = 0;\n        \n        if (whereConditions.length > 0) {\n          const whereClauses = whereConditions.map(cond => {\n            if (cond.operator === 'IN') {\n              const placeholders = cond.value.map(() => `$${++paramIndex}`).join(', ');\n              params.push(...cond.value);\n              return `${cond.column} IN (${placeholders})`;\n            } else if (cond.operator === 'IS') {\n              return `${cond.column} IS ${cond.value}`;\n            } else {\n              paramIndex++;\n              params.push(cond.value);\n              return `${cond.column} ${cond.operator} $${paramIndex}`;\n            }\n          });\n          sql += ` WHERE ${whereClauses.join(' AND ')}`;\n        }\n        \n        if (orderByColumn) {\n          sql += ` ORDER BY ${orderByColumn} ${orderDirection.toUpperCase()}`;\n        }\n        \n        if (limitCount !== null) {\n          sql += ` LIMIT ${limitCount}`;\n        }\n        \n        const result = await query(sql, params);\n        const data = singleResult ? (result[0] || null) : result;\n        resolve({ data, error: null });\n      } catch (error: any) {\n        if (reject) {\n          reject(error);\n        } else {\n          resolve({ data: null, error: { message: error.message } });\n        }\n      }\n    },\n  };\n  \n  return builder as QueryBuilder;\n}\n\nfunction createAuthClient() {\n  return {\n    getUser: async () => {\n      return { data: { user: null }, error: null };\n    },\n    getSession: async () => {\n      return { data: { session: null }, error: null };\n    },\n    signInWithPassword: async (credentials: { email: string; password: string }) => {\n      return { data: { user: null, session: null }, error: { message: 'Local auth not implemented' } };\n    },\n    signUp: async (credentials: { email: string; password: string }) => {\n      return { data: { user: null, session: null }, error: { message: 'Local auth not implemented' } };\n    },\n    signOut: async () => {\n      return { error: null };\n    },\n    onAuthStateChange: (callback: any) => {\n      return { data: { subscription: { unsubscribe: () => {} } } };\n    },\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 480, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/api-logger.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\n\nexport interface ApiLogEntry {\n  endpoint: string\n  method: string\n  payload?: any\n  response?: any\n  statusCode?: number\n  error?: string\n  durationMs?: number\n  branchId?: string\n  externalEndpoint?: string\n}\n\nexport async function logApiCall(entry: ApiLogEntry) {\n  try {\n    const supabase = await createClient()\n\n    await supabase.from(\"api_logs\").insert({\n      endpoint: entry.endpoint,\n      method: entry.method,\n      payload: entry.payload || null,\n      response: entry.response || null,\n      status_code: entry.statusCode || null,\n      error: entry.error || null,\n      duration_ms: entry.durationMs || null,\n      branch_id: entry.branchId || null,\n      user_agent: entry.externalEndpoint || null,\n    })\n  } catch (error) {\n    console.error(\"[v0] Failed to log API call:\", error)\n  }\n}\n\nexport function createApiLogger(endpoint: string, method = \"POST\") {\n  const startTime = Date.now()\n\n  return {\n    success: async (payload: any, response: any, branchId?: string, externalEndpoint?: string) => {\n      const duration = Date.now() - startTime\n      await logApiCall({\n        endpoint,\n        method,\n        payload,\n        response,\n        statusCode: 200,\n        durationMs: duration,\n        branchId,\n        externalEndpoint,\n      })\n    },\n    error: async (payload: any, error: any, statusCode = 500, branchId?: string, externalEndpoint?: string) => {\n      const duration = Date.now() - startTime\n      await logApiCall({\n        endpoint,\n        method,\n        payload,\n        error: error?.message || String(error),\n        statusCode,\n        durationMs: duration,\n        branchId,\n        externalEndpoint,\n      })\n    },\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAcO,eAAe,WAAW,KAAkB;IACjD,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY;QAEnC,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC;YACrC,UAAU,MAAM,QAAQ;YACxB,QAAQ,MAAM,MAAM;YACpB,SAAS,MAAM,OAAO,IAAI;YAC1B,UAAU,MAAM,QAAQ,IAAI;YAC5B,aAAa,MAAM,UAAU,IAAI;YACjC,OAAO,MAAM,KAAK,IAAI;YACtB,aAAa,MAAM,UAAU,IAAI;YACjC,WAAW,MAAM,QAAQ,IAAI;YAC7B,YAAY,MAAM,gBAAgB,IAAI;QACxC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;IAChD;AACF;AAEO,SAAS,gBAAgB,QAAgB,EAAE,SAAS,MAAM;IAC/D,MAAM,YAAY,KAAK,GAAG;IAE1B,OAAO;QACL,SAAS,OAAO,SAAc,UAAe,UAAmB;YAC9D,MAAM,WAAW,KAAK,GAAG,KAAK;YAC9B,MAAM,WAAW;gBACf;gBACA;gBACA;gBACA;gBACA,YAAY;gBACZ,YAAY;gBACZ;gBACA;YACF;QACF;QACA,OAAO,OAAO,SAAc,OAAY,aAAa,GAAG,EAAE,UAAmB;YAC3E,MAAM,WAAW,KAAK,GAAG,KAAK;YAC9B,MAAM,WAAW;gBACf;gBACA;gBACA;gBACA,OAAO,OAAO,WAAW,OAAO;gBAChC;gBACA,YAAY;gBACZ;gBACA;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 548, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/kra-sales-api.ts"],"sourcesContent":["import { query } from \"@/lib/db\"\nimport { logApiCall } from \"@/lib/api-logger\"\n\ninterface KraSaleData {\n  branch_id: string\n  invoice_number: string\n  receipt_number: string\n  fuel_type: string\n  quantity: number\n  unit_price: number\n  total_amount: number\n  payment_method: string\n  customer_name?: string\n  customer_pin?: string\n  sale_date: string\n}\n\ninterface KraResponse {\n  resultCd: string\n  resultMsg: string\n  resultDt: string\n  data?: any\n}\n\ninterface BranchConfig {\n  id: string\n  bhf_id: string\n  kra_pin: string\n  device_token: string\n  server_address: string\n  server_port: string\n}\n\nasync function getBranchConfig(branchId: string): Promise<BranchConfig | null> {\n  try {\n    const result = await query(`\n      SELECT id, bhf_id, kra_pin, device_token, server_address, server_port\n      FROM branches\n      WHERE id = $1\n    `, [branchId])\n\n    if (result.length === 0) {\n      return null\n    }\n\n    return result[0] as BranchConfig\n  } catch (error) {\n    console.error(\"[KRA API] Error fetching branch config:\", error)\n    return null\n  }\n}\n\nexport async function callKraTestSalesEndpoint(saleData: KraSaleData): Promise<{\n  success: boolean\n  kraResponse: KraResponse | null\n  error?: string\n}> {\n  const startTime = Date.now()\n  \n  try {\n    const branchConfig = await getBranchConfig(saleData.branch_id)\n    \n    if (!branchConfig) {\n      const errorMsg = \"Branch configuration not found\"\n      console.log(`[KRA API] ${errorMsg}`)\n      return { success: false, kraResponse: null, error: errorMsg }\n    }\n\n    if (!branchConfig.server_address || !branchConfig.server_port) {\n      const errorMsg = \"KRA server configuration not set for this branch\"\n      console.log(`[KRA API] ${errorMsg}`)\n      return { \n        success: false, \n        kraResponse: {\n          resultCd: \"CONFIG_ERROR\",\n          resultMsg: errorMsg,\n          resultDt: new Date().toISOString()\n        }, \n        error: errorMsg \n      }\n    }\n\n    const kraEndpoint = `http://${branchConfig.server_address}:${branchConfig.server_port}/trnsSales/saveSales`\n    \n    const kraPayload = {\n      tin: branchConfig.kra_pin || \"\",\n      bhfId: branchConfig.bhf_id || \"\",\n      dvcSrlNo: branchConfig.device_token || \"\",\n      invcNo: saleData.invoice_number,\n      rcptNo: saleData.receipt_number,\n      salesDt: saleData.sale_date,\n      salesTy: \"N\",\n      rcptTy: \"S\",\n      pmtTy: saleData.payment_method === \"cash\" ? \"01\" : saleData.payment_method === \"mobile_money\" ? \"02\" : \"03\",\n      salesSttsCd: \"02\",\n      cfmDt: saleData.sale_date,\n      salesAmt: saleData.total_amount,\n      totTaxAmt: 0,\n      totAmt: saleData.total_amount,\n      custNm: saleData.customer_name || \"Walk-in Customer\",\n      custTin: saleData.customer_pin || \"\",\n      itemList: [\n        {\n          itemSeq: 1,\n          itemCd: saleData.fuel_type.toUpperCase().replace(/\\s/g, \"\"),\n          itemNm: saleData.fuel_type,\n          qty: saleData.quantity,\n          unitPrc: saleData.unit_price,\n          splyAmt: saleData.total_amount,\n          totAmt: saleData.total_amount,\n          taxAmt: 0,\n          taxTy: \"B\",\n          taxRt: 0\n        }\n      ]\n    }\n\n    console.log(`[KRA API] Calling endpoint: ${kraEndpoint}`)\n    console.log(`[KRA API] Request payload:`, JSON.stringify(kraPayload, null, 2))\n\n    let kraResponse: KraResponse\n    let httpStatusCode = 200\n\n    try {\n      const response = await fetch(kraEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\",\n        },\n        body: JSON.stringify(kraPayload),\n        signal: AbortSignal.timeout(30000)\n      })\n\n      httpStatusCode = response.status\n      kraResponse = await response.json()\n      \n      console.log(`[KRA API] HTTP Status: ${response.status}`)\n      console.log(`[KRA API] KRA Result Code: ${kraResponse.resultCd}`)\n      console.log(`[KRA API] KRA Result Message: ${kraResponse.resultMsg}`)\n      console.log(`[KRA API] Response body:`, JSON.stringify(kraResponse, null, 2))\n    } catch (fetchError: any) {\n      httpStatusCode = 0\n      kraResponse = {\n        resultCd: \"NETWORK_ERROR\",\n        resultMsg: fetchError.message || \"Failed to connect to KRA backend\",\n        resultDt: new Date().toISOString()\n      }\n      \n      console.log(`[KRA API] Network error:`, fetchError.message)\n      console.log(`[KRA API] Response (network error):`, JSON.stringify(kraResponse, null, 2))\n    }\n\n    const durationMs = Date.now() - startTime\n\n    const responseWithMetadata = {\n      ...kraResponse,\n      _httpStatus: httpStatusCode,\n      _kraEndpoint: kraEndpoint\n    }\n\n    await logApiCall({\n      endpoint: \"/kra/trnsSales/saveSales\",\n      method: \"POST\",\n      payload: kraPayload,\n      response: responseWithMetadata,\n      statusCode: httpStatusCode || 500,\n      durationMs,\n      branchId: saleData.branch_id,\n    })\n\n    return {\n      success: kraResponse.resultCd === \"000\",\n      kraResponse\n    }\n\n  } catch (error: any) {\n    const errorResponse: KraResponse = {\n      resultCd: \"SYSTEM_ERROR\",\n      resultMsg: error.message || \"System error calling KRA API\",\n      resultDt: new Date().toISOString()\n    }\n\n    console.error(`[KRA API] System error:`, error)\n    console.log(`[KRA API] Response (error):`, JSON.stringify(errorResponse, null, 2))\n    console.log(`[KRA API] Sale data for context:`, JSON.stringify(saleData, null, 2))\n\n    const durationMs = Date.now() - startTime\n    \n    await logApiCall({\n      endpoint: \"/kra/trnsSales/saveSales\",\n      method: \"POST\",\n      payload: { saleData, errorContext: \"System error before KRA call\" },\n      response: errorResponse,\n      statusCode: 500,\n      durationMs,\n      branchId: saleData.branch_id,\n      error: error.message\n    })\n\n    return {\n      success: false,\n      kraResponse: errorResponse,\n      error: error.message\n    }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 726, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/mobile/create-sale/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\nimport { callKraTestSalesEndpoint } from \"@/lib/kra-sales-api\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    console.log(\"[Mobile Create Sale] Request body:\", JSON.stringify(body, null, 2))\n    \n    const {\n      branch_id,\n      user_id,\n      nozzle_id,\n      fuel_type,\n      quantity,\n      unit_price,\n      total_amount,\n      payment_method,\n      customer_name,\n      kra_pin,\n      vehicle_number,\n      is_loyalty_customer,\n    } = body\n\n    if (!branch_id || !fuel_type || !total_amount) {\n      console.log(\"[Mobile Create Sale] Missing required fields - branch_id:\", branch_id, \"fuel_type:\", fuel_type, \"total_amount:\", total_amount)\n      return NextResponse.json(\n        { error: `Missing required fields: branch_id=${branch_id}, fuel_type=${fuel_type}, total_amount=${total_amount}` },\n        { status: 400 }\n      )\n    }\n\n    const client = await pool.connect()\n    try {\n      const tankCheck = await client.query(\n        `SELECT id, tank_name, kra_item_cd FROM tanks \n         WHERE branch_id = $1 AND fuel_type ILIKE $2 AND status = 'active' \n         ORDER BY current_stock DESC LIMIT 1`,\n        [branch_id, `%${fuel_type}%`]\n      )\n\n      if (tankCheck.rows.length > 0 && !tankCheck.rows[0].kra_item_cd) {\n        client.release()\n        return NextResponse.json(\n          { error: `Tank \"${tankCheck.rows[0].tank_name}\" is not mapped to an item. Please map the tank to an item in the item list before selling.` },\n          { status: 400 }\n        )\n      }\n\n      await client.query('BEGIN')\n\n      const invoiceNumber = `INV-${Date.now().toString(36).toUpperCase()}`\n      const receiptNumber = `RCP-${Date.now().toString(36).toUpperCase()}`\n\n      let meterReadingAfter = null\n      if (nozzle_id && quantity) {\n        const nozzleResult = await client.query(\n          `SELECT initial_meter_reading FROM nozzles WHERE id = $1`,\n          [nozzle_id]\n        )\n        \n        if (nozzleResult.rows.length > 0) {\n          const currentReading = parseFloat(nozzleResult.rows[0].initial_meter_reading) || 0\n          meterReadingAfter = currentReading + parseFloat(quantity)\n          \n          await client.query(\n            `UPDATE nozzles SET initial_meter_reading = $1, updated_at = NOW() WHERE id = $2`,\n            [meterReadingAfter, nozzle_id]\n          )\n        }\n      }\n\n      const saleResult = await client.query(\n        `INSERT INTO sales (\n          branch_id, nozzle_id, fuel_type, quantity, \n          unit_price, total_amount, payment_method, customer_name, \n          vehicle_number, invoice_number, receipt_number, sale_date,\n          customer_pin, is_loyalty_sale, loyalty_customer_name, loyalty_customer_pin,\n          meter_reading_after\n        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, NOW(), $12, $13, $14, $15, $16)\n        RETURNING *`,\n        [\n          branch_id,\n          nozzle_id || null,\n          fuel_type,\n          quantity || 0,\n          unit_price || 0,\n          total_amount,\n          payment_method || 'cash',\n          customer_name || 'Walk-in Customer',\n          vehicle_number || null,\n          invoiceNumber,\n          receiptNumber,\n          kra_pin || null,\n          is_loyalty_customer || false,\n          is_loyalty_customer ? customer_name : null,\n          is_loyalty_customer ? kra_pin : null,\n          meterReadingAfter,\n        ]\n      )\n\n      const sale = saleResult.rows[0]\n\n      if (is_loyalty_customer && customer_name && customer_name !== 'Walk-in Customer') {\n        const existingCustomer = await client.query(\n          `SELECT id FROM customers WHERE cust_nm = $1 AND branch_id = $2`,\n          [customer_name, branch_id]\n        )\n\n        if (existingCustomer.rows.length === 0) {\n          const custNo = `CUST-${Date.now().toString(36).toUpperCase()}`\n          await client.query(\n            `INSERT INTO customers (branch_id, cust_nm, cust_tin, cust_no, use_yn)\n             VALUES ($1, $2, $3, $4, 'Y')\n             ON CONFLICT DO NOTHING`,\n            [branch_id, customer_name, kra_pin || null, custNo]\n          )\n        }\n      }\n\n      await client.query('COMMIT')\n\n      console.log(\"[Mobile Create Sale] Sale created successfully, calling KRA endpoint...\")\n      \n      const kraResult = await callKraTestSalesEndpoint({\n        branch_id,\n        invoice_number: invoiceNumber,\n        receipt_number: receiptNumber,\n        fuel_type,\n        quantity: quantity || 0,\n        unit_price: unit_price || 0,\n        total_amount,\n        payment_method: payment_method || 'cash',\n        customer_name: customer_name || 'Walk-in Customer',\n        customer_pin: kra_pin || '',\n        sale_date: new Date().toISOString()\n      })\n\n      console.log(\"[Mobile Create Sale] KRA API Response:\", JSON.stringify(kraResult, null, 2))\n\n      return NextResponse.json({\n        success: true,\n        sale_id: sale.id,\n        sale: sale,\n        invoice_number: invoiceNumber,\n        receipt_number: receiptNumber,\n        kra_response: kraResult.kraResponse,\n        kra_success: kraResult.success\n      })\n    } catch (error) {\n      await client.query('ROLLBACK')\n      throw error\n    } finally {\n      client.release()\n    }\n  } catch (error: any) {\n    console.error(\"[Mobile Create Sale API Error]:\", error)\n    return NextResponse.json({ error: error.message || \"Failed to create sale\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}