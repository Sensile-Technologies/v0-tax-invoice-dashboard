{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/receipt/generate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\nimport jsPDF from \"jspdf\"\nimport QRCode from \"qrcode\"\nimport { formatInTimeZone } from \"date-fns-tz\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const { sale_id, branch_id, is_copy = false, mark_original_printed = false } = body\n\n    if (!sale_id || !branch_id) {\n      return NextResponse.json({ error: \"Missing sale_id or branch_id\" }, { status: 400 })\n    }\n\n    const client = await pool.connect()\n    try {\n      const saleResult = await client.query(\n        `SELECT s.*, b.name as branch_name, b.kra_pin, b.bhf_id, b.address as branch_address,\n                b.phone as branch_phone,\n                n.nozzle_number, d.dispenser_number,\n                i.item_name, i.item_code,\n                st.full_name as served_by_name,\n                orig.kra_cu_inv as original_cu_invoice,\n                orig.invoice_number as original_invoice_number\n         FROM sales s\n         LEFT JOIN branches b ON s.branch_id = b.id\n         LEFT JOIN nozzles n ON s.nozzle_id = n.id\n         LEFT JOIN dispensers d ON n.dispenser_id = d.id\n         LEFT JOIN items i ON s.item_id = i.id\n         LEFT JOIN staff st ON s.staff_id = st.id\n         LEFT JOIN sales orig ON s.original_sale_id = orig.id\n         WHERE s.id = $1`,\n        [sale_id]\n      )\n\n      if (saleResult.rows.length === 0) {\n        return NextResponse.json({ error: \"Sale not found\" }, { status: 404 })\n      }\n\n      const sale = saleResult.rows[0]\n      \n      const itemName = sale.item_name || sale.fuel_type || 'Fuel'\n      const itemCode = sale.item_code || sale.fuel_type || 'FUEL'\n      \n      const isCreditNote = sale.sale_type === 'credit_note' || \n                           sale.invoice_number?.includes('-CR') || \n                           parseFloat(sale.total_amount) < 0\n      \n      const pageWidth = 80\n      const doc = new jsPDF({ unit: 'mm', format: [pageWidth, 280] })\n      \n      let y = 8\n      const leftMargin = 5\n      const rightMargin = pageWidth - 5\n      const contentWidth = rightMargin - leftMargin\n\n      const drawLine = () => {\n        doc.setDrawColor(0)\n        doc.setLineWidth(0.1)\n        doc.line(leftMargin, y, rightMargin, y)\n        y += 3\n      }\n\n      const drawDottedLine = () => {\n        doc.setDrawColor(150)\n        doc.setLineWidth(0.1)\n        for (let x = leftMargin; x < rightMargin; x += 2) {\n          doc.line(x, y, x + 1, y)\n        }\n        y += 3\n      }\n\n      // If printing original, mark it as printed\n      if (mark_original_printed && !sale.original_printed) {\n        await client.query(\n          `UPDATE sales SET original_printed = TRUE WHERE id = $1`,\n          [sale_id]\n        )\n      }\n\n      doc.setFontSize(12)\n      doc.setFont(\"helvetica\", \"bold\")\n      \n      // Add INVOICE COPY header if this is a copy\n      if (is_copy) {\n        doc.setTextColor(128, 128, 128)\n        doc.text(\"*** INVOICE COPY ***\", pageWidth / 2, y, { align: \"center\" })\n        y += 5\n        doc.setTextColor(0, 0, 0)\n      }\n      \n      doc.text(isCreditNote ? \"CREDIT NOTE\" : \"TAX INVOICE\", pageWidth / 2, y, { align: \"center\" })\n      y += 6\n\n      doc.setFontSize(10)\n      doc.text(sale.branch_name || \"Flow360 Station\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      doc.setFontSize(8)\n      doc.setFont(\"helvetica\", \"normal\")\n      if (sale.branch_address) {\n        doc.text(sale.branch_address, pageWidth / 2, y, { align: \"center\" })\n        y += 3\n      }\n      if (sale.branch_phone) {\n        doc.text(`Tel: ${sale.branch_phone}`, pageWidth / 2, y, { align: \"center\" })\n        y += 3\n      }\n      \n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(`PIN: ${sale.kra_pin || 'P052344628B'}`, pageWidth / 2, y, { align: \"center\" })\n      y += 5\n\n      drawLine()\n\n      doc.setFontSize(7)\n      doc.setFont(\"helvetica\", \"normal\")\n      \n      if (isCreditNote) {\n        const originalCuInv = sale.original_cu_invoice || sale.original_kra_cu_inv || sale.original_invoice_number || \"N/A\"\n        doc.text(\"REFERENCING ORIGINAL CU INVOICE NO.#:\", pageWidth / 2, y, { align: \"center\" })\n        y += 3\n        doc.setFont(\"helvetica\", \"bold\")\n        doc.text(String(originalCuInv), pageWidth / 2, y, { align: \"center\" })\n        doc.setFont(\"helvetica\", \"normal\")\n      } else {\n        doc.text(\"Welcome to our shop\", pageWidth / 2, y, { align: \"center\" })\n      }\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(8)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"BUYER INFORMATION\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      doc.setFontSize(7)\n      doc.setFont(\"helvetica\", \"normal\")\n      // Use loyalty customer fields first (stored directly in sales table), then fall back to customer_pin/name\n      const buyerPin = sale.loyalty_customer_pin || sale.customer_pin || \"NOT PROVIDED\"\n      const buyerName = sale.loyalty_customer_name || sale.customer_name || \"Walk-in Customer\"\n      doc.text(`Buyer PIN:`, leftMargin, y)\n      doc.text(String(buyerPin), leftMargin + 22, y)\n      y += 3\n      doc.text(`Buyer Name:`, leftMargin, y)\n      doc.text(String(buyerName), leftMargin + 22, y)\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(8)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"PRODUCT DETAILS\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      doc.setFontSize(7)\n      doc.setFont(\"helvetica\", \"normal\")\n      \n      const unitPrice = parseFloat(sale.unit_price) || 0\n      const quantity = parseFloat(sale.quantity) || 0\n      const totalAmount = parseFloat(sale.total_amount) || 0\n      const taxableAmount = totalAmount / 1.16\n      const vatAmount = totalAmount - taxableAmount\n\n      doc.text(`Item Code:`, leftMargin, y)\n      doc.text(itemCode, leftMargin + 22, y)\n      y += 3\n      doc.text(`Description:`, leftMargin, y)\n      doc.text(itemName, leftMargin + 22, y)\n      y += 3\n      doc.text(`Dispenser:`, leftMargin, y)\n      doc.text(`D${sale.dispenser_number || '0'}N${sale.nozzle_number || '1'}`, leftMargin + 22, y)\n      y += 3\n      doc.text(`Unit Price:`, leftMargin, y)\n      doc.text(`KES ${unitPrice.toFixed(2)}`, leftMargin + 22, y)\n      y += 3\n      doc.text(`Quantity:`, leftMargin, y)\n      doc.text(`${quantity.toFixed(3)} L`, leftMargin + 22, y)\n      y += 3\n      doc.text(`Discount:`, leftMargin, y)\n      doc.text(\"(0.00)\", leftMargin + 22, y)\n      y += 4\n      \n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(`Total:`, leftMargin, y)\n      doc.text(`KES ${totalAmount.toFixed(2)}`, leftMargin + 22, y)\n      y += 5\n\n      drawLine()\n\n      doc.setFontSize(8)\n      doc.text(\"TAX BREAKDOWN\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      doc.setFontSize(6)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"Rate\", leftMargin, y)\n      doc.text(\"Taxable\", leftMargin + 20, y)\n      doc.text(\"VAT\", leftMargin + 45, y)\n      y += 3\n\n      drawDottedLine()\n\n      doc.setFont(\"helvetica\", \"normal\")\n      doc.text(\"EX\", leftMargin, y)\n      doc.text(\"KES 0.00\", leftMargin + 20, y)\n      doc.text(\"KES 0.00\", leftMargin + 45, y)\n      y += 3\n\n      doc.text(\"16%\", leftMargin, y)\n      doc.text(`KES ${taxableAmount.toFixed(2)}`, leftMargin + 20, y)\n      doc.text(`KES ${vatAmount.toFixed(2)}`, leftMargin + 45, y)\n      y += 3\n\n      doc.text(\"0%\", leftMargin, y)\n      doc.text(\"KES 0.00\", leftMargin + 20, y)\n      doc.text(\"KES 0.00\", leftMargin + 45, y)\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(7)\n      const saleTimestamp = new Date(sale.created_at || sale.sale_date)\n      const dateStr = formatInTimeZone(saleTimestamp, 'Africa/Nairobi', 'dd/MM/yyyy')\n      const timeStr = formatInTimeZone(saleTimestamp, 'Africa/Nairobi', 'HH:mm:ss')\n      \n      doc.text(`Date:`, leftMargin, y)\n      doc.text(dateStr, leftMargin + 22, y)\n      y += 3\n      doc.text(`Time:`, leftMargin, y)\n      doc.text(timeStr, leftMargin + 22, y)\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(6)\n      doc.text(`SCU ID:`, leftMargin, y)\n      doc.text(sale.kra_scu_id || \"N/A\", leftMargin + 18, y)\n      y += 3\n      doc.text(`CU INV NO:`, leftMargin, y)\n      doc.text(sale.kra_cu_inv || \"N/A\", leftMargin + 18, y)\n      y += 3\n      doc.text(`Internal Data:`, leftMargin, y)\n      doc.text(sale.kra_internal_data || sale.invoice_number || \"N/A\", leftMargin + 18, y)\n      y += 4\n\n      drawLine()\n\n      const kraPin = sale.kra_pin || 'P052344628B'\n      const bhfId = sale.bhf_id || '03'\n      const rcptSign = sale.kra_rcpt_sign || ''\n      \n      const qrData = `${kraPin}${bhfId}${rcptSign}`\n      const kraPortal = process.env.NODE_ENV === 'production' ? 'etims.kra.go.ke' : 'etims-sbx.kra.go.ke'\n      const qrUrl = `https://${kraPortal}/common/link/etims/receipt/indexEtimsReceiptData?Data=${qrData}`\n\n      doc.setFontSize(8)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"KRA eTIMS Verification\", pageWidth / 2, y, { align: \"center\" })\n      y += 5\n\n      try {\n        const qrDataUrl = await QRCode.toDataURL(qrUrl, {\n          width: 150,\n          margin: 1,\n          errorCorrectionLevel: 'M'\n        })\n        \n        const qrSize = 30\n        const qrX = (pageWidth - qrSize) / 2\n        doc.addImage(qrDataUrl, 'PNG', qrX, y, qrSize, qrSize)\n        y += qrSize + 3\n      } catch (qrError) {\n        console.error(\"QR Code generation error:\", qrError)\n        doc.setFontSize(6)\n        doc.setFont(\"helvetica\", \"normal\")\n        doc.text(\"QR Code unavailable\", pageWidth / 2, y + 10, { align: \"center\" })\n        y += 20\n      }\n\n      doc.setFontSize(5)\n      doc.setFont(\"helvetica\", \"normal\")\n      doc.text(\"Scan to verify with KRA eTIMS\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(7)\n      const receiptNo = sale.kra_cu_inv?.split('/')[1] || sale.invoice_number?.replace('INV-', '') || String(sale.id).substring(0, 8)\n      doc.text(`Receipt No:`, leftMargin, y)\n      doc.text(receiptNo, leftMargin + 22, y)\n      y += 3\n      doc.text(`Served by:`, leftMargin, y)\n      doc.text(sale.served_by_name || sale.cashier_name || \"Attendant\", leftMargin + 22, y)\n      y += 3\n      doc.text(`Payment:`, leftMargin, y)\n      doc.text(sale.payment_method || \"Cash\", leftMargin + 22, y)\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(8)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"Carbon Emission Details\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      doc.setFontSize(7)\n      doc.setFont(\"helvetica\", \"normal\")\n      const co2PerLitre = sale.fuel_type?.toLowerCase().includes('diesel') ? 2.68 : 2.31\n      const totalCo2 = quantity * co2PerLitre\n      doc.text(`CO2 Per Litre:`, leftMargin, y)\n      doc.text(`${co2PerLitre.toFixed(2)} kg`, leftMargin + 22, y)\n      y += 3\n      doc.text(`Total CO2:`, leftMargin, y)\n      doc.text(`${totalCo2.toFixed(2)} kg`, leftMargin + 22, y)\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(9)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"THANK YOU FOR SHOPPING WITH US\", pageWidth / 2, y, { align: \"center\" })\n      y += 5\n\n      doc.setFontSize(7)\n      doc.setFont(\"helvetica\", \"normal\")\n      doc.text(\"Powered by Flow360\", pageWidth / 2, y, { align: \"center\" })\n      y += 4\n\n      drawLine()\n\n      doc.setFontSize(7)\n      doc.setFont(\"helvetica\", \"bold\")\n      doc.text(\"END OF LEGAL RECEIPT\", pageWidth / 2, y, { align: \"center\" })\n\n      const pdfBuffer = Buffer.from(doc.output('arraybuffer'))\n\n      return new NextResponse(pdfBuffer, {\n        status: 200,\n        headers: {\n          'Content-Type': 'application/pdf',\n          'Content-Disposition': `attachment; filename=\"receipt-${sale.invoice_number || sale.id}.pdf\"`,\n        },\n      })\n    } finally {\n      client.release()\n    }\n  } catch (error: any) {\n    console.error(\"[Receipt Generate API Error]:\", error)\n    return NextResponse.json({ error: error.message || \"Failed to generate receipt\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}