{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/logs/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const branchId = searchParams.get(\"branch_id\")\n    const endpoint = searchParams.get(\"endpoint\")\n    const limit = parseInt(searchParams.get(\"limit\") || \"500\")\n\n    const conditions: string[] = []\n    const params: any[] = []\n    let paramIndex = 1\n\n    if (branchId) {\n      conditions.push(`branch_id = $${paramIndex}`)\n      params.push(branchId)\n      paramIndex++\n    }\n\n    if (endpoint) {\n      conditions.push(`endpoint ILIKE $${paramIndex}`)\n      params.push(`%${endpoint}%`)\n      paramIndex++\n    }\n\n    const whereClause = conditions.length > 0 ? ` WHERE ` + conditions.join(\" AND \") : \"\"\n\n    let sql: string\n    const queryParams: any[] = []\n\n    if (branchId || endpoint) {\n      const branchConditions: string[] = []\n      let branchParamIndex = conditions.length + 1\n      \n      if (branchId) {\n        branchConditions.push(`branch_id = $${branchParamIndex}`)\n        branchParamIndex++\n      }\n      if (endpoint) {\n        branchConditions.push(`endpoint ILIKE $${branchParamIndex}`)\n        branchParamIndex++\n      }\n      const branchWhereClause = branchConditions.length > 0 ? ` WHERE ` + branchConditions.join(\" AND \") : \"\"\n\n      sql = `\n        SELECT * FROM (\n          SELECT \n            id,\n            endpoint,\n            method,\n            payload,\n            response,\n            status_code,\n            error,\n            duration_ms,\n            created_at,\n            external_endpoint,\n            branch_id,\n            'api' as log_source\n          FROM api_logs\n          ${whereClause}\n          UNION ALL\n          SELECT \n            id,\n            endpoint,\n            'POST' as method,\n            request_payload as payload,\n            response_payload as response,\n            CASE WHEN status = 'success' THEN 200 ELSE 500 END as status_code,\n            CASE WHEN status = 'error' THEN response_payload::text ELSE NULL END as error,\n            NULL as duration_ms,\n            created_at,\n            endpoint as external_endpoint,\n            branch_id,\n            'branch' as log_source\n          FROM branch_logs\n          ${branchWhereClause}\n        ) combined\n        ORDER BY created_at DESC\n        LIMIT $${branchParamIndex}\n      `\n      queryParams.push(...params, ...params, limit)\n    } else {\n      sql = `\n        SELECT * FROM (\n          SELECT \n            id,\n            endpoint,\n            method,\n            payload,\n            response,\n            status_code,\n            error,\n            duration_ms,\n            created_at,\n            external_endpoint,\n            branch_id,\n            'api' as log_source\n          FROM api_logs\n          UNION ALL\n          SELECT \n            id,\n            endpoint,\n            'POST' as method,\n            request_payload as payload,\n            response_payload as response,\n            CASE WHEN status = 'success' THEN 200 ELSE 500 END as status_code,\n            CASE WHEN status = 'error' THEN response_payload::text ELSE NULL END as error,\n            NULL as duration_ms,\n            created_at,\n            endpoint as external_endpoint,\n            branch_id,\n            'branch' as log_source\n          FROM branch_logs\n        ) combined\n        ORDER BY created_at DESC\n        LIMIT $1\n      `\n      queryParams.push(limit)\n    }\n\n    const logs = await query(sql, queryParams)\n\n    return NextResponse.json({ logs })\n  } catch (error: any) {\n    console.error(\"[Logs API] Error fetching logs:\", error)\n    return NextResponse.json({ error: error.message || \"Internal server error\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const branchId = searchParams.get(\"branch_id\")\n\n    if (branchId) {\n      await query(`DELETE FROM api_logs WHERE branch_id = $1`, [branchId])\n    } else {\n      await query(`DELETE FROM api_logs WHERE id IS NOT NULL`)\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error: any) {\n    console.error(\"[Logs API] Error clearing logs:\", error)\n    return NextResponse.json({ error: error.message || \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QAEpD,MAAM,aAAuB,EAAE;QAC/B,MAAM,SAAgB,EAAE;QACxB,IAAI,aAAa;QAEjB,IAAI,UAAU;YACZ,WAAW,IAAI,CAAC,CAAC,aAAa,EAAE,YAAY;YAC5C,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,UAAU;YACZ,WAAW,IAAI,CAAC,CAAC,gBAAgB,EAAE,YAAY;YAC/C,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;YAC3B;QACF;QAEA,MAAM,cAAc,WAAW,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,WAAW,IAAI,CAAC,WAAW;QAEnF,IAAI;QACJ,MAAM,cAAqB,EAAE;QAE7B,IAAI,YAAY,UAAU;YACxB,MAAM,mBAA6B,EAAE;YACrC,IAAI,mBAAmB,WAAW,MAAM,GAAG;YAE3C,IAAI,UAAU;gBACZ,iBAAiB,IAAI,CAAC,CAAC,aAAa,EAAE,kBAAkB;gBACxD;YACF;YACA,IAAI,UAAU;gBACZ,iBAAiB,IAAI,CAAC,CAAC,gBAAgB,EAAE,kBAAkB;gBAC3D;YACF;YACA,MAAM,oBAAoB,iBAAiB,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,iBAAiB,IAAI,CAAC,WAAW;YAErG,MAAM,CAAC;;;;;;;;;;;;;;;;UAgBH,EAAE,YAAY;;;;;;;;;;;;;;;;UAgBd,EAAE,kBAAkB;;;eAGf,EAAE,iBAAiB;MAC5B,CAAC;YACD,YAAY,IAAI,IAAI,WAAW,QAAQ;QACzC,OAAO;YACL,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAkCP,CAAC;YACD,YAAY,IAAI,CAAC;QACnB;QAEA,MAAM,OAAO,MAAM,IAAA,8HAAK,EAAC,KAAK;QAE9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK;IAClC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF;AAEO,eAAe,OAAO,OAAoB;IAC/C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,UAAU;YACZ,MAAM,IAAA,8HAAK,EAAC,CAAC,yCAAyC,CAAC,EAAE;gBAAC;aAAS;QACrE,OAAO;YACL,MAAM,IAAA,8HAAK,EAAC,CAAC,yCAAyC,CAAC;QACzD;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF"}}]
}