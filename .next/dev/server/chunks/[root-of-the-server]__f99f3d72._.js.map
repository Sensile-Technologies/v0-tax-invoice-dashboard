{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/invoices/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n\n    const invoiceResult = await query(`\n      SELECT \n        i.*,\n        v.name as merchant_name,\n        b.name as branch_name\n      FROM invoices i\n      LEFT JOIN vendors v ON i.vendor_id = v.id\n      LEFT JOIN branches b ON i.branch_id = b.id\n      WHERE i.id = $1\n    `, [id])\n\n    if (invoiceResult.length === 0) {\n      return NextResponse.json({ error: \"Invoice not found\" }, { status: 404 })\n    }\n\n    const lineItemsResult = await query(`\n      SELECT * FROM invoice_line_items WHERE invoice_id = $1 ORDER BY created_at\n    `, [id])\n\n    return NextResponse.json({\n      ...invoiceResult[0],\n      line_items: lineItemsResult\n    })\n  } catch (error) {\n    console.error(\"Error fetching invoice:\", error)\n    return NextResponse.json({ error: \"Failed to fetch invoice\" }, { status: 500 })\n  }\n}\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { status } = body\n\n    if (!status || !['draft', 'pending', 'partial', 'paid', 'overdue', 'cancelled'].includes(status)) {\n      return NextResponse.json({ error: \"Invalid status\" }, { status: 400 })\n    }\n\n    await query(`UPDATE invoices SET status = $1 WHERE id = $2`, [status, id])\n\n    const updated = await query(`SELECT * FROM invoices WHERE id = $1`, [id])\n    return NextResponse.json(updated[0])\n  } catch (error) {\n    console.error(\"Error updating invoice status:\", error)\n    return NextResponse.json({ error: \"Failed to update status\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const { billed_to_contact, due_date, notes, include_vat, line_items } = body\n\n    const invoiceResult = await query(`SELECT * FROM invoices WHERE id = $1`, [id])\n    if (invoiceResult.length === 0) {\n      return NextResponse.json({ error: \"Invoice not found\" }, { status: 404 })\n    }\n\n    const invoice = invoiceResult[0]\n    if (invoice.status !== \"draft\") {\n      return NextResponse.json({ error: \"Only draft invoices can be edited\" }, { status: 400 })\n    }\n\n    let subtotal = 0\n    if (line_items && Array.isArray(line_items)) {\n      subtotal = line_items.reduce((sum: number, item: any) => {\n        const lineSubtotal = item.quantity * item.unit_price\n        const discountAmount = lineSubtotal * ((item.discount || 0) / 100)\n        return sum + (lineSubtotal - discountAmount)\n      }, 0)\n    }\n    const taxAmount = include_vat !== false ? subtotal * 0.16 : 0\n    const totalAmount = subtotal + taxAmount\n\n    await query(`\n      UPDATE invoices \n      SET billed_to_contact = $1, due_date = $2, notes = $3, subtotal = $4, tax_amount = $5, total_amount = $6\n      WHERE id = $7\n    `, [billed_to_contact, due_date, notes, subtotal, taxAmount, totalAmount, id])\n\n    await query(`DELETE FROM invoice_line_items WHERE invoice_id = $1`, [id])\n\n    if (line_items && Array.isArray(line_items)) {\n      for (const item of line_items) {\n        const lineSubtotal = item.quantity * item.unit_price\n        const discountAmount = lineSubtotal * ((item.discount || 0) / 100)\n        const lineAmount = lineSubtotal - discountAmount\n        await query(\n          `INSERT INTO invoice_line_items (invoice_id, description, quantity, unit_price, tax_rate, amount, discount)\n           VALUES ($1, $2, $3, $4, $5, $6, $7)`,\n          [id, item.description, item.quantity, item.unit_price, item.tax_rate || 0, lineAmount, item.discount || 0]\n        )\n      }\n    }\n\n    const updatedInvoice = await query(`SELECT * FROM invoices WHERE id = $1`, [id])\n    return NextResponse.json(updatedInvoice[0])\n  } catch (error) {\n    console.error(\"Error updating invoice:\", error)\n    return NextResponse.json({ error: \"Failed to update invoice\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}