{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/sales/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get('branch_id')\n    const nozzleId = searchParams.get('nozzle_id')\n    const limit = searchParams.get('limit') || '50'\n\n    let query = 'SELECT * FROM sales WHERE 1=1'\n    const params: any[] = []\n\n    if (branchId) {\n      params.push(branchId)\n      query += ` AND branch_id = $${params.length}`\n    }\n\n    if (nozzleId) {\n      params.push(nozzleId)\n      query += ` AND nozzle_id = $${params.length}`\n    }\n\n    query += ' ORDER BY sale_date DESC'\n    params.push(parseInt(limit))\n    query += ` LIMIT $${params.length}`\n\n    const result = await pool.query(query, params)\n\n    return NextResponse.json({\n      success: true,\n      data: result.rows\n    })\n\n  } catch (error: any) {\n    console.error(\"Error fetching sales:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch sales\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const {\n      branch_id,\n      shift_id,\n      nozzle_id,\n      fuel_type,\n      quantity,\n      unit_price,\n      total_amount,\n      payment_method,\n      customer_name,\n      vehicle_number,\n      customer_pin,\n      invoice_number,\n      meter_reading_after,\n      transmission_status,\n      receipt_number,\n      is_loyalty_sale,\n      loyalty_customer_name,\n      loyalty_customer_pin\n    } = body\n\n    if (!branch_id || !nozzle_id || !fuel_type) {\n      return NextResponse.json(\n        { error: \"Missing required fields\" },\n        { status: 400 }\n      )\n    }\n\n    const result = await pool.query(\n      `INSERT INTO sales (\n        branch_id, shift_id, nozzle_id, fuel_type, quantity, unit_price, \n        total_amount, payment_method, customer_name, vehicle_number, customer_pin,\n        invoice_number, meter_reading_after, transmission_status, receipt_number,\n        is_loyalty_sale, loyalty_customer_name, loyalty_customer_pin, sale_date, created_at\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, NOW(), NOW())\n      RETURNING *`,\n      [\n        branch_id, shift_id, nozzle_id, fuel_type, quantity, unit_price,\n        total_amount, payment_method, customer_name, vehicle_number, customer_pin,\n        invoice_number, meter_reading_after, transmission_status || 'pending', receipt_number,\n        is_loyalty_sale || false, loyalty_customer_name, loyalty_customer_pin\n      ]\n    )\n\n    return NextResponse.json({\n      success: true,\n      data: result.rows[0]\n    })\n\n  } catch (error: any) {\n    console.error(\"Error creating sale:\", error)\n    return NextResponse.json(\n      { error: \"Failed to create sale\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY;QAE3C,IAAI,QAAQ;QACZ,MAAM,SAAgB,EAAE;QAExB,IAAI,UAAU;YACZ,OAAO,IAAI,CAAC;YACZ,SAAS,CAAC,kBAAkB,EAAE,OAAO,MAAM,EAAE;QAC/C;QAEA,IAAI,UAAU;YACZ,OAAO,IAAI,CAAC;YACZ,SAAS,CAAC,kBAAkB,EAAE,OAAO,MAAM,EAAE;QAC/C;QAEA,SAAS;QACT,OAAO,IAAI,CAAC,SAAS;QACrB,SAAS,CAAC,QAAQ,EAAE,OAAO,MAAM,EAAE;QAEnC,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QAEvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,OAAO,IAAI;QACnB;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,SAAS,MAAM,OAAO;QAAC,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,SAAS,EACT,QAAQ,EACR,SAAS,EACT,SAAS,EACT,QAAQ,EACR,UAAU,EACV,YAAY,EACZ,cAAc,EACd,aAAa,EACb,cAAc,EACd,YAAY,EACZ,cAAc,EACd,mBAAmB,EACnB,mBAAmB,EACnB,cAAc,EACd,eAAe,EACf,qBAAqB,EACrB,oBAAoB,EACrB,GAAG;QAEJ,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,WAAW;YAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,CAAC;;;;;;iBAMU,CAAC,EACZ;YACE;YAAW;YAAU;YAAW;YAAW;YAAU;YACrD;YAAc;YAAgB;YAAe;YAAgB;YAC7D;YAAgB;YAAqB,uBAAuB;YAAW;YACvE,mBAAmB;YAAO;YAAuB;SAClD;QAGH,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,OAAO,IAAI,CAAC,EAAE;QACtB;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,SAAS,MAAM,OAAO;QAAC,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}