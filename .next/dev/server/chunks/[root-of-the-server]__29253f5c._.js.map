{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/staff/create/route.ts"],"sourcesContent":["import { Pool } from \"pg\"\nimport bcrypt from \"bcryptjs\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function POST(request: Request) {\n  try {\n    const { email, username, password, fullName, phoneNumber, role, branchId } = await request.json()\n\n    if (!email || !username || !password || !fullName || !role) {\n      return Response.json({ error: \"Missing required fields\" }, { status: 400 })\n    }\n\n    const client = await pool.connect()\n\n    try {\n      const existingUser = await client.query(\n        \"SELECT id FROM users WHERE email = $1 OR username = $2\",\n        [email, username]\n      )\n\n      if (existingUser.rows.length > 0) {\n        return Response.json({ error: \"User with this email or username already exists\" }, { status: 400 })\n      }\n\n      const userId = crypto.randomUUID()\n      const passwordHash = await bcrypt.hash(password, 10)\n\n      await client.query(\n        `INSERT INTO users (id, email, username, phone_number, password_hash, created_at, updated_at)\n         VALUES ($1, $2, $3, $4, $5, NOW(), NOW())`,\n        [userId, email, username, phoneNumber || null, passwordHash]\n      )\n\n      const staffId = crypto.randomUUID()\n      const staffResult = await client.query(\n        `INSERT INTO staff (id, user_id, username, email, full_name, phone_number, role, branch_id, status, created_at, updated_at)\n         VALUES ($1, $2, $3, $4, $5, $6, $7, $8, 'active', NOW(), NOW())\n         RETURNING *`,\n        [staffId, userId, username, email, fullName, phoneNumber || null, role, branchId || null]\n      )\n\n      return Response.json({\n        success: true,\n        message: \"Staff member created successfully\",\n        staff: staffResult.rows[0],\n      })\n    } finally {\n      client.release()\n    }\n  } catch (error) {\n    console.error(\"Error creating staff:\", error)\n    return Response.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE/F,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,YAAY,CAAC,MAAM;YAC1D,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,SAAS,MAAM,KAAK,OAAO;QAEjC,IAAI;YACF,MAAM,eAAe,MAAM,OAAO,KAAK,CACrC,0DACA;gBAAC;gBAAO;aAAS;YAGnB,IAAI,aAAa,IAAI,CAAC,MAAM,GAAG,GAAG;gBAChC,OAAO,SAAS,IAAI,CAAC;oBAAE,OAAO;gBAAkD,GAAG;oBAAE,QAAQ;gBAAI;YACnG;YAEA,MAAM,SAAS,OAAO,UAAU;YAChC,MAAM,eAAe,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;YAEjD,MAAM,OAAO,KAAK,CAChB,CAAC;kDACyC,CAAC,EAC3C;gBAAC;gBAAQ;gBAAO;gBAAU,eAAe;gBAAM;aAAa;YAG9D,MAAM,UAAU,OAAO,UAAU;YACjC,MAAM,cAAc,MAAM,OAAO,KAAK,CACpC,CAAC;;oBAEW,CAAC,EACb;gBAAC;gBAAS;gBAAQ;gBAAU;gBAAO;gBAAU,eAAe;gBAAM;gBAAM,YAAY;aAAK;YAG3F,OAAO,SAAS,IAAI,CAAC;gBACnB,SAAS;gBACT,SAAS;gBACT,OAAO,YAAY,IAAI,CAAC,EAAE;YAC5B;QACF,SAAU;YACR,OAAO,OAAO;QAChB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IACzE;AACF"}}]
}