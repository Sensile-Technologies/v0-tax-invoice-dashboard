{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/invoices/%5Bid%5D/duplicate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db/client\"\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n\n    const invoiceResult = await query(`\n      SELECT * FROM invoices WHERE id = $1\n    `, [id])\n\n    if (invoiceResult.length === 0) {\n      return NextResponse.json({ error: \"Invoice not found\" }, { status: 404 })\n    }\n\n    const original = invoiceResult[0]\n\n    const year = new Date().getFullYear()\n    const lastInvoiceResult = await query(\n      `SELECT invoice_number FROM invoices \n       WHERE invoice_number LIKE $1 \n       ORDER BY invoice_number DESC LIMIT 1`,\n      [`INV-${year}-%`]\n    )\n    \n    let nextNumber = 1\n    if (lastInvoiceResult.length > 0) {\n      const lastNumber = lastInvoiceResult[0].invoice_number\n      const parts = lastNumber.split('-')\n      if (parts.length === 3) {\n        nextNumber = parseInt(parts[2], 10) + 1\n      }\n    }\n    const invoiceNumber = `INV-${year}-${nextNumber.toString().padStart(4, '0')}`\n\n    const newInvoiceResult = await query(`\n      INSERT INTO invoices (\n        invoice_number, vendor_id, branch_id, issue_date, due_date,\n        subtotal, tax_amount, total_amount, paid_amount, status, notes,\n        is_recurring, recurring_interval, created_by\n      ) VALUES (\n        $1, $2, $3, $4, $5, $6, $7, $8, 0, 'draft', $9, $10, $11, $12\n      )\n      RETURNING *\n    `, [\n      invoiceNumber,\n      original.vendor_id,\n      original.branch_id,\n      new Date().toISOString().split('T')[0],\n      original.due_date,\n      original.subtotal,\n      original.tax_amount,\n      original.total_amount,\n      original.notes,\n      original.is_recurring,\n      original.recurring_interval,\n      original.created_by\n    ])\n\n    const lineItemsResult = await query(`\n      SELECT * FROM invoice_line_items WHERE invoice_id = $1\n    `, [id])\n\n    for (const item of lineItemsResult) {\n      await query(`\n        INSERT INTO invoice_line_items (invoice_id, description, quantity, unit_price, tax_rate, amount)\n        VALUES ($1, $2, $3, $4, $5, $6)\n      `, [\n        newInvoiceResult[0].id,\n        item.description,\n        item.quantity,\n        item.unit_price,\n        item.tax_rate,\n        item.amount\n      ])\n    }\n\n    return NextResponse.json(newInvoiceResult[0])\n  } catch (error) {\n    console.error(\"Error duplicating invoice:\", error)\n    return NextResponse.json({ error: \"Failed to duplicate invoice\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,gBAAgB,MAAM,IAAA,8HAAK,EAAC,CAAC;;IAEnC,CAAC,EAAE;YAAC;SAAG;QAEP,IAAI,cAAc,MAAM,KAAK,GAAG;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,WAAW,aAAa,CAAC,EAAE;QAEjC,MAAM,OAAO,IAAI,OAAO,WAAW;QACnC,MAAM,oBAAoB,MAAM,IAAA,8HAAK,EACnC,CAAC;;2CAEoC,CAAC,EACtC;YAAC,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC;SAAC;QAGnB,IAAI,aAAa;QACjB,IAAI,kBAAkB,MAAM,GAAG,GAAG;YAChC,MAAM,aAAa,iBAAiB,CAAC,EAAE,CAAC,cAAc;YACtD,MAAM,QAAQ,WAAW,KAAK,CAAC;YAC/B,IAAI,MAAM,MAAM,KAAK,GAAG;gBACtB,aAAa,SAAS,KAAK,CAAC,EAAE,EAAE,MAAM;YACxC;QACF;QACA,MAAM,gBAAgB,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,WAAW,QAAQ,GAAG,QAAQ,CAAC,GAAG,MAAM;QAE7E,MAAM,mBAAmB,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;IAStC,CAAC,EAAE;YACD;YACA,SAAS,SAAS;YAClB,SAAS,SAAS;YAClB,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YACtC,SAAS,QAAQ;YACjB,SAAS,QAAQ;YACjB,SAAS,UAAU;YACnB,SAAS,YAAY;YACrB,SAAS,KAAK;YACd,SAAS,YAAY;YACrB,SAAS,kBAAkB;YAC3B,SAAS,UAAU;SACpB;QAED,MAAM,kBAAkB,MAAM,IAAA,8HAAK,EAAC,CAAC;;IAErC,CAAC,EAAE;YAAC;SAAG;QAEP,KAAK,MAAM,QAAQ,gBAAiB;YAClC,MAAM,IAAA,8HAAK,EAAC,CAAC;;;MAGb,CAAC,EAAE;gBACD,gBAAgB,CAAC,EAAE,CAAC,EAAE;gBACtB,KAAK,WAAW;gBAChB,KAAK,QAAQ;gBACb,KAAK,UAAU;gBACf,KAAK,QAAQ;gBACb,KAAK,MAAM;aACZ;QACH;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE;IAC9C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}