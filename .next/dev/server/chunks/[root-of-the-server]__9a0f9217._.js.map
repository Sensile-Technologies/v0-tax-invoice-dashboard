{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,OAAO,MAAM,KAAK,OAAO;AAC3B"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/vendor/upload-logo/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query, queryOne } from \"@/lib/db\"\nimport { cookies } from \"next/headers\"\nimport { writeFile, mkdir } from \"fs/promises\"\nimport path from \"path\"\n\nasync function getSessionUser() {\n  const cookieStore = await cookies()\n  const sessionCookie = cookieStore.get('user_session')\n  \n  if (!sessionCookie?.value) {\n    return null\n  }\n  \n  try {\n    const sessionData = JSON.parse(sessionCookie.value)\n    if (!sessionData.id) return null\n    \n    const users = await query(\n      `SELECT u.id, u.email, u.username, \n       COALESCE(s.role, u.role) as role,\n       COALESCE(v.id, b.vendor_id) as vendor_id\n       FROM users u \n       LEFT JOIN vendors v ON v.email = u.email \n       LEFT JOIN staff s ON s.user_id = u.id\n       LEFT JOIN branches b ON b.id = s.branch_id\n       WHERE u.id = $1`,\n      [sessionData.id]\n    )\n    \n    return users[0] || null\n  } catch {\n    return null\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const user = await getSessionUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n    \n    const role = (user.role || '').toLowerCase()\n    if (!['vendor', 'director'].includes(role)) {\n      return NextResponse.json({ error: \"Access denied\" }, { status: 403 })\n    }\n    \n    if (!user.vendor_id) {\n      return NextResponse.json({ error: \"No vendor associated with user\" }, { status: 400 })\n    }\n\n    const formData = await request.formData()\n    const fileEntry = formData.get('logo')\n    const file = fileEntry instanceof File ? fileEntry : null\n    \n    if (!file) {\n      return NextResponse.json({ error: \"No file uploaded\" }, { status: 400 })\n    }\n\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml']\n    if (!allowedTypes.includes(file.type)) {\n      return NextResponse.json({ error: \"Invalid file type. Please upload a JPG, PNG, GIF, WebP, or SVG image.\" }, { status: 400 })\n    }\n\n    const maxSize = 2 * 1024 * 1024\n    if (file.size > maxSize) {\n      return NextResponse.json({ error: \"File too large. Maximum size is 2MB.\" }, { status: 400 })\n    }\n\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n\n    const ext = file.name.split('.').pop()?.toLowerCase() || 'png'\n    const filename = `${user.vendor_id}-${Date.now()}.${ext}`\n    \n    const uploadsDir = path.join(process.cwd(), 'public', 'uploads', 'logos')\n    await mkdir(uploadsDir, { recursive: true })\n    \n    const filepath = path.join(uploadsDir, filename)\n    await writeFile(filepath, buffer)\n\n    const logoUrl = `/uploads/logos/${filename}`\n\n    await query(\n      `UPDATE vendors SET logo_url = $1, updated_at = NOW() WHERE id = $2`,\n      [logoUrl, user.vendor_id]\n    )\n\n    return NextResponse.json({ success: true, logo_url: logoUrl })\n  } catch (error) {\n    console.error(\"Error uploading logo:\", error)\n    return NextResponse.json({ error: \"Failed to upload logo\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;AAEA,eAAe;IACb,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,gBAAgB,YAAY,GAAG,CAAC;IAEtC,IAAI,CAAC,eAAe,OAAO;QACzB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,cAAc,KAAK,KAAK,CAAC,cAAc,KAAK;QAClD,IAAI,CAAC,YAAY,EAAE,EAAE,OAAO;QAE5B,MAAM,QAAQ,MAAM,IAAA,8HAAK,EACvB,CAAC;;;;;;;sBAOe,CAAC,EACjB;YAAC,YAAY,EAAE;SAAC;QAGlB,OAAO,KAAK,CAAC,EAAE,IAAI;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM;QAEnB,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,CAAC,KAAK,IAAI,IAAI,EAAE,EAAE,WAAW;QAC1C,IAAI,CAAC;YAAC;YAAU;SAAW,CAAC,QAAQ,CAAC,OAAO;YAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,IAAI,CAAC,KAAK,SAAS,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiC,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,YAAY,SAAS,GAAG,CAAC;QAC/B,MAAM,OAAO,qBAAqB,OAAO,YAAY;QAErD,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,eAAe;YAAC;YAAc;YAAa;YAAa;YAAc;SAAgB;QAC5F,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;YACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwE,GAAG;gBAAE,QAAQ;YAAI;QAC7H;QAEA,MAAM,UAAU,IAAI,OAAO;QAC3B,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,MAAM,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,iBAAiB;QACzD,MAAM,WAAW,GAAG,KAAK,SAAS,CAAC,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK;QAEzD,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,WAAW;QACjE,MAAM,IAAA,8HAAK,EAAC,YAAY;YAAE,WAAW;QAAK;QAE1C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;QACvC,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,MAAM,UAAU,CAAC,eAAe,EAAE,UAAU;QAE5C,MAAM,IAAA,8HAAK,EACT,CAAC,kEAAkE,CAAC,EACpE;YAAC;YAAS,KAAK,SAAS;SAAC;QAG3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,UAAU;QAAQ;IAC9D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}