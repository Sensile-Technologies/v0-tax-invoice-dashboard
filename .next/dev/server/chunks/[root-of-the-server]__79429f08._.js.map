{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/vendors/%5Bid%5D/branches/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n\n    const result = await query(`\n      SELECT id, bhf_id, name, address, status, device_token, server_address, server_port, kra_pin, trading_name, device_serial_number, sr_number\n      FROM branches\n      WHERE vendor_id = $1\n      ORDER BY name\n    `, [id])\n\n    return NextResponse.json(result)\n  } catch (error) {\n    console.error(\"Error fetching vendor branches:\", error)\n    return NextResponse.json({ error: \"Failed to fetch branches\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id: vendorId } = await params\n    const body = await request.json()\n    const { branch_id, bhf_id, device_token, server_address, server_port, kra_pin, device_serial_number, sr_number } = body\n\n    if (!branch_id) {\n      return NextResponse.json({ error: \"Branch ID is required\" }, { status: 400 })\n    }\n\n    // Verify branch belongs to this vendor\n    const branchCheck = await query(\n      `SELECT id FROM branches WHERE id = $1 AND vendor_id = $2`,\n      [branch_id, vendorId]\n    )\n\n    if (branchCheck.length === 0) {\n      return NextResponse.json({ error: \"Branch not found or does not belong to this vendor\" }, { status: 404 })\n    }\n\n    // Update branch KRA configuration\n    await query(`\n      UPDATE branches \n      SET \n        bhf_id = COALESCE($1, bhf_id),\n        device_token = COALESCE($2, device_token),\n        server_address = COALESCE($3, server_address),\n        server_port = COALESCE($4, server_port),\n        kra_pin = COALESCE($5, kra_pin),\n        device_serial_number = COALESCE($6, device_serial_number),\n        sr_number = COALESCE($7, sr_number),\n        updated_at = NOW()\n      WHERE id = $8\n    `, [bhf_id, device_token, server_address, server_port, kra_pin, device_serial_number || null, sr_number ? parseInt(sr_number) : null, branch_id])\n\n    return NextResponse.json({ success: true, message: \"Branch KRA configuration updated\" })\n  } catch (error) {\n    console.error(\"Error updating branch KRA config:\", error)\n    return NextResponse.json({ error: \"Failed to update branch configuration\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;IAK5B,CAAC,EAAE;YAAC;SAAG;QAEP,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,IAAI,QAAQ,EAAE,GAAG,MAAM;QAC/B,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,YAAY,EAAE,cAAc,EAAE,WAAW,EAAE,OAAO,EAAE,oBAAoB,EAAE,SAAS,EAAE,GAAG;QAEnH,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,uCAAuC;QACvC,MAAM,cAAc,MAAM,IAAA,8HAAK,EAC7B,CAAC,wDAAwD,CAAC,EAC1D;YAAC;YAAW;SAAS;QAGvB,IAAI,YAAY,MAAM,KAAK,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqD,GAAG;gBAAE,QAAQ;YAAI;QAC1G;QAEA,kCAAkC;QAClC,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;IAYb,CAAC,EAAE;YAAC;YAAQ;YAAc;YAAgB;YAAa;YAAS,wBAAwB;YAAM,YAAY,SAAS,aAAa;YAAM;SAAU;QAEhJ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAmC;IACxF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwC,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}