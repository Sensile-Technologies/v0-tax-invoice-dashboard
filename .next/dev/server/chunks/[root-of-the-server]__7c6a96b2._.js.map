{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/operations/signups/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET() {\n  try {\n    const result = await query(`\n      SELECT \n        l.id as lead_id,\n        l.company_name,\n        l.trading_name,\n        l.kra_pin,\n        l.contact_name,\n        l.contact_email as email,\n        l.contact_phone as phone,\n        l.location,\n        l.county,\n        l.address,\n        l.device_serial_number,\n        l.sr_number,\n        l.stage as status,\n        l.created_at,\n        sp.name as sales_person_name\n      FROM leads l\n      LEFT JOIN sales_people sp ON l.assigned_to = sp.id\n      WHERE l.stage = 'onboarding'\n      ORDER BY l.created_at DESC\n    `)\n    \n    return NextResponse.json(result)\n  } catch (error) {\n    console.error(\"Error fetching signup requests:\", error)\n    return NextResponse.json([])\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const { \n      lead_id, \n      company_name, \n      trading_name, \n      kra_pin, \n      contact_name, \n      email, \n      phone, \n      location, \n      county, \n      address,\n      device_serial_number,\n      sr_number\n    } = await request.json()\n\n    if (!lead_id) {\n      return NextResponse.json({ error: \"Lead ID is required\" }, { status: 400 })\n    }\n\n    // Update lead with editable fields (allows admin to correct input mistakes)\n    const result = await query(`\n      UPDATE leads \n      SET \n        company_name = COALESCE($2, company_name),\n        trading_name = COALESCE($3, trading_name),\n        kra_pin = COALESCE($4, kra_pin),\n        contact_name = COALESCE($5, contact_name),\n        contact_email = COALESCE($6, contact_email),\n        contact_phone = COALESCE($7, contact_phone),\n        location = COALESCE($8, location),\n        county = COALESCE($9, county),\n        address = COALESCE($10, address),\n        device_serial_number = COALESCE($11, device_serial_number),\n        sr_number = COALESCE($12, sr_number),\n        updated_at = NOW()\n      WHERE id = $1\n      RETURNING *\n    `, [lead_id, company_name, trading_name, kra_pin, contact_name, email, phone, location, county, address, device_serial_number || null, sr_number ? parseInt(sr_number) : null])\n\n    if (result.length === 0) {\n      return NextResponse.json({ error: \"Lead not found\" }, { status: 404 })\n    }\n\n    return NextResponse.json(result[0])\n  } catch (error) {\n    console.error(\"Error updating signup request:\", error)\n    return NextResponse.json({ error: \"Failed to save changes\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const leadId = searchParams.get('id')\n\n    if (!leadId) {\n      return NextResponse.json({ error: \"Lead ID is required\" }, { status: 400 })\n    }\n\n    // Move lead back to 'contracting' stage instead of deleting\n    // This allows sales to re-review and move back to onboarding if needed\n    const result = await query(`\n      UPDATE leads \n      SET stage = 'contracting', updated_at = NOW()\n      WHERE id = $1 AND stage = 'onboarding'\n      RETURNING *\n    `, [leadId])\n\n    if (result.length === 0) {\n      return NextResponse.json({ error: \"Lead not found or not in onboarding stage\" }, { status: 404 })\n    }\n\n    return NextResponse.json({ success: true, message: \"Lead moved back to contracting stage\" })\n  } catch (error) {\n    console.error(\"Error removing signup request:\", error)\n    return NextResponse.json({ error: \"Failed to remove from signup requests\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;;;;;;;;;IAqB5B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CAAC,EAAE;IAC7B;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EACJ,OAAO,EACP,YAAY,EACZ,YAAY,EACZ,OAAO,EACP,YAAY,EACZ,KAAK,EACL,KAAK,EACL,QAAQ,EACR,MAAM,EACN,OAAO,EACP,oBAAoB,EACpB,SAAS,EACV,GAAG,MAAM,QAAQ,IAAI;QAEtB,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,4EAA4E;QAC5E,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;;;;;IAiB5B,CAAC,EAAE;YAAC;YAAS;YAAc;YAAc;YAAS;YAAc;YAAO;YAAO;YAAU;YAAQ;YAAS,wBAAwB;YAAM,YAAY,SAAS,aAAa;SAAK;QAE9K,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF;AAEO,eAAe,OAAO,OAAoB;IAC/C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,4DAA4D;QAC5D,uEAAuE;QACvE,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;IAK5B,CAAC,EAAE;YAAC;SAAO;QAEX,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4C,GAAG;gBAAE,QAAQ;YAAI;QACjG;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAuC;IAC5F,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwC,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}