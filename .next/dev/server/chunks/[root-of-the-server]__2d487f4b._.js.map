{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/vendors/route.ts"],"sourcesContent":["import { query } from \"@/lib/db/client\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const vendors = await query(`\n      SELECT \n        v.*,\n        COUNT(DISTINCT b.id) as branch_count,\n        COUNT(DISTINCT t.id) FILTER (WHERE t.status = 'open') as open_tickets,\n        COUNT(DISTINCT i.id) FILTER (WHERE i.status IN ('pending', 'partial', 'overdue', 'draft')) as pending_invoices\n      FROM vendors v\n      LEFT JOIN branches b ON b.vendor_id = v.id\n      LEFT JOIN support_tickets t ON t.vendor_id = v.id\n      LEFT JOIN invoices i ON i.vendor_id = v.id\n      GROUP BY v.id\n      ORDER BY v.name\n    `)\n\n    return NextResponse.json(vendors)\n  } catch (error: any) {\n    console.error(\"[Admin] Error fetching vendors:\", error)\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const { name, email, phone, address, billing_email, subscription_plan } = body\n\n    if (!name || !email) {\n      return NextResponse.json({ error: \"Name and email are required\" }, { status: 400 })\n    }\n\n    const result = await query(\n      `INSERT INTO vendors (name, email, phone, address, billing_email, subscription_plan)\n       VALUES ($1, $2, $3, $4, $5, $6)\n       RETURNING *`,\n      [name, email, phone, address, billing_email || email, subscription_plan || 'basic']\n    )\n\n    return NextResponse.json(result[0])\n  } catch (error: any) {\n    console.error(\"[Admin] Error creating vendor:\", error)\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PUT(request: Request) {\n  try {\n    const body = await request.json()\n    const { id, name, email, phone, address } = body\n\n    if (!id) {\n      return NextResponse.json({ error: \"Vendor ID is required\" }, { status: 400 })\n    }\n\n    const result = await query(\n      `UPDATE vendors \n       SET name = COALESCE($2, name),\n           email = COALESCE($3, email),\n           phone = COALESCE($4, phone),\n           address = COALESCE($5, address),\n           updated_at = NOW()\n       WHERE id = $1\n       RETURNING *`,\n      [id, name, email, phone, address]\n    )\n\n    if (result.length === 0) {\n      return NextResponse.json({ error: \"Vendor not found\" }, { status: 404 })\n    }\n\n    return NextResponse.json(result[0])\n  } catch (error: any) {\n    console.error(\"[Admin] Error updating vendor:\", error)\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;IAY7B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,aAAa,EAAE,iBAAiB,EAAE,GAAG;QAE1E,IAAI,CAAC,QAAQ,CAAC,OAAO;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,SAAS,MAAM,IAAA,8HAAK,EACxB,CAAC;;kBAEW,CAAC,EACb;YAAC;YAAM;YAAO;YAAO;YAAS,iBAAiB;YAAO,qBAAqB;SAAQ;QAGrF,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;IACpC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG;QAE5C,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,MAAM,SAAS,MAAM,IAAA,8HAAK,EACxB,CAAC;;;;;;;kBAOW,CAAC,EACb;YAAC;YAAI;YAAM;YAAO;YAAO;SAAQ;QAGnC,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;IACpC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}