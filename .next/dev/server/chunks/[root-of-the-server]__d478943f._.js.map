{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/mobile/products/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get(\"branch_id\")\n\n    if (!branchId) {\n      return NextResponse.json({ error: \"Branch ID required\" }, { status: 400 })\n    }\n\n    const client = await pool.connect()\n    try {\n      const fuelResult = await client.query(\n        `SELECT \n          fp.id,\n          fp.fuel_type as item_cd,\n          CASE \n            WHEN fp.fuel_type = 'PMS' THEN 'Petrol (Super)'\n            WHEN fp.fuel_type = 'AGO' THEN 'Diesel (AGO)'\n            WHEN fp.fuel_type = 'DPK' THEN 'Kerosene (DPK)'\n            WHEN fp.fuel_type = 'LPG' THEN 'LPG Gas'\n            WHEN fp.fuel_type = 'Petrol' THEN 'Super Petrol'\n            WHEN fp.fuel_type = 'Kerosene' THEN 'Kerosene'\n            WHEN fp.fuel_type = 'Diesel' THEN 'Diesel'\n            ELSE fp.fuel_type\n          END as item_nm,\n          'FUEL' as item_cls_cd,\n          'L' as pkg_unit_cd,\n          'L' as qty_unit_cd,\n          fp.price as unit_price,\n          COALESCE(\n            (SELECT SUM(current_stock) FROM tanks t WHERE t.branch_id = fp.branch_id AND t.fuel_type = fp.fuel_type),\n            0\n          ) as stock_quantity,\n          'active' as status\n        FROM fuel_prices fp\n        WHERE fp.branch_id = $1\n          AND fp.effective_date = (\n            SELECT MAX(fp2.effective_date) \n            FROM fuel_prices fp2 \n            WHERE fp2.branch_id = fp.branch_id \n              AND fp2.fuel_type = fp.fuel_type \n              AND fp2.effective_date <= CURRENT_DATE\n          )\n        ORDER BY fp.fuel_type`,\n        [branchId]\n      )\n\n      const itemsResult = await client.query(\n        `SELECT \n          id, item_cd, item_nm, item_cls_cd, pkg_unit_cd, qty_unit_cd,\n          dflt_prc as unit_price, avail_qty as stock_quantity,\n          CASE WHEN use_yn = 'Y' THEN 'active' ELSE 'inactive' END as status\n         FROM items \n         WHERE branch_id = $1 \n         ORDER BY item_nm ASC`,\n        [branchId]\n      )\n\n      const allProducts = [...(fuelResult.rows || []), ...(itemsResult.rows || [])]\n\n      return NextResponse.json({\n        products: allProducts,\n      })\n    } finally {\n      client.release()\n    }\n  } catch (error) {\n    console.error(\"[Mobile Products API Error]:\", error)\n    return NextResponse.json({ error: \"Failed to fetch products\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,MAAM,SAAS,MAAM,KAAK,OAAO;QACjC,IAAI;YACF,MAAM,aAAa,MAAM,OAAO,KAAK,CACnC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6BA+BoB,CAAC,EACtB;gBAAC;aAAS;YAGZ,MAAM,cAAc,MAAM,OAAO,KAAK,CACpC,CAAC;;;;;;6BAMoB,CAAC,EACtB;gBAAC;aAAS;YAGZ,MAAM,cAAc;mBAAK,WAAW,IAAI,IAAI,EAAE;mBAAO,YAAY,IAAI,IAAI,EAAE;aAAE;YAE7E,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,UAAU;YACZ;QACF,SAAU;YACR,OAAO,OAAO;QAChB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF"}}]
}