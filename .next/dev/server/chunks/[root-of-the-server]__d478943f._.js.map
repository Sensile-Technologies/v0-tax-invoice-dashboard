{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/mobile/products/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get(\"branch_id\")\n\n    if (!branchId) {\n      return NextResponse.json({ error: \"Branch ID required\" }, { status: 400 })\n    }\n\n    const client = await pool.connect()\n    try {\n      const itemsResult = await client.query(\n        `SELECT \n          i.id, \n          i.item_code as item_cd, \n          i.item_name as item_nm, \n          COALESCE(i.class_code, 'ITEM') as item_cls_cd, \n          'L' as pkg_unit_cd, \n          'L' as qty_unit_cd,\n          COALESCE(\n            (SELECT fp.price FROM fuel_prices fp \n             WHERE fp.branch_id = i.branch_id \n             AND LOWER(fp.fuel_type) = LOWER(i.item_name)\n             AND fp.effective_date <= CURRENT_DATE\n             ORDER BY fp.effective_date DESC LIMIT 1),\n            i.sale_price,\n            0\n          ) as unit_price,\n          COALESCE(\n            (SELECT t.current_stock FROM tanks t \n             WHERE t.kra_item_cd = i.item_code \n             AND t.branch_id = i.branch_id \n             AND t.status = 'active' \n             LIMIT 1),\n            0\n          ) as stock_quantity,\n          COALESCE(i.status, 'active') as status\n         FROM items i\n         WHERE i.branch_id = $1 \n         ORDER BY i.item_name ASC`,\n        [branchId]\n      )\n\n      return NextResponse.json({\n        products: itemsResult.rows || [],\n      })\n    } finally {\n      client.release()\n    }\n  } catch (error) {\n    console.error(\"[Mobile Products API Error]:\", error)\n    return NextResponse.json({ error: \"Failed to fetch products\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,MAAM,SAAS,MAAM,KAAK,OAAO;QACjC,IAAI;YACF,MAAM,cAAc,MAAM,OAAO,KAAK,CACpC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;iCA2BwB,CAAC,EAC1B;gBAAC;aAAS;YAGZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,UAAU,YAAY,IAAI,IAAI,EAAE;YAClC;QACF,SAAU;YACR,OAAO,OAAO;QAChB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF"}}]
}