{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/headquarters/stats/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { pool } from '@/lib/db';\n\nexport async function GET() {\n  try {\n    const today = new Date();\n    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);\n    const startOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);\n    const endOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 0);\n\n    const [\n      revenueResult,\n      lastMonthRevenueResult,\n      transactionsResult,\n      employeesResult,\n      inventoryResult,\n      lastMonthInventoryResult,\n      branchStatsResult,\n      monthlyRevenueResult\n    ] = await Promise.all([\n      pool.query(`\n        SELECT COALESCE(SUM(total_amount), 0) as total_revenue\n        FROM sales\n        WHERE created_at >= $1\n      `, [startOfMonth]),\n      \n      pool.query(`\n        SELECT COALESCE(SUM(total_amount), 0) as total_revenue\n        FROM sales\n        WHERE created_at >= $1 AND created_at <= $2\n      `, [startOfLastMonth, endOfLastMonth]),\n      \n      pool.query(`\n        SELECT COUNT(*) as total_transactions\n        FROM sales\n        WHERE created_at >= $1\n      `, [startOfMonth]),\n      \n      pool.query(`\n        SELECT COUNT(*) as total_employees\n        FROM users\n      `),\n      \n      pool.query(`\n        SELECT COALESCE(SUM(current_stock), 0) as total_inventory\n        FROM tanks\n        WHERE status = 'active' OR status IS NULL\n      `),\n      \n      pool.query(`\n        SELECT COALESCE(SUM(current_stock), 0) as last_inventory\n        FROM tanks\n        WHERE status = 'active' OR status IS NULL\n      `),\n      \n      pool.query(`\n        SELECT \n          b.id,\n          b.name,\n          COALESCE(SUM(CASE WHEN s.created_at >= $1 THEN s.total_amount ELSE 0 END), 0) as mtd_sales,\n          0 as mtd_purchases\n        FROM branches b\n        LEFT JOIN sales s ON s.branch_id = b.id\n        WHERE b.status = 'active' OR b.status IS NULL\n        GROUP BY b.id, b.name\n        ORDER BY b.name\n      `, [startOfMonth]),\n      \n      pool.query(`\n        SELECT \n          TO_CHAR(DATE_TRUNC('month', created_at), 'Mon') as month,\n          COALESCE(SUM(total_amount), 0) as revenue\n        FROM sales\n        WHERE created_at >= NOW() - INTERVAL '6 months'\n        GROUP BY DATE_TRUNC('month', created_at)\n        ORDER BY DATE_TRUNC('month', created_at)\n      `)\n    ]);\n\n    const currentRevenue = parseFloat(revenueResult.rows[0]?.total_revenue || 0);\n    const lastMonthRevenue = parseFloat(lastMonthRevenueResult.rows[0]?.total_revenue || 0);\n    const revenueGrowth = lastMonthRevenue > 0 \n      ? ((currentRevenue - lastMonthRevenue) / lastMonthRevenue * 100).toFixed(1)\n      : '0';\n\n    const currentInventory = parseFloat(inventoryResult.rows[0]?.total_inventory || 0);\n    const lastInventory = parseFloat(lastMonthInventoryResult.rows[0]?.last_inventory || 0);\n    const inventoryGrowth = lastInventory > 0\n      ? ((currentInventory - lastInventory) / lastInventory * 100).toFixed(1)\n      : '0';\n\n    const branchPerformance = branchStatsResult.rows.map((row: any) => ({\n      branch: row.name,\n      sales: parseFloat(row.mtd_sales) / 1000,\n      purchases: parseFloat(row.mtd_purchases) / 1000\n    }));\n\n    const monthlyRevenue = monthlyRevenueResult.rows.map((row: any) => ({\n      month: row.month,\n      revenue: parseFloat(row.revenue)\n    }));\n\n    return NextResponse.json({\n      totalRevenue: currentRevenue,\n      revenueGrowth: parseFloat(revenueGrowth),\n      totalTransactions: parseInt(transactionsResult.rows[0]?.total_transactions || 0),\n      totalEmployees: parseInt(employeesResult.rows[0]?.total_employees || 0),\n      totalInventory: Math.round(currentInventory),\n      inventoryGrowth: parseFloat(inventoryGrowth),\n      branchPerformance,\n      monthlyRevenue\n    });\n  } catch (error: any) {\n    console.error('[HQ Stats] Error:', error);\n    return NextResponse.json(\n      { error: error.message || 'Failed to fetch stats' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,IAAI;QAClB,MAAM,eAAe,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,IAAI;QACrE,MAAM,mBAAmB,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,KAAK,GAAG;QAC7E,MAAM,iBAAiB,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,IAAI;QAEvE,MAAM,CACJ,eACA,wBACA,oBACA,iBACA,iBACA,0BACA,mBACA,qBACD,GAAG,MAAM,QAAQ,GAAG,CAAC;YACpB,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;MAIZ,CAAC,EAAE;gBAAC;aAAa;YAEjB,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;MAIZ,CAAC,EAAE;gBAAC;gBAAkB;aAAe;YAErC,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;MAIZ,CAAC,EAAE;gBAAC;aAAa;YAEjB,6HAAI,CAAC,KAAK,CAAC,CAAC;;;MAGZ,CAAC;YAED,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;MAIZ,CAAC;YAED,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;MAIZ,CAAC;YAED,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;;;;MAWZ,CAAC,EAAE;gBAAC;aAAa;YAEjB,6HAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;;MAQZ,CAAC;SACF;QAED,MAAM,iBAAiB,WAAW,cAAc,IAAI,CAAC,EAAE,EAAE,iBAAiB;QAC1E,MAAM,mBAAmB,WAAW,uBAAuB,IAAI,CAAC,EAAE,EAAE,iBAAiB;QACrF,MAAM,gBAAgB,mBAAmB,IACrC,CAAC,CAAC,iBAAiB,gBAAgB,IAAI,mBAAmB,GAAG,EAAE,OAAO,CAAC,KACvE;QAEJ,MAAM,mBAAmB,WAAW,gBAAgB,IAAI,CAAC,EAAE,EAAE,mBAAmB;QAChF,MAAM,gBAAgB,WAAW,yBAAyB,IAAI,CAAC,EAAE,EAAE,kBAAkB;QACrF,MAAM,kBAAkB,gBAAgB,IACpC,CAAC,CAAC,mBAAmB,aAAa,IAAI,gBAAgB,GAAG,EAAE,OAAO,CAAC,KACnE;QAEJ,MAAM,oBAAoB,kBAAkB,IAAI,CAAC,GAAG,CAAC,CAAC,MAAa,CAAC;gBAClE,QAAQ,IAAI,IAAI;gBAChB,OAAO,WAAW,IAAI,SAAS,IAAI;gBACnC,WAAW,WAAW,IAAI,aAAa,IAAI;YAC7C,CAAC;QAED,MAAM,iBAAiB,qBAAqB,IAAI,CAAC,GAAG,CAAC,CAAC,MAAa,CAAC;gBAClE,OAAO,IAAI,KAAK;gBAChB,SAAS,WAAW,IAAI,OAAO;YACjC,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,cAAc;YACd,eAAe,WAAW;YAC1B,mBAAmB,SAAS,mBAAmB,IAAI,CAAC,EAAE,EAAE,sBAAsB;YAC9E,gBAAgB,SAAS,gBAAgB,IAAI,CAAC,EAAE,EAAE,mBAAmB;YACrE,gBAAgB,KAAK,KAAK,CAAC;YAC3B,iBAAiB,WAAW;YAC5B;YACA;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}