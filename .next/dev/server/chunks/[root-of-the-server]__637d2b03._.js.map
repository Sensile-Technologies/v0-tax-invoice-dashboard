{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/leads/upload-contract/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\nimport { writeFile, mkdir } from \"fs/promises\"\nimport path from \"path\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData()\n    const file = formData.get(\"contract\") as File | null\n    const leadId = formData.get(\"leadId\") as string | null\n\n    console.log(\"[Upload Contract] Received request for leadId:\", leadId, \"file:\", file?.name)\n\n    if (!file || !(file instanceof File)) {\n      console.log(\"[Upload Contract] No contract file provided\")\n      return NextResponse.json({ error: \"No contract file provided\" }, { status: 400 })\n    }\n\n    if (!leadId) {\n      console.log(\"[Upload Contract] No lead ID provided\")\n      return NextResponse.json({ error: \"Lead ID is required\" }, { status: 400 })\n    }\n\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n\n    const timestamp = Date.now()\n    const sanitizedFileName = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\")\n    const fileName = `${leadId}_${timestamp}_${sanitizedFileName}`\n    const uploadDir = path.join(process.cwd(), \"public\", \"uploads\", \"contracts\")\n    const filePath = path.join(uploadDir, fileName)\n\n    await mkdir(uploadDir, { recursive: true })\n\n    await writeFile(filePath, buffer)\n    console.log(\"[Upload Contract] File saved to:\", filePath)\n\n    const contractUrl = `/uploads/contracts/${fileName}`\n\n    const result = await query(`\n      UPDATE leads \n      SET contract_url = $1, stage = 'onboarding', updated_at = NOW()\n      WHERE id = $2\n      RETURNING *\n    `, [contractUrl, leadId])\n\n    if (result.length === 0) {\n      console.log(\"[Upload Contract] Lead not found:\", leadId)\n      return NextResponse.json({ error: \"Lead not found\" }, { status: 404 })\n    }\n\n    console.log(\"[Upload Contract] Contract uploaded successfully for lead:\", leadId)\n    return NextResponse.json({ \n      success: true, \n      contract_url: contractUrl,\n      lead: result[0]\n    })\n  } catch (error: any) {\n    console.error(\"[Upload Contract] Error uploading contract:\", error.message, error.stack)\n    return NextResponse.json({ error: \"Failed to upload contract: \" + error.message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;;;;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,SAAS,SAAS,GAAG,CAAC;QAE5B,QAAQ,GAAG,CAAC,kDAAkD,QAAQ,SAAS,MAAM;QAErF,IAAI,CAAC,QAAQ,CAAC,CAAC,gBAAgB,IAAI,GAAG;YACpC,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,IAAI,CAAC,QAAQ;YACX,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,oBAAoB,KAAK,IAAI,CAAC,OAAO,CAAC,mBAAmB;QAC/D,MAAM,WAAW,GAAG,OAAO,CAAC,EAAE,UAAU,CAAC,EAAE,mBAAmB;QAC9D,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,WAAW;QAChE,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,WAAW;QAEtC,MAAM,IAAA,8HAAK,EAAC,WAAW;YAAE,WAAW;QAAK;QAEzC,MAAM,IAAA,kIAAS,EAAC,UAAU;QAC1B,QAAQ,GAAG,CAAC,oCAAoC;QAEhD,MAAM,cAAc,CAAC,mBAAmB,EAAE,UAAU;QAEpD,MAAM,SAAS,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;IAK5B,CAAC,EAAE;YAAC;YAAa;SAAO;QAExB,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,QAAQ,GAAG,CAAC,qCAAqC;YACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,QAAQ,GAAG,CAAC,8DAA8D;QAC1E,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,cAAc;YACd,MAAM,MAAM,CAAC,EAAE;QACjB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+CAA+C,MAAM,OAAO,EAAE,MAAM,KAAK;QACvF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,gCAAgC,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnG;AACF"}}]
}