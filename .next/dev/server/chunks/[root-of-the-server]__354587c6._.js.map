{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,OAAO,MAAM,KAAK,OAAO;AAC3B"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/theme/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query, queryOne } from \"@/lib/db\"\nimport { cookies } from \"next/headers\"\n\nasync function getSessionVendorId(): Promise<string | null> {\n  try {\n    const cookieStore = await cookies()\n    const sessionCookie = cookieStore.get('user_session')\n    \n    if (!sessionCookie?.value) return null\n    \n    const sessionData = JSON.parse(sessionCookie.value)\n    if (!sessionData.id) return null\n    \n    const user = await queryOne<{ vendor_id: string }>(\n      `SELECT COALESCE(v.id, b.vendor_id) as vendor_id\n       FROM users u \n       LEFT JOIN vendors v ON v.email = u.email \n       LEFT JOIN staff s ON s.user_id = u.id\n       LEFT JOIN branches b ON b.id = s.branch_id\n       WHERE u.id = $1`,\n      [sessionData.id]\n    )\n    \n    return user?.vendor_id || null\n  } catch {\n    return null\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const domain = searchParams.get('domain')\n    \n    let vendor = null\n\n    const sessionVendorId = await getSessionVendorId()\n    if (sessionVendorId) {\n      const vendors = await query(\n        `SELECT id, name, display_name, logo_url, primary_color, secondary_color, custom_domain\n         FROM vendors \n         WHERE id = $1 AND status = 'active'\n         LIMIT 1`,\n        [sessionVendorId]\n      )\n      if (vendors.length > 0) {\n        vendor = vendors[0]\n      }\n    }\n\n    if (!vendor && domain) {\n      const cleanDomain = domain.replace(/^https?:\\/\\//, '').split(':')[0]\n      const vendors = await query(\n        `SELECT id, name, display_name, logo_url, primary_color, secondary_color, custom_domain\n         FROM vendors \n         WHERE custom_domain = $1 AND status = 'active'\n         LIMIT 1`,\n        [cleanDomain]\n      )\n      if (vendors.length > 0) {\n        vendor = vendors[0]\n      }\n    }\n\n    if (!vendor) {\n      return NextResponse.json({ \n        vendor: null,\n        theme: getDefaultTheme()\n      })\n    }\n    \n    return NextResponse.json({\n      vendor: {\n        id: vendor.id,\n        name: vendor.display_name || vendor.name,\n      },\n      theme: {\n        logoUrl: vendor.logo_url || '/flow360-logo.png',\n        primaryColor: vendor.primary_color || '#3b82f6',\n        secondaryColor: vendor.secondary_color || '#1e40af',\n        companyName: vendor.display_name || vendor.name || 'Flow360',\n      }\n    }, {\n      headers: {\n        'Cache-Control': 'no-store, no-cache, must-revalidate',\n        'Pragma': 'no-cache',\n      }\n    })\n  } catch (error) {\n    console.error(\"Error fetching theme:\", error)\n    return NextResponse.json({ \n      vendor: null,\n      theme: getDefaultTheme()\n    })\n  }\n}\n\nfunction getDefaultTheme() {\n  return {\n    logoUrl: '/flow360-logo.png',\n    primaryColor: '#3b82f6',\n    secondaryColor: '#1e40af',\n    companyName: 'Flow360',\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;;;;;;;;;AAEA,eAAe;IACb,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,MAAM,gBAAgB,YAAY,GAAG,CAAC;QAEtC,IAAI,CAAC,eAAe,OAAO,OAAO;QAElC,MAAM,cAAc,KAAK,KAAK,CAAC,cAAc,KAAK;QAClD,IAAI,CAAC,YAAY,EAAE,EAAE,OAAO;QAE5B,MAAM,OAAO,MAAM,IAAA,iIAAQ,EACzB,CAAC;;;;;sBAKe,CAAC,EACjB;YAAC,YAAY,EAAE;SAAC;QAGlB,OAAO,MAAM,aAAa;IAC5B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,SAAS;QAEb,MAAM,kBAAkB,MAAM;QAC9B,IAAI,iBAAiB;YACnB,MAAM,UAAU,MAAM,IAAA,8HAAK,EACzB,CAAC;;;gBAGO,CAAC,EACT;gBAAC;aAAgB;YAEnB,IAAI,QAAQ,MAAM,GAAG,GAAG;gBACtB,SAAS,OAAO,CAAC,EAAE;YACrB;QACF;QAEA,IAAI,CAAC,UAAU,QAAQ;YACrB,MAAM,cAAc,OAAO,OAAO,CAAC,gBAAgB,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;YACpE,MAAM,UAAU,MAAM,IAAA,8HAAK,EACzB,CAAC;;;gBAGO,CAAC,EACT;gBAAC;aAAY;YAEf,IAAI,QAAQ,MAAM,GAAG,GAAG;gBACtB,SAAS,OAAO,CAAC,EAAE;YACrB;QACF;QAEA,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,QAAQ;gBACR,OAAO;YACT;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;gBACN,IAAI,OAAO,EAAE;gBACb,MAAM,OAAO,YAAY,IAAI,OAAO,IAAI;YAC1C;YACA,OAAO;gBACL,SAAS,OAAO,QAAQ,IAAI;gBAC5B,cAAc,OAAO,aAAa,IAAI;gBACtC,gBAAgB,OAAO,eAAe,IAAI;gBAC1C,aAAa,OAAO,YAAY,IAAI,OAAO,IAAI,IAAI;YACrD;QACF,GAAG;YACD,SAAS;gBACP,iBAAiB;gBACjB,UAAU;YACZ;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;YACR,OAAO;QACT;IACF;AACF;AAEA,SAAS;IACP,OAAO;QACL,SAAS;QACT,cAAc;QACd,gBAAgB;QAChB,aAAa;IACf;AACF"}}]
}