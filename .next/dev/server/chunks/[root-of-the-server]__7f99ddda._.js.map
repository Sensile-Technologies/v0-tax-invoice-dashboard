{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/fuel-prices/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { Pool } from \"pg\"\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n})\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get('branch_id')\n\n    if (!branchId) {\n      return NextResponse.json({ success: true, data: [] })\n    }\n\n    // Get fuel prices from branch_items (single source of truth)\n    const branchItemsResult = await pool.query(\n      `SELECT DISTINCT ON (\n         CASE \n           WHEN UPPER(i.item_name) LIKE '%DIESEL%' THEN 'Diesel'\n           WHEN UPPER(i.item_name) LIKE '%PETROL%' OR UPPER(i.item_name) LIKE '%SUPER%' THEN 'Petrol'\n           WHEN UPPER(i.item_name) LIKE '%KEROSENE%' THEN 'Kerosene'\n           ELSE i.item_name\n         END\n       )\n         CASE \n           WHEN UPPER(i.item_name) LIKE '%DIESEL%' THEN 'Diesel'\n           WHEN UPPER(i.item_name) LIKE '%PETROL%' OR UPPER(i.item_name) LIKE '%SUPER%' THEN 'Petrol'\n           WHEN UPPER(i.item_name) LIKE '%KEROSENE%' THEN 'Kerosene'\n           ELSE i.item_name\n         END as fuel_type,\n         bi.sale_price as price,\n         bi.updated_at as effective_date,\n         $1::uuid as branch_id\n       FROM branch_items bi\n       JOIN items i ON bi.item_id = i.id\n       WHERE bi.branch_id = $1\n         AND bi.is_available = true\n         AND bi.sale_price IS NOT NULL\n         AND bi.sale_price > 0\n         AND (UPPER(i.item_name) IN ('PETROL', 'DIESEL', 'KEROSENE', 'SUPER PETROL', 'V-POWER') \n              OR i.item_name ILIKE '%petrol%' \n              OR i.item_name ILIKE '%diesel%'\n              OR i.item_name ILIKE '%kerosene%')\n       ORDER BY \n         CASE \n           WHEN UPPER(i.item_name) LIKE '%DIESEL%' THEN 'Diesel'\n           WHEN UPPER(i.item_name) LIKE '%PETROL%' OR UPPER(i.item_name) LIKE '%SUPER%' THEN 'Petrol'\n           WHEN UPPER(i.item_name) LIKE '%KEROSENE%' THEN 'Kerosene'\n           ELSE i.item_name\n         END,\n         bi.updated_at DESC NULLS LAST`,\n      [branchId]\n    )\n\n    return NextResponse.json({\n      success: true,\n      data: branchItemsResult.rows\n    })\n\n  } catch (error: any) {\n    console.error(\"Error fetching fuel prices:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch fuel prices\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM,MAAM,EAAE;YAAC;QACrD;QAEA,6DAA6D;QAC7D,MAAM,oBAAoB,MAAM,KAAK,KAAK,CACxC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sCAkC+B,CAAC,EACjC;YAAC;SAAS;QAGZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,kBAAkB,IAAI;QAC9B;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA+B,SAAS,MAAM,OAAO;QAAC,GAC/D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}