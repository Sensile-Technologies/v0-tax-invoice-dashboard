{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,OAAO,MAAM,KAAK,OAAO;AAC3B"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/vendor/settings/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query, queryOne } from \"@/lib/db\"\nimport { cookies } from \"next/headers\"\n\nasync function getSessionUser() {\n  const cookieStore = await cookies()\n  const sessionCookie = cookieStore.get('user_session')\n  \n  if (!sessionCookie?.value) {\n    return null\n  }\n  \n  try {\n    const sessionData = JSON.parse(sessionCookie.value)\n    if (!sessionData.id) return null\n    \n    const users = await query(\n      `SELECT u.id, u.email, u.username, \n       COALESCE(s.role, u.role) as role,\n       COALESCE(v.id, b.vendor_id) as vendor_id\n       FROM users u \n       LEFT JOIN vendors v ON v.email = u.email \n       LEFT JOIN staff s ON s.user_id = u.id\n       LEFT JOIN branches b ON b.id = s.branch_id\n       WHERE u.id = $1`,\n      [sessionData.id]\n    )\n    \n    return users[0] || null\n  } catch {\n    return null\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getSessionUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n    \n    const role = (user.role || '').toLowerCase()\n    if (!['vendor', 'director'].includes(role)) {\n      return NextResponse.json({ error: \"Access denied\" }, { status: 403 })\n    }\n    \n    if (!user.vendor_id) {\n      return NextResponse.json({ error: \"No vendor associated with user\" }, { status: 400 })\n    }\n    \n    const vendor = await queryOne(\n      `SELECT id, name, display_name, logo_url, primary_color, custom_domain\n       FROM vendors \n       WHERE id = $1`,\n      [user.vendor_id]\n    )\n    \n    if (!vendor) {\n      return NextResponse.json({ error: \"Vendor not found\" }, { status: 404 })\n    }\n    \n    return NextResponse.json({ vendor })\n  } catch (error) {\n    console.error(\"Error fetching vendor settings:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const user = await getSessionUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n    \n    const role = (user.role || '').toLowerCase()\n    if (!['vendor', 'director'].includes(role)) {\n      return NextResponse.json({ error: \"Access denied\" }, { status: 403 })\n    }\n    \n    if (!user.vendor_id) {\n      return NextResponse.json({ error: \"No vendor associated with user\" }, { status: 400 })\n    }\n    \n    const body = await request.json()\n    const { display_name, logo_url, primary_color, custom_domain } = body\n    \n    if (custom_domain) {\n      const cleanDomain = custom_domain.replace(/^https?:\\/\\//, '').split(':')[0].toLowerCase()\n      \n      const existingVendor = await queryOne(\n        `SELECT id FROM vendors WHERE custom_domain = $1 AND id != $2`,\n        [cleanDomain, user.vendor_id]\n      )\n      \n      if (existingVendor) {\n        return NextResponse.json({ error: \"This domain is already in use by another vendor\" }, { status: 400 })\n      }\n    }\n    \n    await query(\n      `UPDATE vendors \n       SET display_name = $1,\n           logo_url = $2,\n           primary_color = $3,\n           custom_domain = $4,\n           updated_at = NOW()\n       WHERE id = $5`,\n      [\n        display_name || null,\n        logo_url || null,\n        primary_color || '#3b82f6',\n        custom_domain ? custom_domain.replace(/^https?:\\/\\//, '').split(':')[0].toLowerCase() : null,\n        user.vendor_id\n      ]\n    )\n    \n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Error updating vendor settings:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}