{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/kra-stock-service.ts"],"sourcesContent":["import { query } from \"@/lib/db\"\n\nconst KRA_BASE_URL = \"http://20.224.40.56:8088\"\nconst STOCK_ENDPOINT = \"/stock/saveStockItems\"\n\nexport interface StockItem {\n  itemSeq: number\n  itemCd: string\n  itemClsCd: string\n  itemNm: string\n  bcd: string | null\n  pkgUnitCd: string\n  pkg: number\n  qtyUnitCd: string\n  qty: number\n  itemExprDt: string | null\n  prc: number\n  splyAmt: number\n  totDcAmt: number\n  taxblAmt: number\n  taxTyCd: string\n  taxAmt: number\n  totAmt: number\n}\n\nexport interface StockPayload {\n  tin: string\n  bhfId: string\n  sarNo: number\n  orgSarNo: number\n  regTyCd: string\n  custTin: string | null\n  custNm: string | null\n  custBhfId: string | null\n  sarTyCd: string\n  ocrnDt: string\n  totItemCnt: number\n  totTaxblAmt: number\n  totTaxAmt: number\n  totAmt: number\n  remark: string | null\n  regrId: string\n  regrNm: string\n  modrNm: string\n  modrId: string\n  itemList: StockItem[]\n}\n\nexport type StockMovementType = \n  | \"initial_stock\"      // Tank created with initial stock\n  | \"stock_receive\"      // Stock received into tank\n  | \"stock_adjustment\"   // Manual adjustment (gain/loss)\n  | \"stock_transfer\"     // Transfer between tanks\n  | \"sale\"               // Sale deducting from stock\n\nexport const SAR_TYPE_CODES = {\n  initial_stock: \"01\",      // Opening/Initial Stock\n  stock_receive: \"02\",      // Stock Received/Purchase\n  stock_adjustment: \"06\",   // Stock Adjustment\n  stock_transfer: \"05\",     // Stock Transfer\n  sale: \"11\"                // Sale\n}\n\nexport async function getNextSarNo(branchId: string, endpoint: string = STOCK_ENDPOINT): Promise<number> {\n  const result = await query(`\n    UPDATE branches \n    SET sr_number = COALESCE(sr_number, 0) + 1,\n        updated_at = NOW()\n    WHERE id = $1\n    RETURNING sr_number\n  `, [branchId])\n  \n  if (result.length === 0) {\n    throw new Error(`Branch ${branchId} not found`)\n  }\n  \n  return result[0].sr_number\n}\n\nexport async function getBranchKraInfo(branchId: string): Promise<{ tin: string, bhfId: string } | null> {\n  const result = await query(`\n    SELECT b.kra_pin as tin, b.bhf_id \n    FROM branches b \n    WHERE b.id = $1\n  `, [branchId])\n  \n  if (result.length === 0) return null\n  \n  const branch = result[0]\n  if (!branch.tin) {\n    const vendorResult = await query(`\n      SELECT v.kra_pin as tin \n      FROM branches b \n      JOIN vendors v ON v.id = b.vendor_id \n      WHERE b.id = $1\n    `, [branchId])\n    \n    if (vendorResult.length > 0 && vendorResult[0].tin) {\n      return { tin: vendorResult[0].tin, bhfId: branch.bhf_id || \"00\" }\n    }\n    return null\n  }\n  \n  return { tin: branch.tin, bhfId: branch.bhf_id || \"00\" }\n}\n\nexport async function getTankWithItemInfo(tankId: string): Promise<any> {\n  const result = await query(`\n    SELECT t.*, i.item_code, i.class_code, i.item_name, i.package_unit, \n           i.quantity_unit, i.tax_type, i.sale_price, i.purchase_price,\n           fp.price as current_price\n    FROM tanks t\n    LEFT JOIN items i ON i.item_name ILIKE '%' || t.fuel_type || '%' AND i.branch_id = t.branch_id\n    LEFT JOIN fuel_prices fp ON fp.branch_id = t.branch_id AND fp.fuel_type = t.fuel_type\n    WHERE t.id = $1\n  `, [tankId])\n  \n  return result.length > 0 ? result[0] : null\n}\n\nexport function formatKraDate(date: Date = new Date()): string {\n  const year = date.getFullYear()\n  const month = String(date.getMonth() + 1).padStart(2, '0')\n  const day = String(date.getDate()).padStart(2, '0')\n  return `${year}${month}${day}`\n}\n\nexport function calculateTaxAmount(taxableAmount: number, taxType: string = \"B\"): number {\n  if (taxType === \"B\") {\n    return Math.round(taxableAmount * 0.16 * 100) / 100\n  }\n  return 0\n}\n\nexport async function createStockMovementRecord(\n  branchId: string,\n  kraPayload: StockPayload,\n  kraResponse: any,\n  httpStatus: number,\n  durationMs: number\n): Promise<string> {\n  const isSuccess = kraResponse?.resultCd === \"000\" || kraResponse?.resultCd === \"0\"\n  \n  const result = await query(`\n    INSERT INTO stock_movements (\n      branch_id, tin, bhf_id, sar_no, org_sar_no, reg_ty_cd, \n      cust_tin, cust_bhf_id, cust_nm, sar_ty_cd, ocrn_dt,\n      tot_item_cnt, tot_taxbl_amt, tot_tax_amt, tot_amt, remark,\n      regr_id, regr_nm, modr_id, modr_nm,\n      kra_status, kra_response, kra_synced_at\n    ) VALUES (\n      $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11,\n      $12, $13, $14, $15, $16, $17, $18, $19, $20,\n      $21, $22, $23\n    ) RETURNING id\n  `, [\n    branchId,\n    kraPayload.tin,\n    kraPayload.bhfId,\n    kraPayload.sarNo,\n    kraPayload.orgSarNo,\n    kraPayload.regTyCd,\n    kraPayload.custTin,\n    kraPayload.custBhfId,\n    kraPayload.custNm,\n    kraPayload.sarTyCd,\n    kraPayload.ocrnDt,\n    kraPayload.totItemCnt,\n    kraPayload.totTaxblAmt,\n    kraPayload.totTaxAmt,\n    kraPayload.totAmt,\n    kraPayload.remark,\n    kraPayload.regrId,\n    kraPayload.regrNm,\n    kraPayload.modrId,\n    kraPayload.modrNm,\n    isSuccess ? \"success\" : \"failed\",\n    JSON.stringify(kraResponse),\n    isSuccess ? new Date() : null\n  ])\n  \n  return result[0].id\n}\n\nexport async function logKraApiCall(\n  endpoint: string,\n  payload: any,\n  response: any,\n  statusCode: number,\n  durationMs: number,\n  branchId: string\n): Promise<void> {\n  try {\n    await query(`\n      INSERT INTO api_logs (endpoint, method, payload, response, status_code, duration_ms, branch_id, user_agent, created_at)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW())\n    `, [\n      endpoint,\n      \"POST\",\n      JSON.stringify(payload),\n      JSON.stringify(response),\n      statusCode,\n      durationMs,\n      branchId,\n      `${KRA_BASE_URL}${endpoint}`\n    ])\n  } catch (error) {\n    console.error(\"[KRA Stock Service] Failed to log API call:\", error)\n  }\n}\n\nexport async function syncStockWithKRA(\n  branchId: string,\n  movementType: StockMovementType,\n  items: Array<{\n    tankId: string\n    quantity: number\n    unitPrice: number\n    itemCode?: string\n    itemClassCode?: string\n    itemName?: string\n  }>,\n  options?: {\n    customerId?: string\n    customerName?: string\n    customerBhfId?: string\n    remark?: string\n  }\n): Promise<{ success: boolean; kraResponse: any; movementId?: string; error?: string }> {\n  const startTime = Date.now()\n  \n  try {\n    const kraInfo = await getBranchKraInfo(branchId)\n    if (!kraInfo) {\n      return { success: false, kraResponse: null, error: \"Branch KRA info not configured (missing KRA PIN)\" }\n    }\n    \n    const sarNo = await getNextSarNo(branchId)\n    const sarTyCd = SAR_TYPE_CODES[movementType] || \"06\"\n    \n    let totTaxblAmt = 0\n    let totTaxAmt = 0\n    let totAmt = 0\n    \n    const itemList: StockItem[] = await Promise.all(items.map(async (item, index) => {\n      let tankInfo = await getTankWithItemInfo(item.tankId)\n      \n      const itemCd = item.itemCode || tankInfo?.item_code || tankInfo?.kra_item_cd || `KE1NTXU000000${index + 1}`\n      const itemClsCd = item.itemClassCode || tankInfo?.class_code || \"5059690800\"\n      const itemNm = item.itemName || tankInfo?.item_name || tankInfo?.fuel_type || \"Fuel Item\"\n      const isPurchaseMovement = movementType === \"stock_receive\"\n      const price = item.unitPrice || (isPurchaseMovement ? tankInfo?.purchase_price : tankInfo?.current_price) || tankInfo?.sale_price || 0\n      \n      const splyAmt = Math.round(item.quantity * price * 100) / 100\n      const taxAmt = calculateTaxAmount(splyAmt, tankInfo?.tax_type || \"B\")\n      \n      totTaxblAmt += splyAmt\n      totTaxAmt += taxAmt\n      totAmt += splyAmt\n      \n      return {\n        itemSeq: index + 1,\n        itemCd,\n        itemClsCd,\n        itemNm,\n        bcd: null,\n        pkgUnitCd: tankInfo?.package_unit || \"NT\",\n        pkg: Math.ceil(item.quantity),\n        qtyUnitCd: tankInfo?.quantity_unit || \"U\",\n        qty: item.quantity,\n        itemExprDt: null,\n        prc: price,\n        splyAmt,\n        totDcAmt: 0,\n        taxblAmt: splyAmt,\n        taxTyCd: tankInfo?.tax_type || \"B\",\n        taxAmt,\n        totAmt: splyAmt\n      }\n    }))\n    \n    const payload: StockPayload = {\n      tin: kraInfo.tin,\n      bhfId: kraInfo.bhfId,\n      sarNo,\n      orgSarNo: 0,\n      regTyCd: \"M\",\n      custTin: options?.customerId || null,\n      custNm: options?.customerName || null,\n      custBhfId: options?.customerBhfId || null,\n      sarTyCd,\n      ocrnDt: formatKraDate(),\n      totItemCnt: itemList.length,\n      totTaxblAmt: Math.round(totTaxblAmt * 100) / 100,\n      totTaxAmt: Math.round(totTaxAmt * 100) / 100,\n      totAmt: Math.round(totAmt * 100) / 100,\n      remark: options?.remark || null,\n      regrId: \"Admin\",\n      regrNm: \"Admin\",\n      modrNm: \"Admin\",\n      modrId: \"Admin\",\n      itemList\n    }\n    \n    console.log(`[KRA Stock Service] Syncing ${movementType} to KRA for branch ${branchId}`)\n    console.log(`[KRA Stock Service] Payload:`, JSON.stringify(payload, null, 2))\n    \n    let kraResponse: any\n    let httpStatusCode = 200\n    \n    try {\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => controller.abort(), 15000)\n      \n      const response = await fetch(`${KRA_BASE_URL}${STOCK_ENDPOINT}`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n        signal: controller.signal\n      })\n      \n      clearTimeout(timeoutId)\n      httpStatusCode = response.status\n      kraResponse = await response.json()\n    } catch (fetchError: any) {\n      if (fetchError.name === 'AbortError') {\n        kraResponse = {\n          resultCd: \"TIMEOUT\",\n          resultMsg: \"Request timed out after 15 seconds\",\n          resultDt: new Date().toISOString()\n        }\n      } else {\n        kraResponse = {\n          resultCd: \"NETWORK_ERROR\",\n          resultMsg: `Network error: ${fetchError.message}`,\n          resultDt: new Date().toISOString()\n        }\n      }\n      httpStatusCode = 0\n    }\n    \n    const duration = Date.now() - startTime\n    console.log(`[KRA Stock Service] Response (${duration}ms):`, JSON.stringify(kraResponse, null, 2))\n    \n    await logKraApiCall(STOCK_ENDPOINT, payload, kraResponse, httpStatusCode, duration, branchId)\n    \n    const movementId = await createStockMovementRecord(branchId, payload, kraResponse, httpStatusCode, duration)\n    \n    const isSuccess = kraResponse?.resultCd === \"000\" || kraResponse?.resultCd === \"0\"\n    \n    if (isSuccess) {\n      console.log(`[KRA Stock Service] saveStockItems successful, now calling saveStockMaster for each item`)\n      \n      for (const item of items) {\n        const stockMasterStartTime = Date.now()\n        let stockMasterResponse: any = null\n        let stockMasterStatusCode = 0\n        \n        try {\n          const tankInfo = await getTankWithItemInfo(item.tankId)\n          const tankResult = await query(`SELECT current_stock FROM tanks WHERE id = $1`, [item.tankId])\n          const currentStock = tankResult.length > 0 ? parseFloat(tankResult[0].current_stock) || 0 : 0\n          \n          const itemCd = item.itemCode || tankInfo?.item_code || tankInfo?.kra_item_cd\n          \n          if (!itemCd) {\n            console.log(`[KRA Stock Service] Skipping saveStockMaster for tank ${item.tankId} - no item code`)\n            continue\n          }\n          \n          const stockMasterPayload = {\n            tin: kraInfo.tin,\n            bhfId: kraInfo.bhfId,\n            itemCd: itemCd,\n            rsdQty: currentStock,\n            regrId: \"Admin\",\n            regrNm: \"Admin\",\n            modrNm: \"Admin\",\n            modrId: \"Admin\"\n          }\n          \n          console.log(`[KRA Stock Service] Calling saveStockMaster:`, JSON.stringify(stockMasterPayload, null, 2))\n          \n          try {\n            const stockMasterController = new AbortController()\n            const stockMasterTimeoutId = setTimeout(() => stockMasterController.abort(), 15000)\n            \n            const response = await fetch(`${KRA_BASE_URL}/stockMaster/saveStockMaster`, {\n              method: \"POST\",\n              headers: { \"Content-Type\": \"application/json\" },\n              body: JSON.stringify(stockMasterPayload),\n              signal: stockMasterController.signal\n            })\n            \n            clearTimeout(stockMasterTimeoutId)\n            stockMasterStatusCode = response.status\n            stockMasterResponse = await response.json()\n          } catch (fetchError: any) {\n            if (fetchError.name === 'AbortError') {\n              stockMasterResponse = {\n                resultCd: \"TIMEOUT\",\n                resultMsg: \"Request timed out after 15 seconds\",\n                resultDt: new Date().toISOString()\n              }\n            } else {\n              stockMasterResponse = {\n                resultCd: \"NETWORK_ERROR\",\n                resultMsg: `Network error: ${fetchError.message}`,\n                resultDt: new Date().toISOString()\n              }\n            }\n          }\n          \n          console.log(`[KRA Stock Service] saveStockMaster response for ${itemCd}:`, JSON.stringify(stockMasterResponse, null, 2))\n          \n          await logKraApiCall(\"/stockMaster/saveStockMaster\", stockMasterPayload, stockMasterResponse, stockMasterStatusCode, Date.now() - stockMasterStartTime, branchId)\n          \n        } catch (stockMasterError: any) {\n          console.error(`[KRA Stock Service] Error calling saveStockMaster for tank ${item.tankId}:`, stockMasterError.message)\n        }\n      }\n    }\n    \n    return {\n      success: isSuccess,\n      kraResponse,\n      movementId,\n      error: isSuccess ? undefined : kraResponse?.resultMsg || \"KRA sync failed\"\n    }\n    \n  } catch (error: any) {\n    console.error(\"[KRA Stock Service] Error:\", error)\n    return {\n      success: false,\n      kraResponse: null,\n      error: error.message || \"Internal error during KRA sync\"\n    }\n  }\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 487, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/tanks/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\nimport { syncStockWithKRA } from \"@/lib/kra-stock-service\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const branchId = searchParams.get(\"branch_id\")\n\n    if (!branchId) {\n      return NextResponse.json({ success: false, error: \"branch_id is required\" }, { status: 400 })\n    }\n\n    const tanks = await query(\n      `SELECT t.*, i.item_name \n       FROM tanks t \n       LEFT JOIN items i ON t.item_id = i.id \n       WHERE t.branch_id = $1 \n       ORDER BY t.tank_name`,\n      [branchId]\n    )\n\n    return NextResponse.json({ success: true, data: tanks })\n  } catch (error) {\n    console.error(\"Error fetching tanks:\", error)\n    return NextResponse.json({ success: false, error: \"Failed to fetch tanks\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { \n      branch_id, \n      tank_name, \n      fuel_type, \n      capacity, \n      current_stock, \n      status,\n      kra_item_cd,\n      sync_to_kra,\n      unit_price,\n      item_id\n    } = body\n\n    if (!branch_id || !tank_name || !fuel_type) {\n      return NextResponse.json({ success: false, error: \"branch_id, tank_name, and fuel_type are required\" }, { status: 400 })\n    }\n\n    const result = await query(\n      `INSERT INTO tanks (branch_id, tank_name, fuel_type, capacity, current_stock, status, kra_item_cd, item_id)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n       RETURNING *`,\n      [branch_id, tank_name, fuel_type, capacity || 0, current_stock || 0, status || \"active\", kra_item_cd || null, item_id || null]\n    )\n\n    const tank = result[0]\n    let kraResult = null\n\n    if (sync_to_kra && current_stock > 0) {\n      console.log(`[Tanks API] Syncing initial stock of ${current_stock} for tank ${tank.id} to KRA`)\n      \n      kraResult = await syncStockWithKRA(\n        branch_id,\n        \"initial_stock\",\n        [{\n          tankId: tank.id,\n          quantity: current_stock,\n          unitPrice: unit_price || 0,\n          itemCode: kra_item_cd,\n          itemName: fuel_type\n        }],\n        { remark: `Initial stock for tank: ${tank_name}` }\n      )\n\n      if (kraResult.success) {\n        await query(\n          `UPDATE tanks SET kra_sync_status = 'synced', last_kra_synced_stock = $1 WHERE id = $2`,\n          [current_stock, tank.id]\n        )\n      } else {\n        await query(\n          `UPDATE tanks SET kra_sync_status = 'failed' WHERE id = $1`,\n          [tank.id]\n        )\n      }\n    }\n\n    return NextResponse.json({ \n      success: true, \n      data: tank,\n      kraSync: kraResult ? {\n        synced: kraResult.success,\n        movementId: kraResult.movementId,\n        error: kraResult.error\n      } : null\n    })\n  } catch (error) {\n    console.error(\"Error creating tank:\", error)\n    return NextResponse.json({ success: false, error: \"Failed to create tank\" }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { id, current_stock, status, sync_to_kra, adjustment_type, unit_price, item_id } = body\n\n    if (!id) {\n      return NextResponse.json({ success: false, error: \"Tank id is required\" }, { status: 400 })\n    }\n\n    const existingTank = await query(\"SELECT * FROM tanks WHERE id = $1\", [id])\n    if (existingTank.length === 0) {\n      return NextResponse.json({ success: false, error: \"Tank not found\" }, { status: 404 })\n    }\n\n    const tank = existingTank[0]\n    const previousStock = tank.current_stock || 0\n\n    const updates: string[] = []\n    const values: any[] = []\n    let paramIndex = 1\n\n    if (current_stock !== undefined) {\n      updates.push(`current_stock = $${paramIndex}`)\n      values.push(current_stock)\n      paramIndex++\n    }\n\n    if (status !== undefined) {\n      updates.push(`status = $${paramIndex}`)\n      values.push(status)\n      paramIndex++\n    }\n\n    if (item_id !== undefined) {\n      updates.push(`item_id = $${paramIndex}`)\n      values.push(item_id || null)\n      paramIndex++\n    }\n\n    if (updates.length === 0) {\n      return NextResponse.json({ success: false, error: \"No fields to update\" }, { status: 400 })\n    }\n\n    updates.push(`updated_at = NOW()`)\n\n    values.push(id)\n    const result = await query(\n      `UPDATE tanks SET ${updates.join(\", \")} WHERE id = $${paramIndex} RETURNING *`,\n      values\n    )\n\n    const updatedTank = result[0]\n    let kraResult = null\n\n    if (sync_to_kra && current_stock !== undefined && current_stock !== previousStock) {\n      const stockDiff = current_stock - previousStock\n      const movementType = adjustment_type || (stockDiff > 0 ? \"stock_receive\" : \"stock_adjustment\")\n      \n      console.log(`[Tanks API] Syncing stock ${movementType} of ${Math.abs(stockDiff)} for tank ${id} to KRA`)\n      \n      kraResult = await syncStockWithKRA(\n        tank.branch_id,\n        movementType,\n        [{\n          tankId: id,\n          quantity: Math.abs(stockDiff),\n          unitPrice: unit_price || 0,\n          itemCode: tank.kra_item_cd,\n          itemName: tank.fuel_type\n        }],\n        { remark: `Stock ${movementType}: ${previousStock} -> ${current_stock}` }\n      )\n\n      if (kraResult.success) {\n        await query(\n          `UPDATE tanks SET kra_sync_status = 'synced', last_kra_synced_stock = $1 WHERE id = $2`,\n          [current_stock, id]\n        )\n      } else {\n        await query(\n          `UPDATE tanks SET kra_sync_status = 'failed' WHERE id = $1`,\n          [id]\n        )\n      }\n\n      await query(\n        `INSERT INTO stock_adjustments (branch_id, tank_id, adjustment_type, quantity, previous_stock, new_stock, reason, approval_status)\n         VALUES ($1, $2, $3, $4, $5, $6, $7, $8)`,\n        [tank.branch_id, id, movementType, Math.abs(stockDiff), previousStock, current_stock, `API adjustment`, 'approved']\n      )\n    }\n\n    return NextResponse.json({ \n      success: true, \n      data: updatedTank,\n      kraSync: kraResult ? {\n        synced: kraResult.success,\n        movementId: kraResult.movementId,\n        error: kraResult.error\n      } : null\n    })\n  } catch (error) {\n    console.error(\"Error updating tank:\", error)\n    return NextResponse.json({ success: false, error: \"Failed to update tank\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const id = searchParams.get(\"id\")\n\n    if (!id) {\n      return NextResponse.json({ success: false, error: \"Tank id is required\" }, { status: 400 })\n    }\n\n    await query(\"DELETE FROM tanks WHERE id = $1\", [id])\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Error deleting tank:\", error)\n    return NextResponse.json({ success: false, error: \"Failed to delete tank\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}