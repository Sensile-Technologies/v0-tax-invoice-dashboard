{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function getClient() {\n  return await pool.connect();\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,OAAO,MAAM,KAAK,OAAO;AAC3B"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/staff/reset-password/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\n\nexport async function POST(request: Request) {\n  try {\n    const { staffId, email } = await request.json()\n\n    if (!staffId && !email) {\n      return NextResponse.json(\n        { error: \"Staff ID or email is required\" },\n        { status: 400 }\n      )\n    }\n\n    const defaultPassword = \"flow360\"\n    const hashedPassword = await bcrypt.hash(defaultPassword, 10)\n\n    // Get the staff member and their user_id\n    let staffResult\n    if (staffId) {\n      staffResult = await query(\n        `SELECT id, user_id, email FROM staff WHERE id = $1`,\n        [staffId]\n      )\n    } else {\n      staffResult = await query(\n        `SELECT id, user_id, email FROM staff WHERE email = $1`,\n        [email]\n      )\n    }\n\n    if (staffResult.length === 0) {\n      return NextResponse.json(\n        { error: \"Staff member not found\" },\n        { status: 404 }\n      )\n    }\n\n    const staff = staffResult[0]\n\n    // Update password in users table and set must_change_password flag\n    if (staff.user_id) {\n      await query(\n        `UPDATE users SET password_hash = $1, must_change_password = true, updated_at = NOW() WHERE id = $2`,\n        [hashedPassword, staff.user_id]\n      )\n    }\n\n    return NextResponse.json({ \n      success: true, \n      message: \"Password reset to default. User must change password on next login.\" \n    })\n  } catch (error: any) {\n    console.error(\"Error resetting password:\", error)\n    return NextResponse.json(\n      { error: \"Failed to reset password\", details: error.message },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;;;;;;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE7C,IAAI,CAAC,WAAW,CAAC,OAAO;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,kBAAkB;QACxB,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,iBAAiB;QAE1D,yCAAyC;QACzC,IAAI;QACJ,IAAI,SAAS;YACX,cAAc,MAAM,IAAA,8HAAK,EACvB,CAAC,kDAAkD,CAAC,EACpD;gBAAC;aAAQ;QAEb,OAAO;YACL,cAAc,MAAM,IAAA,8HAAK,EACvB,CAAC,qDAAqD,CAAC,EACvD;gBAAC;aAAM;QAEX;QAEA,IAAI,YAAY,MAAM,KAAK,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,WAAW,CAAC,EAAE;QAE5B,mEAAmE;QACnE,IAAI,MAAM,OAAO,EAAE;YACjB,MAAM,IAAA,8HAAK,EACT,CAAC,kGAAkG,CAAC,EACpG;gBAAC;gBAAgB,MAAM,OAAO;aAAC;QAEnC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA4B,SAAS,MAAM,OAAO;QAAC,GAC5D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}