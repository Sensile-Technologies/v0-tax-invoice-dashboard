{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/client.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows as T[];\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db/index.ts"],"sourcesContent":["export * from './client';\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/controller-logs/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const limit = parseInt(searchParams.get(\"limit\") || \"100\")\n    const offset = parseInt(searchParams.get(\"offset\") || \"0\")\n    const ptsId = searchParams.get(\"pts_id\")\n    const startDate = searchParams.get(\"start_date\")\n    const endDate = searchParams.get(\"end_date\")\n\n    let whereClause = \"\"\n    const params: any[] = []\n    let paramIndex = 1\n\n    if (ptsId) {\n      whereClause += ` AND pt.pts_id = $${paramIndex++}`\n      params.push(ptsId)\n    }\n\n    if (startDate) {\n      whereClause += ` AND pt.created_at >= $${paramIndex++}`\n      params.push(startDate)\n    }\n\n    if (endDate) {\n      whereClause += ` AND pt.created_at <= $${paramIndex++}`\n      params.push(endDate + \" 23:59:59\")\n    }\n\n    const logsResult: any = await query(`\n      SELECT \n        pt.id, pt.packet_id, pt.pts_id, pt.pump_number, pt.nozzle_number,\n        pt.fuel_grade_id, pt.fuel_grade_name, pt.transaction_id,\n        pt.volume, pt.tc_volume, pt.price, pt.amount,\n        pt.total_volume, pt.total_amount, pt.tag, pt.user_id,\n        pt.configuration_id, pt.transaction_start, pt.transaction_end,\n        pt.processed, pt.sale_id, pt.created_at,\n        pt.raw_packet,\n        pce.raw_request,\n        pce.raw_response\n      FROM pump_transactions pt\n      LEFT JOIN pump_callback_events pce ON pt.callback_event_id = pce.id\n      WHERE 1=1 ${whereClause}\n      ORDER BY pt.created_at DESC\n      LIMIT $${paramIndex++} OFFSET $${paramIndex}\n    `, [...params, limit, offset])\n\n    const countResult: any = await query(`\n      SELECT COUNT(*) as total FROM pump_transactions pt WHERE 1=1 ${whereClause}\n    `, params)\n\n    const summaryResult: any = await query(`\n      SELECT \n        COUNT(*) as total_transactions,\n        SUM(volume) as total_volume,\n        SUM(amount) as total_amount,\n        COUNT(DISTINCT pts_id) as unique_controllers,\n        COUNT(DISTINCT pump_number) as unique_pumps,\n        COUNT(CASE WHEN processed = true THEN 1 END) as processed_count,\n        COUNT(CASE WHEN processed = false THEN 1 END) as pending_count\n      FROM pump_transactions pt\n      WHERE 1=1 ${whereClause}\n    `, params)\n\n    const logs = logsResult.rows || logsResult\n    const count = countResult.rows || countResult\n    const summary = summaryResult.rows || summaryResult\n\n    return NextResponse.json({\n      logs: logs,\n      total: parseInt(count[0]?.total || \"0\"),\n      summary: summary[0] || {},\n      limit,\n      offset\n    })\n  } catch (error: any) {\n    console.error(\"[Controller Logs API] Error:\", error.message)\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,SAAS,aAAa,GAAG,CAAC,aAAa;QACtD,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,UAAU,aAAa,GAAG,CAAC;QAEjC,IAAI,cAAc;QAClB,MAAM,SAAgB,EAAE;QACxB,IAAI,aAAa;QAEjB,IAAI,OAAO;YACT,eAAe,CAAC,kBAAkB,EAAE,cAAc;YAClD,OAAO,IAAI,CAAC;QACd;QAEA,IAAI,WAAW;YACb,eAAe,CAAC,uBAAuB,EAAE,cAAc;YACvD,OAAO,IAAI,CAAC;QACd;QAEA,IAAI,SAAS;YACX,eAAe,CAAC,uBAAuB,EAAE,cAAc;YACvD,OAAO,IAAI,CAAC,UAAU;QACxB;QAEA,MAAM,aAAkB,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;;;;gBAazB,EAAE,YAAY;;aAEjB,EAAE,aAAa,SAAS,EAAE,WAAW;IAC9C,CAAC,EAAE;eAAI;YAAQ;YAAO;SAAO;QAE7B,MAAM,cAAmB,MAAM,IAAA,8HAAK,EAAC,CAAC;mEACyB,EAAE,YAAY;IAC7E,CAAC,EAAE;QAEH,MAAM,gBAAqB,MAAM,IAAA,8HAAK,EAAC,CAAC;;;;;;;;;;gBAU5B,EAAE,YAAY;IAC1B,CAAC,EAAE;QAEH,MAAM,OAAO,WAAW,IAAI,IAAI;QAChC,MAAM,QAAQ,YAAY,IAAI,IAAI;QAClC,MAAM,UAAU,cAAc,IAAI,IAAI;QAEtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM;YACN,OAAO,SAAS,KAAK,CAAC,EAAE,EAAE,SAAS;YACnC,SAAS,OAAO,CAAC,EAAE,IAAI,CAAC;YACxB;YACA;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gCAAgC,MAAM,OAAO;QAC3D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}