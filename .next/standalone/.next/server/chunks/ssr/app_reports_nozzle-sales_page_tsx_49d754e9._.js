module.exports=[93156,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(344),f=a.i(69265),g=a.i(3130),h=a.i(40695),i=a.i(5522),j=a.i(87682),k=a.i(84505),l=a.i(71931),m=a.i(96221),n=a.i(13655),o=a.i(92e3),p=a.i(69520),q=a.i(41675),r=a.i(210),s=a.i(54161),t=a.i(74575);function u(){let a=(0,d.useSearchParams)().get("shift_id"),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(a||""),[G,H]=(0,c.useState)(new Date().toISOString().split("T")[0]),[I,J]=(0,c.useState)("shift"),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),{formatCurrency:O}=(0,t.useCurrency)(),P=a=>a?new Date(a).toLocaleString("en-KE",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"In Progress",Q=(0,c.useCallback)(async()=>{try{L(!0);let a=localStorage.getItem("selectedBranch"),b="";if(a&&(b=JSON.parse(a).id),!b)return void D([]);let c=new URLSearchParams;c.append("branch_id",b),c.append("limit","50");let d=await fetch(`/api/shifts?${c.toString()}`),e=await d.json();e.success&&e.shifts&&D(e.shifts.map(a=>({id:a.id,start_time:a.start_time,end_time:a.end_time,status:a.status,cashier_name:a.cashier})))}catch(a){console.error("Error fetching shifts:",a)}finally{L(!1)}},[]);(0,c.useEffect)(()=>{Q()},[Q]);let R=(0,c.useCallback)(async()=>{try{z(!0);let a=localStorage.getItem("selectedBranch"),b="";if(a&&(b=JSON.parse(a).id),!b)return void B(null);let c=new URLSearchParams;if(c.append("branch_id",b),"shift"===I&&E)c.append("shift_id",E);else if("daily"===I)c.append("date",G);else{B(null),z(!1);return}let d=await fetch(`/api/shifts/nozzle-report?${c.toString()}`),e=await d.json();e.success&&e.data?B(e.data):B(null)}catch(a){console.error("Error fetching nozzle report:",a),B(null)}finally{z(!1)}},[I,E,G]);return(0,c.useEffect)(()=>{("shift"===I&&E||"daily"===I)&&R()},[R,I,E]),(0,c.useEffect)(()=>{a&&!M&&(F(a),J("shift"),N(!0))},[a,M]),(0,b.jsxs)("div",{className:"flex min-h-screen w-full overflow-x-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,b.jsx)(e.default,{collapsed:u,onToggle:()=>v(!u),mobileOpen:w,onMobileClose:()=>x(!1)}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-w-0 lg:ml-8 my-2 lg:my-6 mx-2 lg:mr-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl lg:rounded-tl-3xl shadow-2xl flex-1 flex flex-col overflow-hidden",children:[(0,b.jsx)(f.default,{onMobileMenuToggle:()=>x(!w)}),(0,b.jsx)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden bg-slate-50 p-4 lg:p-6",children:(0,b.jsxs)("div",{className:"mx-auto max-w-7xl space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900 flex items-center gap-2",children:[(0,b.jsx)(n.Fuel,{className:"h-8 w-8 text-blue-600"}),"Nozzle Sales Report"]}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Meter readings and variance analysis by nozzle"})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[a&&(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>window.location.href="/reports/shifts",children:[(0,b.jsx)(r.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Shifts"]}),(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:R,disabled:y,children:[(0,b.jsx)(p.RefreshCw,{className:`h-4 w-4 mr-2 ${y?"animate-spin":""}`}),"Refresh"]}),(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>{window.print()},children:[(0,b.jsx)(l.Printer,{className:"h-4 w-4 mr-2"}),"Print"]}),(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>{if(!A||!A.nozzles.length)return;let a=new Blob([[["Nozzle","Fuel Type","Opening","Closing","Meter Diff (L)","Invoiced (L)","Invoiced Amount","Variance (L)"],...A.nozzles.map(a=>[a.nozzle_name,a.fuel_type,a.opening_reading.toString(),a.closing_reading.toString(),a.meter_difference.toString(),a.invoiced_quantity.toString(),a.invoiced_amount.toString(),a.variance.toString()]),["TOTAL","","","",A.totals?.total_meter_difference.toString()||"0",A.totals?.total_invoiced_quantity.toString()||"0",A.totals?.total_invoiced_amount.toString()||"0",A.totals?.total_variance.toString()||"0"]].map(a=>a.join(",")).join("\n")],{type:"text/csv"}),b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`nozzle-sales-report-${"shift"===I?E:G}.csv`,c.click(),window.URL.revokeObjectURL(b)},disabled:!A?.nozzles.length,children:[(0,b.jsx)(k.Download,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{className:"text-lg",children:"Report Filters"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 items-end",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"View By"}),(0,b.jsxs)(j.Select,{value:I,onValueChange:a=>J(a),children:[(0,b.jsx)(j.SelectTrigger,{className:"w-40 rounded-xl",children:(0,b.jsx)(j.SelectValue,{})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"shift",children:"By Shift"}),(0,b.jsx)(j.SelectItem,{value:"daily",children:"By Date"})]})]})]}),"shift"===I?(0,b.jsxs)("div",{className:"space-y-2 flex-1 min-w-[250px]",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Select Shift"}),(0,b.jsxs)(j.Select,{value:E,onValueChange:F,children:[(0,b.jsx)(j.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(j.SelectValue,{placeholder:K?"Loading shifts...":"Select a shift"})}),(0,b.jsx)(j.SelectContent,{children:C.map(a=>(0,b.jsxs)(j.SelectItem,{value:a.id,children:[P(a.start_time)," - ",P(a.end_time),a.cashier_name&&` (${a.cashier_name})`,"active"===a.status&&" [Active]"]},a.id))})]})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Select Date"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Calendar,{className:"h-4 w-4 text-slate-500"}),(0,b.jsx)(i.Input,{type:"date",value:G,onChange:a=>H(a.target.value),className:"w-44 rounded-xl"})]})]}),(0,b.jsxs)(h.Button,{onClick:R,disabled:y||"shift"===I&&!E,children:[y?(0,b.jsx)(m.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(p.RefreshCw,{className:"h-4 w-4 mr-2"}),"Load Report"]})]})})]}),A?.shifts&&A.shifts.length>0&&"daily"===I&&(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)(g.CardTitle,{className:"text-lg",children:["Shifts on ",new Date(G).toLocaleDateString("en-KE",{weekday:"long",day:"numeric",month:"long"})]})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:A.shifts.map(a=>(0,b.jsxs)(s.Badge,{variant:"active"===a.status?"default":"secondary",className:"text-sm py-1 px-3",children:[P(a.start_time)," - ",P(a.end_time),a.cashier_name&&` (${a.cashier_name})`]},a.id))})})]}),(0,b.jsxs)(g.Card,{className:"rounded-2xl",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{className:"text-lg",children:"shift"===I&&A?.shift?`${A.shift.branch_name} - ${P(A.shift.start_time)} to ${P(A.shift.end_time)}`:"daily"===I&&A?.branch?`${A.branch.name} - ${new Date(G).toLocaleDateString("en-KE",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}`:"Select a shift or date to view report"})}),(0,b.jsx)(g.CardContent,{children:y?(0,b.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-slate-400"}),(0,b.jsx)("span",{className:"ml-2 text-slate-500",children:"Loading nozzle report..."})]}):A&&A.nozzles&&A.nozzles.length>0?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4",children:[(0,b.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Total Volume (L)"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:A.totals?.total_meter_difference.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),(0,b.jsxs)("div",{className:"bg-green-50 rounded-xl p-4",children:[(0,b.jsx)("p",{className:"text-sm text-green-600 font-medium",children:"Invoiced (L)"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-900",children:A.totals?.total_invoiced_quantity.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),(0,b.jsxs)("div",{className:"bg-purple-50 rounded-xl p-4",children:[(0,b.jsx)("p",{className:"text-sm text-purple-600 font-medium",children:"Invoiced Amount"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-purple-900",children:O(A.totals?.total_invoiced_amount||0)})]}),(0,b.jsxs)("div",{className:`rounded-xl p-4 ${0===(A.totals?.total_variance||0)?"bg-green-50":(A.totals?.total_variance||0)>0?"bg-amber-50":"bg-red-50"}`,children:[(0,b.jsx)("p",{className:`text-sm font-medium ${0===(A.totals?.total_variance||0)?"text-green-600":(A.totals?.total_variance||0)>0?"text-amber-600":"text-red-600"}`,children:"Total Variance (L)"}),(0,b.jsxs)("p",{className:`text-2xl font-bold ${0===(A.totals?.total_variance||0)?"text-green-900":(A.totals?.total_variance||0)>0?"text-amber-900":"text-red-900"}`,children:[(A.totals?.total_variance||0)>0?"+":"",A.totals?.total_variance.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full min-w-[800px]",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b bg-slate-100",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Nozzle"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Fuel Type"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Opening"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Closing"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Meter Diff (L)"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Invoiced (L)"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Amount"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Variance (L)"})]})}),(0,b.jsx)("tbody",{children:A.nozzles.map(a=>(0,b.jsxs)("tr",{className:"border-b hover:bg-slate-50",children:[(0,b.jsx)("td",{className:"py-3 px-4 font-medium",children:a.nozzle_name}),(0,b.jsx)("td",{className:"py-3 px-4",children:(0,b.jsx)(s.Badge,{variant:"outline",children:a.fuel_type})}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:a.opening_reading.toLocaleString()}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:a.closing_reading.toLocaleString()}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono font-semibold",children:a.meter_difference.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:a.invoiced_quantity.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:O(a.invoiced_amount)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:(0,b.jsxs)("span",{className:`font-mono font-semibold ${0===a.variance?"text-green-600":a.variance>0?"text-amber-600":"text-red-600"}`,children:[a.variance>0?"+":"",a.variance.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),0!==a.variance&&(0,b.jsx)(o.AlertCircle,{className:"h-4 w-4 inline ml-1"})]})})]},a.nozzle_id))}),(0,b.jsx)("tfoot",{className:"bg-slate-100",children:(0,b.jsxs)("tr",{className:"font-bold",children:[(0,b.jsx)("td",{className:"py-3 px-4",colSpan:4,children:"TOTAL STATION SALES"}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:A.totals?.total_meter_difference.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:A.totals?.total_invoiced_quantity.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-mono",children:O(A.totals?.total_invoiced_amount||0)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:(0,b.jsxs)("span",{className:`font-mono ${0===(A.totals?.total_variance||0)?"text-green-600":(A.totals?.total_variance||0)>0?"text-amber-600":"text-red-600"}`,children:[(A.totals?.total_variance||0)>0?"+":"",A.totals?.total_variance.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})})]})})]})}),(0,b.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 mt-4",children:[(0,b.jsx)("h4",{className:"font-semibold text-blue-900 mb-2",children:"How to read this report:"}),(0,b.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Meter Difference"})," = Closing Reading - Opening Reading (actual fuel dispensed)"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Invoiced"})," = Total quantity from invoices issued on this nozzle"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Variance"})," = Meter Difference - Invoiced (should be 0 ideally)"]}),(0,b.jsxs)("li",{className:"text-amber-700",children:[(0,b.jsx)("strong",{children:"Positive variance"})," = More fuel dispensed than invoiced (potential loss)"]}),(0,b.jsxs)("li",{className:"text-red-700",children:[(0,b.jsx)("strong",{children:"Negative variance"})," = Less fuel dispensed than invoiced (data error)"]})]})]})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-slate-500",children:[(0,b.jsx)(n.Fuel,{className:"h-12 w-12 mb-4 text-slate-300"}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"shift"!==I||E?"No nozzle readings found":"Select a shift to view nozzle report"}),(0,b.jsx)("p",{className:"text-sm",children:"shift"!==I||E?"This shift/date may not have recorded nozzle readings yet":"Choose a shift from the dropdown above"})]})})]}),(0,b.jsxs)("footer",{className:"mt-12 border-t pt-6 pb-4 text-center text-sm text-muted-foreground",children:["Powered by ",(0,b.jsx)("span",{className:"font-semibold text-navy-900",children:"Sensile Technologies East Africa Ltd"})]})]})})]})})]})}function v(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-slate-400"})}),children:(0,b.jsx)(u,{})})}a.s(["default",()=>v])}];

//# sourceMappingURL=app_reports_nozzle-sales_page_tsx_49d754e9._.js.map