module.exports=[15021,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69265),e=a.i(3130),f=a.i(5522),g=a.i(88237),h=a.i(76504),i=a.i(40695),j=a.i(54161),k=a.i(65733),l=a.i(17171),m=a.i(87682),n=a.i(87532),o=a.i(79360),p=a.i(24569),q=a.i(70106);let r=(0,q.default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),s=(0,q.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var t=a.i(15618);let u={Director:"Full system access, financial approvals, user management, strategic reporting",Manager:"Branch operations, staff supervision, inventory management, sales reporting",Supervisor:"Daily operations, stock monitoring, customer management, basic reporting",Cashier:"Sales transactions, customer invoicing, basic inventory view, receipt generation"};var v=a.i(90023);function w(){let[a,q]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)({name:"",username:"",email:"",phone:"",role:"Cashier",password:"",branchId:""}),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(!0);(0,c.useEffect)(()=>{Q(),R()},[]);let Q=async()=>{try{let a=(0,v.getCurrentUser)(),b=a?.id,c=b?`/api/branches/list?user_id=${b}`:"/api/branches/list",d=await fetch(c);if(d.ok){let a=await d.json();F(a.branches||a||[])}}catch(a){console.error("Error fetching branches:",a)}},R=async()=>{P(!0);try{let a=(0,v.getCurrentUser)(),b=a?.id,c=b?`/api/staff/list?user_id=${b}`:"/api/staff/list",d=await fetch(c);if(d.ok){let a=await d.json(),b=(a.staff||a||[]).map((a,b)=>({id:a.id,staffId:a.staff_id||`STF-${String(b+1).padStart(3,"0")}`,name:a.full_name||a.name||"",username:a.username||a.email?.split("@")[0]||"",email:a.email||"",phone:a.phone_number||a.phone||"",role:a.role||"Cashier",status:a.status||"active",branchId:a.branch_id||"",branchName:a.branch_name||"All Branches"}));q(b)}}catch(a){console.error("Error fetching staff:",a)}finally{P(!1)}},S=async()=>{if(C)q(a.map(a=>a.id===C.id?{...a,...G}:a)),x(!1),D(null);else{if(!G.password)return void alert("Password is required for new staff members");if("Director"!==G.role&&!G.branchId)return void alert("Please select a branch for this staff member");N(!0);try{let a=await fetch("/api/staff/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:G.email,username:G.username,password:G.password,fullName:G.name,phoneNumber:G.phone,role:G.role,branchId:"Director"===G.role?null:G.branchId})}),b=await a.json();N(!1),a.ok&&b.success?(await R(),alert("Staff account created successfully! They can now log in with their credentials."),x(!1),D(null)):alert(`Error creating staff: ${b.error}`)}catch(a){N(!1),alert("Failed to create staff member. Please try again.")}}},T=async()=>{N(!0);try{let a=await fetch("/api/staff/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:C.id,email:C.email})});if(N(!1),a.ok)alert("Password has been reset to 'flow360'. User should change it on next login."),z(!1);else{let b=await a.json();alert(`Error resetting password: ${b.error||"Please try again."}`)}}catch(a){N(!1),alert("Failed to reset password. Please try again.")}},U=async()=>{I!==K?alert("Passwords do not match!"):(N(!0),N(!1),alert("Password changed successfully!"),B(!1),J(""),L(""),D(null))},V=async b=>{let c="active"===b.status?"inactive":"active";try{(await fetch("/api/staff/update-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:b.id,status:c})})).ok?q(a.map(a=>a.id===b.id?{...a,status:c}:a)):alert("Failed to update staff status. Please try again.")}catch(a){console.error("Error updating staff status:",a),alert("Failed to update staff status. Please try again.")}};return(0,b.jsxs)("div",{className:"flex h-screen flex-col overflow-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,b.jsx)(d.DashboardHeader,{currentBranch:"hq"}),(0,b.jsxs)("main",{className:"flex-1 overflow-y-auto p-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-balance text-white",children:"Staff List"}),(0,b.jsx)("p",{className:"mt-1 text-white/80 text-pretty",children:"Manage your staff members"})]}),(0,b.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,b.jsxs)("div",{className:"relative w-96",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"Search staff...",className:"pl-10 rounded-xl"})]}),(0,b.jsxs)(i.Button,{onClick:()=>{D(null),H({name:"",username:"",email:"",phone:"",role:"Cashier",password:"",branchId:""}),x(!0)},className:"rounded-xl gap-2",children:[(0,b.jsx)(t.Plus,{className:"h-4 w-4"}),"Add Staff"]})]})]}),(0,b.jsx)(e.Card,{className:"rounded-2xl",children:(0,b.jsx)(e.CardContent,{className:"p-6",children:(0,b.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHeader,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHead,{children:"Staff ID"}),(0,b.jsx)(g.TableHead,{children:"Name"}),(0,b.jsx)(g.TableHead,{children:"Username"}),(0,b.jsx)(g.TableHead,{children:"Email"}),(0,b.jsx)(g.TableHead,{children:"Phone"}),(0,b.jsx)(g.TableHead,{children:"Role"}),(0,b.jsx)(g.TableHead,{children:"Branch"}),(0,b.jsx)(g.TableHead,{children:"Status"}),(0,b.jsx)(g.TableHead,{className:"w-12"})]})}),(0,b.jsx)(g.TableBody,{children:O?(0,b.jsx)(g.TableRow,{children:(0,b.jsx)(g.TableCell,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"Loading staff members..."})}):0===a.length?(0,b.jsx)(g.TableRow,{children:(0,b.jsx)(g.TableCell,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:'No staff members found. Click "Add Staff" to create one.'})}):a.map(a=>(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableCell,{className:"font-medium",children:a.staffId}),(0,b.jsx)(g.TableCell,{children:a.name}),(0,b.jsx)(g.TableCell,{children:a.username}),(0,b.jsx)(g.TableCell,{children:a.email}),(0,b.jsx)(g.TableCell,{children:a.phone}),(0,b.jsx)(g.TableCell,{children:a.role}),(0,b.jsx)(g.TableCell,{children:a.branchName||"All Branches"}),(0,b.jsx)(g.TableCell,{children:(0,b.jsx)(j.Badge,{variant:"active"===a.status?"default":"secondary",className:"rounded-lg",children:a.status})}),(0,b.jsx)(g.TableCell,{children:(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",className:"rounded-lg",children:(0,b.jsx)(o.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsxs)(h.DropdownMenuContent,{align:"end",className:"rounded-xl",children:[(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>{D(a),H({name:a.name,username:a.username,email:a.email,phone:a.phone,role:a.role,password:"",branchId:a.branchId||""}),x(!0)},className:"gap-2 cursor-pointer rounded-lg",children:[(0,b.jsx)(p.Edit,{className:"h-4 w-4"}),"Edit"]}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>{D(a),z(!0)},className:"gap-2 cursor-pointer rounded-lg",children:[(0,b.jsx)(r,{className:"h-4 w-4"}),"Reset Account"]}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>V(a),className:"gap-2 cursor-pointer rounded-lg text-red-600",children:[(0,b.jsx)(s,{className:"h-4 w-4"}),"active"===a.status?"Deactivate":"Activate"]})]})]})})]},a.id))})]})})})})]}),(0,b.jsx)("footer",{className:"border-t px-8 py-4 text-center text-sm text-navy-900",children:"Powered by Sensile Technologies East Africa Ltd"}),(0,b.jsx)(k.Dialog,{open:w,onOpenChange:x,children:(0,b.jsxs)(k.DialogContent,{className:"max-w-2xl rounded-2xl",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:C?"Edit Staff Member":"Add New Staff Member"}),(0,b.jsx)(k.DialogDescription,{children:C?"Update staff information and role assignment":"Create a new staff account with authentication credentials and role permissions"})]}),(0,b.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"Full Name"}),(0,b.jsx)(f.Input,{id:"name",value:G.name,onChange:a=>H({...G,name:a.target.value}),className:"rounded-xl",placeholder:"Enter full name"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"username",children:"Username"}),(0,b.jsx)(f.Input,{id:"username",value:G.username,onChange:a=>H({...G,username:a.target.value}),className:"rounded-xl",placeholder:"Enter username"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"phone",children:"Phone Number"}),(0,b.jsx)(f.Input,{id:"phone",value:G.phone,onChange:a=>H({...G,phone:a.target.value}),className:"rounded-xl",placeholder:"+254 7XX XXXXXX"})]})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(f.Input,{id:"email",type:"email",value:G.email,onChange:a=>H({...G,email:a.target.value}),className:"rounded-xl",placeholder:"email@flow360.co.ke"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"role",children:"Role & Permissions"}),(0,b.jsxs)(m.Select,{value:G.role,onValueChange:a=>H({...G,role:a}),children:[(0,b.jsx)(m.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(m.SelectValue,{})}),(0,b.jsxs)(m.SelectContent,{className:"rounded-xl",children:[(0,b.jsx)(m.SelectItem,{value:"Director",className:"rounded-lg",children:"Director"}),(0,b.jsx)(m.SelectItem,{value:"Manager",className:"rounded-lg",children:"Manager"}),(0,b.jsx)(m.SelectItem,{value:"Supervisor",className:"rounded-lg",children:"Supervisor"}),(0,b.jsx)(m.SelectItem,{value:"Cashier",className:"rounded-lg",children:"Cashier"})]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:u[G.role]})]}),"Director"!==G.role&&(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"branch",children:"Assigned Branch *"}),(0,b.jsxs)(m.Select,{value:G.branchId,onValueChange:a=>H({...G,branchId:a}),children:[(0,b.jsx)(m.SelectTrigger,{className:"rounded-xl",children:(0,b.jsx)(m.SelectValue,{placeholder:"Select branch"})}),(0,b.jsx)(m.SelectContent,{className:"rounded-xl",children:E.map(a=>(0,b.jsx)(m.SelectItem,{value:a.id,className:"rounded-lg",children:a.name},a.id))})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"This user will only be able to access and manage this specific branch."})]}),!C&&(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"password",children:"Initial Password"}),(0,b.jsx)(f.Input,{id:"password",type:"password",value:G.password,onChange:a=>H({...G,password:a.target.value}),className:"rounded-xl",placeholder:"Enter initial password"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"This password will be used to create their login account. They can change it later."})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>x(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:S,disabled:M,className:"rounded-xl",children:M?"Creating...":C?"Save Changes":"Create Account"})]})]})}),(0,b.jsx)(k.Dialog,{open:y,onOpenChange:z,children:(0,b.jsxs)(k.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Reset Account Password"}),(0,b.jsxs)(k.DialogDescription,{children:["This will reset ",C?.name,'\'s password to the default password "flow360". They will be prompted to change it immediately.']})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>z(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:T,disabled:M,className:"rounded-xl",children:M?"Resetting...":"Confirm Reset"})]})]})}),(0,b.jsx)(k.Dialog,{open:A,onOpenChange:B,children:(0,b.jsxs)(k.DialogContent,{className:"rounded-2xl",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Change Password"}),(0,b.jsx)(k.DialogDescription,{children:"Your password has been reset. Please create a new secure password."})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"new-password",children:"New Password"}),(0,b.jsx)(f.Input,{id:"new-password",type:"password",value:I,onChange:a=>J(a.target.value),className:"rounded-xl",placeholder:"Enter new password"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"confirm-password",children:"Confirm Password"}),(0,b.jsx)(f.Input,{id:"confirm-password",type:"password",value:K,onChange:a=>L(a.target.value),className:"rounded-xl",placeholder:"Confirm new password"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>B(!1),className:"rounded-xl",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:U,className:"rounded-xl",children:"Change Password"})]})]})})]})}a.s(["default",()=>w],15021)}];

//# sourceMappingURL=app_headquarters_staff-management_page_tsx_c150a828._.js.map