module.exports=[96305,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(54161),g=a.i(5522),h=a.i(17171),i=a.i(65733),j=a.i(21958),k=a.i(67900),l=a.i(87532),m=a.i(63519);let n=(0,a.i(70106).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var o=a.i(57990),p=a.i(4720),q=a.i(41675),r=a.i(10448),s=a.i(21161),t=a.i(1027),u=a.i(96221),v=a.i(23292),w=a.i(56711);function x(){let[a,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)({name:"",email:"",phone:"",address:""}),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)({bhf_id:"",device_token:"",server_address:"",server_port:"",kra_pin:"",device_serial_number:"",sr_number:""}),[Y,Z]=(0,c.useState)(!1);(0,c.useEffect)(()=>{$()},[]);let $=async()=>{try{let a=await fetch("/api/admin/vendors"),b=await a.json();x(Array.isArray(b)?b:[])}catch(a){console.error("Error fetching merchants:",a),x([])}finally{z(!1)}},_=async a=>{L(!0);try{let[b,c]=await Promise.all([fetch(`/api/admin/vendors/${a.id}/branches`),fetch(`/api/admin/vendors/${a.id}/invoices`)]),d=await b.json(),e=await c.json();H(Array.isArray(d)?d:[]),J(Array.isArray(e)?e:[])}catch(a){console.error("Error fetching merchant details:",a),H([]),J([])}finally{L(!1)}},aa=async()=>{if(O)try{if(!(await fetch("/api/admin/vendors",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:O.id,...Q})})).ok)throw Error("Failed to update merchant");v.toast.success("Merchant updated successfully"),N(!1),$()}catch(a){v.toast.error("Failed to update merchant")}},ab=async()=>{if(U&&E)try{if(!(await fetch(`/api/admin/vendors/${E.id}/branches`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:U.id,...W})})).ok)throw Error("Failed to update branch");v.toast.success("Branch KRA configuration updated"),T(!1),_(E)}catch(a){v.toast.error("Failed to update branch configuration")}},ac=async()=>{if(U){Z(!0);try{let a=await fetch("/api/kra/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:U.id})}),b=await a.json();if(!a.ok)return void v.toast.error(b.error||"Failed to initialize");b.success?v.toast.success("KRA initialization successful - logged to branch profile"):v.toast.warning("KRA initialization completed with errors - check branch logs")}catch(a){v.toast.error(a.message||"Failed to initialize branch")}finally{Z(!1)}}},ad=a=>{switch(a){case"active":case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";case"partial":return"bg-blue-100 text-blue-800";default:return"bg-slate-100 text-slate-800"}},ae=a.filter(a=>a.name?.toLowerCase().includes(A.toLowerCase())||a.email?.toLowerCase().includes(A.toLowerCase())),af=I.filter(a=>"pending"===a.status||"overdue"===a.status||"partial"===a.status);return y?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Merchants"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Manage all merchants on the platform"})]})}),(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(l.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,b.jsx)(g.Input,{placeholder:"Search merchants...",value:A,onChange:a=>B(a.target.value),className:"pl-10"})]})}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ae.map(a=>(0,b.jsxs)(d.Card,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{F(a),D(!0),_(a)},children:[(0,b.jsx)(d.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(k.Building2,{className:"h-5 w-5 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{className:"text-lg",children:a.name}),(0,b.jsx)(d.CardDescription,{children:a.email})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),P(a),R({name:a.name||"",email:a.email||"",phone:a.phone||"",address:a.address||""}),N(!0)},title:"Edit Contact",children:(0,b.jsx)(r.Edit2,{className:"h-4 w-4"})}),(0,b.jsx)(f.Badge,{className:ad(a.status),children:a.status})]})]})}),(0,b.jsxs)(d.CardContent,{className:"space-y-3",children:[a.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,b.jsx)(m.Phone,{className:"h-4 w-4"}),a.phone]}),a.address&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,b.jsx)(n,{className:"h-4 w-4"}),a.address]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 pt-2 border-t",children:[(0,b.jsxs)("div",{className:"text-center flex-1",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:Number(a.branch_count)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Branches"})]}),(0,b.jsxs)("div",{className:"text-center flex-1",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:Number(a.pending_invoices||0)}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Invoices Pending"})]}),(0,b.jsx)("div",{className:"text-center flex-1",children:(0,b.jsx)(f.Badge,{variant:"outline",className:"text-xs",children:a.subscription_plan})})]})]})]},a.id))}),(0,b.jsx)(i.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(i.DialogContent,{className:"max-w-3xl max-h-[85vh] overflow-y-auto",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)(i.DialogTitle,{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(k.Building2,{className:"h-5 w-5 text-blue-600"})}),E?.name]}),(0,b.jsxs)(i.DialogDescription,{children:[E?.email," ",E?.phone&&`| ${E.phone}`]})]}),K?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,b.jsxs)(j.Tabs,{defaultValue:"branches",className:"mt-4",children:[(0,b.jsxs)(j.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsxs)(j.TabsTrigger,{value:"branches",children:[(0,b.jsx)(o.Store,{className:"h-4 w-4 mr-2"}),"Branches (",G.length,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"invoices",children:[(0,b.jsx)(p.FileText,{className:"h-4 w-4 mr-2"}),"Invoices (",af.length," pending)"]})]}),(0,b.jsx)(j.TabsContent,{value:"branches",className:"mt-4 space-y-3",children:0===G.length?(0,b.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,b.jsx)(o.Store,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No branches found"]}):G.map(a=>(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(o.Store,{className:"h-5 w-5 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||a.trading_name}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:a.address||"No address"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),V(a),X({bhf_id:a.bhf_id||"",device_token:a.device_token||"",server_address:a.server_address||"",server_port:a.server_port||"",kra_pin:a.kra_pin||"",device_serial_number:a.device_serial_number||"",sr_number:a.sr_number?.toString()||""}),T(!0)},title:"Edit KRA Configuration",children:(0,b.jsx)(s.Settings,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)(f.Badge,{variant:"outline",className:"font-mono",children:["BHF-ID: ",a.bhf_id||"Not set"]}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(f.Badge,{className:ad(a.status||"active"),children:a.status||"active"})})]})]})]}),(a.server_address||a.device_token)&&(0,b.jsxs)("div",{className:"mt-3 pt-3 border-t text-xs text-slate-500 space-y-1",children:[a.server_address&&(0,b.jsxs)("p",{children:["Server: ",a.server_address,":",a.server_port||"8088"]}),a.device_token&&(0,b.jsxs)("p",{children:["Token: ",a.device_token.substring(0,8),"...",a.device_token.substring(a.device_token.length-4)]})]})]})},a.id))}),(0,b.jsx)(j.TabsContent,{value:"invoices",className:"mt-4 space-y-3",children:0===I.length?(0,b.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,b.jsx)(p.FileText,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No invoices found"]}):I.map(a=>{let c;return(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(p.FileText,{className:"h-5 w-5 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-mono font-medium",children:a.invoice_number}),(0,b.jsxs)("p",{className:"text-sm text-slate-500 flex items-center gap-1",children:[(0,b.jsx)(q.Calendar,{className:"h-3 w-3"}),"Due: ",a.due_date?(0,w.format)(new Date(a.due_date),"MMM d, yyyy"):"N/A"]})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-bold text-lg",children:(c=Number(a.total_amount),new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(c))}),(0,b.jsx)(f.Badge,{className:ad(a.status),children:a.status})]})]})})},a.id)})})]})]})}),0===ae.length&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(k.Building2,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-500",children:"No merchants found"})]}),(0,b.jsx)(i.Dialog,{open:M,onOpenChange:N,children:(0,b.jsxs)(i.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{children:"Edit Merchant Contact"}),(0,b.jsx)(i.DialogDescription,{children:"Update the contact information for this merchant"})]}),(0,b.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"edit-name",children:"Name"}),(0,b.jsx)(g.Input,{id:"edit-name",value:Q.name,onChange:a=>R({...Q,name:a.target.value}),placeholder:"Merchant name"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"edit-email",children:"Email"}),(0,b.jsx)(g.Input,{id:"edit-email",type:"email",value:Q.email,onChange:a=>R({...Q,email:a.target.value}),placeholder:"contact@example.com"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"edit-phone",children:"Phone"}),(0,b.jsx)(g.Input,{id:"edit-phone",value:Q.phone,onChange:a=>R({...Q,phone:a.target.value}),placeholder:"+254 xxx xxx xxx"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"edit-address",children:"Address"}),(0,b.jsx)(g.Input,{id:"edit-address",value:Q.address,onChange:a=>R({...Q,address:a.target.value}),placeholder:"Business address"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:aa,children:"Save Changes"})]})]})]})}),(0,b.jsx)(i.Dialog,{open:S,onOpenChange:T,children:(0,b.jsxs)(i.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(s.Settings,{className:"h-5 w-5"}),"Edit Branch KRA Configuration"]}),(0,b.jsxs)(i.DialogDescription,{children:["Update KRA TIMS settings for ",U?.name||U?.trading_name]})]}),(0,b.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-bhf-id",children:"Branch ID (BHF ID)"}),(0,b.jsx)(g.Input,{id:"branch-bhf-id",value:W.bhf_id,onChange:a=>X({...W,bhf_id:a.target.value}),placeholder:"00"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"KRA Branch ID (e.g., 00 for main branch)"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-kra-pin",children:"KRA PIN"}),(0,b.jsx)(g.Input,{id:"branch-kra-pin",value:W.kra_pin,onChange:a=>X({...W,kra_pin:a.target.value}),placeholder:"P000000000X"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-device-token",children:"Device Token"}),(0,b.jsx)(g.Input,{id:"branch-device-token",value:W.device_token,onChange:a=>X({...W,device_token:a.target.value}),placeholder:"Enter device token"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"KRA VSCU device token for this branch"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-server-address",children:"Server Address"}),(0,b.jsx)(g.Input,{id:"branch-server-address",value:W.server_address,onChange:a=>X({...W,server_address:a.target.value}),placeholder:"5.189.171.160"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-server-port",children:"Server Port"}),(0,b.jsx)(g.Input,{id:"branch-server-port",value:W.server_port,onChange:a=>X({...W,server_port:a.target.value}),placeholder:"8088"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-device-serial",children:"Device Serial Number"}),(0,b.jsx)(g.Input,{id:"branch-device-serial",value:W.device_serial_number,onChange:a=>X({...W,device_serial_number:a.target.value}),placeholder:"Device serial number"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"branch-sr-number",children:"SR Number"}),(0,b.jsx)(g.Input,{id:"branch-sr-number",value:W.sr_number,onChange:a=>X({...W,sr_number:a.target.value}),placeholder:"SR number"})]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center gap-2 pt-4 border-t",children:[(0,b.jsxs)(e.Button,{variant:"outline",onClick:ac,disabled:Y,className:"gap-2",children:[Y?(0,b.jsx)(u.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(t.Zap,{className:"h-4 w-4"}),"Initialize"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:ab,children:"Save Configuration"})]})]})]})]})})]})}a.s(["default",()=>x],96305)}];

//# sourceMappingURL=app_admin_merchants_page_tsx_06f75668._.js.map