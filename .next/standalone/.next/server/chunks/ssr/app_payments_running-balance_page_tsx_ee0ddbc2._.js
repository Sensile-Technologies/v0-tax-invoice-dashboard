module.exports=[46638,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(344),e=a.i(69265),f=a.i(3130),g=a.i(40695),h=a.i(21958),i=a.i(84505),j=a.i(74575);function k(){let a,k,l,m,n,o,p,[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)("All"),{formatCurrency:E}=(0,j.useCurrency)();(0,c.useEffect)(()=>{(async()=>{try{v(!0);let a=localStorage.getItem("selectedBranch"),b=a?JSON.parse(a).id:null;if(!b){console.error("[v0] No branch selected"),F(),v(!1);return}let[c,d,e]=await Promise.all([fetch(`/api/shifts?branch_id=${b}`),fetch(`/api/sales?branch_id=${b}`),fetch(`/api/staff?branch_id=${b}`)]),[f,g,h]=await Promise.all([c.json(),d.json(),e.json()]),i=f.success?f.data:[],j=g.success?g.data:[],k=h.success?h.data:[];if(!i||0===i.length){F(),v(!1);return}let l=new Map((k||[]).map(a=>[a.id,a.full_name])),m=(j||[]).reduce((a,b)=>(a[b.shift_id]||(a[b.shift_id]=[]),a[b.shift_id].push(b),a),{}),n=i.map(a=>({...a,opening_cash:Number(a.opening_cash)||0,closing_cash:Number(a.closing_cash)||0,total_sales:Number(a.total_sales)||0,sales:m[a.id]||[]})).sort((a,b)=>new Date(a.start_time).getTime()-new Date(b.start_time).getTime()),o=[],p=0;if(n&&n.length>0){let a=n[0];p=a.opening_cash||0,o.push({date:new Date(a.start_time).toLocaleDateString(),shift:"Opening",user:"-",debit:0,credit:a.opening_cash||0,balance:p,paymentMethod:"All"})}if(n?.forEach(a=>{let b=new Date(a.start_time).toLocaleDateString(),c=a.end_time?new Date(a.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Ongoing",d=`${new Date(a.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${c}`,e=l.get(a.staff_id)||"Unknown Staff",f={};a.sales?.forEach(a=>{let b=a.payment_method||"Cash";f[b]=(f[b]||0)+(Number(a.total_amount)||0)}),Object.entries(f).forEach(([a,c])=>{p+=c,o.push({date:b,shift:d,user:e,debit:c,credit:0,balance:p,paymentMethod:a})})}),o.reduce((a,b)=>a+b.debit,0),o.reduce((a,b)=>a+b.credit,0),n&&n.length>0){let a=n[n.length-1];o.push({date:new Date(a.end_time||a.start_time).toLocaleDateString(),shift:"Closing",user:"-",debit:0,credit:0,balance:p,paymentMethod:"All"})}t(o),v(!1)}catch(a){console.error("[v0] Error fetching running balance:",a),F(),v(!1)}})()},[]);let F=()=>{t([{date:"12/15/2025",shift:"Opening",user:"-",debit:0,credit:5e4,balance:5e4,paymentMethod:"All"},{date:"12/15/2025",shift:"06:00 AM - 02:00 PM",user:"John Doe",debit:125e3,credit:0,balance:175e3,paymentMethod:"Cash"},{date:"12/15/2025",shift:"06:00 AM - 02:00 PM",user:"John Doe",debit:89e3,credit:0,balance:264e3,paymentMethod:"M-Pesa"},{date:"12/15/2025",shift:"06:00 AM - 02:00 PM",user:"John Doe",debit:45e3,credit:0,balance:309e3,paymentMethod:"Card"},{date:"12/15/2025",shift:"02:00 PM - 10:00 PM",user:"Jane Smith",debit:156e3,credit:0,balance:465e3,paymentMethod:"Cash"},{date:"12/15/2025",shift:"02:00 PM - 10:00 PM",user:"Jane Smith",debit:112e3,credit:0,balance:577e3,paymentMethod:"M-Pesa"},{date:"12/16/2025",shift:"06:00 AM - 02:00 PM",user:"Peter Johnson",debit:134e3,credit:0,balance:711e3,paymentMethod:"Cash"},{date:"12/16/2025",shift:"06:00 AM - 02:00 PM",user:"Peter Johnson",debit:98e3,credit:0,balance:809e3,paymentMethod:"M-Pesa"},{date:"12/16/2025",shift:"Closing",user:"-",debit:0,credit:0,balance:809e3,paymentMethod:"All"}])},G=a=>s.filter(b=>{let c=b.shift.toLowerCase().includes(w.toLowerCase())||b.user.toLowerCase().includes(w.toLowerCase()),d=new Date(b.date),e=y?new Date(y):null,f=A?new Date(A):null,g=(!e||d>=e)&&(!f||d<=f);return"All"===a?c&&g:c&&g&&b.paymentMethod===a}),H=Array.from(new Set(s.map(a=>a.paymentMethod).filter(a=>"All"!==a))),I=a=>{let c=G(a);if(0===c.length)return(0,b.jsx)("div",{className:"text-center py-12",children:(0,b.jsx)("p",{className:"text-slate-600",children:"No transactions found"})});let d=c.filter(a=>"Opening"!==a.shift&&"Closing"!==a.shift).reduce((a,b)=>a+b.debit,0),e=c.filter(a=>"Opening"!==a.shift&&"Closing"!==a.shift).reduce((a,b)=>a+b.credit,0),f=c.find(a=>"Opening"===a.shift),g=c.find(a=>"Closing"===a.shift),h=c.filter(a=>"Opening"!==a.shift&&"Closing"!==a.shift);return(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Date"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Shift"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"User/Staff"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Payment Method"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Debit"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Credit"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Balance"})]})}),(0,b.jsxs)("tbody",{children:[f&&(0,b.jsxs)("tr",{className:"bg-green-50 font-semibold border-b",children:[(0,b.jsx)("td",{className:"py-3 px-4",children:f.date}),(0,b.jsx)("td",{className:"py-3 px-4",children:f.shift}),(0,b.jsx)("td",{className:"py-3 px-4",children:f.user}),(0,b.jsx)("td",{className:"py-3 px-4",children:f.paymentMethod}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(f.debit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(f.credit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-semibold",children:E(f.balance)})]}),h.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b hover:bg-slate-50",children:[(0,b.jsx)("td",{className:"py-3 px-4",children:a.date}),(0,b.jsx)("td",{className:"py-3 px-4",children:a.shift}),(0,b.jsx)("td",{className:"py-3 px-4",children:a.user}),(0,b.jsx)("td",{className:"py-3 px-4",children:a.paymentMethod}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(a.debit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(a.credit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-semibold",children:E(a.balance)})]},c)),(0,b.jsxs)("tr",{className:"border-t-2 border-slate-300 bg-slate-100 font-bold",children:[(0,b.jsx)("td",{className:"py-3 px-4",colSpan:4,children:"Totals"}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(d)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(e)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:"-"})]}),g&&(0,b.jsxs)("tr",{className:"border-t-2 border-slate-300 bg-blue-50 font-bold",children:[(0,b.jsx)("td",{className:"py-3 px-4",children:g.date}),(0,b.jsx)("td",{className:"py-3 px-4",children:g.shift}),(0,b.jsx)("td",{className:"py-3 px-4",children:g.user}),(0,b.jsx)("td",{className:"py-3 px-4",children:g.paymentMethod}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(g.debit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(g.credit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-semibold text-blue-600",children:E(g.balance)})]})]})]})})};return(0,b.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,b.jsx)(d.DashboardSidebar,{collapsed:q,onToggle:()=>r(!q)}),(0,b.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden -ml-6 mt-6 bg-white rounded-tl-3xl shadow-2xl z-10",children:[(0,b.jsx)(e.DashboardHeader,{}),(0,b.jsx)("main",{className:"flex-1 overflow-y-auto bg-slate-50 p-6",children:(0,b.jsxs)("div",{className:"mx-auto max-w-7xl space-y-6",children:[(0,b.jsxs)(f.Card,{className:"shadow-lg",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-2xl font-bold text-slate-800",children:"Running Balance Report"})}),(0,b.jsx)(f.CardContent,{children:u?(0,b.jsx)("div",{className:"text-center py-8 text-slate-600",children:"Loading..."}):(0,b.jsxs)(h.Tabs,{value:C,onValueChange:D,className:"w-full",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)(h.TabsList,{children:[H.map(a=>(0,b.jsx)(h.TabsTrigger,{value:a,children:a},a)),(0,b.jsx)(h.TabsTrigger,{value:"All",children:"All Payment Methods"}),(0,b.jsx)(h.TabsTrigger,{value:"BankStatement",children:"Bank Account Statement"})]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{if("BankStatement"===C){let a,b,c,d,e,f,g,h;a=[],(b=s.find(a=>"Opening"===a.shift))&&a.push({date:b.date,transactionId:"OPN-001",source:"Opening Balance",debit:b.credit,balance:b.credit}),c=b?b.credit:0,d=1,s.filter(a=>"Opening"!==a.shift&&"Closing"!==a.shift).forEach(b=>{let e=b.debit+b.credit;if(e>0){c+=e;let f="";f="Cash"===b.paymentMethod?"Cash Deposit":"M-Pesa"===b.paymentMethod?"Mpesa Withdrawal":"Card"===b.paymentMethod?"Card Payment":`${b.paymentMethod} Transaction`,a.push({date:b.date,transactionId:`TXN-${String(d).padStart(4,"0")}`,source:f,debit:e,balance:c}),d++}}),a.push({date:a[a.length-1]?.date||new Date().toLocaleDateString(),transactionId:"CLS-001",source:"Closing Balance",debit:0,balance:c}),e="Date,Transaction ID,Source,Debit,Balance\n",a.forEach(a=>{e+=`${a.date},${a.transactionId},${a.source},${a.debit},${a.balance}
`}),f=new Blob([e],{type:"text/csv"}),g=window.URL.createObjectURL(f),(h=document.createElement("a")).href=g,h.download=`bank-account-statement-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(g)}else{let a,b,c,d,e;a=G(C),b="Date,Shift,User/Staff,Payment Method,Debit,Credit,Balance\n",a.forEach(a=>{b+=`${a.date},${a.shift},${a.user},${a.paymentMethod},${a.debit},${a.credit},${a.balance}
`}),c=new Blob([b],{type:"text/csv"}),d=window.URL.createObjectURL(c),(e=document.createElement("a")).href=d,e.download=`running-balance-${C.toLowerCase()}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(d)}},children:[(0,b.jsx)(i.Download,{className:"h-4 w-4 mr-2"}),"Export"]})]}),H.map(a=>(0,b.jsx)(h.TabsContent,{value:a,children:I(a)},a)),(0,b.jsx)(h.TabsContent,{value:"All",children:I("All")}),(0,b.jsx)(h.TabsContent,{value:"BankStatement",children:(a=[],(k=s.find(a=>"Opening"===a.shift))&&a.push({date:k.date,transactionId:"OPN-001",source:"Opening Balance",debit:k.credit,balance:k.credit}),l=k?k.credit:0,m=1,s.filter(a=>"Opening"!==a.shift&&"Closing"!==a.shift).forEach(b=>{let c=b.debit+b.credit;if(c>0){l+=c;let d="";d="Cash"===b.paymentMethod?"Cash Deposit":"M-Pesa"===b.paymentMethod?"Mpesa Withdrawal":"Card"===b.paymentMethod?"Card Payment":`${b.paymentMethod} Transaction`,a.push({date:b.date,transactionId:`TXN-${String(m).padStart(4,"0")}`,source:d,debit:c,balance:l}),m++}}),a.push({date:a[a.length-1]?.date||new Date().toLocaleDateString(),transactionId:"CLS-001",source:"Closing Balance",debit:0,balance:l}),n=a[0],o=a[a.length-1],p=a.slice(1,a.length-1),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Date"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Transaction ID"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Source"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Debit"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-700",children:"Balance"})]})}),(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{className:"bg-green-50 font-semibold border-b",children:[(0,b.jsx)("td",{className:"py-3 px-4",children:n.date}),(0,b.jsx)("td",{className:"py-3 px-4",children:n.transactionId}),(0,b.jsx)("td",{className:"py-3 px-4",children:n.source}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(n.debit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-semibold",children:E(n.balance)})]}),p.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b hover:bg-slate-50",children:[(0,b.jsx)("td",{className:"py-3 px-4",children:a.date}),(0,b.jsx)("td",{className:"py-3 px-4 font-mono text-sm",children:a.transactionId}),(0,b.jsx)("td",{className:"py-3 px-4",children:a.source}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(a.debit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-semibold",children:E(a.balance)})]},c)),(0,b.jsxs)("tr",{className:"bg-blue-50 font-semibold border-b-2",children:[(0,b.jsx)("td",{colSpan:3,className:"py-3 px-4 text-right",children:"Totals:"}),(0,b.jsx)("td",{className:"py-3 px-4"}),(0,b.jsx)("td",{className:"py-3 px-4"})]}),(0,b.jsxs)("tr",{className:"bg-amber-50 font-semibold border-b-2",children:[(0,b.jsx)("td",{className:"py-3 px-4",children:o.date}),(0,b.jsx)("td",{className:"py-3 px-4",children:o.transactionId}),(0,b.jsx)("td",{className:"py-3 px-4",children:o.source}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:E(o.debit)}),(0,b.jsx)("td",{className:"py-3 px-4 text-right font-semibold",children:E(o.balance)})]})]})]})}))})]})})]}),(0,b.jsxs)("footer",{className:"mt-12 border-t pt-6 pb-4 text-center text-sm text-muted-foreground",children:["Powered by ",(0,b.jsx)("span",{className:"font-semibold text-foreground",children:"Sensile Technologies East Africa Ltd"})]})]})})]})]})}a.s(["default",()=>k])}];

//# sourceMappingURL=app_payments_running-balance_page_tsx_ee0ddbc2._.js.map