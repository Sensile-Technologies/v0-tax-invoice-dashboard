(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,69004,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(32219),n=e.i(22623);e.i(47167);var l=e.i(30374),s=e.i(70065),i=e.i(67881),o=e.i(23750),c=e.i(10708),d=e.i(62870),u=e.i(63415),m=e.i(46696),h=e.i(63209),p=e.i(64659),y=e.i(25913),x=e.i(47163);let f=(0,y.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function g({className:e,variant:a,...r}){return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,x.cn)(f({variant:a}),e),...r})}function v({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"alert-description",className:(0,x.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...a})}var j=e.i(33541),b=e.i(84762),_=e.i(71435),S=e.i(53751),C=e.i(59377),N=e.i(44523),w=e.i(43531),A=e.i(25949),O=e.i(70778),D=e.i(98596),P=e.i(22273),E=e.i(62327),I=e.i(27241),k=e.i(73310);function T(e){var t=(0,I.useAppDispatch)();return(0,a.useEffect)(()=>{t((0,k.updatePolarOptions)(e))},[t,e]),null}var z=e.i(48973),F=e.i(51883),L=["layout"];function M(){return(M=Object.assign.bind()).apply(null,arguments)}var R={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},B=(0,a.forwardRef)(function(e,t){var r,n=(0,F.resolveDefaultProps)(e.categoricalChartProps,R),{layout:l}=n,s=function(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;a[r]=e[r]}return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],-1===t.indexOf(a)&&({}).propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}(n,L),{chartName:i,defaultTooltipEventType:o,validateTooltipEventTypes:c,tooltipPayloadSearcher:d}=e;return a.createElement(O.RechartsStoreProvider,{preloadedState:{options:{chartName:i,defaultTooltipEventType:o,validateTooltipEventTypes:c,tooltipPayloadSearcher:d,eventEmitter:void 0}},reduxStoreName:null!=(r=n.id)?r:i},a.createElement(D.ChartDataContextProvider,{chartData:n.data}),a.createElement(P.ReportMainChartProps,{layout:l,margin:n.margin}),a.createElement(E.ReportChartProps,{baseValue:void 0,accessibilityLayer:n.accessibilityLayer,barCategoryGap:n.barCategoryGap,maxBarSize:n.maxBarSize,stackOffset:n.stackOffset,barGap:n.barGap,barSize:n.barSize,syncId:n.syncId,syncMethod:n.syncMethod,className:n.className,reverseStackOrder:n.reverseStackOrder}),a.createElement(T,{cx:n.cx,cy:n.cy,startAngle:n.startAngle,endAngle:n.endAngle,innerRadius:n.innerRadius,outerRadius:n.outerRadius}),a.createElement(z.CategoricalChart,M({},s,{ref:t})))});function K(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function V(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?K(Object(a),!0).forEach(function(t){var r,n,l;r=e,n=t,l=a[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):K(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var $=["item"],J=V(V({},R),{},{layout:"centric",startAngle:0,endAngle:360}),U=(0,a.forwardRef)((e,t)=>{var r=(0,F.resolveDefaultProps)(e,J);return a.createElement(B,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:$,tooltipPayloadSearcher:A.arrayTooltipSearcher,categoricalChartProps:r,ref:t})}),G=e.i(92068),W=e.i(7670),H=e.i(61849),q=e.i(92860),Y=e.i(41088),Z=e.i(79812),X=e.i(61764),Q=e.i(46710),ee=e.i(73962),et=e.i(91561),ea=e.i(77320),er=e=>e.graphicalItems.polarItems,en=(0,H.createSelector)([ee.pickAxisType,et.pickAxisId],X.itemAxisPredicate),el=(0,H.createSelector)([er,X.selectBaseAxis,en],X.combineGraphicalItemsSettings),es=(0,H.createSelector)([el],X.combineGraphicalItemsData),ei=(0,H.createSelector)([es,q.selectChartDataAndAlwaysIgnoreIndexes],X.combineDisplayedData),eo=(0,H.createSelector)([ei,X.selectBaseAxis,el],X.combineAppliedValues);(0,H.createSelector)([ei,X.selectBaseAxis,el],(e,t,a)=>a.length>0?e.flatMap(e=>a.flatMap(a=>{var r;return{value:(0,Z.getValueByDataKey)(e,null!=(r=t.dataKey)?r:a.dataKey),errorDomain:[]}})).filter(Boolean):(null==t?void 0:t.dataKey)!=null?e.map(e=>({value:(0,Z.getValueByDataKey)(e,t.dataKey),errorDomain:[]})):e.map(e=>({value:e,errorDomain:[]})));var ec=()=>void 0,ed=(0,H.createSelector)([ei,X.selectBaseAxis,el,X.selectAllErrorBarSettings,ee.pickAxisType],X.combineDomainOfAllAppliedNumericalValuesIncludingErrorValues),eu=(0,H.createSelector)([X.selectBaseAxis,X.selectDomainDefinition,X.selectDomainFromUserPreference,ec,ed,ec,Q.selectChartLayout,ee.pickAxisType],X.combineNumericalDomain),em=(0,H.createSelector)([X.selectBaseAxis,Q.selectChartLayout,ei,eo,ea.selectStackOffsetType,ee.pickAxisType,eu],X.combineAxisDomain),eh=(0,H.createSelector)([em,X.selectBaseAxis,X.selectRealScaleType],X.combineNiceTicks);function ep(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function ey(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ep(Object(a),!0).forEach(function(t){var r,n,l;r=e,n=t,l=a[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ep(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}(0,H.createSelector)([X.selectBaseAxis,em,eh,ee.pickAxisType],X.combineAxisDomainWithNiceTicks);var ex=(0,H.createSelector)([er,(e,t)=>t],(e,t)=>e.filter(e=>"pie"===e.type).find(e=>e.id===t)),ef=[],eg=(e,t,a)=>(null==a?void 0:a.length)===0?ef:a,ev=(0,H.createSelector)([q.selectChartDataAndAlwaysIgnoreIndexes,ex,eg],(e,t,a)=>{var r,{chartData:n}=e;if(null!=t&&((r=(null==t?void 0:t.data)!=null&&t.data.length>0?t.data:n)&&r.length||null==a||(r=a.map(e=>ey(ey({},t.presentationProps),e.props))),null!=r))return r}),ej=(0,H.createSelector)([ev,ex,eg],(e,t,a)=>{if(null!=e&&null!=t)return e.map((e,r)=>{var n,l,s=(0,Z.getValueByDataKey)(e,t.nameKey,t.name);return l=null!=a&&null!=(n=a[r])&&null!=(n=n.props)&&n.fill?a[r].props.fill:"object"==typeof e&&null!=e&&"fill"in e?e.fill:t.fill,{value:(0,Z.getTooltipNameProp)(s,t.dataKey),color:l,payload:e,type:t.legendType}})}),eb=(0,H.createSelector)([ev,ex,eg,Y.selectChartOffsetInternal],(e,t,a,r)=>{if(null!=t&&null!=e)return function(e){var t,a,r,{pieSettings:n,displayedData:l,cells:s,offset:i}=e,{cornerRadius:o,startAngle:c,endAngle:d,dataKey:u,nameKey:m,tooltipType:h}=n,p=Math.abs(n.minAngle),y=(0,eO.mathSign)(d-c)*Math.min(Math.abs(d-c),360),x=Math.abs(y),f=l.length<=1?0:null!=(t=n.paddingAngle)?t:0,g=l.filter(e=>0!==(0,Z.getValueByDataKey)(e,u,0)).length,v=x-g*p-(x>=360?g:g-1)*f,j=l.reduce((e,t)=>{var a=(0,Z.getValueByDataKey)(t,u,0);return e+((0,eO.isNumber)(a)?a:0)},0);return j>0&&(a=l.map((e,t)=>{var a,l=(0,Z.getValueByDataKey)(e,u,0),d=(0,Z.getValueByDataKey)(e,m,t),x=((e,t,a)=>{var r,{top:n,left:l,width:s,height:i}=t,o=(0,eA.getMaxRadius)(s,i),c=l+(0,eO.getPercentValue)(e.cx,s,s/2),d=n+(0,eO.getPercentValue)(e.cy,i,i/2),u=(0,eO.getPercentValue)(e.innerRadius,o,0);return{cx:c,cy:d,innerRadius:u,outerRadius:(r=e.outerRadius,"function"==typeof r?(0,eO.getPercentValue)(r(a),o,.8*o):(0,eO.getPercentValue)(r,o,.8*o)),maxRadius:e.maxRadius||Math.sqrt(s*s+i*i)/2}})(n,i,e),g=((0,eO.isNumber)(l)?l:0)/j,b=eq(eq({},e),s&&s[t]&&s[t].props),_=(a=t?r.endAngle+(0,eO.mathSign)(y)*f*(0!==l):c)+(0,eO.mathSign)(y)*((0!==l?p:0)+g*v),S=(a+_)/2,C=(x.innerRadius+x.outerRadius)/2,N=[{name:d,value:l,payload:b,dataKey:u,type:h}],w=(0,eA.polarToCartesian)(x.cx,x.cy,C,S);return r=eq(eq(eq(eq({},n.presentationProps),{},{percent:g,cornerRadius:"string"==typeof o?parseFloat(o):o,name:d,tooltipPayload:N,midAngle:S,middleRadius:C,tooltipPosition:w},b),x),{},{value:l,dataKey:u,startAngle:a,endAngle:_,payload:b,paddingAngle:(0,eO.mathSign)(y)*f})})),a}({offset:r,pieSettings:t,displayedData:e,cells:a})}),e_=e.i(97865),eS=e.i(72733),eC=e.i(9516),eN=e.i(22787),ew=e.i(81977),eA=e.i(68970),eO=e.i(94395),eD=e.i(73393),eP=e.i(18519),eE=e.i(94585),eI=e.i(844),ek=e.i(76735),eT=e.i(95146),ez=e.i(94810),eF=e.i(40657),eL=e.i(15549),eM=e.i(91187),eR=e.i(57999),eB=e.i(66576),eK=e.i(69212),eV=e.i(29601),e$=e.i(81299),eJ=["key"],eU=["onMouseEnter","onClick","onMouseLeave"],eG=["id"],eW=["id"];function eH(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function eq(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?eH(Object(a),!0).forEach(function(t){var r,n,l;r=e,n=t,l=a[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eH(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function eY(){return(eY=Object.assign.bind()).apply(null,arguments)}function eZ(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;a[r]=e[r]}return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],-1===t.indexOf(a)&&({}).propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function eX(e){var t=(0,a.useMemo)(()=>(0,ew.findAllByType)(e.children,eN.Cell),[e.children]),r=(0,I.useAppSelector)(a=>ej(a,e.id,t));return null==r?null:a.createElement(eT.SetPolarLegendPayload,{legendPayload:r})}var eQ=a.memo(e=>{var{dataKey:t,nameKey:r,sectors:n,stroke:l,strokeWidth:s,fill:i,name:o,hide:c,tooltipType:d}=e,u={dataDefinedOnItem:n.map(e=>e.tooltipPayload),positions:n.map(e=>e.tooltipPosition),settings:{stroke:l,strokeWidth:s,fill:i,dataKey:t,nameKey:r,name:(0,Z.getTooltipNameProp)(o,t),hide:c,type:d,color:i,unit:""}};return a.createElement(eI.SetTooltipEntrySettings,{tooltipEntrySettings:u})});function e0(e){var{sectors:t,props:r,showLabels:n}=e,{label:l,labelLine:s,dataKey:i}=r;if(!n||!l||!t)return null;var o=(0,eR.svgPropertiesNoEvents)(r),c=(0,eR.svgPropertiesNoEventsFromUnknown)(l),d=(0,eR.svgPropertiesNoEventsFromUnknown)(s),u="object"==typeof l&&"offsetRadius"in l&&"number"==typeof l.offsetRadius&&l.offsetRadius||20,m=t.map((e,t)=>{var r,n,m=(e.startAngle+e.endAngle)/2,h=(0,eA.polarToCartesian)(e.cx,e.cy,e.outerRadius+u,m),p=eq(eq(eq(eq({},o),e),{},{stroke:"none"},c),{},{index:t,textAnchor:(r=h.x)>(n=e.cx)?"start":r<n?"end":"middle"},h),y=eq(eq(eq(eq({},o),e),{},{fill:"none",stroke:e.fill},d),{},{index:t,points:[(0,eA.polarToCartesian)(e.cx,e.cy,e.outerRadius,m),h],key:"line"});return a.createElement(eV.ZIndexLayer,{zIndex:e$.DefaultZIndexes.label,key:"label-".concat(e.startAngle,"-").concat(e.endAngle,"-").concat(e.midAngle,"-").concat(t)},a.createElement(e_.Layer,null,s&&((e,t)=>{if(a.isValidElement(e))return a.cloneElement(e,t);if("function"==typeof e)return e(t);var r=(0,W.clsx)("recharts-pie-label-line","boolean"!=typeof e?e.className:""),{key:n}=t,l=eZ(t,eJ);return a.createElement(eS.Curve,eY({},l,{type:"linear",className:r}))})(s,y),((e,t,r)=>{if(a.isValidElement(e))return a.cloneElement(e,t);var n=r;if("function"==typeof e&&(n=e(t),a.isValidElement(n)))return n;var l=(0,W.clsx)("recharts-pie-label-text",e&&"object"==typeof e&&"className"in e&&"string"==typeof e.className?e.className:"");return a.createElement(eC.Text,eY({},t,{alignmentBaseline:"middle",className:l}),n)})(l,p,(0,Z.getValueByDataKey)(e,i))))});return a.createElement(e_.Layer,{className:"recharts-pie-labels"},m)}function e1(e){var{sectors:t,props:r,showLabels:n}=e,{label:l}=r;return"object"==typeof l&&null!=l&&"position"in l?a.createElement(eK.LabelListFromLabelProp,{label:l}):a.createElement(e0,{sectors:t,props:r,showLabels:n})}function e2(e){var{sectors:t,activeShape:r,inactiveShape:n,allOtherPieProps:l,shape:s,id:i}=e,o=(0,I.useAppSelector)(ek.selectActiveTooltipIndex),c=(0,I.useAppSelector)(ek.selectActiveTooltipDataKey),d=(0,I.useAppSelector)(ek.selectActiveTooltipGraphicalItemId),{onMouseEnter:u,onClick:m,onMouseLeave:h}=l,p=eZ(l,eU),y=(0,eE.useMouseEnterItemDispatch)(u,l.dataKey,i),x=(0,eE.useMouseLeaveItemDispatch)(h),f=(0,eE.useMouseClickItemDispatch)(m,l.dataKey,i);return null==t||0===t.length?null:a.createElement(a.Fragment,null,t.map((e,u)=>{if((null==e?void 0:e.startAngle)===0&&(null==e?void 0:e.endAngle)===0&&1!==t.length)return null;var m=null==d||d===i,h=String(u)===o&&(null==c||l.dataKey===c)&&m,g=r&&h?r:o?n:null,v=eq(eq({},e),{},{stroke:e.stroke,tabIndex:-1,[ez.DATA_ITEM_INDEX_ATTRIBUTE_NAME]:u,[ez.DATA_ITEM_DATAKEY_ATTRIBUTE_NAME]:l.dataKey});return a.createElement(e_.Layer,eY({key:"sector-".concat(null==e?void 0:e.startAngle,"-").concat(null==e?void 0:e.endAngle,"-").concat(e.midAngle,"-").concat(u),tabIndex:-1,className:"recharts-pie-sector"},(0,eD.adaptEventsOfChild)(p,e,u),{onMouseEnter:y(e,u),onMouseLeave:x(e,u),onClick:f(e,u)}),a.createElement(eP.Shape,eY({option:null!=s?s:g,index:u,shapeType:"sector",isActive:h},v)))}))}function e5(e){var{showLabels:t,sectors:r,children:n}=e,l=(0,a.useMemo)(()=>t&&r?r.map(e=>({value:e.value,payload:e.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:e.cx,cy:e.cy,innerRadius:e.innerRadius,outerRadius:e.outerRadius,startAngle:e.startAngle,endAngle:e.endAngle,clockWise:!1},fill:e.fill})):[],[r,t]);return a.createElement(eK.PolarLabelListContextProvider,{value:t?l:void 0},n)}function e4(e){var{props:t,previousSectorsRef:r,id:n}=e,{sectors:l,isAnimationActive:s,animationBegin:i,animationDuration:o,animationEasing:c,activeShape:d,inactiveShape:u,onAnimationStart:m,onAnimationEnd:h}=t,p=(0,eF.useAnimationId)(t,"recharts-pie-"),y=r.current,[x,f]=(0,a.useState)(!1),g=(0,a.useCallback)(()=>{"function"==typeof h&&h(),f(!1)},[h]),v=(0,a.useCallback)(()=>{"function"==typeof m&&m(),f(!0)},[m]);return a.createElement(e5,{showLabels:!x,sectors:l},a.createElement(eB.JavascriptAnimate,{animationId:p,begin:i,duration:o,isActive:s,easing:c,onAnimationStart:v,onAnimationEnd:g,key:p},e=>{var s=[],i=l&&l[0],o=null==i?void 0:i.startAngle;return null==l||l.forEach((t,a)=>{var r=y&&y[a],n=a>0?(0,G.default)(t,"paddingAngle",0):0;if(r){var l=(0,eO.interpolate)(r.endAngle-r.startAngle,t.endAngle-t.startAngle,e),i=eq(eq({},t),{},{startAngle:o+n,endAngle:o+l+n});s.push(i),o=i.endAngle}else{var{endAngle:c,startAngle:d}=t,u=(0,eO.interpolate)(0,c-d,e),m=eq(eq({},t),{},{startAngle:o+n,endAngle:o+u+n});s.push(m),o=m.endAngle}}),r.current=s,a.createElement(e_.Layer,null,a.createElement(e2,{sectors:s,activeShape:d,inactiveShape:u,allOtherPieProps:t,shape:t.shape,id:n}))}),a.createElement(e1,{showLabels:!x,sectors:l,props:t}),t.children)}var e7={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:"auto",label:!1,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:e$.DefaultZIndexes.area};function e6(e){var{id:t}=e,r=eZ(e,eG),{hide:n,className:l,rootTabIndex:s}=e,i=(0,a.useMemo)(()=>(0,ew.findAllByType)(e.children,eN.Cell),[e.children]),o=(0,I.useAppSelector)(e=>eb(e,t,i)),c=(0,a.useRef)(null),d=(0,W.clsx)("recharts-pie",l);return n||null==o?(c.current=null,a.createElement(e_.Layer,{tabIndex:s,className:d})):a.createElement(eV.ZIndexLayer,{zIndex:e.zIndex},a.createElement(eQ,{dataKey:e.dataKey,nameKey:e.nameKey,sectors:o,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,tooltipType:e.tooltipType}),a.createElement(e_.Layer,{tabIndex:s,className:d},a.createElement(e4,{props:eq(eq({},r),{},{sectors:o}),previousSectorsRef:c,id:t})))}function e3(e){var t=(0,F.resolveDefaultProps)(e,e7),{id:r}=t,n=eZ(t,eW),l=(0,eR.svgPropertiesNoEvents)(n);return a.createElement(eL.RegisterGraphicalItemId,{id:r,type:"pie"},e=>a.createElement(a.Fragment,null,a.createElement(eM.SetPolarGraphicalItem,{type:"pie",id:e,data:n.data,dataKey:n.dataKey,hide:n.hide,angleAxisId:0,radiusAxisId:0,name:n.name,nameKey:n.nameKey,tooltipType:n.tooltipType,legendType:n.legendType,fill:n.fill,cx:n.cx,cy:n.cy,startAngle:n.startAngle,endAngle:n.endAngle,paddingAngle:n.paddingAngle,minAngle:n.minAngle,innerRadius:n.innerRadius,outerRadius:n.outerRadius,cornerRadius:n.cornerRadius,presentationProps:l,maxRadius:t.maxRadius}),a.createElement(eX,eY({},n,{id:e})),a.createElement(e6,eY({},n,{id:e}))))}e3.displayName="Pie";var e8=e.i(9694),e9=e.i(75225),te=e.i(85183),tt=e.i(93230),ta=e.i(72526),tr=e.i(34239),tn=e.i(31195),tl=e.i(29228),ts=e.i(72325);function ti(){let e,r,n,y,f,{formatCurrency:A}=(0,j.useCurrency)(),[O,D]=(0,a.useState)([]),[P,E]=(0,a.useState)([]),[I,k]=(0,a.useState)([]),[T,z]=(0,a.useState)([]),[F,L]=(0,a.useState)([]),[M,R]=(0,a.useState)({}),[B,K]=(0,a.useState)({}),[V,$]=(0,a.useState)({}),[J,G]=(0,a.useState)({}),[W,H]=(0,a.useState)({}),[q,Y]=(0,a.useState)(null),[Z,X]=(0,a.useState)(!1),[Q,ee]=(0,a.useState)(!1),[et,ea]=(0,a.useState)(!1),[er,en]=(0,a.useState)(!1),[el,es]=(0,a.useState)(null),[ei,eo]=(0,a.useState)(null),[ec,ed]=(0,a.useState)([]),[eu,em]=(0,a.useState)(!1),[eh,ep]=(0,a.useState)(null),[ey,ex]=(0,a.useState)({nozzle_id:"",fuel_type:"",amount:"",payment_method:"cash",customer_name:"",vehicle_number:"",customer_pin:"",meter_reading_after:"",is_loyalty_sale:!1,loyalty_customer_name:"",loyalty_customer_pin:"",discount_type:"fixed",discount_value:""}),[ef,eg]=(0,a.useState)({date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),closing_cash:"",notes:""}),[ev,ej]=(0,a.useState)(!1),[eb,e_]=(0,a.useState)(!1),[eS,eC]=(0,a.useState)(!1),[ew,eA]=(0,a.useState)(null),[eO,eD]=(0,a.useState)(!1),[eP,eE]=(0,a.useState)({amount:"",nozzle_id:"",customer_pin:"",payment_method:"cash",discount_type:"fixed",discount_value:"",is_loyalty_sale:!1,loyalty_customer_id:"",loyalty_customer_name:"",loyalty_customer_pin:""});async function eI(){try{X(!0);let e=localStorage.getItem("selectedBranch");if(!e){m.toast.error("No branch selected"),X(!1);return}let t=JSON.parse(e).id,[a,r,n,l,s]=await Promise.all([fetch(`/api/nozzles?branch_id=${t}&status=active`),fetch(`/api/dispensers?branch_id=${t}`),fetch(`/api/fuel-prices?branch_id=${t}`),fetch(`/api/shifts?branch_id=${t}&status=active`),fetch(`/api/tanks?branch_id=${t}`)]),[i,o,c,d,u]=await Promise.all([a.json(),r.json(),n.json(),l.json(),s.json()]);i.success&&E(i.data||[]),o.success&&z(o.data||[]),c.success&&L(c.data||[]),u.success&&k(u.data||[]),d.success&&d.data?(Y(d.data),await ek(d.data.id)):(Y(null),D([]))}catch(e){console.error("Error fetching data:",e),m.toast.error("Failed to load sales data")}finally{X(!1)}}async function ek(e){try{let e=localStorage.getItem("selectedBranch");if(!e)return;let t=JSON.parse(e).id,a=new Date().toISOString().split("T")[0],r=`/api/sales?branch_id=${t}&limit=100&start_date=${a}`,n=await fetch(r),l=await n.json();if(l.success){let e=(l.data||[]).map(e=>({...e,quantity:Number(e.quantity)||0,unit_price:Number(e.unit_price)||0,total_amount:Number(e.total_amount)||0,meter_reading_after:Number(e.meter_reading_after)||0,loyalty_points_earned:Number(e.loyalty_points_earned)||0}));D(e)}}catch(e){console.error("Error fetching sales:",e)}}async function eT(){if(!ey.nozzle_id||!ey.fuel_type||!ey.amount)return void m.toast.error("Please fill in all required fields");if(!q)return void m.toast.error("Please start a shift before recording sales");ee(!0);try{let e=localStorage.getItem("selectedBranch");if(!e){m.toast.error("No branch selected"),ee(!1);return}let t=JSON.parse(e).id,a=F.find(e=>e.fuel_type===ey.fuel_type);if(!a){m.toast.error(`No price configured for ${ey.fuel_type}`),ee(!1);return}let r=Number.parseFloat(ey.amount),n=Number.parseFloat(a.price),l=0;if(ey.discount_value&&Number.parseFloat(ey.discount_value)>0)if("percentage"===ey.discount_type){let e=Math.min(Number.parseFloat(ey.discount_value),100);l=r*e/100}else l=Math.min(Number.parseFloat(ey.discount_value),r);let s=Math.max(r-l,0),i=s/n,o=`INV-${Date.now()}`,c=`RCP-${Date.now()}`,d=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:t,shift_id:q.id,nozzle_id:ey.nozzle_id,fuel_type:ey.fuel_type,quantity:i,unit_price:n,total_amount:s,payment_method:ey.payment_method,customer_name:ey.customer_name||null,vehicle_number:ey.vehicle_number||null,customer_pin:ey.customer_pin||null,invoice_number:o,meter_reading_after:0,transmission_status:"pending",receipt_number:c,is_loyalty_sale:ey.is_loyalty_sale,loyalty_customer_name:ey.is_loyalty_sale?ey.loyalty_customer_name:null,loyalty_customer_pin:ey.is_loyalty_sale?ey.loyalty_customer_pin:null})}),u=await d.json();if(d.ok&&u.success){let e=u.data;try{let a=await fetch("/api/kra/test-sale",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:t,invoice_number:e.invoice_number,receipt_number:e.receipt_number,fuel_type:ey.fuel_type,quantity:i,unit_price:n,total_amount:s,payment_method:ey.payment_method,customer_name:ey.customer_name||"Walk-in Customer",customer_pin:ey.customer_pin||""})}),r=await a.json();console.log("KRA API Response:",JSON.stringify(r,null,2))}catch(e){console.error("Error calling KRA endpoint:",e)}m.toast.success("Sale recorded successfully!"),ex({nozzle_id:"",fuel_type:"",amount:"",payment_method:"cash",customer_name:"",vehicle_number:"",customer_pin:"",meter_reading_after:"",is_loyalty_sale:!1,loyalty_customer_name:"",loyalty_customer_pin:"",discount_type:"fixed",discount_value:""}),ea(!1),ee(!1),ek(q?.id).catch(console.error);return}console.error("Sale creation error:",u.error),m.toast.error(`Error recording sale: ${u.error||"Unknown error"}`)}catch(e){console.error("Sale creation error:",e),m.toast.error("Failed to record sale")}finally{ee(!1)}}async function ez(){if(!ef.date||!ef.time)return void m.toast.error("Please select date and time");ej(!0);try{let e=localStorage.getItem("selectedBranch");if(!e){m.toast.error("No branch selected. Please select a branch from the header."),ej(!1);return}let t=JSON.parse(e).id,a=new Date(`${ef.date}T${ef.time}`),r={branch_id:t,start_time:a.toISOString(),status:"active",opening_cash:0,notes:ef.notes||null,user_id:eh},n=await fetch("/api/shifts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),l=await n.json();if(n.ok&&l.success)m.toast.success("Shift started successfully"),Y(l.data),en(!1),eg({date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),closing_cash:"",notes:""});else if(l.error?.includes("active shift already exists")){let e=await fetch(`/api/shifts?branch_id=${t}&status=active`),a=await e.json();a.success&&a.data?(Y(a.data),await ek(a.data.id),m.toast.info("Using existing active shift"),en(!1)):m.toast.error("An active shift exists but couldn't be loaded. Please refresh the page.")}else console.error("Error starting shift:",l.error),m.toast.error(`Failed to start shift: ${l.error||"Unknown error"}`)}catch(e){console.error("Error starting shift:",e),m.toast.error(`Failed to start shift: ${e instanceof Error?e.message:"Unknown error"}`)}finally{ej(!1)}}async function eF(){if(!q)return void m.toast.error("No active shift to end");ej(!0);try{let e=O.reduce((e,t)=>e+(parseFloat(t.total_amount)||0),0),t=Object.entries(M).filter(([e,t])=>""!==t).map(([e,t])=>({nozzle_id:e,closing_reading:parseFloat(t)})),a=Object.entries(B).filter(([e,t])=>""!==t).map(([e,t])=>({tank_id:e,closing_reading:parseFloat(t),stock_received:parseFloat(V[e]||"0")||0})),r=await fetch("/api/shifts",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:q.id,end_time:new Date().toISOString(),status:"completed",closing_cash:ef.closing_cash?Number.parseFloat(ef.closing_cash):0,total_sales:e,notes:ef.notes||null,nozzle_readings:t,tank_stocks:a})}),n=await r.json();r.ok&&n.success?(m.toast.success("Shift ended & new shift started"),n.newShift&&Y(n.newShift),en(!1),eg({date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),closing_cash:"",notes:""}),R({}),K({}),$({}),eI()):(console.error("Error ending shift:",n.error),m.toast.error(n.error||"Failed to end shift"))}catch(e){console.error("Error ending shift:",e),m.toast.error("Failed to end shift")}finally{ej(!1)}}async function eL(e){if(es(e),en(!0),"end"===e&&ei?.id)try{let e=await fetch(`/api/shifts/baselines?branch_id=${ei.id}`),t=await e.json();t.success&&(G(t.nozzleBaselines||{}),H(t.tankBaselines||{}))}catch(e){console.error("Error fetching baselines:",e)}}(0,a.useEffect)(()=>{!async function(){try{let e=await fetch("/api/auth/session",{credentials:"include"});if(e.ok){let t=(await e.json()).user;if(t){ep(t.id);let e=(t.role||"").toLowerCase();if(["supervisor","manager","cashier"].includes(e)&&t.branch_id&&t.branch_name){let e={id:t.branch_id,name:t.branch_name,type:"branch",status:"active"};eo(e),localStorage.setItem("selectedBranch",JSON.stringify(e));return}let a=localStorage.getItem("selectedBranch");if(a)try{eo(JSON.parse(a))}catch(e){}return}}}catch(e){console.error("Error fetching session:",e)}let e=localStorage.getItem("flow360_user")||localStorage.getItem("user");if(e)try{let t=JSON.parse(e);if(ep(t.id),t.branch_id&&t.branch_name){let e={id:t.branch_id,name:t.branch_name,type:"branch",status:"active"};eo(e),localStorage.setItem("selectedBranch",JSON.stringify(e));return}}catch(e){console.error("Error parsing user data:",e)}let t=localStorage.getItem("selectedBranch");if(t)try{eo(JSON.parse(t))}catch(e){}}();let e=e=>{"selectedBranch"===e.key&&e.newValue&&eo(JSON.parse(e.newValue))},t=setInterval(()=>{let e=localStorage.getItem("selectedBranch");if(e)try{let t=JSON.parse(e);eo(e=>e?.id!==t.id?t:e)}catch(e){}},500);return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e),clearInterval(t)}},[]),(0,a.useEffect)(()=>{ei?.id&&eI()},[ei?.id]),(0,a.useEffect)(()=>{async function e(){try{let e=await fetch(`/api/customers?branch_id=${ei?.id}`),t=await e.json();t.success&&ed((t.data||[]).map(e=>({id:e.id,name:e.cust_nm||"",pin:e.cust_tin||""})))}catch(e){console.error("Error fetching loyalty customers:",e)}}ei?.id&&e()},[ei?.id]);let eM=q?new Date(q.start_time).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown";async function eR(){if(!eP.amount||!eP.nozzle_id)return void m.toast.error("Please fill in amount and select a nozzle");let e=localStorage.getItem("selectedBranch");if(!e)return void m.toast.error("No branch selected");let t=JSON.parse(e),a=P.find(e=>e.id===eP.nozzle_id);if(!a)return void m.toast.error("Invalid nozzle selected");eC(!0),eA(null);try{let e=await fetch("/api/kra/issue-invoice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:t.id,amount:parseFloat(eP.amount),nozzle_id:eP.nozzle_id,fuel_type:a.fuel_type,customer_pin:eP.is_loyalty_sale?eP.loyalty_customer_pin:eP.customer_pin,payment_method:eP.payment_method,discount_type:eP.discount_type,discount_value:eP.discount_value?parseFloat(eP.discount_value):0,is_loyalty_sale:eP.is_loyalty_sale,loyalty_customer_name:eP.loyalty_customer_name})}),r=await e.json();if(r.success)m.toast.success("Invoice issued successfully! Check logs for details."),e_(!1),eA(null),eE({amount:"",nozzle_id:"",customer_pin:"",payment_method:"cash",discount_type:"fixed",discount_value:"",is_loyalty_sale:!1,loyalty_customer_id:"",loyalty_customer_name:"",loyalty_customer_pin:""}),eI();else{let e=r.error||"Failed to issue invoice";eA(e),m.toast.error(e)}}catch(t){console.error("Error issuing invoice:",t);let e=t?.message||"Failed to issue invoice";eA(e),m.toast.error(e)}finally{eC(!1)}}return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Sales Summary"}),(0,t.jsx)("p",{className:"text-slate-600",children:"Overview of sales performance and trends"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(u.DropdownMenu,{children:[(0,t.jsx)(u.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{variant:"outline",children:["Shift Management ",(0,t.jsx)(p.ChevronDown,{className:"ml-2 h-4 w-4"})]})}),(0,t.jsxs)(u.DropdownMenuContent,{align:"end",children:[(0,t.jsx)(u.DropdownMenuItem,{onClick:()=>eL("start"),disabled:!!q,children:"Start Shift"}),(0,t.jsx)(u.DropdownMenuItem,{onClick:()=>eL("end"),disabled:!q,children:"End Shift"})]})]}),(0,t.jsx)(i.Button,{onClick:()=>{eA(null),e_(!0)},variant:"default",className:"bg-blue-600 hover:bg-blue-700",children:"Issue Invoice"})]})]}),q?(0,t.jsx)(g,{className:"bg-green-50 border-green-200",children:(0,t.jsxs)(v,{className:"text-green-800",children:["Current ongoing shift started at ",eM]})}):(0,t.jsxs)(g,{className:"bg-amber-50 border-amber-200",children:[(0,t.jsx)(h.AlertCircle,{className:"h-4 w-4 text-amber-600"}),(0,t.jsx)(v,{className:"text-amber-800",children:"No active shift. Please start a shift before recording sales."})]}),O.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4 mb-4",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,t.jsx)(s.CardTitle,{className:"text-base text-black",children:"Sales by Fuel Type"}),(0,t.jsx)(s.CardDescription,{className:"text-xs text-black/70",children:"Revenue by fuel type"})]}),(0,t.jsx)(s.CardContent,{className:"pt-2",children:(0,t.jsx)(tn.ResponsiveContainer,{width:"100%",height:220,children:(0,t.jsxs)(U,{children:[(0,t.jsx)(e3,{data:Object.entries(O.reduce((e,t)=>(e[t.fuel_type]=(e[t.fuel_type]||0)+t.total_amount,e),{})).map(([e,t])=>({name:e,value:t})),cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{cx:a,cy:r,midAngle:n,innerRadius:l,outerRadius:s,percent:i,name:o}=e,c=l+(s-l)*.5,d=a+c*Math.cos(-(Math.PI/180*n)),u=r+c*Math.sin(-(Math.PI/180*n));return(0,t.jsx)("text",{x:d,y:u,fill:"#000000",textAnchor:d>a?"start":"end",dominantBaseline:"central",fontSize:"11",fontWeight:"500",children:`${o} ${(100*i).toFixed(0)}%`})},outerRadius:70,fill:"#8884d8",dataKey:"value",children:(e={Diesel:"#FFFF00",Petrol:"#FF0000",Unleaded:"#FF0000",Super:"#10B981"},Object.keys(O.reduce((e,t)=>(e[t.fuel_type]=(e[t.fuel_type]||0)+t.total_amount,e),{})).map((a,r)=>(0,t.jsx)(eN.Cell,{fill:e[a]||"#6B7280"},`cell-${r}`)))}),(0,t.jsx)(tr.Tooltip,{formatter:e=>A(e),contentStyle:{color:"#000"}})]})})})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,t.jsx)(s.CardTitle,{className:"text-base text-black",children:"Payment Methods"}),(0,t.jsx)(s.CardDescription,{className:"text-xs text-black/70",children:"Payment breakdown"})]}),(0,t.jsx)(s.CardContent,{className:"pt-2",children:(0,t.jsx)(tn.ResponsiveContainer,{width:"100%",height:220,children:(0,t.jsxs)(U,{children:[(0,t.jsx)(e3,{data:Object.entries(O.reduce((e,t)=>{let a,r="mpesa"===(a=(t.payment_method||"cash").toLowerCase())||"m-pesa"===a||"mobile_money"===a?"Mobile Money":"card"===a?"Card":"credit"===a?"Credit":"Cash";return e[r]=(e[r]||0)+t.total_amount,e},{})).map(([e,t])=>({name:e,value:t})),cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{cx:a,cy:r,midAngle:n,innerRadius:l,outerRadius:s,percent:i,name:o}=e,c=l+(s-l)*.5,d=a+c*Math.cos(-(Math.PI/180*n)),u=r+c*Math.sin(-(Math.PI/180*n));return(0,t.jsx)("text",{x:d,y:u,fill:"#000000",textAnchor:d>a?"start":"end",dominantBaseline:"central",fontSize:"11",fontWeight:"500",children:`${"Mobile Money"===o?"M.Money":o} ${(100*i).toFixed(0)}%`})},outerRadius:70,fill:"#8884d8",dataKey:"value",children:(r={Cash:"#3A7085","Mobile Money":"#008C51",Card:"#F59E0B",Credit:"#EF4444"},Object.keys(O.reduce((e,t)=>{let a,r="mpesa"===(a=(t.payment_method||"cash").toLowerCase())||"m-pesa"===a||"mobile_money"===a?"Mobile Money":"card"===a?"Card":"credit"===a?"Credit":"Cash";return e[r]=(e[r]||0)+t.total_amount,e},{})).map((e,a)=>(0,t.jsx)(eN.Cell,{fill:r[e]||"#6B7280"},`cell-${a}`)))}),(0,t.jsx)(tr.Tooltip,{formatter:e=>A(e),contentStyle:{color:"#000"}})]})})})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,t.jsx)(s.CardTitle,{className:"text-base text-black",children:"Loyalty Program"}),(0,t.jsx)(s.CardDescription,{className:"text-xs text-black/70",children:"Loyalty vs Walk-in sales"})]}),(0,t.jsx)(s.CardContent,{className:"pt-2",children:(0,t.jsx)(tn.ResponsiveContainer,{width:"100%",height:220,children:(0,t.jsxs)(U,{children:[(0,t.jsxs)(e3,{data:[{name:"Loyalty",value:O.filter(e=>e.is_loyalty_sale).reduce((e,t)=>e+t.total_amount,0)},{name:"Walk-in",value:O.filter(e=>!e.is_loyalty_sale).reduce((e,t)=>e+t.total_amount,0)}],cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{cx:a,cy:r,midAngle:n,innerRadius:l,outerRadius:s,percent:i,name:o}=e,c=l+(s-l)*.5,d=a+c*Math.cos(-(Math.PI/180*n)),u=r+c*Math.sin(-(Math.PI/180*n));return(0,t.jsx)("text",{x:d,y:u,fill:"#000000",textAnchor:d>a?"start":"end",dominantBaseline:"central",fontSize:"11",fontWeight:"500",children:`${o} ${(100*i).toFixed(0)}%`})},outerRadius:70,fill:"#8884d8",dataKey:"value",children:[(0,t.jsx)(eN.Cell,{fill:"#C8A2C8"}),(0,t.jsx)(eN.Cell,{fill:"#87CEEB"})]}),(0,t.jsx)(tr.Tooltip,{formatter:e=>A(e),contentStyle:{color:"#000"}})]})})})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,t.jsx)(s.CardTitle,{className:"text-base text-black",children:"Revenue vs VAT"}),(0,t.jsx)(s.CardDescription,{className:"text-xs text-black/70",children:"Month-to-date comparison"})]}),(0,t.jsx)(s.CardContent,{className:"pt-2",children:(0,t.jsx)(tn.ResponsiveContainer,{width:"100%",height:220,children:(0,t.jsxs)(e8.BarChart,{data:(y=new Date((n=new Date).getFullYear(),n.getMonth(),1),[{name:"Revenue",value:f=O.filter(e=>new Date(e.sale_date)>=y).reduce((e,t)=>e+t.total_amount,0)},{name:"VAT",value:.16*f}]),margin:{top:5,right:5,left:5,bottom:5},children:[(0,t.jsx)(ta.CartesianGrid,{strokeDasharray:"3 3"}),(0,t.jsx)(te.XAxis,{dataKey:"name",tick:{fill:"#000",fontSize:11}}),(0,t.jsx)(tt.YAxis,{tick:{fill:"#000",fontSize:10}}),(0,t.jsx)(tr.Tooltip,{formatter:e=>A(e),contentStyle:{color:"#000"}}),(0,t.jsxs)(e9.Bar,{dataKey:"value",children:[(0,t.jsx)(eN.Cell,{fill:"#15426D"}),(0,t.jsx)(eN.Cell,{fill:"#D55402"})]})]})})})]})]}),(0,t.jsxs)(s.Card,{className:"rounded-2xl md:col-span-2",children:[(0,t.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,t.jsx)(s.CardTitle,{className:"text-base text-black",children:"Daily Sales Trend"}),(0,t.jsx)(s.CardDescription,{className:"text-xs text-black/70",children:"Sales per product over 7 days"})]}),(0,t.jsx)(s.CardContent,{className:"pt-2",children:(0,t.jsx)(tn.ResponsiveContainer,{width:"100%",height:220,children:(0,t.jsxs)(tl.LineChart,{data:(()=>{let e=[];for(let t=6;t>=0;t--){let a=new Date;a.setDate(a.getDate()-t);let r=a.toISOString().split("T")[0],n={date:r};[...new Set(O.map(e=>e.fuel_type))].forEach(e=>{let t=O.filter(t=>t.sale_date.startsWith(r)&&t.fuel_type===e).reduce((e,t)=>e+t.total_amount,0);n[e]=t}),e.push(n)}return e})(),margin:{top:5,right:10,left:0,bottom:5},children:[(0,t.jsx)(ta.CartesianGrid,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,t.jsx)(te.XAxis,{dataKey:"date",tick:{fontSize:10,fill:"#000"},tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),(0,t.jsx)(tt.YAxis,{tick:{fontSize:11,fill:"#000"}}),(0,t.jsx)(tr.Tooltip,{formatter:e=>A(e),contentStyle:{color:"#000"},labelFormatter:e=>new Date(e).toLocaleDateString()}),[...new Set(O.map(e=>e.fuel_type))].map(e=>{let a={Diesel:"#FFFF00",Petrol:"#FF0000",Unleaded:"#FF0000",Super:"#10B981"};return(0,t.jsx)(ts.Line,{type:"monotone",dataKey:e,stroke:a[e]||"#000",strokeWidth:2,dot:{fill:a[e]||"#000"},name:e},e)})]})})})]})]}),0===O.length&&!Z&&(0,t.jsx)(s.Card,{className:"rounded-2xl",children:(0,t.jsx)(s.CardContent,{className:"py-12 text-center",children:(0,t.jsx)("p",{className:"text-slate-500",children:"No sales data available. Start a shift and record sales to see performance metrics."})})}),(0,t.jsx)(l.Dialog,{open:er,onOpenChange:en,children:(0,t.jsxs)(l.DialogContent,{className:"max-h-[90vh] overflow-hidden flex flex-col",children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsx)(l.DialogTitle,{children:"start"===el?"Start New Shift":"End Current Shift"}),(0,t.jsx)(l.DialogDescription,{children:"start"===el?"Enter details to start a new shift":"Enter closing details to end the shift"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden",children:["start"===el&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"shift-date",children:"Date"}),(0,t.jsx)(o.Input,{id:"shift-date",type:"date",value:ef.date,onChange:e=>eg({...ef,date:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"shift-time",children:"Time"}),(0,t.jsx)(o.Input,{id:"shift-time",type:"time",value:ef.time,onChange:e=>eg({...ef,time:e.target.value})})]})]}),"end"===el&&q&&(0,t.jsx)(_.ScrollArea,{className:"h-[50vh]",children:(0,t.jsxs)("div",{className:"space-y-4 pr-4",children:[(0,t.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg space-y-2",children:[(0,t.jsx)("h4",{className:"font-semibold text-slate-700",children:"Shift Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-500",children:"Started:"}),(0,t.jsx)("span",{className:"ml-2 font-medium",children:eM})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-500",children:"Duration:"}),(0,t.jsxs)("span",{className:"ml-2 font-medium",children:[Math.round((Date.now()-new Date(q.start_time).getTime())/36e5),"h"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-500",children:"Opening Cash:"}),(0,t.jsxs)("span",{className:"ml-2 font-medium",children:["KES ",(q.opening_cash||0).toLocaleString()]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-500",children:"Total Sales:"}),(0,t.jsxs)("span",{className:"ml-2 font-medium text-green-600",children:["KES ",O.reduce((e,t)=>e+(parseFloat(t.total_amount)||0),0).toLocaleString()]})]})]})]}),P.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-slate-700",children:"Nozzle Meter Readings"}),(0,t.jsx)("div",{className:"grid gap-3",children:P.map(e=>{let a=T.find(t=>t.id===e.dispenser_id),r=J[e.id]||0;return(0,t.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"text-sm font-medium",children:[a?.name||"Dispenser"," - Nozzle ",e.nozzle_number]}),(0,t.jsxs)("p",{className:"text-xs text-slate-500 capitalize",children:[e.fuel_type," - Opening: ",r.toLocaleString()]})]}),(0,t.jsx)(o.Input,{type:"number",step:"0.01",min:r,placeholder:"Closing reading",className:"w-36",value:M[e.id]||"",onChange:t=>R({...M,[e.id]:t.target.value})})]}),M[e.id]&&parseFloat(M[e.id])<r&&(0,t.jsxs)("p",{className:"text-xs text-red-500",children:["Closing reading cannot be less than opening (",r,")"]})]},e.id)})})]}),I.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-slate-700",children:"Tank Closing Stock"}),(0,t.jsx)("div",{className:"grid gap-3",children:I.map(e=>{let a=W[e.id]||0,r=(parseFloat(B[e.id]||"0")||0)>a;return(0,t.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e.tank_name}),(0,t.jsxs)("p",{className:"text-xs text-slate-500 capitalize",children:[e.fuel_type," - Opening: ",a.toLocaleString()," L"]})]}),(0,t.jsx)(o.Input,{type:"number",step:"0.01",placeholder:"Closing stock (L)",className:"w-36",value:B[e.id]||"",onChange:t=>K({...B,[e.id]:t.target.value})})]}),r&&(0,t.jsxs)("div",{className:"flex items-center gap-2 pt-1 border-t border-slate-200",children:[(0,t.jsx)("span",{className:"text-xs text-amber-600 flex-1",children:"Stock increased - enter fuel received:"}),(0,t.jsx)(o.Input,{type:"number",step:"0.01",placeholder:"Stock received (L)",className:"w-36",value:V[e.id]||"",onChange:t=>$({...V,[e.id]:t.target.value})})]})]},e.id)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"closing-cash",children:"Closing Cash Amount"}),(0,t.jsx)(o.Input,{id:"closing-cash",type:"number",placeholder:"Enter actual cash in drawer",value:ef.closing_cash,onChange:e=>eg({...ef,closing_cash:e.target.value})}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Enter the actual cash amount in the drawer to calculate variance"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"shift-notes",children:"Notes (Optional)"}),(0,t.jsx)(b.Textarea,{id:"shift-notes",placeholder:"Add any notes about this shift",value:ef.notes,onChange:e=>eg({...ef,notes:e.target.value})})]})]})}),"start"===el&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"shift-notes",children:"Notes (Optional)"}),(0,t.jsx)(b.Textarea,{id:"shift-notes",placeholder:"Add any notes about this shift",value:ef.notes,onChange:e=>eg({...ef,notes:e.target.value})})]})})]}),(0,t.jsxs)(l.DialogFooter,{className:"mt-4",children:[(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>en(!1),children:"Cancel"}),(0,t.jsx)(i.Button,{onClick:"start"===el?ez:eF,disabled:ev,children:"start"===el?"Start Shift":"End Shift"})]})]})}),(0,t.jsx)(l.Dialog,{open:et,onOpenChange:ea,children:(0,t.jsxs)(l.DialogContent,{className:"max-w-2xl",children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsx)(l.DialogTitle,{children:"Record Fuel Sale"}),(0,t.jsx)(l.DialogDescription,{children:"Enter sale details to record a new fuel transaction"})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),eT()},children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"nozzle",children:"Nozzle *"}),(0,t.jsxs)(d.Select,{value:ey.nozzle_id,onValueChange:e=>{let t=P.find(t=>t.id===e);ex({...ey,nozzle_id:e,fuel_type:t?.fuel_type||""})},children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Select nozzle"})}),(0,t.jsx)(d.SelectContent,{children:P.map(e=>{let a=T.find(t=>t.id===e.dispenser_id);return(0,t.jsxs)(d.SelectItem,{value:e.id,children:[a?`D${a.dispenser_number}N${e.nozzle_number}`:`Nozzle ${e.nozzle_number}`," - ",e.fuel_type]},e.id)})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"fuel-type",children:"Fuel Type *"}),(0,t.jsx)(o.Input,{id:"fuel-type",value:ey.fuel_type,readOnly:!0,className:"bg-slate-50"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"amount",children:"Amount (KES) *"}),(0,t.jsx)(o.Input,{id:"amount",type:"number",placeholder:"0.00",value:ey.amount,onChange:e=>ex({...ey,amount:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"payment-method",children:"Payment Method"}),(0,t.jsxs)(d.Select,{value:ey.payment_method,onValueChange:e=>ex({...ey,payment_method:e}),children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"cash",children:"Cash"}),(0,t.jsx)(d.SelectItem,{value:"mobile_money",children:"Mobile Money"}),(0,t.jsx)(d.SelectItem,{value:"card",children:"Card"}),(0,t.jsx)(d.SelectItem,{value:"credit",children:"Credit"})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"discount-type",children:"Discount Type"}),(0,t.jsxs)(d.Select,{value:ey.discount_type,onValueChange:e=>ex({...ey,discount_type:e}),children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"fixed",children:"Fixed Amount"}),(0,t.jsx)(d.SelectItem,{value:"percentage",children:"Percentage"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"discount-value",children:"Discount Value"}),(0,t.jsx)(o.Input,{id:"discount-value",type:"number",placeholder:"percentage"===ey.discount_type?"0%":"0.00",value:ey.discount_value,onChange:e=>ex({...ey,discount_value:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"customer-name",children:"Customer Name"}),(0,t.jsx)(o.Input,{id:"customer-name",placeholder:"Walk-in Customer",value:ey.customer_name,onChange:e=>ex({...ey,customer_name:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"vehicle-number",children:"Vehicle Number"}),(0,t.jsx)(o.Input,{id:"vehicle-number",placeholder:"KAA 123A",value:ey.vehicle_number,onChange:e=>ex({...ey,vehicle_number:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"is-loyalty",checked:ey.is_loyalty_sale,onChange:e=>ex({...ey,is_loyalty_sale:e.target.checked}),className:"h-4 w-4"}),(0,t.jsx)(c.Label,{htmlFor:"is-loyalty",children:"Loyalty Customer"})]}),ey.is_loyalty_sale&&(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{children:"Select Loyalty Customer"}),(0,t.jsxs)(C.Popover,{open:eu,onOpenChange:em,children:[(0,t.jsx)(C.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[ey.loyalty_customer_name||"Select customer...",(0,t.jsx)(N.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,t.jsx)(C.PopoverContent,{className:"w-full p-0",children:(0,t.jsxs)(S.Command,{children:[(0,t.jsx)(S.CommandInput,{placeholder:"Search customer..."}),(0,t.jsxs)(S.CommandList,{children:[(0,t.jsx)(S.CommandEmpty,{children:"No customer found."}),(0,t.jsx)(S.CommandGroup,{children:ec.map(e=>(0,t.jsxs)(S.CommandItem,{value:e.name,onSelect:()=>{ex({...ey,loyalty_customer_name:e.name,loyalty_customer_pin:e.pin}),em(!1)},children:[(0,t.jsx)(w.Check,{className:(0,x.cn)("mr-2 h-4 w-4",ey.loyalty_customer_name===e.name?"opacity-100":"opacity-0")}),e.name," (",e.pin,")"]},e.id))})]})]})})]})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>ea(!1),children:"Cancel"}),(0,t.jsx)(i.Button,{type:"button",className:"flex-1 h-12 text-lg font-bold bg-green-600 hover:bg-green-700 text-white",disabled:Q,onClick:()=>eT(),children:Q?"Processing...":"SELL"})]})]})]})}),(0,t.jsx)(l.Dialog,{open:eb,onOpenChange:e_,children:(0,t.jsxs)(l.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsx)(l.DialogTitle,{children:"Issue Invoice"}),(0,t.jsx)(l.DialogDescription,{children:"Create and submit invoice to KRA eTIMS"})]}),ew&&(0,t.jsxs)(g,{variant:"destructive",className:"mb-4",children:[(0,t.jsx)(h.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(v,{children:ew})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"invoice-amount",children:"Amount (KES)"}),(0,t.jsx)(o.Input,{id:"invoice-amount",type:"number",placeholder:"Enter amount",value:eP.amount,onChange:e=>eE({...eP,amount:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"invoice-nozzle",children:"Nozzle"}),(0,t.jsxs)(d.Select,{value:eP.nozzle_id,onValueChange:e=>eE({...eP,nozzle_id:e}),children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Select nozzle"})}),(0,t.jsx)(d.SelectContent,{children:T.map(e=>{let a=P.filter(t=>t.dispenser_id===e.id);return 0===a.length?null:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"px-2 py-1 text-xs font-semibold text-gray-500",children:["Dispenser ",e.dispenser_number]}),a.map(e=>(0,t.jsxs)(d.SelectItem,{value:e.id,children:["Nozzle ",e.nozzle_number," - ",e.fuel_type]},e.id))]},e.id)})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"invoice-payment",children:"Payment Method"}),(0,t.jsxs)(d.Select,{value:eP.payment_method,onValueChange:e=>eE({...eP,payment_method:e}),children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Select payment method"})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"cash",children:"Cash"}),(0,t.jsx)(d.SelectItem,{value:"mpesa",children:"M-Pesa"}),(0,t.jsx)(d.SelectItem,{value:"card",children:"Card"}),(0,t.jsx)(d.SelectItem,{value:"credit",children:"Credit"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"invoice-discount-type",children:"Discount Type"}),(0,t.jsxs)(d.Select,{value:eP.discount_type,onValueChange:e=>eE({...eP,discount_type:e}),children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"fixed",children:"Fixed (KES)"}),(0,t.jsx)(d.SelectItem,{value:"percentage",children:"Percentage (%)"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"invoice-discount-value",children:"Discount Value"}),(0,t.jsx)(o.Input,{id:"invoice-discount-value",type:"number",placeholder:"0",value:eP.discount_value,onChange:e=>eE({...eP,discount_value:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"invoice-is-loyalty",checked:eP.is_loyalty_sale,onChange:e=>eE({...eP,is_loyalty_sale:e.target.checked}),className:"h-4 w-4"}),(0,t.jsx)(c.Label,{htmlFor:"invoice-is-loyalty",children:"Loyalty Customer"})]}),eP.is_loyalty_sale?(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{children:"Select Loyalty Customer"}),(0,t.jsxs)(C.Popover,{open:eO,onOpenChange:eD,children:[(0,t.jsx)(C.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[eP.loyalty_customer_name||"Select customer...",(0,t.jsx)(N.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,t.jsx)(C.PopoverContent,{className:"w-full p-0",children:(0,t.jsxs)(S.Command,{children:[(0,t.jsx)(S.CommandInput,{placeholder:"Search customer..."}),(0,t.jsxs)(S.CommandList,{children:[(0,t.jsx)(S.CommandEmpty,{children:"No customer found."}),(0,t.jsx)(S.CommandGroup,{children:ec.map(e=>(0,t.jsxs)(S.CommandItem,{value:e.name,onSelect:()=>{eE({...eP,loyalty_customer_id:e.id,loyalty_customer_name:e.name,loyalty_customer_pin:e.pin}),eD(!1)},children:[(0,t.jsx)(w.Check,{className:(0,x.cn)("mr-2 h-4 w-4",eP.loyalty_customer_name===e.name?"opacity-100":"opacity-0")}),e.name," (",e.pin,")"]},e.id))})]})]})})]})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"invoice-customer-pin",children:"Customer KRA PIN (Optional)"}),(0,t.jsx)(o.Input,{id:"invoice-customer-pin",placeholder:"e.g., P0123456789A",value:eP.customer_pin,onChange:e=>eE({...eP,customer_pin:e.target.value})})]})]}),(0,t.jsxs)(l.DialogFooter,{className:"mt-4",children:[(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>e_(!1),children:"Cancel"}),(0,t.jsx)(i.Button,{onClick:eR,disabled:eS,className:"bg-blue-600 hover:bg-blue-700",children:eS?"Processing...":"Submit Invoice"})]})]})})]})}function to(){let[e,l]=(0,a.useState)(!1),[s,i]=(0,a.useState)(!1);return(0,t.jsxs)("div",{className:"flex min-h-screen bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,t.jsx)(r.DashboardSidebar,{collapsed:e,onToggle:()=>l(!e),mobileOpen:s,onMobileClose:()=>i(!1)}),(0,t.jsx)("div",{className:"flex-1 flex flex-col lg:ml-8 my-0 lg:my-6 mr-0 lg:mr-6 relative z-10",children:(0,t.jsxs)("div",{className:"bg-white lg:rounded-tl-3xl shadow-2xl flex-1 flex flex-col overflow-hidden",children:[(0,t.jsx)(n.DashboardHeader,{onMobileMenuToggle:()=>i(!s)}),(0,t.jsx)("main",{className:"flex-1 overflow-y-auto bg-slate-50 p-4 lg:p-6 pointer-events-auto",children:(0,t.jsxs)("div",{className:"mx-auto max-w-7xl space-y-6",children:[(0,t.jsx)(ti,{}),(0,t.jsxs)("footer",{className:"mt-12 border-t pt-6 pb-4 text-center text-sm text-muted-foreground",children:["Powered by ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:"Sensile Technologies East Africa Ltd"})]})]})})]})})]})}e.s(["default",()=>to],69004)}]);