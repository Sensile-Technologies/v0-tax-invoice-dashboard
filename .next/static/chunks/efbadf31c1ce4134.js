(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20800,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(32219),r=e.i(22623),n=e.i(67881),l=e.i(70065),i=e.i(23750),d=e.i(10708),c=e.i(47627),o=e.i(25652),h=e.i(75254);let x=(0,h.default)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);var u=e.i(55436);e.i(99602),(0,h.default)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),(0,h.default)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var m=e.i(22858),j=e.i(78583),p=e.i(16715),g=e.i(12426),f=e.i(33541),b=e.i(62870),N=e.i(30374);let y=(0,h.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var v=e.i(7233),_=e.i(88844),C=e.i(27612),k=e.i(94179),w=e.i(70319);function S({branchId:e}){let[t,r]=(0,a.useState)([]),[c,o]=(0,a.useState)([]),[h,x]=(0,a.useState)([]),[u,j]=(0,a.useState)([]),[p,g]=(0,a.useState)(!0),[f,S]=(0,a.useState)(!1),[T,z]=(0,a.useState)(!1),[D,I]=(0,a.useState)(!1),[B,L]=(0,a.useState)(null),[H,P]=(0,a.useState)(null),[F,E]=(0,a.useState)([]),[A,O]=(0,a.useState)(!1),[R,M]=(0,a.useState)({quantity:"",reason:"",requestedBy:""}),[$,q]=(0,a.useState)({toTankId:"",toBranchId:e,quantity:"",notes:"",requestedBy:""}),[V,U]=(0,a.useState)({tankName:"",fuelType:"Petrol",capacity:"",initialStock:""});(0,a.useEffect)(()=>{e&&(K(),Q(),G(),Y())},[e]),(0,a.useEffect)(()=>{$.toBranchId&&$.toBranchId!==e?J($.toBranchId):$.toBranchId===e&&E(t)},[$.toBranchId,e,t]);let J=async e=>{O(!0);try{let s=await fetch(`/api/tanks?branch_id=${e}`),a=await s.json();a.success?E(a.data||[]):E([])}catch(e){console.error("Error fetching destination tanks:",e),E([])}finally{O(!1)}},K=async()=>{g(!0);try{let s=await fetch(`/api/tanks?branch_id=${e}`),a=await s.json();if(!a.success){console.error("Error fetching tanks:",a.error),g(!1);return}let[t,n]=await Promise.all([fetch(`/api/dispensers?branch_id=${e}`),fetch(`/api/nozzles?branch_id=${e}`)]),l=await t.json(),i=await n.json(),d=l.success?l.data:[],c=i.success?i.data:[],o=(a.data||[]).map(e=>({...e,dispensers:d.filter(s=>{let a=s.tank_ids||[];return a.includes(e.id)||s.tank_id===e.id||!s.tank_id&&!a.length&&s.fuel_type===e.fuel_type}),nozzles:c.filter(s=>s.fuel_type===e.fuel_type)}));r(o)}catch(e){console.error("Error fetching tanks:",e)}finally{g(!1)}},Q=async()=>{try{let e=await fetch("/api/branches"),s=await e.json();s.success&&o(s.data||[])}catch(e){console.error("Error fetching branches:",e)}},G=async()=>{try{let s=await fetch(`/api/branch-items?branchId=${e}`),a=await s.json();if(a.success){let e=(a.items||[]).filter(e=>e.is_assigned||e.branch_item_id).map(e=>({id:e.item_id,item_name:e.item_name,item_code:e.item_code,item_type:e.item_type}));x(e)}}catch(e){console.error("Error fetching items:",e)}},Y=async()=>{try{let s=await fetch(`/api/stock-transfers?branch_id=${e}`),a=await s.json();if(a.success){let s=(a.data||[]).filter(s=>s.to_branch_id===e&&("pending"===s.status||!s.status&&"pending"===s.approval_status)),t=await Promise.all(s.map(async e=>{let s="Unknown Branch",a="Unknown Tank",t=await fetch(`/api/branches?id=${e.from_branch_id}`),r=await t.json();r.success&&r.data?.length>0&&(s=r.data[0].name);let n=await fetch(`/api/tanks?branch_id=${e.from_branch_id}`),l=await n.json();if(l.success){let s=l.data.find(s=>s.id===e.from_tank_id);s&&(a=s.tank_name)}return{...e,from_branch_name:s,from_tank_name:a}}));j(t)}}catch(e){console.error("Error fetching pending transfers:",e)}},W=async e=>{P(e);try{let s=await fetch("/api/stock-transfers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({transfer_id:e,action:"accept",approved_by:"Branch User"})}),a=await s.json();s.ok&&a.success?(w.toast.success(`Transfer accepted. New stock: ${a.data.newStock} litres`),K(),Y(),S(!1)):w.toast.error(a.error||"Error accepting transfer")}catch(e){console.error("Error accepting transfer:",e),w.toast.error("Error accepting transfer")}finally{P(null)}},X=async e=>{try{let s=await fetch("/api/stock-transfers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({transfer_id:e,action:"reject",approved_by:"Branch User"})}),a=await s.json();s.ok&&a.success?(w.toast.info("Transfer rejected"),Y()):w.toast.error(a.error||"Error rejecting transfer")}catch(e){console.error("Error rejecting transfer:",e),w.toast.error("Error rejecting transfer")}},Z=async(e,s)=>{try{(await fetch("/api/tanks",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,item_id:s})})).ok?(w.toast.success("Item mapped to tank successfully"),K()):w.toast.error("Failed to map item to tank")}catch(e){console.error("Error updating tank item:",e),w.toast.error("Failed to map item to tank")}},ee=async()=>{if(!B)return;let s=Number.parseFloat($.quantity);try{if(!(await fetch("/api/stock-transfers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from_tank_id:B.id,to_tank_id:$.toTankId,from_branch_id:e,to_branch_id:$.toBranchId,quantity:s,requested_by:$.requestedBy,notes:$.notes,approval_status:"pending"})})).ok)return void console.error("Error creating transfer");w.toast.success("Transfer request submitted. Awaiting approval at destination branch."),z(!1),q({toTankId:"",toBranchId:e,quantity:"",notes:"",requestedBy:""}),K()}catch(e){console.error("Error creating transfer:",e)}},es=async()=>{if(e)try{(await fetch("/api/tanks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:e,tank_name:V.tankName,fuel_type:V.fuelType,capacity:Number.parseFloat(V.capacity),current_stock:Number.parseFloat(V.initialStock||"0"),status:"active"})})).ok?(w.toast.success(`Tank ${V.tankName} added successfully`),I(!1),U({tankName:"",fuelType:"Petrol",capacity:"",initialStock:""}),K()):(console.error("Error adding tank"),w.toast.error("Failed to add tank"))}catch(e){console.error("Error adding tank:",e),w.toast.error("Failed to add tank")}},ea=async e=>{if(confirm(`Are you sure you want to delete "${e.tank_name}"? This action cannot be undone.`))try{let s=await fetch(`/api/tanks?id=${e.id}`,{method:"DELETE"});if(s.ok)w.toast.success(`Tank "${e.tank_name}" deleted successfully`),K();else{let e=await s.json();w.toast.error(e.error||"Failed to delete tank")}}catch(e){console.error("Error deleting tank:",e),w.toast.error("Failed to delete tank")}};return e?p?(0,s.jsx)("div",{className:"p-6",children:"Loading tank management..."}):(0,s.jsxs)("div",{className:"space-y-6 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Tank Management"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage fuel tanks, stock levels, and transfers"})]}),(0,s.jsxs)(n.Button,{onClick:()=>I(!0),className:"rounded-xl",children:[(0,s.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Add New Tank"]})]}),(0,s.jsx)("div",{className:"grid gap-4",children:t.map(e=>{let a,t=Number.parseFloat((e.current_stock/e.capacity*100).toFixed(1)),r=t<20?"critical":t<50?"low":"normal";return(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,s.jsx)(m.Fuel,{className:"h-5 w-5 text-primary"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.CardTitle,{className:"text-lg",children:e.tank_name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.fuel_type})]})]}),(0,s.jsxs)(k.Badge,{variant:"critical"===r?"destructive":"low"===r?"secondary":"default",children:[t,"% Full"]})]})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Capacity"}),(0,s.jsxs)("p",{className:"text-lg font-semibold",children:[e.capacity.toLocaleString()," L"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Current Stock"}),(0,s.jsxs)("p",{className:"text-lg font-semibold",children:[e.current_stock.toLocaleString()," L"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Available Space"}),(0,s.jsxs)("p",{className:"text-lg font-semibold",children:[(e.capacity-e.current_stock).toLocaleString()," L"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Linked Item"}),(0,s.jsxs)(b.Select,{value:e.item_id||"none",onValueChange:s=>Z(e.id,"none"===s?null:s),children:[(0,s.jsx)(b.SelectTrigger,{className:"h-8 rounded-lg text-sm",children:(0,s.jsx)(b.SelectValue,{placeholder:"Select item"})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"none",children:"No item linked"}),h.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:e.item_name},e.id))]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Serving Dispensers/Nozzles"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[e.dispensers?.map(e=>(0,s.jsxs)(k.Badge,{variant:"outline",children:["D",e.dispenser_number]},e.id)),e.nozzles?.map(e=>(0,s.jsxs)(k.Badge,{variant:"outline",children:["N",e.nozzle_number]},e.id)),!e.dispensers?.length&&!e.nozzles?.length&&(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"No dispensers/nozzles assigned"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(a=u.filter(s=>s.to_tank_id===e.id),(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>{L(e),S(!0)},className:"rounded-xl relative",disabled:0===a.length,title:0===a.length?"No pending transfers to accept":`${a.length} pending transfer(s)`,children:[(0,s.jsx)(_.Package,{className:"h-4 w-4 mr-2"}),"Accept Transfer",a.length>0&&(0,s.jsx)(k.Badge,{className:"ml-2 h-5 min-w-5 bg-orange-500 text-white text-xs",children:a.length})]})),(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>{L(e),z(!0)},className:"rounded-xl",children:[(0,s.jsx)(y,{className:"h-4 w-4 mr-2"}),"Transfer Stock"]}),(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>ea(e),className:"rounded-xl text-red-600 hover:text-red-700 hover:bg-red-50",children:[(0,s.jsx)(C.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]},e.id)})}),(0,s.jsx)(N.Dialog,{open:f,onOpenChange:S,children:(0,s.jsxs)(N.DialogContent,{className:"rounded-2xl max-w-lg",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Accept Stock Transfer"}),(0,s.jsxs)(N.DialogDescription,{children:["Accept incoming stock transfers for ",B?.tank_name,". Stock can only be received via approved transfers from other branches."]})]}),(0,s.jsx)("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:B&&0===u.filter(e=>e.to_tank_id===B.id).length?(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(_.Package,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No pending transfers for this tank"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:"Transfers must be initiated from another branch"})]}):B&&u.filter(e=>e.to_tank_id===B.id).map(e=>(0,s.jsx)(l.Card,{className:"rounded-xl",children:(0,s.jsx)(l.CardContent,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"font-medium",children:[Number(e.quantity).toLocaleString()," litres"]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["From: ",e.from_branch_name," - ",e.from_tank_name]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Requested by: ",e.requested_by||"Unknown"]}),e.notes&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Notes: ",e.notes]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[new Date(e.created_at).toLocaleDateString()," ",new Date(e.created_at).toLocaleTimeString()]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(n.Button,{size:"sm",variant:"outline",onClick:()=>X(e.id),className:"rounded-lg text-red-600 hover:bg-red-50",children:"Reject"}),(0,s.jsx)(n.Button,{size:"sm",onClick:()=>W(e.id),disabled:H===e.id,className:"rounded-lg",children:H===e.id?"Accepting...":"Accept"})]})]})})},e.id))}),(0,s.jsx)(N.DialogFooter,{children:(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>S(!1),className:"rounded-xl",children:"Close"})})]})}),(0,s.jsx)(N.Dialog,{open:T,onOpenChange:z,children:(0,s.jsxs)(N.DialogContent,{className:"rounded-2xl",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Transfer Stock"}),(0,s.jsxs)(N.DialogDescription,{children:["Transfer stock from ",B?.tank_name," to another tank"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Destination Branch"}),(0,s.jsxs)(b.Select,{value:$.toBranchId||void 0,onValueChange:e=>q({...$,toBranchId:e,toTankId:""}),children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{placeholder:"Select branch"})}),(0,s.jsx)(b.SelectContent,{children:c.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Destination Tank"}),(0,s.jsxs)(b.Select,{value:$.toTankId,onValueChange:e=>q({...$,toTankId:e}),disabled:A,children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{placeholder:A?"Loading tanks...":"Select tank"})}),(0,s.jsxs)(b.SelectContent,{children:[F.filter(e=>e.id!==B?.id&&e.fuel_type===B?.fuel_type).map(e=>(0,s.jsxs)(b.SelectItem,{value:e.id,children:[e.tank_name," (",e.fuel_type,")"]},e.id)),0===F.filter(e=>e.id!==B?.id&&e.fuel_type===B?.fuel_type).length&&!A&&(0,s.jsx)("div",{className:"px-2 py-1 text-sm text-muted-foreground",children:"No matching tanks found"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Quantity to Transfer (Litres)"}),(0,s.jsx)(i.Input,{type:"number",placeholder:"e.g., 1000",value:$.quantity,onChange:e=>q({...$,quantity:e.target.value}),className:"rounded-xl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Transfer Notes"}),(0,s.jsx)(i.Input,{placeholder:"Reason for transfer",value:$.notes,onChange:e=>q({...$,notes:e.target.value}),className:"rounded-xl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Requested By"}),(0,s.jsx)(i.Input,{placeholder:"Your name",value:$.requestedBy,onChange:e=>q({...$,requestedBy:e.target.value}),className:"rounded-xl"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"This transfer requires approval before taking effect."})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>z(!1),className:"rounded-xl",children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:ee,className:"rounded-xl",children:"Submit Transfer Request"})]})]})}),(0,s.jsx)(N.Dialog,{open:D,onOpenChange:I,children:(0,s.jsxs)(N.DialogContent,{className:"rounded-2xl",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Add New Tank"}),(0,s.jsx)(N.DialogDescription,{children:"Add a new fuel tank to this branch"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Tank Name"}),(0,s.jsx)(i.Input,{placeholder:"e.g., Tank 03",value:V.tankName,onChange:e=>U({...V,tankName:e.target.value}),className:"rounded-xl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Fuel Type"}),(0,s.jsxs)(b.Select,{value:V.fuelType,onValueChange:e=>U({...V,fuelType:e}),children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"Petrol",children:"Petrol"}),(0,s.jsx)(b.SelectItem,{value:"Diesel",children:"Diesel"}),(0,s.jsx)(b.SelectItem,{value:"Kerosene",children:"Kerosene"}),(0,s.jsx)(b.SelectItem,{value:"Super",children:"Super"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Tank Capacity (Litres)"}),(0,s.jsx)(i.Input,{type:"number",placeholder:"e.g., 10000",value:V.capacity,onChange:e=>U({...V,capacity:e.target.value}),className:"rounded-xl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Initial Stock (Litres)"}),(0,s.jsx)(i.Input,{type:"number",placeholder:"e.g., 5000",value:V.initialStock,onChange:e=>U({...V,initialStock:e.target.value}),className:"rounded-xl"})]})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>I(!1),className:"rounded-xl",children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:es,className:"rounded-xl",children:"Add Tank"})]})]})})]}):(0,s.jsx)("div",{className:"p-6 text-center",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Please select a branch to view tank management."})})}var T=e.i(88511);function z({branchId:e}){let[t,r]=(0,a.useState)([]),[o,h]=(0,a.useState)([]),[x,u]=(0,a.useState)(!0),[j,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!1),[y,_]=(0,a.useState)(null),[S,z]=(0,a.useState)({dispenser_id:"",nozzle_number:"1",fuel_type:"Diesel",initial_meter_reading:"0"});(0,a.useEffect)(()=>{e&&D()},[e]);let D=async()=>{u(!0);try{let[s,a]=await Promise.all([fetch(`/api/nozzles?branch_id=${e}`),fetch(`/api/dispensers?branch_id=${e}`)]),t=await s.json(),n=await a.json();t.success&&r(t.data||[]),n.success&&h(n.data||[])}catch(e){console.error("Error fetching data:",e),w.toast.error("Failed to load nozzles")}finally{u(!1)}},I=async()=>{if(!S.dispenser_id)return void w.toast.error("Please select a dispenser");try{let s=await fetch("/api/nozzles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:e,dispenser_id:S.dispenser_id,nozzle_number:parseInt(S.nozzle_number),fuel_type:S.fuel_type,initial_meter_reading:parseFloat(S.initial_meter_reading)||0,status:"active"})}),a=await s.json();a.success?(w.toast.success("Nozzle added successfully"),p(!1),H(),D()):w.toast.error(a.error||"Failed to add nozzle")}catch(e){console.error("Error adding nozzle:",e),w.toast.error("Failed to add nozzle")}},B=async()=>{if(y)try{let e=await fetch("/api/nozzles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:y.id,dispenser_id:S.dispenser_id,nozzle_number:parseInt(S.nozzle_number),fuel_type:S.fuel_type,status:y.status,initial_meter_reading:parseFloat(S.initial_meter_reading)||0})}),s=await e.json();s.success?(w.toast.success("Nozzle updated successfully"),f(!1),_(null),H(),D()):w.toast.error(s.error||"Failed to update nozzle")}catch(e){console.error("Error updating nozzle:",e),w.toast.error("Failed to update nozzle")}},L=async e=>{if(confirm(`Are you sure you want to delete nozzle D${e.dispenser_number}N${e.nozzle_number}?`))try{let s=await fetch("/api/nozzles",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}),a=await s.json();a.success?(w.toast.success("Nozzle deleted successfully"),D()):w.toast.error(a.error||"Failed to delete nozzle")}catch(e){console.error("Error deleting nozzle:",e),w.toast.error("Failed to delete nozzle")}},H=()=>{z({dispenser_id:"",nozzle_number:"1",fuel_type:"Diesel",initial_meter_reading:"0"})},P=e=>`D${e.dispenser_number} - ${e.fuel_type||"Unknown"} (${e.tank_name||"No tank"})`;return e?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Fuel,{className:"h-5 w-5"}),"Nozzle Management"]}),(0,s.jsxs)(n.Button,{onClick:()=>{H(),p(!0)},children:[(0,s.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Add Nozzle"]})]}),(0,s.jsx)(l.CardContent,{children:x?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading nozzles..."}):0===t.length?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No nozzles found. Click "Add Nozzle" to create one.'}):(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"Nozzle"}),(0,s.jsx)(c.TableHead,{children:"Dispenser"}),(0,s.jsx)(c.TableHead,{children:"Fuel Type"}),(0,s.jsx)(c.TableHead,{children:"Status"}),(0,s.jsx)(c.TableHead,{children:"Current Meter Reading"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(c.TableBody,{children:t.map(e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsxs)(c.TableCell,{className:"font-medium",children:["D",e.dispenser_number,"N",e.nozzle_number]}),(0,s.jsxs)(c.TableCell,{children:["Dispenser ",e.dispenser_number]}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(k.Badge,{variant:"Diesel"===e.fuel_type?"default":"secondary",children:e.fuel_type})}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(k.Badge,{variant:"active"===e.status?"default":"destructive",children:e.status})}),(0,s.jsx)(c.TableCell,{children:e.initial_meter_reading?.toLocaleString()||0}),(0,s.jsxs)(c.TableCell,{className:"text-right",children:[(0,s.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>{_(e),z({dispenser_id:e.dispenser_id,nozzle_number:e.nozzle_number.toString(),fuel_type:e.fuel_type,initial_meter_reading:(e.initial_meter_reading||0).toString()}),f(!0)},children:(0,s.jsx)(T.Edit,{className:"h-4 w-4"})}),(0,s.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>L(e),children:(0,s.jsx)(C.Trash2,{className:"h-4 w-4 text-red-500"})})]})]},e.id))})]})})]}),(0,s.jsx)(N.Dialog,{open:j,onOpenChange:p,children:(0,s.jsxs)(N.DialogContent,{children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Add New Nozzle"}),(0,s.jsx)(N.DialogDescription,{children:"Add a nozzle to a dispenser. The nozzle will be used for recording sales."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Dispenser"}),(0,s.jsxs)(b.Select,{value:S.dispenser_id,onValueChange:e=>z({...S,dispenser_id:e}),children:[(0,s.jsx)(b.SelectTrigger,{children:(0,s.jsx)(b.SelectValue,{placeholder:"Select dispenser"})}),(0,s.jsx)(b.SelectContent,{children:o.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:P(e)},e.id))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Nozzle Number"}),(0,s.jsx)(i.Input,{type:"number",min:"1",value:S.nozzle_number,onChange:e=>z({...S,nozzle_number:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Fuel Type"}),(0,s.jsxs)(b.Select,{value:S.fuel_type,onValueChange:e=>z({...S,fuel_type:e}),children:[(0,s.jsx)(b.SelectTrigger,{children:(0,s.jsx)(b.SelectValue,{})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"Diesel",children:"Diesel"}),(0,s.jsx)(b.SelectItem,{value:"Petrol",children:"Petrol"}),(0,s.jsx)(b.SelectItem,{value:"Kerosene",children:"Kerosene"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Current Meter Reading"}),(0,s.jsx)(i.Input,{type:"number",min:"0",value:S.initial_meter_reading,onChange:e=>z({...S,initial_meter_reading:e.target.value})})]})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:I,children:"Add Nozzle"})]})]})}),(0,s.jsx)(N.Dialog,{open:g,onOpenChange:f,children:(0,s.jsxs)(N.DialogContent,{children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Edit Nozzle"}),(0,s.jsx)(N.DialogDescription,{children:"Update nozzle details."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Dispenser"}),(0,s.jsxs)(b.Select,{value:S.dispenser_id,onValueChange:e=>z({...S,dispenser_id:e}),children:[(0,s.jsx)(b.SelectTrigger,{children:(0,s.jsx)(b.SelectValue,{placeholder:"Select dispenser"})}),(0,s.jsx)(b.SelectContent,{children:o.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:P(e)},e.id))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Nozzle Number"}),(0,s.jsx)(i.Input,{type:"number",min:"1",value:S.nozzle_number,onChange:e=>z({...S,nozzle_number:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Fuel Type"}),(0,s.jsxs)(b.Select,{value:S.fuel_type,onValueChange:e=>z({...S,fuel_type:e}),children:[(0,s.jsx)(b.SelectTrigger,{children:(0,s.jsx)(b.SelectValue,{})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"Diesel",children:"Diesel"}),(0,s.jsx)(b.SelectItem,{value:"Petrol",children:"Petrol"}),(0,s.jsx)(b.SelectItem,{value:"Kerosene",children:"Kerosene"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Current Meter Reading"}),(0,s.jsx)(i.Input,{type:"number",min:"0",value:S.initial_meter_reading,onChange:e=>z({...S,initial_meter_reading:e.target.value})})]})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:B,children:"Save Changes"})]})]})})]}):(0,s.jsx)(l.Card,{children:(0,s.jsx)(l.CardContent,{className:"p-6 text-center text-muted-foreground",children:"Please select a branch to manage nozzles"})})}var D=e.i(58524),I=e.i(25959);function B({branchId:e}){let[t,r]=(0,a.useState)([]),[o,h]=(0,a.useState)([]),[x,u]=(0,a.useState)(!0),[j,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!1),[y,_]=(0,a.useState)(!1),[S,z]=(0,a.useState)(!1),[B,L]=(0,a.useState)(null),[H,P]=(0,a.useState)([]),[F,E]=(0,a.useState)({dispenser_number:"",status:"active"}),[A,O]=(0,a.useState)([]);(0,a.useEffect)(()=>{e&&R()},[e]);let R=async()=>{u(!0);try{let[s,a]=await Promise.all([fetch(`/api/dispensers?branch_id=${e}`),fetch(`/api/tanks?branch_id=${e}`)]),t=await s.json(),n=await a.json();t.success&&r(t.data||[]),n.success&&h(n.data||[])}catch(e){console.error("Error fetching data:",e),w.toast.error("Failed to load dispensers")}finally{u(!1)}},M=async()=>{if(!F.dispenser_number)return void w.toast.error("Please enter a dispenser number");try{let s=await fetch("/api/dispensers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch_id:e,dispenser_number:parseInt(F.dispenser_number),fuel_type:"Pending",status:F.status,tank_ids:[]})}),a=await s.json();a.success?(w.toast.success("Dispenser added successfully. Now assign tanks to it."),p(!1),J(),R()):w.toast.error(a.error||"Failed to add dispenser")}catch(e){console.error("Error adding dispenser:",e),w.toast.error("Failed to add dispenser")}},$=async()=>{if(B)try{let s=await fetch("/api/dispensers/assign-tanks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dispenser_id:B.id,tank_ids:A,branch_id:e})}),a=await s.json();a.success?(_(!1),a.createdNozzles&&a.createdNozzles.length>0?(P(a.createdNozzles.map(e=>({...e,meter_reading:"0"}))),z(!0),w.toast.success(`Tanks assigned. Please enter meter readings for ${a.createdNozzles.length} new nozzle(s).`)):(w.toast.success("Tanks assigned successfully"),L(null),O([]),R())):w.toast.error(a.error||"Failed to assign tanks")}catch(e){console.error("Error assigning tanks:",e),w.toast.error("Failed to assign tanks")}},q=async()=>{for(let e of H){let s=parseFloat(e.meter_reading);if(isNaN(s)||s<0)return void w.toast.error(`Invalid meter reading for D${e.dispenser_number}N${e.nozzle_number}`)}try{let e=!1;for(let s of H){let a=await fetch("/api/nozzles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.id,initial_meter_reading:parseFloat(s.meter_reading)||0})});(await a.json()).success||(e=!0,w.toast.error(`Failed to save reading for D${s.dispenser_number}N${s.nozzle_number}`))}e||w.toast.success("Meter readings saved successfully"),z(!1),P([]),L(null),O([]),R()}catch(e){console.error("Error saving meter readings:",e),w.toast.error("Failed to save meter readings")}},V=async()=>{if(B)try{let e=await fetch("/api/dispensers",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:B.id,dispenser_number:parseInt(F.dispenser_number),status:F.status})}),s=await e.json();s.success?(w.toast.success("Dispenser updated successfully"),f(!1),L(null),J(),R()):w.toast.error(s.error||"Failed to update dispenser")}catch(e){console.error("Error updating dispenser:",e),w.toast.error("Failed to update dispenser")}},U=async e=>{if(confirm(`Are you sure you want to delete Dispenser ${e.dispenser_number}? This will also delete all associated nozzles.`))try{let s=await fetch("/api/dispensers",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}),a=await s.json();a.success?(w.toast.success("Dispenser deleted successfully"),R()):w.toast.error(a.error||"Failed to delete dispenser")}catch(e){console.error("Error deleting dispenser:",e),w.toast.error("Failed to delete dispenser")}},J=()=>{E({dispenser_number:"",status:"active"})},K=o.filter(e=>"active"===e.status);return x?(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Fuel,{className:"h-5 w-5"}),"Manage Dispensers"]})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading dispensers..."})})]}):(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Fuel,{className:"h-5 w-5"}),"Manage Dispensers"]}),(0,s.jsxs)(n.Button,{onClick:()=>p(!0),className:"rounded-xl",children:[(0,s.jsx)(v.Plus,{className:"mr-2 h-4 w-4"}),"Add Dispenser"]})]}),(0,s.jsx)(l.CardContent,{children:0===t.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:'No dispensers found. Click "Add Dispenser" to create one.'}):(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"Dispenser #"}),(0,s.jsx)(c.TableHead,{children:"Assigned Tanks"}),(0,s.jsx)(c.TableHead,{children:"Fuel Types"}),(0,s.jsx)(c.TableHead,{children:"Item"}),(0,s.jsx)(c.TableHead,{children:"Status"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(c.TableBody,{children:t.map(e=>{let a;return(0,s.jsxs)(c.TableRow,{children:[(0,s.jsxs)(c.TableCell,{className:"font-medium",children:["D",e.dispenser_number]}),(0,s.jsx)(c.TableCell,{children:0===(a=e.tank_ids||(e.tank_id?[e.tank_id]:[])).length?"None":o.filter(e=>a.includes(e.id)).map(e=>e.tank_name).join(", ")||"None"}),(0,s.jsx)(c.TableCell,{children:e.fuel_type||"Pending"}),(0,s.jsx)(c.TableCell,{children:e.item_name||"-"}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(k.Badge,{variant:"active"===e.status?"default":"secondary",children:e.status})}),(0,s.jsxs)(c.TableCell,{className:"text-right space-x-2",children:[(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>{L(e),O(e.tank_ids||(e.tank_id?[e.tank_id]:[])),_(!0)},className:"rounded-xl",children:[(0,s.jsx)(D.Link2,{className:"h-4 w-4 mr-1"}),"Assign Tanks"]}),(0,s.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>{L(e),E({dispenser_number:e.dispenser_number.toString(),status:e.status}),f(!0)},className:"rounded-xl",children:(0,s.jsx)(T.Edit,{className:"h-4 w-4"})}),(0,s.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>U(e),className:"rounded-xl text-red-500 hover:text-red-700",children:(0,s.jsx)(C.Trash2,{className:"h-4 w-4"})})]})]},e.id)})})]})}),(0,s.jsx)(N.Dialog,{open:j,onOpenChange:p,children:(0,s.jsxs)(N.DialogContent,{className:"rounded-2xl",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Add New Dispenser"}),(0,s.jsx)(N.DialogDescription,{children:"Create a new dispenser. After adding, assign tanks to it."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Dispenser Number"}),(0,s.jsx)(i.Input,{type:"number",placeholder:"e.g., 1",value:F.dispenser_number,onChange:e=>E({...F,dispenser_number:e.target.value}),className:"rounded-xl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Status"}),(0,s.jsxs)(b.Select,{value:F.status,onValueChange:e=>E({...F,status:e}),children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"active",children:"Active"}),(0,s.jsx)(b.SelectItem,{value:"inactive",children:"Inactive"}),(0,s.jsx)(b.SelectItem,{value:"maintenance",children:"Maintenance"})]})]})]})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>p(!1),className:"rounded-xl",children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:M,className:"rounded-xl",children:"Add Dispenser"})]})]})}),(0,s.jsx)(N.Dialog,{open:g,onOpenChange:f,children:(0,s.jsxs)(N.DialogContent,{className:"rounded-2xl",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Edit Dispenser"}),(0,s.jsx)(N.DialogDescription,{children:"Update dispenser details."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Dispenser Number"}),(0,s.jsx)(i.Input,{type:"number",value:F.dispenser_number,onChange:e=>E({...F,dispenser_number:e.target.value}),className:"rounded-xl"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Status"}),(0,s.jsxs)(b.Select,{value:F.status,onValueChange:e=>E({...F,status:e}),children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"active",children:"Active"}),(0,s.jsx)(b.SelectItem,{value:"inactive",children:"Inactive"}),(0,s.jsx)(b.SelectItem,{value:"maintenance",children:"Maintenance"})]})]})]})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>f(!1),className:"rounded-xl",children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:V,className:"rounded-xl",children:"Save Changes"})]})]})}),(0,s.jsx)(N.Dialog,{open:y,onOpenChange:_,children:(0,s.jsxs)(N.DialogContent,{className:"rounded-2xl",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsxs)(N.DialogTitle,{children:["Assign Tanks to Dispenser ",B?.dispenser_number]}),(0,s.jsx)(N.DialogDescription,{children:"Select tanks this dispenser will serve. Nozzles will be automatically created for each tank."})]}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{className:"mb-2 block",children:"Select Active Tanks"}),(0,s.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-3",children:0===K.length?(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"No active tanks available"}):K.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(I.Checkbox,{id:`assign-tank-${e.id}`,checked:A.includes(e.id),onCheckedChange:s=>{s?O([...A,e.id]):O(A.filter(s=>s!==e.id))}}),(0,s.jsxs)("label",{htmlFor:`assign-tank-${e.id}`,className:"text-sm cursor-pointer flex-1",children:[(0,s.jsx)("span",{className:"font-medium",children:e.tank_name}),(0,s.jsxs)("span",{className:"text-muted-foreground ml-2",children:["- ",e.fuel_type]}),e.item_id&&(0,s.jsx)("span",{className:"text-green-600 ml-2",children:"(Item linked)"})]})]},e.id))}),A.length>0&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:[A.length," tank(s) selected - ",A.length," nozzle(s) will be created"]})]})}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>{_(!1),O([])},className:"rounded-xl",children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:$,className:"rounded-xl",children:"Assign Tanks & Create Nozzles"})]})]})}),(0,s.jsx)(N.Dialog,{open:S,onOpenChange:z,children:(0,s.jsxs)(N.DialogContent,{className:"sm:max-w-[500px]",children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:"Enter Nozzle Meter Readings"}),(0,s.jsx)(N.DialogDescription,{children:"Enter the current meter readings for the newly created nozzles."})]}),(0,s.jsx)("div",{className:"space-y-4 max-h-[400px] overflow-y-auto",children:H.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("p",{className:"font-medium",children:["D",e.dispenser_number,"N",e.nozzle_number]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.tank_name," - ",e.fuel_type]})]}),(0,s.jsxs)("div",{className:"w-40",children:[(0,s.jsx)(d.Label,{className:"text-xs",children:"Meter Reading"}),(0,s.jsx)(i.Input,{type:"number",min:"0",step:"0.01",value:e.meter_reading,onChange:s=>{var a,t;return a=e.id,t=s.target.value,void P(e=>e.map(e=>e.id===a?{...e,meter_reading:t}:e))},placeholder:"0"})]})]},e.id))}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>{z(!1),P([]),L(null),O([]),R()},className:"rounded-xl",children:"Skip"}),(0,s.jsx)(n.Button,{onClick:q,className:"rounded-xl",children:"Save Meter Readings"})]})]})})]})}var L=e.i(19036),H=e.i(63415),P=e.i(23585);function F(){let[e,t]=(0,a.useState)([]),[r,o]=(0,a.useState)(!0),[h,x]=(0,a.useState)(""),[m,j]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[v,_]=(0,a.useState)(!1),[S,z]=(0,a.useState)(null),[D,I]=(0,a.useState)(""),{formatCurrency:B}=(0,f.useCurrency)(),[F,E]=(0,a.useState)({salePrice:"",purchasePrice:"",isAvailable:!0});(0,a.useEffect)(()=>{A()},[]),(0,a.useEffect)(()=>{S&&O()},[S]);let A=async()=>{try{let e=localStorage.getItem("selectedBranch");if(e){let s=JSON.parse(e);if(s.id){z(s.id),I(s.name||"");return}}let s=await fetch("/api/auth/session"),a=await s.json();if(a.success&&a.session?.branch_id){z(a.session.branch_id);let e=await fetch(`/api/branches/${a.session.branch_id}`),s=await e.json();s.success&&I(s.branch?.name||"")}else{let e=await fetch("/api/branches"),s=await e.json();if(s.success&&s.data?.length>0){let e=s.data[0];z(e.id),I(e.name)}}}catch(e){console.error("Error fetching branch:",e)}},O=async()=>{if(S){o(!0);try{let e=await fetch(`/api/branch-items?branchId=${S}`),s=await e.json();s.success?t(s.items||[]):w.toast.error(s.error||"Failed to fetch items")}catch(e){console.error("Error fetching branch items:",e),w.toast.error("Failed to fetch items")}finally{o(!1)}}},R=async()=>{if(b&&S){if(!F.salePrice)return void w.toast.error("Sale price is required");_(!0);try{if(b.is_assigned&&b.branch_item_id){let e=await fetch("/api/branch-items",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchItemId:b.branch_item_id,salePrice:parseFloat(F.salePrice),purchasePrice:F.purchasePrice?parseFloat(F.purchasePrice):null,isAvailable:F.isAvailable})}),s=await e.json();s.success?(w.toast.success("Item price updated"),j(!1),O()):w.toast.error(s.error||"Failed to update price")}else{let e=await fetch("/api/branch-items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchId:S,itemId:b.item_id,salePrice:parseFloat(F.salePrice),purchasePrice:F.purchasePrice?parseFloat(F.purchasePrice):null})}),s=await e.json();s.success?(w.toast.success("Item assigned to branch with custom pricing"),j(!1),O()):w.toast.error(s.error||"Failed to assign item")}}catch(e){console.error("Error saving price:",e),w.toast.error("Failed to save price")}finally{_(!1)}}},M=async e=>{if(e.branch_item_id&&confirm("Remove this item from the branch? This will make it unavailable for sales at this location."))try{let s=await fetch(`/api/branch-items?id=${e.branch_item_id}`,{method:"DELETE"}),a=await s.json();a.success?(w.toast.success("Item removed from branch"),O()):w.toast.error(a.error||"Failed to remove item")}catch(e){console.error("Error removing item:",e),w.toast.error("Failed to remove item")}},$=e.filter(e=>e.item_name.toLowerCase().includes(h.toLowerCase())||e.item_code.toLowerCase().includes(h.toLowerCase()));return S?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(l.Card,{className:"rounded-2xl shadow-lg border-2",children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(g.DollarSign,{className:"h-5 w-5"}),"Set Prices"]}),(0,s.jsxs)(l.CardDescription,{children:["Manage selling prices for items at ",D||"your branch"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[D&&(0,s.jsx)(k.Badge,{variant:"outline",className:"text-sm",children:D}),(0,s.jsxs)(n.Button,{variant:"outline",onClick:O,className:"rounded-xl",children:[(0,s.jsx)(p.RefreshCw,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(i.Input,{placeholder:"Search items...",value:h,onChange:e=>x(e.target.value),className:"pl-9 rounded-xl"})]})}),r?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading items..."}):0===$.length?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No items found. Add items in Item Management first."}):(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"Item Code"}),(0,s.jsx)(c.TableHead,{children:"Name"}),(0,s.jsx)(c.TableHead,{children:"Type"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Selling Price"}),(0,s.jsx)(c.TableHead,{children:"Status"}),(0,s.jsx)(c.TableHead,{className:"text-right w-[50px]"})]})}),(0,s.jsx)(c.TableBody,{children:$.map(e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{className:"font-mono text-sm",children:e.item_code}),(0,s.jsx)(c.TableCell,{className:"font-medium",children:e.item_name}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(k.Badge,{variant:"outline",className:"capitalize",children:e.item_type})}),(0,s.jsx)(c.TableCell,{className:"text-right font-medium",children:e.is_assigned&&null!==e.branch_sale_price?B(e.branch_sale_price):(0,s.jsx)("span",{className:"text-muted-foreground",children:"Not set"})}),(0,s.jsx)(c.TableCell,{children:e.is_assigned?!1!==e.is_available?(0,s.jsx)(k.Badge,{className:"bg-green-100 text-green-800",children:"Active"}):(0,s.jsx)(k.Badge,{className:"bg-gray-100 text-gray-800",children:"Disabled"}):(0,s.jsx)(k.Badge,{className:"bg-yellow-100 text-yellow-800",children:"Not Assigned"})}),(0,s.jsx)(c.TableCell,{className:"text-right",children:(0,s.jsxs)(H.DropdownMenu,{children:[(0,s.jsx)(H.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(n.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,s.jsx)(P.MoreVertical,{className:"h-4 w-4"})})}),(0,s.jsxs)(H.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(H.DropdownMenuItem,{onClick:()=>{y(e),E({salePrice:e.branch_sale_price?.toString()||"",purchasePrice:e.branch_purchase_price?.toString()||"",isAvailable:!1!==e.is_available}),j(!0)},children:[(0,s.jsx)(T.Edit,{className:"h-4 w-4 mr-2"}),e.is_assigned?"Edit Price":"Set Price"]}),e.is_assigned&&e.branch_item_id&&(0,s.jsxs)(H.DropdownMenuItem,{onClick:()=>M(e),className:"text-red-600",children:[(0,s.jsx)(C.Trash2,{className:"h-4 w-4 mr-2"}),"Remove from Branch"]})]})]})})]},e.item_id))})]})]})]}),(0,s.jsx)(N.Dialog,{open:m,onOpenChange:j,children:(0,s.jsxs)(N.DialogContent,{children:[(0,s.jsxs)(N.DialogHeader,{children:[(0,s.jsx)(N.DialogTitle,{children:b?.is_assigned?"Edit Selling Price":"Set Selling Price"}),(0,s.jsx)(N.DialogDescription,{children:b?.is_assigned?"Update the selling price for this item":"Set the selling price for this item at your branch"})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.Label,{className:"text-muted-foreground",children:"Item"}),(0,s.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,s.jsx)("p",{className:"font-medium",children:b?.item_name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:b?.item_code})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.Label,{htmlFor:"salePrice",children:"Selling Price *"}),(0,s.jsx)(i.Input,{id:"salePrice",type:"number",step:"0.01",value:F.salePrice,onChange:e=>E({...F,salePrice:e.target.value}),placeholder:"Enter selling price",className:"rounded-xl"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"This price is required for sales at this branch"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.Label,{htmlFor:"purchasePrice",children:"Purchase Price (Optional)"}),(0,s.jsx)(i.Input,{id:"purchasePrice",type:"number",step:"0.01",value:F.purchasePrice,onChange:e=>E({...F,purchasePrice:e.target.value}),placeholder:"Enter purchase price",className:"rounded-xl"})]}),b?.is_assigned&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(d.Label,{htmlFor:"isAvailable",children:"Item Available for Sale"}),(0,s.jsx)(L.Switch,{id:"isAvailable",checked:F.isAvailable,onCheckedChange:e=>E({...F,isAvailable:e})})]})]}),(0,s.jsxs)(N.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>j(!1),className:"rounded-xl",children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:R,disabled:v,className:"rounded-xl",children:v?"Saving...":"Save Price"})]})]})})]}):(0,s.jsx)(l.Card,{className:"rounded-2xl",children:(0,s.jsx)(l.CardContent,{className:"py-8 text-center text-muted-foreground",children:"Loading branch information..."})})}function E(){let[e,t]=(0,a.useState)("cards"),[r,h]=(0,a.useState)(""),[N,y]=(0,a.useState)(""),[v,_]=(0,a.useState)(""),[C,w]=(0,a.useState)(""),[T,D]=(0,a.useState)(null),{formatCurrency:I}=(0,f.useCurrency)(),[L,H]=(0,a.useState)([]),[P,E]=(0,a.useState)(""),[A,O]=(0,a.useState)([]),[R,M]=(0,a.useState)([]),[$,q]=(0,a.useState)(null),[V,U]=(0,a.useState)(!1);(0,a.useEffect)(()=>{J();try{let e=localStorage.getItem("selectedBranch");if(e){let s=JSON.parse(e);s.id&&E(s.id)}}catch{}},[]);let J=async()=>{try{let e=await fetch("/api/branches"),s=await e.json();s.success&&H(s.data||[])}catch(e){console.error("Error fetching branches:",e)}},K=(0,a.useCallback)(async()=>{if(P){U(!0);try{let e=`/api/stock-report?branch_id=${P}`;N&&(e+=`&start_date=${N}`),v&&(e+=`&end_date=${v}`);let s=await fetch(e),a=await s.json();a.success&&(O(a.data.summary||[]),M(a.data.movements||[]),q(a.data.totals||null))}catch(e){console.error("Error fetching stock report:",e)}finally{U(!1)}}},[P,N,v]);(0,a.useEffect)(()=>{("stockReport"===e||"stockIn"===e||"stockOut"===e)&&K()},[e,K]);let Q=R.filter(e=>"receive"===e.adjustment_type||"stock_receive"===e.adjustment_type||"addition"===e.adjustment_type||"increase"===e.adjustment_type||"purchase_receive"===e.adjustment_type||"manual_adjustment"===e.adjustment_type&&e.quantity>0||"transfer_in"===e.adjustment_type),G=R.filter(e=>"sale"===e.adjustment_type||"deduction"===e.adjustment_type||"decrease"===e.adjustment_type||"manual_adjustment"===e.adjustment_type&&e.quantity<0||"transfer_out"===e.adjustment_type||"transfer"===e.adjustment_type),Y=e=>new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),W=e=>({receive:"bg-green-100 text-green-800",stock_receive:"bg-green-100 text-green-800",addition:"bg-green-100 text-green-800",increase:"bg-green-100 text-green-800",purchase_receive:"bg-green-100 text-green-800",sale:"bg-blue-100 text-blue-800",deduction:"bg-red-100 text-red-800",decrease:"bg-red-100 text-red-800",manual_adjustment:"bg-yellow-100 text-yellow-800",transfer_in:"bg-purple-100 text-purple-800",transfer_out:"bg-orange-100 text-orange-800",transfer:"bg-orange-100 text-orange-800"})[e]||"bg-gray-100 text-gray-800";return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-balance",children:"Inventory Management"}),(0,s.jsx)("p",{className:"mt-1 text-muted-foreground text-pretty",children:"Monitor and manage your stock levels"})]})}),"cards"===e&&(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("stockReport"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Stock Report"}),(0,s.jsx)(j.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"View Report"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Per tank stock summary"})]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("stockIn"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Stock In History"}),(0,s.jsx)(o.TrendingUp,{className:"h-4 w-4 text-green-600"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[Q.length," Entries"]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Stock received & adjusted in"})]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("stockOut"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Stock Out History"}),(0,s.jsx)(x,{className:"h-4 w-4 text-red-600"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[G.length," Entries"]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Sales & deductions"})]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("tankManagement"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Tank Management"}),(0,s.jsx)(m.Fuel,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"Manage Tanks"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Stock levels & transfers"})]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("dispenserManagement"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Dispenser Management"}),(0,s.jsx)(m.Fuel,{className:"h-4 w-4 text-purple-600"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"Manage Dispensers"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Add dispensers & assign tanks"})]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("nozzleManagement"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Nozzle Management"}),(0,s.jsx)(m.Fuel,{className:"h-4 w-4 text-blue-600"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"Manage Nozzles"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Add & configure nozzles"})]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t("itemPricing"),children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Item Pricing"}),(0,s.jsx)(g.DollarSign,{className:"h-4 w-4 text-green-600"})]}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:"Set Prices"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Branch-specific item prices"})]})]})]}),"cards"===e&&$&&(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"Stock Summary"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-green-50 rounded-xl",children:[(0,s.jsx)("p",{className:"text-sm text-green-700",children:"Total Received"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-green-800",children:[$.total_received.toLocaleString()," L"]})]}),(0,s.jsxs)("div",{className:"p-4 bg-blue-50 rounded-xl",children:[(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"Total Sold"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-blue-800",children:[$.total_sold.toLocaleString()," L"]})]}),(0,s.jsxs)("div",{className:"p-4 bg-yellow-50 rounded-xl",children:[(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:"Adjusted In/Out"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-yellow-800",children:["+",$.total_adjusted_in.toLocaleString()," / -",$.total_adjusted_out.toLocaleString()," L"]})]}),(0,s.jsxs)("div",{className:"p-4 bg-purple-50 rounded-xl",children:[(0,s.jsx)("p",{className:"text-sm text-purple-700",children:"Current Stock"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-purple-800",children:[$.current_stock.toLocaleString()," L"]})]})]})})]}),"stockReport"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(n.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>t("cards"),children:" Back to Overview"}),(0,s.jsxs)(n.Button,{variant:"outline",className:"rounded-xl",onClick:K,disabled:V,children:[(0,s.jsx)(p.RefreshCw,{className:`h-4 w-4 mr-2 ${V?"animate-spin":""}`}),"Refresh"]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"Stock Report by Tank"})}),(0,s.jsxs)(l.CardContent,{children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"w-64",children:[(0,s.jsx)(d.Label,{children:"Branch"}),(0,s.jsxs)(b.Select,{value:P,onValueChange:E,children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{placeholder:"Select branch"})}),(0,s.jsx)(b.SelectContent,{children:L.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Start Date"}),(0,s.jsx)(i.Input,{type:"date",value:N,onChange:e=>y(e.target.value),className:"rounded-xl w-48"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"End Date"}),(0,s.jsx)(i.Input,{type:"date",value:v,onChange:e=>_(e.target.value),className:"rounded-xl w-48"})]})]}),V?(0,s.jsx)("div",{className:"text-center py-8",children:"Loading..."}):0===A.length?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:P?"No stock data found":"Select a branch to view report"}):(0,s.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"Tank"}),(0,s.jsx)(c.TableHead,{children:"Fuel Type"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Capacity"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Current Stock"}),(0,s.jsx)(c.TableHead,{className:"text-right text-green-700",children:"Received"}),(0,s.jsx)(c.TableHead,{className:"text-right text-yellow-700",children:"Adjusted +/-"}),(0,s.jsx)(c.TableHead,{className:"text-right text-blue-700",children:"Sold"}),(0,s.jsx)(c.TableHead,{className:"text-right text-purple-700",children:"Transferred In/Out"})]})}),(0,s.jsx)(c.TableBody,{children:A.map(e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{className:"font-medium",children:e.tank_name}),(0,s.jsx)(c.TableCell,{children:e.fuel_type}),(0,s.jsxs)(c.TableCell,{className:"text-right",children:[Number(e.capacity).toLocaleString()," L"]}),(0,s.jsxs)(c.TableCell,{className:"text-right font-medium",children:[Number(e.current_stock).toLocaleString()," L"]}),(0,s.jsxs)(c.TableCell,{className:"text-right text-green-600",children:["+",Number(e.total_received).toLocaleString()]}),(0,s.jsxs)(c.TableCell,{className:"text-right text-yellow-600",children:["+",Number(e.total_adjusted_in).toLocaleString()," / -",Number(e.total_adjusted_out).toLocaleString()]}),(0,s.jsx)(c.TableCell,{className:"text-right text-blue-600",children:Number(e.total_sold).toLocaleString()}),(0,s.jsxs)(c.TableCell,{className:"text-right text-purple-600",children:["+",Number(e.total_transferred_in).toLocaleString()," / -",Number(e.total_transferred_out).toLocaleString()]})]},e.tank_id))})]})})]})]}),R.length>0&&(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"Recent Stock Movements"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"Date"}),(0,s.jsx)(c.TableHead,{children:"Tank"}),(0,s.jsx)(c.TableHead,{children:"Type"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Quantity"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Before"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"After"}),(0,s.jsx)(c.TableHead,{children:"Reason"}),(0,s.jsx)(c.TableHead,{children:"KRA Status"})]})}),(0,s.jsx)(c.TableBody,{children:R.slice(0,20).map(e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{className:"text-sm",children:Y(e.created_at)}),(0,s.jsx)(c.TableCell,{className:"font-medium",children:e.tank_name}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(k.Badge,{className:W(e.adjustment_type),children:e.adjustment_type.replace(/_/g," ")})}),(0,s.jsxs)(c.TableCell,{className:`text-right font-medium ${e.quantity>=0?"text-green-600":"text-red-600"}`,children:[e.quantity>=0?"+":"",Number(e.quantity).toLocaleString()]}),(0,s.jsx)(c.TableCell,{className:"text-right",children:Number(e.previous_stock).toLocaleString()}),(0,s.jsx)(c.TableCell,{className:"text-right",children:Number(e.new_stock).toLocaleString()}),(0,s.jsx)(c.TableCell,{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:e.reason||"-"}),(0,s.jsx)(c.TableCell,{children:"synced"===e.kra_sync_status?(0,s.jsx)(k.Badge,{className:"bg-green-100 text-green-800",children:"Synced"}):"failed"===e.kra_sync_status?(0,s.jsx)(k.Badge,{className:"bg-red-100 text-red-800",children:"Failed"}):(0,s.jsx)(k.Badge,{className:"bg-gray-100 text-gray-600",children:"Pending"})})]},e.id))})]})})})]})]}),("stockIn"===e||"stockOut"===e)&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(n.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>t("cards"),children:" Back to Overview"}),(0,s.jsxs)(n.Button,{variant:"outline",className:"rounded-xl",onClick:K,disabled:V,children:[(0,s.jsx)(p.RefreshCw,{className:`h-4 w-4 mr-2 ${V?"animate-spin":""}`}),"Refresh"]})]}),(0,s.jsxs)(l.Card,{className:"rounded-2xl",children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{children:"stockIn"===e?"Stock In History":"Stock Out History"})}),(0,s.jsxs)(l.CardContent,{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"w-64",children:[(0,s.jsx)(d.Label,{children:"Branch"}),(0,s.jsxs)(b.Select,{value:P,onValueChange:E,children:[(0,s.jsx)(b.SelectTrigger,{className:"rounded-xl",children:(0,s.jsx)(b.SelectValue,{placeholder:"Select branch"})}),(0,s.jsx)(b.SelectContent,{children:L.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(d.Label,{children:"Search"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(i.Input,{placeholder:"Search by tank or reason...",value:r,onChange:e=>h(e.target.value),className:"pl-9 rounded-xl"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"Start Date"}),(0,s.jsx)(i.Input,{type:"date",value:N,onChange:e=>y(e.target.value),className:"rounded-xl w-48"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Label,{children:"End Date"}),(0,s.jsx)(i.Input,{type:"date",value:v,onChange:e=>_(e.target.value),className:"rounded-xl w-48"})]})]}),V?(0,s.jsx)("div",{className:"text-center py-8",children:"Loading..."}):(0,s.jsx)("div",{className:"rounded-xl border overflow-hidden",children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHeader,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableHead,{children:"Date"}),(0,s.jsx)(c.TableHead,{children:"Tank"}),(0,s.jsx)(c.TableHead,{children:"Fuel Type"}),(0,s.jsx)(c.TableHead,{children:"Type"}),(0,s.jsx)(c.TableHead,{className:"text-right",children:"Quantity"}),(0,s.jsx)(c.TableHead,{children:"Reason"}),(0,s.jsx)(c.TableHead,{children:"KRA Status"})]})}),(0,s.jsxs)(c.TableBody,{children:[("stockIn"===e?Q:G).filter(e=>""===r||e.tank_name?.toLowerCase().includes(r.toLowerCase())||e.reason?.toLowerCase().includes(r.toLowerCase())).map(a=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{className:"text-sm",children:Y(a.created_at)}),(0,s.jsx)(c.TableCell,{className:"font-medium",children:a.tank_name}),(0,s.jsx)(c.TableCell,{children:a.fuel_type}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(k.Badge,{className:W(a.adjustment_type),children:a.adjustment_type.replace(/_/g," ")})}),(0,s.jsxs)(c.TableCell,{className:`text-right font-medium ${"stockIn"===e?"text-green-600":"text-red-600"}`,children:["stockIn"===e?"+":"-",Math.abs(Number(a.quantity)).toLocaleString()," L"]}),(0,s.jsx)(c.TableCell,{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:a.reason||"-"}),(0,s.jsx)(c.TableCell,{children:"synced"===a.kra_sync_status?(0,s.jsx)(k.Badge,{className:"bg-green-100 text-green-800",children:"Synced"}):"failed"===a.kra_sync_status?(0,s.jsx)(k.Badge,{className:"bg-red-100 text-red-800",children:"Failed"}):(0,s.jsx)(k.Badge,{className:"bg-gray-100 text-gray-600",children:"Pending"})})]},a.id)),0===("stockIn"===e?Q:G).length&&(0,s.jsx)(c.TableRow,{children:(0,s.jsx)(c.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:P?"No stock movements found":"Select a branch to view history"})})]})]})})]})]})]}),"tankManagement"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)(n.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>t("cards"),children:" Back to Overview"})}),(0,s.jsx)(S,{branchId:P})]}),"dispenserManagement"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)(n.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>t("cards"),children:" Back to Overview"})}),(0,s.jsx)(B,{branchId:P})]}),"nozzleManagement"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)(n.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>t("cards"),children:" Back to Overview"})}),(0,s.jsx)(z,{branchId:P})]}),"itemPricing"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)(n.Button,{variant:"outline",className:"rounded-xl bg-transparent",onClick:()=>t("cards"),children:" Back to Overview"})}),(0,s.jsx)(F,{})]})]})}function A(){let[e,n]=(0,a.useState)(!1),[l,i]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"flex min-h-screen w-full overflow-x-hidden bg-gradient-to-b from-slate-900 via-blue-900 to-white",children:[(0,s.jsx)(t.DashboardSidebar,{collapsed:e,onToggle:()=>n(!e),mobileOpen:l,onMobileClose:()=>i(!1)}),(0,s.jsx)("div",{className:"flex-1 flex flex-col min-w-0 lg:ml-8 my-2 lg:my-6 mx-2 lg:mr-6",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl lg:rounded-tl-3xl shadow-2xl flex-1 flex flex-col overflow-hidden",children:[(0,s.jsx)(r.DashboardHeader,{onMobileMenuToggle:()=>i(!l)}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden bg-slate-50 p-3 md:p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-7xl mx-auto space-y-4 md:space-y-6",children:[(0,s.jsx)(E,{}),(0,s.jsxs)("footer",{className:"mt-12 border-t pt-6 pb-4 text-center text-sm text-muted-foreground",children:["Powered by ",(0,s.jsx)("span",{className:"font-semibold text-foreground",children:"Sensile Technologies East Africa Ltd"})]})]})})]})})]})}e.s(["default",()=>A],20800)}]);